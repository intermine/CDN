(function(){var root=this;var context={};var define=function(name,deps,f){context[name]=f()};define.amd={jQuery:true};context.document=root.document;context.location=root.location;(function(){(function(window,undefined){var rootjQuery,readyList,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="2.0.3",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()},completed=function(){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false);jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem;if(!selector){return this}if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else if(jQuery.isFunction(selector)){return rootjQuery.ready(selector)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(num){return num==null?this.toArray():num<0?this[this.length+num]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){jQuery.ready.promise().done(fn);return this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready")}},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){if(obj==null){return String(obj)}return typeof obj==="object"||typeof obj==="function"?class2type[core_toString.call(obj)]||"object":typeof obj},isPlainObject:function(obj){if(jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}try{if(obj.constructor&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}return true},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},error:function(msg){throw new Error(msg)},parseHTML:function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts);if(scripts){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)},parseJSON:JSON.parse,parseXML:function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{tmp=new DOMParser;xml=tmp.parseFromString(data,"text/xml")}catch(e){xml=undefined}if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml},noop:function(){},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code);if(code){if(code.indexOf("use strict")===1){script=document.createElement("script");script.text=code;document.head.appendChild(script).parentNode.removeChild(script)}else{indirect(code)}}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray){for(;i<length;i++){value=callback.apply(obj[i],args);if(value===false){break}}}else{for(i in obj){value=callback.apply(obj[i],args);if(value===false){break}}}}else{if(isArray){for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}else{for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}}return obj},trim:function(text){return text==null?"":core_trim.call(text)},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArraylike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{core_push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){return arr==null?-1:core_indexOf.call(arr,elem,i)},merge:function(first,second){var l=second.length,i=first.length,j=0;if(typeof l==="number"){for(;j<l;j++){first[i++]=second[j]}}else{while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i])}}return ret},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}return core_concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=core_slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(core_slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},access:function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){jQuery.access(elems,fn,i,key[i],true,emptyGet,raw)}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<length;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:Date.now,swap:function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret}});jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready)}else{document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}}return readyList.promise(obj)};jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);if(jQuery.isWindow(obj)){return false}if(obj.nodeType===1&&length){return true}return type==="array"||type!=="function"&&(length===0||typeof length==="number"&&length>0&&length-1 in obj)}rootjQuery=jQuery(document);(function(window,undefined){var i,support,cachedruns,Expr,getText,isXML,compile,outermostContext,sortInput,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),hasDuplicate=false,sortOrder=function(a,b){if(a===b){hasDuplicate=true;return 0}return 0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i}}return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:([*^$|!~]?=)"+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+attributes.replace(3,8)+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rsibling=new RegExp(whitespace+"*[+~]"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];if(!selector||typeof selector!=="string"){return results}if((nodeType=context.nodeType)!==1&&nodeType!==9){return[]}if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector)){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType===9&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if(old=context.getAttribute("id")){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&context.parentNode||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+=" ")>Expr.cacheLength){delete cache[keys.shift()]}return cache[key]=value}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=attrs.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};support=Sizzle.support={};setDocument=Sizzle.setDocument=function(node){var doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);if(parent&&parent.attachEvent&&parent!==parent.top){parent.attachEvent("onbeforeunload",function(){setDocument()})}support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return!div.getElementsByTagName("*").length});support.getElementsByClassName=assert(function(div){div.innerHTML="<div class='a'></div><div class='a i'></div>";div.firstChild.className="i";return div.getElementsByClassName("i").length===2});support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!==strundefined&&documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(doc.querySelectorAll)){assert(function(div){div.innerHTML="<select><option selected=''></option></select>";if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}});assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("t","");if(div.querySelectorAll("[t^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if(support.matchesSelector=rnative.test(matches=docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));contains=rnative.test(docElem.contains)||docElem.compareDocumentPosition?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);if(compare){if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===doc||contains(preferredDoc,a)){return-1}if(b===doc||contains(preferredDoc,b)){return 1}return sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}return compare&4?-1:1}return a.compareDocumentPosition?-1:1}:function(a,b){var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(a===b){hasDuplicate=true;return 0}else if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val===undefined?support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null:val};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){for(;node=elem[i];i++){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+(match[7]+match[8]||match[3]==="odd")}else if(match[3]){Sizzle.error(match[0])}return match},PSEUDO:function(match){var excess,unquoted=!match[5]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null}if(match[3]&&match[4]!==undefined){match[2]=match[4]}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeName>"@"||elem.nodeType===3||elem.nodeType===4){return false}}return true},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()===elem.type)},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var data,cache,outerCache,dirkey=dirruns+" "+doneName;
if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((cache=outerCache[dir])&&cache[0]===dirkey){if((data=cache[1])===true||data===cachedruns){return data===true}}else{cache=outerCache[dir]=[dirkey];cache[1]=matcher(elem,context,xml)||cachedruns;if(cache[1]===true){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var matcherCachedRuns=0,bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=expandContext!=null,contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",expandContext&&context.parentNode||context),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1;if(outermost){outermostContext=context!==document&&context;cachedruns=matcherCachedRuns}for(;(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++]){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique;cachedruns=++matcherCachedRuns}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!group){group=tokenize(selector)}i=group.length;while(i--){cached=matcherFromTokens(group[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))}return cached};function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function select(selector,context,results,seed){var i,tokens,token,type,find,match=tokenize(selector);if(!seed){if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&context.parentNode||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}}compile(selector,match)(seed,context,!documentIsHTML,results,rsibling.test(selector));return results}support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return(val=elem.getAttributeNode(name))&&val.specified?val.value:elem[name]===true?name.toLowerCase():null}})}jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains})(window);var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(core_rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?optionsCache[options]||createOptions(options):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&type!=="string"){add(arg)}})})(arguments);if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!(list&&list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return!stack},fireWith:function(context,args){if(list&&(!fired||stack)){args=args||[];args=[context,args.slice?args.slice():args];if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[action+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?core_slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!--remaining){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});jQuery.support=function(support){var input=document.createElement("input"),fragment=document.createDocumentFragment(),div=document.createElement("div"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));if(!input.type){return support}input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;support.reliableMarginRight=true;support.boxSizingReliable=true;support.pixelPosition=false;input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t";input.setAttribute("checked","t");input.setAttribute("name","t");fragment.appendChild(input);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.focusinBubbles="onfocusin"in window;div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";jQuery(function(){var container,marginDiv,divReset="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",body=document.getElementsByTagName("body")[0];if(!body){return}container=document.createElement("div");container.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";body.appendChild(container).appendChild(div);div.innerHTML="";div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%";jQuery.swap(body,body.style.zoom!=null?{zoom:1}:{},function(){support.boxSizing=div.offsetWidth===4});if(window.getComputedStyle){support.pixelPosition=(window.getComputedStyle(div,null)||{}).top!=="1%";support.boxSizingReliable=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px";marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight)}body.removeChild(container)});return support}({});var data_user,data_priv,rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=jQuery.expando+Math.random()}Data.uid=1;Data.accepts=function(owner){return owner.nodeType?owner.nodeType===1||owner.nodeType===9:true};Data.prototype={key:function(owner){if(!Data.accepts(owner)){return 0}var descriptor={},unlock=owner[this.expando];if(!unlock){unlock=Data.uid++;try{descriptor[this.expando]={value:unlock};Object.defineProperties(owner,descriptor)}catch(e){descriptor[this.expando]=unlock;jQuery.extend(owner,descriptor)}}if(!this.cache[unlock]){this.cache[unlock]={}}return unlock},set:function(owner,data,value){var prop,unlock=this.key(owner),cache=this.cache[unlock];if(typeof data==="string"){cache[data]=value}else{if(jQuery.isEmptyObject(cache)){jQuery.extend(this.cache[unlock],data)}else{for(prop in data){cache[prop]=data[prop]}}}return cache},get:function(owner,key){var cache=this.cache[this.key(owner)];return key===undefined?cache:cache[key]},access:function(owner,key,value){var stored;if(key===undefined||key&&typeof key==="string"&&value===undefined){stored=this.get(owner,key);return stored!==undefined?stored:this.get(owner,jQuery.camelCase(key))}this.set(owner,key,value);return value!==undefined?value:key},remove:function(owner,key){var i,name,camel,unlock=this.key(owner),cache=this.cache[unlock];if(key===undefined){this.cache[unlock]={}}else{if(jQuery.isArray(key)){name=key.concat(key.map(jQuery.camelCase))}else{camel=jQuery.camelCase(key);if(key in cache){name=[key,camel]}else{name=camel;name=name in cache?[name]:name.match(core_rnotwhite)||[]}}i=name.length;while(i--){delete cache[name[i]]}}},hasData:function(owner){return!jQuery.isEmptyObject(this.cache[owner[this.expando]]||{})},discard:function(owner){if(owner[this.expando]){delete this.cache[owner[this.expando]]}}};data_user=new Data;data_priv=new Data;jQuery.extend({acceptData:Data.accepts,hasData:function(elem){return data_user.hasData(elem)||data_priv.hasData(elem)},data:function(elem,name,data){return data_user.access(elem,name,data)},removeData:function(elem,name){data_user.remove(elem,name)},_data:function(elem,name,data){return data_priv.access(elem,name,data)},_removeData:function(elem,name){data_priv.remove(elem,name)}});jQuery.fn.extend({data:function(key,value){var attrs,name,elem=this[0],i=0,data=null;if(key===undefined){if(this.length){data=data_user.get(elem);if(elem.nodeType===1&&!data_priv.get(elem,"hasDataAttrs")){attrs=elem.attributes;for(;i<attrs.length;i++){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}data_priv.set(elem,"hasDataAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){data_user.set(this,key)})}return jQuery.access(this,function(value){var data,camelKey=jQuery.camelCase(key);if(elem&&value===undefined){data=data_user.get(elem,key);if(data!==undefined){return data}data=data_user.get(elem,camelKey);if(data!==undefined){return data}data=dataAttr(elem,camelKey,undefined);if(data!==undefined){return data}return}this.each(function(){var data=data_user.get(this,camelKey);data_user.set(this,camelKey,value);if(key.indexOf("-")!==-1&&data!==undefined){data_user.set(this,key,value)}})},null,value,arguments.length>1,null,true)},removeData:function(key){return this.each(function(){data_user.remove(this,key)})}});function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?JSON.parse(data):data}catch(e){}data_user.set(elem,key,data)}else{data=undefined}}return data}jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=data_priv.get(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=data_priv.access(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return data_priv.get(elem,key)||data_priv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(elem,[type+"queue",key])})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=data_priv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var nodeHook,boolHook,rclass=/[\t\r\n\f]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})},addClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;while(clazz=classes[j++]){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}elem.className=jQuery.trim(cur)}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=arguments.length===0||typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;while(clazz=classes[j++]){while(cur.indexOf(" "+clazz+" ")>=0){cur=cur.replace(" "+clazz+" "," ")}}elem.className=value?jQuery.trim(cur):""}}}return this},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value)}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),classNames=value.match(core_rnotwhite)||[];while(className=classNames[i++]){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else if(type===core_strundefined||type==="boolean"){if(this.className){data_priv.set(this,"__className__",this.className)}this.className=this.className||value===false?"":data_priv.get(this,"__className__")||""}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true}}return false},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else if(typeof val==="number"){val+=""}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(jQuery(option).val(),values)>=0){optionSet=true}}if(!optionSet){elem.selectedIndex=-1}return values}}},attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute===core_strundefined){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name)}else if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+"");return value}}else if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(core_rnotwhite);if(attrNames&&elem.nodeType===1){while(name=attrNames[i++]){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){elem[propName]=false}elem.removeAttribute(name)}}},attrHooks:{type:{set:function(elem,value){if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){return hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value}else{return hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){return elem.hasAttribute("tabindex")||rfocusable.test(elem.nodeName)||elem.href?elem.tabIndex:-1}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else{elem.setAttribute(name,name)}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=jQuery.expr.attrHandle[name]||jQuery.find.attr;jQuery.expr.attrHandle[name]=function(elem,name,isXML){var fn=jQuery.expr.attrHandle[name],ret=isXML?undefined:(jQuery.expr.attrHandle[name]=undefined)!=getter(elem,name,isXML)?name.toLowerCase():null;jQuery.expr.attrHandle[name]=fn;return ret}});if(!jQuery.support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex}return null}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}}};if(!jQuery.support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.get(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!==core_strundefined&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined};eventHandle.elem=elem}types=(types||"").match(core_rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}elem=null},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.hasData(elem)&&data_priv.get(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(core_rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;data_priv.remove(elem,"events")}},trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=core_hasOwn.call(event,"type")?event.type:event,namespaces=core_hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};
if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(data_priv.get(cur,"events")||{})[event.type]&&data_priv.get(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===false){event.preventDefault()}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&jQuery.acceptData(elem)){if(ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=core_slice.call(arguments),handlers=(data_priv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=="click")){for(;cur!==this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.which&&button!==undefined){event.which=button&1?1:button&2?3:button&4?2:0}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=document}if(event.target.nodeType===3){event.target=event.target.parentNode}return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input")){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined){event.originalEvent.returnValue=event.result}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.getPreventDefault&&src.getPreventDefault()?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&e.preventDefault){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true)}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return this}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});var isSimple=/^.[^:#\[\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true}}})},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){cur=matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof elem==="string"){return core_indexOf.call(jQuery(elem),this[0])}return core_indexOf.call(this,elem.jquery?elem[0]:elem)},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(jQuery.unique(all))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched)}if(this.length>1){if(!guaranteedUnique[name]){jQuery.unique(matched)}if(rparentsprev.test(name)){matched.reverse()}}return this.pushStack(matched)}});jQuery.extend({filter:function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))},dir:function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break}matched.push(elem)}}return matched},sibling:function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n)}}return matched}});function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return elem===qualifier!==not})}if(typeof qualifier==="string"){if(isSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return core_indexOf.call(qualifier,elem)>=0!==not})}var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++){if(!keepData&&elem.nodeType===1){jQuery.cleanData(getAll(elem))}if(elem.parentNode){if(keepData&&jQuery.contains(elem.ownerDocument,elem)){setGlobalEval(getAll(elem,"script"))}elem.parentNode.removeChild(elem)}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent=""}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var args=jQuery.map(this,function(elem){return[elem.nextSibling,elem.parentNode]}),i=0;this.domManip(arguments,function(elem){var next=args[i++],parent=args[i++];if(parent){if(next&&next.parentNode!==parent){next=this.nextSibling}jQuery(this).remove();parent.insertBefore(elem,next)}},true);return i?this:this.remove()},detach:function(selector){return this.remove(selector,true)},domManip:function(args,callback,allowIntersection){args=core_concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||!(l<=1||typeof value!=="string"||jQuery.support.checkClone||!rchecked.test(value))){return this.each(function(index){var self=set.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}self.domManip(args,callback,allowIntersection)})}if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,false,!allowIntersection&&this);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!data_priv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){jQuery._evalUrl(node.src)}else{jQuery.globalEval(node.textContent.replace(rcleanScript,""))}}}}}}return this}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);core_push.apply(ret,elems.get())}return this.pushStack(ret)}});jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=jQuery.contains(elem.ownerDocument,elem);if(!jQuery.support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i])}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}return clone},buildFragment:function(elems,context,scripts,selection){var elem,tmp,tag,wrap,contains,j,i=0,l=elems.length,fragment=context.createDocumentFragment(),nodes=[];for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent=""}}}fragment.textContent="";i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)!==-1){continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(fragment.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while(elem=tmp[j++]){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}return fragment},cleanData:function(elems){var data,elem,events,type,key,j,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(Data.accepts(elem)){key=elem[data_priv.expando];if(key&&(data=data_priv.cache[key])){events=Object.keys(data.events||{});if(events.length){for(j=0;(type=events[j])!==undefined;j++){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(data_priv.cache[key]){delete data_priv.cache[key]}}}delete data_user.cache[elem[data_user.expando]]}},_evalUrl:function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:false,global:false,"throws":true})}});function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType===1?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function setGlobalEval(elems,refElements){var l=elems.length,i=0;for(;i<l;i++){data_priv.set(elems[i],"globalEval",!refElements||data_priv.get(refElements[i],"globalEval"))}}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return}if(data_priv.hasData(src)){pdataOld=data_priv.access(src);pdataCur=data_priv.set(dest,pdataOld);events=pdataOld.events;if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}}if(data_user.hasData(src)){udataOld=data_user.access(src);udataCur=jQuery.extend({},udataOld);data_user.set(dest,udataCur)}}function getAll(context,tag){var ret=context.getElementsByTagName?context.getElementsByTagName(tag||"*"):context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&manipulation_rcheckableType.test(src.type)){dest.checked=src.checked}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}jQuery.fn.extend({wrapAll:function(html){var wrap;if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});var curCSS,iframe,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];function vendorPropName(style,name){if(name in style){return name}var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function isHidden(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)}function getStyles(elem){return window.getComputedStyle(elem,null)}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=data_priv.get(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=data_priv.access(elem,"olddisplay",css_defaultDisplay(elem.nodeName))}}else{if(!values[index]){hidden=isHidden(elem);if(display&&display!=="none"||!hidden){data_priv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{columnCount:true,fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":"cssFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||type==="number"&&isNaN(value)){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!jQuery.support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){style[name]=value}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||jQuery.isNumeric(num)?num||0:val}return val}});curCSS=function(elem,name,_computed){var width,minWidth,maxWidth,computed=_computed||getStyles(elem),ret=computed?computed.getPropertyValue(name)||computed[name]:undefined,style=elem.style;if(computed){if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret};function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function css_defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(doc.documentElement);doc=(iframe[0].contentWindow||iframe[0].contentDocument).document;doc.write("<!doctype html><html><body>");doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");elem.remove();return display}jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return elem.offsetWidth===0&&rdisplayswap.test(jQuery.css(elem,"display"))?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0)}}});jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){if(computed){return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}}}}if(!jQuery.support.pixelPosition&&jQuery.fn.position){jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}}}})}});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)}}jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;
jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!manipulation_rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(func)){while(dataType=dataTypes[i++]){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else if(seekingTransport){return!(selected=dataTypeOrTransport)}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=url.slice(off);url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==="object"){type="POST"}if(self.length>0){jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])})}return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(core_rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=s.url+=(ajax_rquery.test(cacheURL)?"&":"?")+s.data;delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+ajax_nonce++):cacheURL+(ajax_rquery.test(cacheURL)?"&":"?")+"_="+ajax_nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}return{state:"success",data:response}}jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET"}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({async:true,charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type)}});document.head.appendChild(script[0])},abort:function(){if(callback){callback()}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else if(s.jsonp!==false){s.url+=(ajax_rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrSupported=jQuery.ajaxSettings.xhr(),xhrSuccessStatus={0:200,1223:204},xhrId=0,xhrCallbacks={};if(window.ActiveXObject){jQuery(window).on("unload",function(){for(var key in xhrCallbacks){xhrCallbacks[key]()}xhrCallbacks=undefined})}jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;jQuery.support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback;if(jQuery.support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,id,xhr=options.xhr();xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){xhr.setRequestHeader(i,headers[i])}callback=function(type){return function(){if(callback){delete xhrCallbacks[id];callback=xhr.onload=xhr.onerror=null;if(type==="abort"){xhr.abort()}else if(type==="error"){complete(xhr.status||404,xhr.statusText)}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,typeof xhr.responseText==="string"?{text:xhr.responseText}:undefined,xhr.getAllResponseHeaders())}}}};xhr.onload=callback();xhr.onerror=callback("error");callback=xhrCallbacks[id=xhrId++]=callback("abort");xhr.send(options.hasContent&&options.data||null)},abort:function(){if(callback){callback()}}}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||unit!=="px"&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3];parts=parts||[];start=+target||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}if(parts){start=tween.start=+start||+target||0;tween.unit=unit;tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function createTween(value,prop,animation){var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(tween=collection[index].call(animation,prop,value)){return tween}}}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=data_priv.get(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];if(jQuery.css(elem,"display")==="inline"&&jQuery.css(elem,"float")==="none"){style.display="inline-block"}}if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden}}else{dataShow=data_priv.access(elem,"fxshow",{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;data_priv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||data_priv.get(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=data_priv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=data_priv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}};jQuery.timers=[];jQuery.fx=Tween.prototype.init;jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){if(timer()&&jQuery.timers.push(timer)){jQuery.fx.start()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fx.step={};if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length}}jQuery.fn.offset=function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==core_strundefined){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}};jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if("using"in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({position:function(){if(!this[0]){return}var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static"){offsetParent=offsetParent.offsetParent}return offsetParent||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?win[prop]:elem[method]}if(win){win.scrollTo(!top?val:window.pageXOffset,top?val:window.pageYOffset)}else{elem[method]=val}},method,val,arguments.length,null)}});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView}jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");
return jQuery.access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=jQuery}else{if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}}if(typeof window==="object"&&typeof window.document==="object"){window.jQuery=window.$=jQuery}})(window)}).call(context,context);context.jQuery=context.$=context.jquery;context.jquery.noConflict();(function(jQuery){var $=jQuery;(function($,undefined){var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{};$.extend($.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({focus:function(orig){return function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem)}},delay)}):orig.apply(this,arguments)}}($.fn.focus),scrollParent:function(){var scrollParent;if($.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))){scrollParent=this.parents().filter(function(){return/(relative|absolute|fixed)/.test($.css(this,"position"))&&/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0)}else{scrollParent=this.parents().filter(function(){return/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0)}return/fixed/.test(this.css("position"))||!scrollParent.length?$(document):scrollParent},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex)}if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value}}elem=elem.parent()}}return 0},uniqueId:function(){return this.each(function(){if(!this.id){this.id="ui-id-"+ ++uuid}})},removeUniqueId:function(){return this.each(function(){if(runiqueId.test(this.id)){$(this).removeAttr("id")}})}});function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false}img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img)}return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return $.css(this,"visibility")==="hidden"}).length}$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}});if(!$("<a>").outerWidth(1).jquery){$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0}if(margin){size-=parseFloat($.css(elem,"margin"+this))||0}});return size}$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this)}return this.each(function(){$(this).css(type,reduce(this,size)+"px")})};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size)}return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px")})}})}if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}}if($("<a>").data("a-b","a").removeData("a-b").data("a-b")){$.fn.removeData=function(removeData){return function(key){if(arguments.length){return removeData.call(this,$.camelCase(key))}else{return removeData.call(this)}}}($.fn.removeData)}$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.support.selectstart="onselectstart"in document.createElement("div");$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]])}},call:function(instance,name,args){var i,set=instance.plugins[name];if(!set||!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11){return}for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args)}}}},hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false}var scroll=a&&a==="left"?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true}el[scroll]=1;has=el[scroll]>0;el[scroll]=0;return has}})})(jQuery);(function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++){try{$(elem).triggerHandler("remove")}catch(e){}}_cleanData(elems)};$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget}$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element)}if(arguments.length){this._createWidget(options,element)}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base;basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return}proxiedPrototype[prop]=function(){var _super=function(){return base.prototype[prop].apply(this,arguments)},_superApply=function(args){return base.prototype[prop].apply(this,args)};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue}}()});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix||name:name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)});delete existingConstructor._childConstructors}else{base._childConstructors.push(constructor)}$.widget.bridge(name,constructor)};$.widget.extend=function(target){var input=slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value)}else{target[key]=value}}}}return target};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;if(isMethodCall){this.each(function(){var methodValue,instance=$.data(this,fullName);if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'")}if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance")}methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false}})}else{this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{})._init()}else{$.data(this,fullName,new object(options,this))}})}return returnValue}};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element){this.destroy()}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow)}this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var options=key,parts,curOption,i;if(arguments.length===0){return $.widget.extend({},this.options)}if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]]}key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key]}curOption[key]=value}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key]}options[key]=value}}this._setOptions(options);return this},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key])}return this},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false}if(!handlers){handlers=element;element=this.element;delegateElement=this.widget()}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element)}$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return}return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments)}if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++}var match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];if(selector){delegateElement.delegate(selector,eventName,handlerProxy)}else{element.bind(eventName,handlerProxy)}})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName)},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover")},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus")},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop]}}}this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented())}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options}}var hasOptions,effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options}}hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay)}if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options)}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback)}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0])}next()})}}})})(jQuery);(function($,undefined){var mouseHandled=false;$(document).mouseup(function(){mouseHandled=false});$.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event)}).bind("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)}},_mouseDown:function(event){if(mouseHandled){return}this._mouseStarted&&this._mouseUp(event);this._mouseDownEvent=event;var that=this,btnIsLeft=event.which===1,elIsCancel=typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false;if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(event)!==false;if(!this._mouseStarted){event.preventDefault();return true}}if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent")}this._mouseMoveDelegate=function(event){return that._mouseMove(event)};this._mouseUpDelegate=function(event){return that._mouseUp(event)};$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true},_mouseMove:function(event){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event)}if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault()}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(this._mouseDownEvent,event)!==false;this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)}return!this._mouseStarted},_mouseUp:function(event){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true)}this._mouseStop(event)}return false},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);(function($,undefined){$.widget("ui.draggable",$.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false,drag:null,start:null,stop:null},_create:function(){if(this.options.helper==="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))){this.element[0].style.position="relative"}if(this.options.addClasses){this.element.addClass("ui-draggable")}if(this.options.disabled){this.element.addClass("ui-draggable-disabled")}this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy()},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).closest(".ui-resizable-handle").length>0){return false}this.handle=this._getHandle(event);if(!this.handle){return false}$(o.iframeFix===true?"iframe":o.iframeFix).each(function(){$("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css($(this).offset()).appendTo("body")});return true},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();if($.ui.ddmanager){$.ui.ddmanager.current=this}this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offsetParent=this.helper.offsetParent();this.offsetParentCssPosition=this.offsetParent.css("position");this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.offset.scroll=false;$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt);this._setContainment();if(this._trigger("start",event)===false){this._clear();return false}this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event)}this._mouseDrag(event,true);if($.ui.ddmanager){$.ui.ddmanager.dragStart(this,event)}return true},_mouseDrag:function(event,noPropagation){if(this.offsetParentCssPosition==="fixed"){this.offset.parent=this._getParentOffset()}this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===false){this._mouseUp({});return false}this.position=ui.position}if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px"}if($.ui.ddmanager){$.ui.ddmanager.drag(this,event)}return false},_mouseStop:function(event){var that=this,dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour){dropped=$.ui.ddmanager.drop(this,event)}if(this.dropped){dropped=this.dropped;this.dropped=false}if(this.options.helper==="original"&&!$.contains(this.element[0].ownerDocument,this.element[0])){return false}if(this.options.revert==="invalid"&&!dropped||this.options.revert==="valid"&&dropped||this.options.revert===true||$.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped)){$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(that._trigger("stop",event)!==false){that._clear()}})}else{if(this._trigger("stop",event)!==false){this._clear()}}return false},_mouseUp:function(event){$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});if($.ui.ddmanager){$.ui.ddmanager.dragStop(this,event)}return $.ui.mouse.prototype._mouseUp.call(this,event)},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({})}else{this._clear()}return this},_getHandle:function(event){return this.options.handle?!!$(event.target).closest(this.element.find(this.options.handle)).length:true},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):o.helper==="clone"?this.element.clone().removeAttr("id"):this.element;if(!helper.parents("body").length){helper.appendTo(o.appendTo==="parent"?this.element[0].parentNode:o.appendTo)}if(helper[0]!==this.element[0]&&!/(fixed|absolute)/.test(helper.css("position"))){helper.css("position","absolute")}return helper},_adjustOffsetFromHelper:function(obj){if(typeof obj==="string"){obj=obj.split(" ")}if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0}}if("left"in obj){this.offset.click.left=obj.left+this.margins.left}if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left}if("top"in obj){this.offset.click.top=obj.top+this.margins.top}if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top}},_getParentOffset:function(){var po=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&$.ui.ie){po={top:0,left:0}}return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var over,c,ce,o=this.options;if(!o.containment){this.containment=null;return}if(o.containment==="window"){this.containment=[$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,$(window).scrollLeft()+$(window).width()-this.helperProportions.width-this.margins.left,$(window).scrollTop()+($(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(o.containment==="document"){this.containment=[0,0,$(document).width()-this.helperProportions.width-this.margins.left,($(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(o.containment.constructor===Array){this.containment=o.containment;return}if(o.containment==="parent"){o.containment=this.helper[0].parentNode}c=$(o.containment);ce=c[0];if(!ce){return}over=c.css("overflow")!=="hidden";this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=c},_convertPositionTo:function(d,pos){if(!pos){pos=this.position}var mod=d==="absolute"?1:-1,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent;if(!this.offset.scroll){this.offset.scroll={top:scroll.scrollTop(),left:scroll.scrollLeft()}}return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():this.offset.scroll.top)*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():this.offset.scroll.left)*mod}},_generatePosition:function(event){var containment,co,top,left,o=this.options,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,pageX=event.pageX,pageY=event.pageY;if(!this.offset.scroll){this.offset.scroll={top:scroll.scrollTop(),left:scroll.scrollLeft()}}if(this.originalPosition){if(this.containment){if(this.relative_container){co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top]}else{containment=this.containment}if(event.pageX-this.offset.click.left<containment[0]){pageX=containment[0]+this.offset.click.left}if(event.pageY-this.offset.click.top<containment[1]){pageY=containment[1]+this.offset.click.top}if(event.pageX-this.offset.click.left>containment[2]){pageX=containment[2]+this.offset.click.left}if(event.pageY-this.offset.click.top>containment[3]){pageY=containment[3]+this.offset.click.top}}if(o.grid){top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?top-this.offset.click.top>=containment[1]||top-this.offset.click.top>containment[3]?top:top-this.offset.click.top>=containment[1]?top-o.grid[1]:top+o.grid[1]:top;left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?left-this.offset.click.left>=containment[0]||left-this.offset.click.left>containment[2]?left:left-this.offset.click.left>=containment[0]?left-o.grid[0]:left+o.grid[0]:left}}return{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():this.offset.scroll.top),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval){this.helper.remove()}this.helper=null;this.cancelHelperRemoval=false},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui]);if(type==="drag"){this.positionAbs=this._convertPositionTo("absolute")}return $.Widget.prototype._trigger.call(this,type,event,ui)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("ui-draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[];$(o.connectToSortable).each(function(){var sortable=$.data(this,"ui-sortable");if(sortable&&!sortable.options.disabled){inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert});sortable.refreshPositions();sortable._trigger("activate",event,uiSortable)}})},stop:function(event,ui){var inst=$(this).data("ui-draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;inst.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert){this.instance.options.revert=this.shouldRevert}this.instance._mouseStop(event);this.instance.options.helper=this.instance.options._helper;if(inst.options.helper==="original"){this.instance.currentItem.css({top:"auto",left:"auto"})}}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",event,uiSortable)}})},drag:function(event,ui){var inst=$(this).data("ui-draggable"),that=this;$.each(inst.sortables,function(){var innermostIntersecting=false,thisSortable=this;this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){innermostIntersecting=true;$.each(inst.sortables,function(){this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this!==thisSortable&&this.instance._intersectsWith(this.instance.containerCache)&&$.contains(thisSortable.instance.element[0],this.instance.element[0])){innermostIntersecting=false}return innermostIntersecting})}if(innermostIntersecting){if(!this.instance.isOver){this.instance.isOver=1;
this.instance.currentItem=$(that).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return ui.helper[0]};event.target=this.instance.currentItem[0];this.instance._mouseCapture(event,true);this.instance._mouseStart(event,true,true);this.instance.offset.click.top=inst.offset.click.top;this.instance.offset.click.left=inst.offset.click.left;this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top;inst._trigger("toSortable",event);inst.dropped=this.instance.element;inst.currentItem=inst.element;this.instance.fromOutside=inst}if(this.instance.currentItem){this.instance._mouseDrag(event)}}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",event,this.instance._uiHash(this.instance));this.instance._mouseStop(event,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder){this.instance.placeholder.remove()}inst._trigger("fromSortable",event);inst.dropped=false}}})}});$.ui.plugin.add("draggable","cursor",{start:function(){var t=$("body"),o=$(this).data("ui-draggable").options;if(t.css("cursor")){o._cursor=t.css("cursor")}t.css("cursor",o.cursor)},stop:function(){var o=$(this).data("ui-draggable").options;if(o._cursor){$("body").css("cursor",o._cursor)}}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("ui-draggable").options;if(t.css("opacity")){o._opacity=t.css("opacity")}t.css("opacity",o.opacity)},stop:function(event,ui){var o=$(this).data("ui-draggable").options;if(o._opacity){$(ui.helper).css("opacity",o._opacity)}}});$.ui.plugin.add("draggable","scroll",{start:function(){var i=$(this).data("ui-draggable");if(i.scrollParent[0]!==document&&i.scrollParent[0].tagName!=="HTML"){i.overflowOffset=i.scrollParent.offset()}},drag:function(event){var i=$(this).data("ui-draggable"),o=i.options,scrolled=false;if(i.scrollParent[0]!==document&&i.scrollParent[0].tagName!=="HTML"){if(!o.axis||o.axis!=="x"){if(i.overflowOffset.top+i.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity){i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed}else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity){i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed}}if(!o.axis||o.axis!=="y"){if(i.overflowOffset.left+i.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity){i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed}else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity){i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed}}}else{if(!o.axis||o.axis!=="x"){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed)}else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed)}}if(!o.axis||o.axis!=="y"){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed)}else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed)}}}if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(i,event)}}});$.ui.plugin.add("draggable","snap",{start:function(){var i=$(this).data("ui-draggable"),o=i.options;i.snapElements=[];$(o.snap.constructor!==String?o.snap.items||":data(ui-draggable)":o.snap).each(function(){var $t=$(this),$o=$t.offset();if(this!==i.element[0]){i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left})}})},drag:function(event,ui){var ts,bs,ls,rs,l,r,t,b,i,first,inst=$(this).data("ui-draggable"),o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(i=inst.snapElements.length-1;i>=0;i--){l=inst.snapElements[i].left;r=l+inst.snapElements[i].width;t=inst.snapElements[i].top;b=t+inst.snapElements[i].height;if(x2<l-d||x1>r+d||y2<t-d||y1>b+d||!$.contains(inst.snapElements[i].item.ownerDocument,inst.snapElements[i].item)){if(inst.snapElements[i].snapping){inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item}))}inst.snapElements[i].snapping=false;continue}if(o.snapMode!=="inner"){ts=Math.abs(t-y2)<=d;bs=Math.abs(b-y1)<=d;ls=Math.abs(l-x2)<=d;rs=Math.abs(r-x1)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top}if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top}if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left}if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left}}first=ts||bs||ls||rs;if(o.snapMode!=="outer"){ts=Math.abs(t-y1)<=d;bs=Math.abs(b-y2)<=d;ls=Math.abs(l-x1)<=d;rs=Math.abs(r-x2)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top}if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top}if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left}if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left}}if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)){inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item}))}inst.snapElements[i].snapping=ts||bs||ls||rs||first}}});$.ui.plugin.add("draggable","stack",{start:function(){var min,o=this.data("ui-draggable").options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0)});if(!group.length){return}min=parseInt($(group[0]).css("zIndex"),10)||0;$(group).each(function(i){$(this).css("zIndex",min+i)});this.css("zIndex",min+group.length)}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("ui-draggable").options;if(t.css("zIndex")){o._zIndex=t.css("zIndex")}t.css("zIndex",o.zIndex)},stop:function(event,ui){var o=$(this).data("ui-draggable").options;if(o._zIndex){$(ui.helper).css("zIndex",o._zIndex)}}})})(jQuery);(function($,undefined){function isOverAxis(x,reference,size){return x>reference&&x<reference+size}$.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var proportions,o=this.options,accept=o.accept;this.isover=false;this.isout=true;this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept)};this.proportions=function(){if(arguments.length){proportions=arguments[0]}else{return proportions?proportions:proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}}};$.ui.ddmanager.droppables[o.scope]=$.ui.ddmanager.droppables[o.scope]||[];$.ui.ddmanager.droppables[o.scope].push(this);o.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){var i=0,drop=$.ui.ddmanager.droppables[this.options.scope];for(;i<drop.length;i++){if(drop[i]===this){drop.splice(i,1)}}this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(key,value){if(key==="accept"){this.accept=$.isFunction(value)?value:function(d){return d.is(value)}}$.Widget.prototype._setOption.apply(this,arguments)},_activate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass){this.element.addClass(this.options.activeClass)}if(draggable){this._trigger("activate",event,this.ui(draggable))}},_deactivate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass){this.element.removeClass(this.options.activeClass)}if(draggable){this._trigger("deactivate",event,this.ui(draggable))}},_over:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return}if(this.accept.call(this.element[0],draggable.currentItem||draggable.element)){if(this.options.hoverClass){this.element.addClass(this.options.hoverClass)}this._trigger("over",event,this.ui(draggable))}},_out:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return}if(this.accept.call(this.element[0],draggable.currentItem||draggable.element)){if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass)}this._trigger("out",event,this.ui(draggable))}},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current,childrenIntersection=false;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return false}this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var inst=$.data(this,"ui-droppable");if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope===draggable.options.scope&&inst.accept.call(inst.element[0],draggable.currentItem||draggable.element)&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance)){childrenIntersection=true;return false}});if(childrenIntersection){return false}if(this.accept.call(this.element[0],draggable.currentItem||draggable.element)){if(this.options.activeClass){this.element.removeClass(this.options.activeClass)}if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass)}this._trigger("drop",event,this.ui(draggable));return this.element}return false},ui:function(c){return{draggable:c.currentItem||c.element,helper:c.helper,position:c.position,offset:c.positionAbs}}});$.ui.intersect=function(draggable,droppable,toleranceMode){if(!droppable.offset){return false}var draggableLeft,draggableTop,x1=(draggable.positionAbs||draggable.position.absolute).left,y1=(draggable.positionAbs||draggable.position.absolute).top,x2=x1+draggable.helperProportions.width,y2=y1+draggable.helperProportions.height,l=droppable.offset.left,t=droppable.offset.top,r=l+droppable.proportions().width,b=t+droppable.proportions().height;switch(toleranceMode){case"fit":return l<=x1&&x2<=r&&t<=y1&&y2<=b;case"intersect":return l<x1+draggable.helperProportions.width/2&&x2-draggable.helperProportions.width/2<r&&t<y1+draggable.helperProportions.height/2&&y2-draggable.helperProportions.height/2<b;case"pointer":draggableLeft=(draggable.positionAbs||draggable.position.absolute).left+(draggable.clickOffset||draggable.offset.click).left;draggableTop=(draggable.positionAbs||draggable.position.absolute).top+(draggable.clickOffset||draggable.offset.click).top;return isOverAxis(draggableTop,t,droppable.proportions().height)&&isOverAxis(draggableLeft,l,droppable.proportions().width);case"touch":return(y1>=t&&y1<=b||y2>=t&&y2<=b||y1<t&&y2>b)&&(x1>=l&&x1<=r||x2>=l&&x2<=r||x1<l&&x2>r);default:return false}};$.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,event){var i,j,m=$.ui.ddmanager.droppables[t.options.scope]||[],type=event?event.type:null,list=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();droppablesLoop:for(i=0;i<m.length;i++){if(m[i].options.disabled||t&&!m[i].accept.call(m[i].element[0],t.currentItem||t.element)){continue}for(j=0;j<list.length;j++){if(list[j]===m[i].element[0]){m[i].proportions().height=0;continue droppablesLoop}}m[i].visible=m[i].element.css("display")!=="none";if(!m[i].visible){continue}if(type==="mousedown"){m[i]._activate.call(m[i],event)}m[i].offset=m[i].element.offset();m[i].proportions({width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight})}},drop:function(draggable,event){var dropped=false;$.each(($.ui.ddmanager.droppables[draggable.options.scope]||[]).slice(),function(){if(!this.options){return}if(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance)){dropped=this._drop.call(this,event)||dropped}if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)){this.isout=true;this.isover=false;this._deactivate.call(this,event)}});return dropped},dragStart:function(draggable,event){draggable.element.parentsUntil("body").bind("scroll.droppable",function(){if(!draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event)}})},drag:function(draggable,event){if(draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event)}$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible){return}var parentInstance,scope,parent,intersects=$.ui.intersect(draggable,this,this.options.tolerance),c=!intersects&&this.isover?"isout":intersects&&!this.isover?"isover":null;if(!c){return}if(this.options.greedy){scope=this.options.scope;parent=this.element.parents(":data(ui-droppable)").filter(function(){return $.data(this,"ui-droppable").options.scope===scope});if(parent.length){parentInstance=$.data(parent[0],"ui-droppable");parentInstance.greedyChild=c==="isover"}}if(parentInstance&&c==="isover"){parentInstance.isover=false;parentInstance.isout=true;parentInstance._out.call(parentInstance,event)}this[c]=true;this[c==="isout"?"isover":"isout"]=false;this[c==="isover"?"_over":"_out"].call(this,event);if(parentInstance&&c==="isout"){parentInstance.isout=false;parentInstance.isover=true;parentInstance._over.call(parentInstance,event)}})},dragStop:function(draggable,event){draggable.element.parentsUntil("body").unbind("scroll.droppable");if(!draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event)}}}})(jQuery);(function($,undefined){$.ui=$.ui||{};var cachedScrollbarWidth,max=Math.max,abs=Math.abs,round=Math.round,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)]}function parseCss(element,property){return parseInt($.css(element,property),10)||0}function getDimensions(elem){var raw=elem[0];if(raw.nodeType===9){return{width:elem.width(),height:elem.height(),offset:{top:0,left:0}}}if($.isWindow(raw)){return{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}}}if(raw.preventDefault){return{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}}}return{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()}}$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth}var w1,w2,div=$("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth}div.remove();return cachedScrollbarWidth=w1-w2},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||overflowX==="auto"&&within.width<within.element[0].scrollWidth,hasOverflowY=overflowY==="scroll"||overflowY==="auto"&&within.height<within.element[0].scrollHeight;return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0}},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&withinElement[0].nodeType===9;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:withinElement.offset()||{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:isWindow?withinElement.width():withinElement.outerWidth(),height:isWindow?withinElement.height():withinElement.outerHeight()}}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments)}options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);if(target[0].preventDefault){options.at="left top"}targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"]}pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]]});if(collision.length===1){collision[1]=collision[0]}if(options.at[0]==="right"){basePosition.left+=targetWidth}else if(options.at[0]==="center"){basePosition.left+=targetWidth/2}if(options.at[1]==="bottom"){basePosition.top+=targetHeight}else if(options.at[1]==="center"){basePosition.top+=targetHeight/2}atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth}else if(options.my[0]==="center"){position.left-=elemWidth/2}if(options.my[1]==="bottom"){position.top-=elemHeight}else if(options.my[1]==="center"){position.top-=elemHeight/2}position.left+=myOffset[0];position.top+=myOffset[1];if(!$.support.offsetFractions){position.left=round(position.left);position.top=round(position.top)}collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem})}});if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center"}if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle"}if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal"}else{feedback.important="vertical"}options.using.call(this,props,feedback)}}elem.offset($.extend(position,{using:using}))})};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight}else if(overRight>0&&overLeft<=0){position.left=withinOffset}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth}else{position.left=withinOffset}}}else if(overLeft>0){position.left+=overLeft}else if(overRight>0){position.left-=overRight}else{position.left=max(position.left-collisionPosLeft,position.left)}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom}else if(overBottom>0&&overTop<=0){position.top=withinOffset}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight}else{position.top=withinOffset}}}else if(overTop>0){position.top+=overTop}else if(overBottom>0){position.top-=overBottom}else{position.top=max(position.top-collisionPosTop,position.top)}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset}}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;if(position.top+myOffset+atOffset+offset>overTop&&(newOverBottom<0||newOverBottom<abs(overTop))){position.top+=myOffset+atOffset+offset}}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;if(position.top+myOffset+atOffset+offset>overBottom&&(newOverTop>0||abs(newOverTop)<overBottom)){position.top+=myOffset+atOffset+offset}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments)},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments)}}};(function(){var testElement,testElementParent,testElementStyle,offsetLeft,i,body=document.getElementsByTagName("body")[0],div=document.createElement("div");testElement=document.createElement(body?"div":"body");testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(body){$.extend(testElementStyle,{position:"absolute",left:"-1000px",top:"-1000px"})}for(i in testElementStyle){testElement.style[i]=testElementStyle[i]}testElement.appendChild(div);testElementParent=body||document.documentElement;testElementParent.insertBefore(testElement,testElementParent.firstChild);div.style.cssText="position: absolute; left: 10.7432222px;";offsetLeft=$(div).offset().left;$.support.offsetFractions=offsetLeft>10&&offsetLeft<11;testElement.innerHTML="";testElementParent.removeChild(testElement)})()})(jQuery);(function($,undefined){$.widget("ui.selectable",$.ui.mouse,{version:"1.10.4",options:{appendTo:"body",autoRefresh:true,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var selectees,that=this;this.element.addClass("ui-selectable");this.dragged=false;this.refresh=function(){selectees=$(that.options.filter,that.element[0]);selectees.addClass("ui-selectee");selectees.each(function(){var $this=$(this),pos=$this.offset();$.data(this,"selectable-item",{element:this,$element:$this,left:pos.left,top:pos.top,right:pos.left+$this.outerWidth(),bottom:pos.top+$this.outerHeight(),startselected:false,selected:$this.hasClass("ui-selected"),selecting:$this.hasClass("ui-selecting"),unselecting:$this.hasClass("ui-unselecting")})})};this.refresh();this.selectees=selectees.addClass("ui-selectee");this._mouseInit();this.helper=$("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled");this._mouseDestroy()},_mouseStart:function(event){var that=this,options=this.options;this.opos=[event.pageX,event.pageY];if(this.options.disabled){return}this.selectees=$(options.filter,this.element[0]);this._trigger("start",event);$(options.appendTo).append(this.helper);this.helper.css({left:event.pageX,top:event.pageY,width:0,height:0});if(options.autoRefresh){this.refresh()}this.selectees.filter(".ui-selected").each(function(){var selectee=$.data(this,"selectable-item");selectee.startselected=true;if(!event.metaKey&&!event.ctrlKey){selectee.$element.removeClass("ui-selected");selectee.selected=false;selectee.$element.addClass("ui-unselecting");selectee.unselecting=true;that._trigger("unselecting",event,{unselecting:selectee.element})}});$(event.target).parents().addBack().each(function(){var doSelect,selectee=$.data(this,"selectable-item");if(selectee){doSelect=!event.metaKey&&!event.ctrlKey||!selectee.$element.hasClass("ui-selected");selectee.$element.removeClass(doSelect?"ui-unselecting":"ui-selected").addClass(doSelect?"ui-selecting":"ui-unselecting");selectee.unselecting=!doSelect;selectee.selecting=doSelect;selectee.selected=doSelect;if(doSelect){that._trigger("selecting",event,{selecting:selectee.element})}else{that._trigger("unselecting",event,{unselecting:selectee.element})}return false}})},_mouseDrag:function(event){this.dragged=true;if(this.options.disabled){return}var tmp,that=this,options=this.options,x1=this.opos[0],y1=this.opos[1],x2=event.pageX,y2=event.pageY;if(x1>x2){tmp=x2;x2=x1;x1=tmp}if(y1>y2){tmp=y2;y2=y1;y1=tmp}this.helper.css({left:x1,top:y1,width:x2-x1,height:y2-y1});this.selectees.each(function(){var selectee=$.data(this,"selectable-item"),hit=false;if(!selectee||selectee.element===that.element[0]){return}if(options.tolerance==="touch"){hit=!(selectee.left>x2||selectee.right<x1||selectee.top>y2||selectee.bottom<y1)}else if(options.tolerance==="fit"){hit=selectee.left>x1&&selectee.right<x2&&selectee.top>y1&&selectee.bottom<y2}if(hit){if(selectee.selected){selectee.$element.removeClass("ui-selected");selectee.selected=false}if(selectee.unselecting){selectee.$element.removeClass("ui-unselecting");selectee.unselecting=false}if(!selectee.selecting){selectee.$element.addClass("ui-selecting");selectee.selecting=true;that._trigger("selecting",event,{selecting:selectee.element})}}else{if(selectee.selecting){if((event.metaKey||event.ctrlKey)&&selectee.startselected){selectee.$element.removeClass("ui-selecting");selectee.selecting=false;selectee.$element.addClass("ui-selected");selectee.selected=true}else{selectee.$element.removeClass("ui-selecting");selectee.selecting=false;if(selectee.startselected){selectee.$element.addClass("ui-unselecting");selectee.unselecting=true}that._trigger("unselecting",event,{unselecting:selectee.element})}}if(selectee.selected){if(!event.metaKey&&!event.ctrlKey&&!selectee.startselected){selectee.$element.removeClass("ui-selected");selectee.selected=false;selectee.$element.addClass("ui-unselecting");selectee.unselecting=true;that._trigger("unselecting",event,{unselecting:selectee.element})}}}});return false},_mouseStop:function(event){var that=this;this.dragged=false;$(".ui-unselecting",this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass("ui-unselecting");selectee.unselecting=false;selectee.startselected=false;that._trigger("unselected",event,{unselected:selectee.element})});$(".ui-selecting",this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass("ui-selecting").addClass("ui-selected");selectee.selecting=false;selectee.selected=true;selectee.startselected=true;that._trigger("selected",event,{selected:selectee.element})});this._trigger("stop",event);this.helper.remove();return false}})})(jQuery);(function($,undefined){var numPages=5;$.widget("ui.slider",$.ui.mouse,{version:"1.10.4",widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider"+" ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all");this._refresh();this._setOption("disabled",this.options.disabled);this._animateOff=false},_refresh:function(){this._createRange();this._createHandles();this._setupEvents();this._refreshValue()},_createHandles:function(){var i,handleCount,options=this.options,existingHandles=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),handle="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",handles=[];handleCount=options.values&&options.values.length||1;if(existingHandles.length>handleCount){existingHandles.slice(handleCount).remove();existingHandles=existingHandles.slice(0,handleCount)}for(i=existingHandles.length;i<handleCount;i++){handles.push(handle)}this.handles=existingHandles.add($(handles.join("")).appendTo(this.element));this.handle=this.handles.eq(0);this.handles.each(function(i){$(this).data("ui-slider-handle-index",i)})},_createRange:function(){var options=this.options,classes="";if(options.range){if(options.range===true){if(!options.values){options.values=[this._valueMin(),this._valueMin()]}else if(options.values.length&&options.values.length!==2){options.values=[options.values[0],options.values[0]]
}else if($.isArray(options.values)){options.values=options.values.slice(0)}}if(!this.range||!this.range.length){this.range=$("<div></div>").appendTo(this.element);classes="ui-slider-range"+" ui-widget-header ui-corner-all"}else{this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""})}this.range.addClass(classes+(options.range==="min"||options.range==="max"?" ui-slider-range-"+options.range:""))}else{if(this.range){this.range.remove()}this.range=null}},_setupEvents:function(){var elements=this.handles.add(this.range).filter("a");this._off(elements);this._on(elements,this._handleEvents);this._hoverable(elements);this._focusable(elements)},_destroy:function(){this.handles.remove();if(this.range){this.range.remove()}this.element.removeClass("ui-slider"+" ui-slider-horizontal"+" ui-slider-vertical"+" ui-widget"+" ui-widget-content"+" ui-corner-all");this._mouseDestroy()},_mouseCapture:function(event){var position,normValue,distance,closestHandle,index,allowed,offset,mouseOverHandle,that=this,o=this.options;if(o.disabled){return false}this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();position={x:event.pageX,y:event.pageY};normValue=this._normValueFromMouse(position);distance=this._valueMax()-this._valueMin()+1;this.handles.each(function(i){var thisDistance=Math.abs(normValue-that.values(i));if(distance>thisDistance||distance===thisDistance&&(i===that._lastChangedValue||that.values(i)===o.min)){distance=thisDistance;closestHandle=$(this);index=i}});allowed=this._start(event,index);if(allowed===false){return false}this._mouseSliding=true;this._handleIndex=index;closestHandle.addClass("ui-state-active").focus();offset=closestHandle.offset();mouseOverHandle=!$(event.target).parents().addBack().is(".ui-slider-handle");this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-closestHandle.width()/2,top:event.pageY-offset.top-closestHandle.height()/2-(parseInt(closestHandle.css("borderTopWidth"),10)||0)-(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+(parseInt(closestHandle.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(event,index,normValue)}this._animateOff=true;return true},_mouseStart:function(){return true},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);this._slide(event,this._handleIndex,normValue);return false},_mouseStop:function(event){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(event,this._handleIndex);this._change(event,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;if(this.orientation==="horizontal"){pixelTotal=this.elementSize.width;pixelMouse=position.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{pixelTotal=this.elementSize.height;pixelMouse=position.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}percentMouse=pixelMouse/pixelTotal;if(percentMouse>1){percentMouse=1}if(percentMouse<0){percentMouse=0}if(this.orientation==="vertical"){percentMouse=1-percentMouse}valueTotal=this._valueMax()-this._valueMin();valueMouse=this._valueMin()+percentMouse*valueTotal;return this._trimAlignValue(valueMouse)},_start:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values()}return this._trigger("start",event,uiHash)},_slide:function(event,index,newVal){var otherVal,newValues,allowed;if(this.options.values&&this.options.values.length){otherVal=this.values(index?0:1);if(this.options.values.length===2&&this.options.range===true&&(index===0&&newVal>otherVal||index===1&&newVal<otherVal)){newVal=otherVal}if(newVal!==this.values(index)){newValues=this.values();newValues[index]=newVal;allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal,values:newValues});otherVal=this.values(index?0:1);if(allowed!==false){this.values(index,newVal)}}}else{if(newVal!==this.value()){allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal});if(allowed!==false){this.value(newVal)}}}},_stop:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values()}this._trigger("stop",event,uiHash)},_change:function(event,index){if(!this._keySliding&&!this._mouseSliding){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values()}this._lastChangedValue=index;this._trigger("change",event,uiHash)}},value:function(newValue){if(arguments.length){this.options.value=this._trimAlignValue(newValue);this._refreshValue();this._change(null,0);return}return this._value()},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1){this.options.values[index]=this._trimAlignValue(newValue);this._refreshValue();this._change(null,index);return}if(arguments.length){if($.isArray(arguments[0])){vals=this.options.values;newValues=arguments[0];for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(newValues[i]);this._change(null,i)}this._refreshValue()}else{if(this.options.values&&this.options.values.length){return this._values(index)}else{return this.value()}}}else{return this._values()}},_setOption:function(key,value){var i,valsLength=0;if(key==="range"&&this.options.range===true){if(value==="min"){this.options.value=this._values(0);this.options.values=null}else if(value==="max"){this.options.value=this._values(this.options.values.length-1);this.options.values=null}}if($.isArray(this.options.values)){valsLength=this.options.values.length}$.Widget.prototype._setOption.apply(this,arguments);switch(key){case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(i=0;i<valsLength;i+=1){this._change(null,i)}this._animateOff=false;break;case"min":case"max":this._animateOff=true;this._refreshValue();this._animateOff=false;break;case"range":this._animateOff=true;this._refresh();this._animateOff=false;break}},_value:function(){var val=this.options.value;val=this._trimAlignValue(val);return val},_values:function(index){var val,vals,i;if(arguments.length){val=this.options.values[index];val=this._trimAlignValue(val);return val}else if(this.options.values&&this.options.values.length){vals=this.options.values.slice();for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(vals[i])}return vals}else{return[]}},_trimAlignValue:function(val){if(val<=this._valueMin()){return this._valueMin()}if(val>=this._valueMax()){return this._valueMax()}var step=this.options.step>0?this.options.step:1,valModStep=(val-this._valueMin())%step,alignValue=val-valModStep;if(Math.abs(valModStep)*2>=step){alignValue+=valModStep>0?step:-step}return parseFloat(alignValue.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var lastValPercent,valPercent,value,valueMin,valueMax,oRange=this.options.range,o=this.options,that=this,animate=!this._animateOff?o.animate:false,_set={};if(this.options.values&&this.options.values.length){this.handles.each(function(i){valPercent=(that.values(i)-that._valueMin())/(that._valueMax()-that._valueMin())*100;_set[that.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate);if(that.options.range===true){if(that.orientation==="horizontal"){if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate)}if(i===1){that.range[animate?"animate":"css"]({width:valPercent-lastValPercent+"%"},{queue:false,duration:o.animate})}}else{if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({bottom:valPercent+"%"},o.animate)}if(i===1){that.range[animate?"animate":"css"]({height:valPercent-lastValPercent+"%"},{queue:false,duration:o.animate})}}}lastValPercent=valPercent})}else{value=this.value();valueMin=this._valueMin();valueMax=this._valueMax();valPercent=valueMax!==valueMin?(value-valueMin)/(valueMax-valueMin)*100:0;_set[this.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate);if(oRange==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate)}if(oRange==="max"&&this.orientation==="horizontal"){this.range[animate?"animate":"css"]({width:100-valPercent+"%"},{queue:false,duration:o.animate})}if(oRange==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate)}if(oRange==="max"&&this.orientation==="vertical"){this.range[animate?"animate":"css"]({height:100-valPercent+"%"},{queue:false,duration:o.animate})}}},_handleEvents:{keydown:function(event){var allowed,curVal,newVal,step,index=$(event.target).data("ui-slider-handle-index");switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:event.preventDefault();if(!this._keySliding){this._keySliding=true;$(event.target).addClass("ui-state-active");allowed=this._start(event,index);if(allowed===false){return}}break}step=this.options.step;if(this.options.values&&this.options.values.length){curVal=newVal=this.values(index)}else{curVal=newVal=this.value()}switch(event.keyCode){case $.ui.keyCode.HOME:newVal=this._valueMin();break;case $.ui.keyCode.END:newVal=this._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=this._trimAlignValue(curVal+(this._valueMax()-this._valueMin())/numPages);break;case $.ui.keyCode.PAGE_DOWN:newVal=this._trimAlignValue(curVal-(this._valueMax()-this._valueMin())/numPages);break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===this._valueMax()){return}newVal=this._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===this._valueMin()){return}newVal=this._trimAlignValue(curVal-step);break}this._slide(event,index,newVal)},click:function(event){event.preventDefault()},keyup:function(event){var index=$(event.target).data("ui-slider-handle-index");if(this._keySliding){this._keySliding=false;this._stop(event,index);this._change(event,index);$(event.target).removeClass("ui-state-active")}}}})})(jQuery);(function($,undefined){function isOverAxis(x,reference,size){return x>reference&&x<reference+size}function isFloating(item){return/left|right/.test(item.css("float"))||/inline|table-cell/.test(item.css("display"))}$.widget("ui.sortable",$.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var o=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?o.axis==="x"||isFloating(this.items[0].item):false;this.offset=this.element.offset();this._mouseInit();this.ready=true},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--){this.items[i].item.removeData(this.widgetName+"-item")}return this},_setOption:function(key,value){if(key==="disabled"){this.options[key]=value;this.widget().toggleClass("ui-sortable-disabled",!!value)}else{$.Widget.prototype._setOption.apply(this,arguments)}},_mouseCapture:function(event,overrideHandle){var currentItem=null,validHandle=false,that=this;if(this.reverting){return false}if(this.options.disabled||this.options.type==="static"){return false}this._refreshItems(event);$(event.target).parents().each(function(){if($.data(this,that.widgetName+"-item")===that){currentItem=$(this);return false}});if($.data(event.target,that.widgetName+"-item")===that){currentItem=$(event.target)}if(!currentItem){return false}if(this.options.handle&&!overrideHandle){$(this.options.handle,currentItem).find("*").addBack().each(function(){if(this===event.target){validHandle=true}});if(!validHandle){return false}}this.currentItem=currentItem;this._removeCurrentsFromItems();return true},_mouseStart:function(event,overrideHandle,noActivation){var i,body,o=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!==this.currentItem[0]){this.currentItem.hide()}this._createPlaceholder();if(o.containment){this._setContainment()}if(o.cursor&&o.cursor!=="auto"){body=this.document.find("body");this.storedCursor=body.css("cursor");body.css("cursor",o.cursor);this.storedStylesheet=$("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(body)}if(o.opacity){if(this.helper.css("opacity")){this._storedOpacity=this.helper.css("opacity")}this.helper.css("opacity",o.opacity)}if(o.zIndex){if(this.helper.css("zIndex")){this._storedZIndex=this.helper.css("zIndex")}this.helper.css("zIndex",o.zIndex)}if(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"){this.overflowOffset=this.scrollParent.offset()}this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions()}if(!noActivation){for(i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,this._uiHash(this))}}if($.ui.ddmanager){$.ui.ddmanager.current=this}if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event)}this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(event);return true},_mouseDrag:function(event){var i,item,itemElement,intersection,o=this.options,scrolled=false;this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs}if(this.options.scroll){if(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"){if(this.overflowOffset.top+this.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed}else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed}if(this.overflowOffset.left+this.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed}else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed}}else{if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed)}else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed)}if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed)}else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed)}}if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event)}}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px"}for(i=this.items.length-1;i>=0;i--){item=this.items[i];itemElement=item.item[0];intersection=this._intersectsWithPointer(item);if(!intersection){continue}if(item.instance!==this.currentContainer){continue}if(itemElement!==this.currentItem[0]&&this.placeholder[intersection===1?"next":"prev"]()[0]!==itemElement&&!$.contains(this.placeholder[0],itemElement)&&(this.options.type==="semi-dynamic"?!$.contains(this.element[0],itemElement):true)){this.direction=intersection===1?"down":"up";if(this.options.tolerance==="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item)}else{break}this._trigger("change",event,this._uiHash());break}}this._contactContainers(event);if($.ui.ddmanager){$.ui.ddmanager.drag(this,event)}this._trigger("sort",event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(event,noPropagation){if(!event){return}if($.ui.ddmanager&&!this.options.dropBehaviour){$.ui.ddmanager.drop(this,event)}if(this.options.revert){var that=this,cur=this.placeholder.offset(),axis=this.options.axis,animation={};if(!axis||axis==="x"){animation.left=cur.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)}if(!axis||axis==="y"){animation.top=cur.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)}this.reverting=true;$(this.helper).animate(animation,parseInt(this.options.revert,10)||500,function(){that._clear(event)})}else{this._clear(event,noPropagation)}return false},cancel:function(){if(this.dragging){this._mouseUp({target:null});if(this.options.helper==="original"){this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,this._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,this._uiHash(this));this.containers[i].containerCache.over=0}}}if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0])}if(this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode){this.helper.remove()}$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem)}else{$(this.domPosition.parent).prepend(this.currentItem)}}return this},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected),str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||"id")||"").match(o.expression||/(.+)[\-=_](.+)/);if(res){str.push((o.key||res[1]+"[]")+"="+(o.key&&o.expression?res[1]:res[2]))}});if(!str.length&&o.key){str.push(o.key+"=")}return str.join("&")},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected),ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||"id")||"")});return ret},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height,l=item.left,r=l+item.width,t=item.top,b=t+item.height,dyClick=this.offset.click.top,dxClick=this.offset.click.left,isOverElementHeight=this.options.axis==="x"||y1+dyClick>t&&y1+dyClick<b,isOverElementWidth=this.options.axis==="y"||x1+dxClick>l&&x1+dxClick<r,isOverElement=isOverElementHeight&&isOverElementWidth;if(this.options.tolerance==="pointer"||this.options.forcePointerForContainers||this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>item[this.floating?"width":"height"]){return isOverElement}else{return l<x1+this.helperProportions.width/2&&x2-this.helperProportions.width/2<r&&t<y1+this.helperProportions.height/2&&y2-this.helperProportions.height/2<b}},_intersectsWithPointer:function(item){var isOverElementHeight=this.options.axis==="x"||isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=this.options.axis==="y"||isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(!isOverElement){return false}return this.floating?horizontalDirection&&horizontalDirection==="right"||verticalDirection==="down"?2:1:verticalDirection&&(verticalDirection==="down"?2:1)},_intersectsWithSides:function(item){var isOverBottomHalf=isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+item.height/2,item.height),isOverRightHalf=isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+item.width/2,item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return horizontalDirection==="right"&&isOverRightHalf||horizontalDirection==="left"&&!isOverRightHalf}else{return verticalDirection&&(verticalDirection==="down"&&isOverBottomHalf||verticalDirection==="up"&&!isOverBottomHalf)}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!==0&&(delta>0?"down":"up")},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!==0&&(delta>0?"right":"left")},refresh:function(event){this._refreshItems(event);this.refreshPositions();return this},_connectWith:function(){var options=this.options;return options.connectWith.constructor===String?[options.connectWith]:options.connectWith},_getItemsAsjQuery:function(connected){var i,j,cur,inst,items=[],queries=[],connectWith=this._connectWith();if(connectWith&&connected){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),inst])}}}}queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);function addItems(){items.push(this)}for(i=queries.length-1;i>=0;i--){queries[i][0].each(addItems)}return $(items)},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++){if(list[j]===item.item[0]){return false}}return true})},_refreshItems:function(event){this.items=[];this.containers=[this];var i,j,cur,inst,targetData,_queries,item,queriesLength,items=this.items,queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]],connectWith=this._connectWith();if(connectWith&&this.ready){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst)}}}}for(i=queries.length-1;i>=0;i--){targetData=queries[i][1];_queries=queries[i][0];for(j=0,queriesLength=_queries.length;j<queriesLength;j++){item=$(_queries[j]);item.data(this.widgetName+"-item",targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0})}}},refreshPositions:function(fast){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset()}var i,item,t,p;for(i=this.items.length-1;i>=0;i--){item=this.items[i];if(item.instance!==this.currentContainer&&this.currentContainer&&item.item[0]!==this.currentItem[0]){continue}t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight()}p=t.offset();item.left=p.left;item.top=p.top}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(i=this.containers.length-1;i>=0;i--){p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}}return this},_createPlaceholder:function(that){that=that||this;var className,o=that.options;if(!o.placeholder||o.placeholder.constructor===String){className=o.placeholder;o.placeholder={element:function(){var nodeName=that.currentItem[0].nodeName.toLowerCase(),element=$("<"+nodeName+">",that.document[0]).addClass(className||that.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");if(nodeName==="tr"){that.currentItem.children().each(function(){$("<td>&#160;</td>",that.document[0]).attr("colspan",$(this).attr("colspan")||1).appendTo(element)})}else if(nodeName==="img"){element.attr("src",that.currentItem.attr("src"))}if(!className){element.css("visibility","hidden")}return element},update:function(container,p){if(className&&!o.forcePlaceholderSize){return}if(!p.height()){p.height(that.currentItem.innerHeight()-parseInt(that.currentItem.css("paddingTop")||0,10)-parseInt(that.currentItem.css("paddingBottom")||0,10))}if(!p.width()){p.width(that.currentItem.innerWidth()-parseInt(that.currentItem.css("paddingLeft")||0,10)-parseInt(that.currentItem.css("paddingRight")||0,10))}}}}that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem));that.currentItem.after(that.placeholder);o.placeholder.update(that,that.placeholder)},_contactContainers:function(event){var i,j,dist,itemWithLeastDistance,posProperty,sizeProperty,base,cur,nearBottom,floating,innermostContainer=null,innermostIndex=null;for(i=this.containers.length-1;i>=0;i--){if($.contains(this.currentItem[0],this.containers[i].element[0])){continue}if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0])){continue}innermostContainer=this.containers[i];innermostIndex=i}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0}}}if(!innermostContainer){return}if(this.containers.length===1){if(!this.containers[innermostIndex].containerCache.over){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1}}else{dist=1e4;itemWithLeastDistance=null;floating=innermostContainer.floating||isFloating(this.currentItem);posProperty=floating?"left":"top";sizeProperty=floating?"width":"height";base=this.positionAbs[posProperty]+this.offset.click[posProperty];for(j=this.items.length-1;j>=0;j--){if(!$.contains(this.containers[innermostIndex].element[0],this.items[j].item[0])){continue}if(this.items[j].item[0]===this.currentItem[0]){continue}if(floating&&!isOverAxis(this.positionAbs.top+this.offset.click.top,this.items[j].top,this.items[j].height)){continue}cur=this.items[j].item.offset()[posProperty];nearBottom=false;if(Math.abs(cur-base)>Math.abs(cur+this.items[j][sizeProperty]-base)){nearBottom=true;cur+=this.items[j][sizeProperty]}if(Math.abs(cur-base)<dist){dist=Math.abs(cur-base);itemWithLeastDistance=this.items[j];this.direction=nearBottom?"up":"down"}}if(!itemWithLeastDistance&&!this.options.dropOnEmpty){return}if(this.currentContainer===this.containers[innermostIndex]){return}itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.currentContainer=this.containers[innermostIndex];this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1}},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):o.helper==="clone"?this.currentItem.clone():this.currentItem;if(!helper.parents("body").length){$(o.appendTo!=="parent"?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0])}if(helper[0]===this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}}if(!helper[0].style.width||o.forceHelperSize){helper.width(this.currentItem.width())}if(!helper[0].style.height||o.forceHelperSize){helper.height(this.currentItem.height())}return helper},_adjustOffsetFromHelper:function(obj){if(typeof obj==="string"){obj=obj.split(" ")}if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0}}if("left"in obj){this.offset.click.left=obj.left+this.margins.left}if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left}if("top"in obj){this.offset.click.top=obj.top+this.margins.top}if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&$.ui.ie){po={top:0,left:0}}return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var ce,co,over,o=this.options;
if(o.containment==="parent"){o.containment=this.helper[0].parentNode}if(o.containment==="document"||o.containment==="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$(o.containment==="document"?document:window).width()-this.helperProportions.width-this.margins.left,($(o.containment==="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!/^(document|window|parent)$/.test(o.containment)){ce=$(o.containment)[0];co=$(o.containment).offset();over=$(ce).css("overflow")!=="hidden";this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(d,pos){if(!pos){pos=this.position}var mod=d==="absolute"?1:-1,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop())*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod}},_generatePosition:function(event){var top,left,o=this.options,pageX=event.pageX,pageY=event.pageY,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);if(this.cssPosition==="relative"&&!(this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0])){this.offset.relative=this._getRelativeOffset()}if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0]){pageX=this.containment[0]+this.offset.click.left}if(event.pageY-this.offset.click.top<this.containment[1]){pageY=this.containment[1]+this.offset.click.top}if(event.pageX-this.offset.click.left>this.containment[2]){pageX=this.containment[2]+this.offset.click.left}if(event.pageY-this.offset.click.top>this.containment[3]){pageY=this.containment[3]+this.offset.click.top}}if(o.grid){top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?top-this.offset.click.top>=this.containment[1]&&top-this.offset.click.top<=this.containment[3]?top:top-this.offset.click.top>=this.containment[1]?top-o.grid[1]:top+o.grid[1]:top;left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?left-this.offset.click.left>=this.containment[0]&&left-this.offset.click.left<=this.containment[2]?left:left-this.offset.click.left>=this.containment[0]?left-o.grid[0]:left+o.grid[0]:left}}return{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop()),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())}},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],this.direction==="down"?i.item[0]:i.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){if(counter===this.counter){this.refreshPositions(!hardRefresh)}})},_clear:function(event,noPropagation){this.reverting=false;var i,delayedTriggers=[];if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem)}this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(i in this._storedCSS){if(this._storedCSS[i]==="auto"||this._storedCSS[i]==="static"){this._storedCSS[i]=""}}this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}if(this.fromOutside&&!noPropagation){delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside))})}if((this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!noPropagation){delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash())})}if(this!==this.currentContainer){if(!noPropagation){delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash())});delayedTriggers.push(function(c){return function(event){c._trigger("receive",event,this._uiHash(this))}}.call(this,this.currentContainer));delayedTriggers.push(function(c){return function(event){c._trigger("update",event,this._uiHash(this))}}.call(this,this.currentContainer))}}function delayEvent(type,instance,container){return function(event){container._trigger(type,event,instance._uiHash(instance))}}for(i=this.containers.length-1;i>=0;i--){if(!noPropagation){delayedTriggers.push(delayEvent("deactivate",this,this.containers[i]))}if(this.containers[i].containerCache.over){delayedTriggers.push(delayEvent("out",this,this.containers[i]));this.containers[i].containerCache.over=0}}if(this.storedCursor){this.document.find("body").css("cursor",this.storedCursor);this.storedStylesheet.remove()}if(this._storedOpacity){this.helper.css("opacity",this._storedOpacity)}if(this._storedZIndex){this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex)}this.dragging=false;if(this.cancelHelperRemoval){if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());for(i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event)}this._trigger("stop",event,this._uiHash())}this.fromOutside=false;return false}if(!noPropagation){this._trigger("beforeStop",event,this._uiHash())}this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!==this.currentItem[0]){this.helper.remove()}this.helper=null;if(!noPropagation){for(i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event)}this._trigger("stop",event,this._uiHash())}this.fromOutside=false;return true},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel()}},_uiHash:function(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null}}})})(jQuery)}).call(context,context.jquery);(function(){(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.6.0";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return obj;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,length=obj.length;i<length;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return}}else{var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return}}return obj};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))});return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator)}each(obj,function(value,index,list){if(!initial){memo=value;initial=true}else{memo=iterator.call(context,memo,value,index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator)}var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true}else{memo=iterator.call(context,memo,obj[index],index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.find=_.detect=function(obj,predicate,context){var result;any(obj,function(value,index,list){if(predicate.call(context,value,index,list)){result=value;return true}});return result};_.filter=_.select=function(obj,predicate,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(predicate,context);each(obj,function(value,index,list){if(predicate.call(context,value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,function(value,index,list){return!predicate.call(context,value,index,list)},context)};_.every=_.all=function(obj,predicate,context){predicate||(predicate=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(predicate,context);each(obj,function(value,index,list){if(!(result=result&&predicate.call(context,value,index,list)))return breaker});return!!result};var any=_.some=_.any=function(obj,predicate,context){predicate||(predicate=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(predicate,context);each(obj,function(value,index,list){if(result||(result=predicate.call(context,value,index,list)))return breaker});return!!result};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,function(value){return value===target})};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj)}var result=-Infinity,lastComputed=-Infinity;each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;if(computed>lastComputed){result=value;lastComputed=computed}});return result};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj)}var result=Infinity,lastComputed=Infinity;each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;if(computed<lastComputed){result=value;lastComputed=computed}});return result};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value});return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(obj.length!==+obj.length)obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};var lookupIterator=function(value){if(value==null)return _.identity;if(_.isFunction(value))return value;return _.property(value)};_.sortBy=function(obj,iterator,context){iterator=lookupIterator(iterator);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iterator,context){var result={};iterator=lookupIterator(iterator);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)});return result}};_.groupBy=group(function(result,key,value){_.has(result,key)?result[key].push(value):result[key]=[value]});_.indexBy=group(function(result,key,value){result[key]=value});_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1});_.sortedIndex=function(array,obj,iterator,context){iterator=lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return obj.length===+obj.length?obj.length:_.keys(obj).length};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];if(n<0)return[];return slice.call(array,0,n)};_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return slice.call(array,Math.max(array.length-n,0))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){if(shallow&&_.every(input,_.isArray)){return concat.apply(output,input)}each(input,function(value){if(_.isArray(value)||_.isArguments(value)){shallow?push.apply(output,value):flatten(value,shallow,output)}else{output.push(value)}});return output};_.flatten=function(array,shallow){return flatten(array,shallow,[])};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.partition=function(array,predicate){var pass=[],fail=[];each(array,function(elem){(predicate(elem)?pass:fail).push(elem)});return[pass,fail]};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false}var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?!index||seen[seen.length-1]!==value:!_.contains(seen,value)){seen.push(value);results.push(array[index])}});return results};_.union=function(){return _.uniq(_.flatten(arguments,true))};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.contains(other,item)})})};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){var length=_.max(_.pluck(arguments,"length").concat(0));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(arguments,""+i)}return results};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,length=list.length;i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,length=array.length;if(isSorted){if(typeof isSorted=="number"){i=isSorted<0?Math.max(0,length+isSorted):isSorted}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1}}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<length;i++)if(array[i]===item)return i;return-1};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item)}var i=hasIndex?from:array.length;while(i--)if(array[i]===item)return i;return-1};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=arguments[2]||1;var length=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(length);while(idx<length){range[idx++]=start;start+=step}return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self}};_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){var position=0;var args=boundArgs.slice();for(var i=0,length=args.length;i<length;i++){if(args[i]===_)args[i]=arguments[position++]}while(position<arguments.length)args.push(arguments[position++]);return func.apply(this,args)}};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)throw new Error("bindAll must be passed function names");each(funcs,function(f){obj[f]=_.bind(obj[f],obj)});return obj};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;options||(options={});var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout){timeout=setTimeout(later,wait)}if(callNow){result=func.apply(context,args);context=args=null}return result}};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)]}return args[0]}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=new Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=new Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop]}}});return obj};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key]});return copy};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key))copy[key]=obj[key]}return copy};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop]}}});return obj};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return false;var length=aStack.length;while(length--){if(aStack[length]==a)return bStack[length]==b}var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b){return false}aStack.push(a);bStack.push(b);var size=0,result=true;if(className=="[object Array]"){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break}}}else{for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}}if(result){for(key in b){if(_.has(b,key)&&!size--)break}result=!size}}aStack.pop();bStack.pop();return result};_.isEqual=function(a,b){return eq(a,b,[],[])};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"};_.isObject=function(obj){return obj===Object(obj)};each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,"callee"))}}if(typeof/./!=="function"){_.isFunction=function(obj){return typeof obj==="function"}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.property=function(key){return function(obj){return obj[key]}};_.matches=function(attrs){return function(obj){if(obj===attrs)return true;for(var key in attrs){if(attrs[key]!==obj[key])return false}return true}};_.times=function(n,iterator,context){var accum=Array(Math.max(0,n));for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){if(string==null)return"";return(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}});_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}if(evaluate){source+="';\n"+evaluate+"\n__p+='"}index=offset+match.length;return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};template.source="function("+(settings.variable||"obj")+"){\n"+source+"}";return template};_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_);each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=="shift"||name=="splice")&&obj.length===0)delete obj[0];return result.call(this,obj)}});each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}});_.extend(_.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}});if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this)}).call(context);(function(){(function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=="undefined"){Backbone=exports}else{Backbone=root.Backbone={}}Backbone.VERSION="0.9.10";var _=root._;if(!_&&typeof require!=="undefined")_=require("underscore");Backbone.$=root.jQuery||root.Zepto||root.ender;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==="object"){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest))}}else if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest))}}else{return true}};var triggerEvents=function(events,args){var ev,i=-1,l=events.length;switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,args[0]);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,args[0],args[1]);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,args[0],args[1],args[2]);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args)}};var Events=Backbone.Events={on:function(name,callback,context){if(!(eventsApi(this,"on",name,[callback,context])&&callback))return this;this._events||(this._events={});var list=this._events[name]||(this._events[name]=[]);list.push({callback:callback,context:context,ctx:context||this});return this},once:function(name,callback,context){if(!(eventsApi(this,"once",name,[callback,context])&&callback))return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments)});once._callback=callback;this.on(name,once,context);return this},off:function(name,callback,context){var list,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this}names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(list=this._events[name]){events=[];if(callback||context){for(j=0,k=list.length;j<k;j++){ev=list[j];if(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context){events.push(ev)}}}this._events[name]=events}}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this},listenTo:function(obj,name,callback){var listeners=this._listeners||(this._listeners={});var id=obj._listenerId||(obj._listenerId=_.uniqueId("l"));listeners[id]=obj;obj.on(name,typeof name==="object"?this:callback,this);return this},stopListening:function(obj,name,callback){var listeners=this._listeners;if(!listeners)return;if(obj){obj.off(name,typeof name==="object"?this:callback,this);if(!name&&!callback)delete listeners[obj._listenerId]}else{if(typeof name==="object")callback=this;for(var id in listeners){listeners[id].off(name,callback,this)}this._listeners={}}return this}};Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var defaults;
var attrs=attributes||{};this.cid=_.uniqueId("c");this.attributes={};if(options&&options.collection)this.collection=options.collection;if(options&&options.parse)attrs=this.parse(attrs,options)||{};if(defaults=_.result(this,"defaults")){attrs=_.defaults({},attrs,defaults)}this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return this.get(attr)!=null},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={}}current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val}else{delete this.changed[attr]}unset?delete current[attr]:current[attr]=val}if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger("change:"+changes[i],this,current[changes[i]],options)}}if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger("change",this,options)}}this._pending=false;this._changing=false;return this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}))},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],val=diff[attr]))continue;(changed||(changed={}))[attr]=val}return changed},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;options.success=function(model,resp,options){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options)};return this.sync("read",this,options)},save:function(key,val,options){var attrs,success,method,xhr,attributes=this.attributes;if(key==null||typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}if(attrs&&(!options||!options.wait)&&!this.set(attrs,options))return false;options=_.extend({validate:true},options);if(!this._validate(attrs,options))return false;if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs)}if(options.parse===void 0)options.parse=true;success=options.success;options.success=function(model,resp,options){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false}if(success)success(model,resp,options)};method=this.isNew()?"create":options.patch?"patch":"update";if(method==="patch")options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger("destroy",model,model.collection,options)};options.success=function(model,resp,options){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options)};if(this.isNew()){options.success(this,null,options);return false}var xhr=this.sync("delete",this,options);if(!options.wait)destroy();return xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(options){return!this.validate||!this.validate(this.attributes,options)},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger("invalid",this,error,options||{});return false}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this.models=[];this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options))};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){models=_.isArray(models)?models.slice():[models];options||(options={});var i,l,model,attrs,existing,doSort,add,at,sort,sortAttr;add=[];at=options.at;sort=this.comparator&&at==null&&options.sort!=false;sortAttr=_.isString(this.comparator)?this.comparator:null;for(i=0,l=models.length;i<l;i++){if(!(model=this._prepareModel(attrs=models[i],options))){this.trigger("invalid",this,attrs,options);continue}if(existing=this.get(model)){if(options.merge){existing.set(attrs===model?model.attributes:attrs,options);if(sort&&!doSort&&existing.hasChanged(sortAttr))doSort=true}continue}add.push(model);model.on("all",this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model}if(add.length){if(sort)doSort=true;this.length+=add.length;if(at!=null){splice.apply(this.models,[at,0].concat(add))}else{push.apply(this.models,add)}}if(doSort)this.sort({silent:true});if(options.silent)return this;for(i=0,l=add.length;i<l;i++){(model=add[i]).trigger("add",model,this,options)}if(doSort)this.trigger("sort",this,options);return this},remove:function(models,options){models=_.isArray(models)?models.slice():[models];options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}this._removeReference(model)}return this},push:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:this.length},options));return model},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model},unshift:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:0},options));return model},shift:function(options){var model=this.at(0);this.remove(model,options);return model},slice:function(begin,end){return this.models.slice(begin,end)},get:function(obj){if(obj==null)return void 0;this._idAttr||(this._idAttr=this.model.prototype.idAttribute);return this._byId[obj.id||obj.cid||obj[this._idAttr]||obj]},at:function(index){return this.models[index]},where:function(attrs){if(_.isEmpty(attrs))return[];return this.filter(function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false}return true})},sort:function(options){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(_.bind(this.comparator,this))}if(!options.silent)this.trigger("sort",this,options);return this},pluck:function(attr){return _.invoke(this.models,"get",attr)},update:function(models,options){options=_.extend({add:true,merge:true,remove:true},options);if(options.parse)models=this.parse(models,options);var model,i,l,existing;var add=[],remove=[],modelMap={};if(!_.isArray(models))models=models?[models]:[];if(options.add&&!options.remove)return this.add(models,options);for(i=0,l=models.length;i<l;i++){model=models[i];existing=this.get(model);if(options.remove&&existing)modelMap[existing.cid]=true;if(options.add&&!existing||options.merge&&existing){add.push(model)}}if(options.remove){for(i=0,l=this.models.length;i<l;i++){model=this.models[i];if(!modelMap[model.cid])remove.push(model)}}if(remove.length)this.remove(remove,options);if(add.length)this.add(add,options);return this},reset:function(models,options){options||(options={});if(options.parse)models=this.parse(models,options);for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i])}options.previousModels=this.models.slice();this._reset();if(models)this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return this},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;options.success=function(collection,resp,options){var method=options.update?"update":"reset";collection[method](resp,options);if(success)success(collection,resp,options)};return this.sync("read",this,options)},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp,options){if(options.wait)collection.add(model,options);if(success)success(model,resp,options)};model.save(null,options);return model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models.length=0;this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs}options||(options={});options.collection=this;var model=new this.model(attrs,options);if(!model._validate(attrs,options))return false;return model},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if((event==="add"||event==="remove")&&collection!==this)return;if(event==="destroy")this.remove(model,options);if(model&&event==="change:"+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model}this.trigger.apply(this,arguments)},sortedIndex:function(model,value,context){value||(value=this.comparator);var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _.sortedIndex(this.models,model,iterator,context)}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(!callback)callback=this[name];Backbone.history.route(route,_.bind(function(fragment){var args=this._extractParameters(route,fragment);callback&&callback.apply(this,args);this.trigger.apply(this,["route:"+name].concat(args));this.trigger("route",name,args);Backbone.history.trigger("route",this,name,args)},this));return this},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this},_bindRoutes:function(){if(!this.routes)return;var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/]+)"}).replace(splatParam,"(.*?)");return new RegExp("^"+route+"$")},_extractParameters:function(route,fragment){return route.exec(fragment).slice(1)}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,"");if(!fragment.indexOf(root))fragment=fragment.substr(root.length)}else{fragment=this.getHash()}}return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({},{root:"/"},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);this.root=("/"+this.root+"/").replace(rootStripper,"/");if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(fragment)}if(this._hasPushState){Backbone.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!oldIE){Backbone.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=fragment;var loc=this.location;var atRoot=loc.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,"");this.history.replaceState({},document.title,this.root+this.fragment+loc.search)}if(!this.options.silent)return this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe))}if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}});return matched},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:options};fragment=this.getFragment(fragment||"");if(this.fragment===fragment)return;this.fragment=fragment;var url=this.root+fragment;if(this._hasPushState){this.history[options.replace?"replaceState":"pushState"]({},document.title,url)}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace)}}else{return this.location.assign(url)}if(options.trigger)this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else{location.hash="#"+fragment}}});Backbone.history=new History;var View=Backbone.View=function(options){this.cid=_.uniqueId("view");this._configure(options||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this},delegateEvents:function(events){if(!(events||(events=_.result(this,"events"))))return;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)throw new Error('Method "'+events[key]+'" does not exist');var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+=".delegateEvents"+this.cid;if(selector===""){this.$el.on(eventName,method)}else{this.$el.on(eventName,selector,method)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(options){if(this.options)options=_.extend({},_.result(this,"options"),options);_.extend(this,_.pick(options,viewOptions));this.options=options},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,"attributes"));if(this.id)attrs.id=_.result(this,"id");if(this.className)attrs["class"]=_.result(this,"className");var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,false)}else{this.setElement(_.result(this,"el"),false)}}});var methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(!options.url){params.url=_.result(model,"url")||urlError()}if(options.data==null&&model&&(method==="create"||method==="update"||method==="patch")){params.contentType="application/json";params.data=JSON.stringify(options.attrs||model.toJSON(options))}if(options.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(options.emulateHTTP&&(type==="PUT"||type==="DELETE"||type==="PATCH")){params.type="POST";if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type);if(beforeSend)return beforeSend.apply(this,arguments)}}if(params.type!=="GET"&&!options.emulateJSON){params.processData=false}var success=options.success;options.success=function(resp){if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};var error=options.error;options.error=function(xhr){if(error)error(model,xhr,options);model.trigger("error",model,xhr,options)};var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger("request",model,xhr,options);return xhr};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,"constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')}}).call(this)}).call(context);(function(window){!function($){"use strict";$(function(){$.support.transition=function(){var transitionEnd=function(){var el=document.createElement("bootstrap"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},name;for(name in transEndEventNames){if(el.style[name]!==undefined){return transEndEventNames[name]}}}();return transitionEnd&&{end:transitionEnd}}()})}(window.jQuery);!function($){"use strict";var dismiss='[data-dismiss="alert"]',Alert=function(el){$(el).on("click",dismiss,this.close)};Alert.prototype.close=function(e){var $this=$(this),selector=$this.data("target"),$parent;if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}$parent=$(selector);e&&e.preventDefault();$parent.length||($parent=$this.hasClass("alert")?$this:$this.parent());$parent.trigger(e=$.Event("close"));if(e.isDefaultPrevented())return;$parent.removeClass("in");function removeElement(){$parent.trigger("closed").remove()}$.support.transition&&$parent.hasClass("fade")?$parent.on($.support.transition.end,removeElement):removeElement()};var old=$.fn.alert;$.fn.alert=function(option){return this.each(function(){var $this=$(this),data=$this.data("alert");if(!data)$this.data("alert",data=new Alert(this));if(typeof option=="string")data[option].call($this)})};$.fn.alert.Constructor=Alert;$.fn.alert.noConflict=function(){$.fn.alert=old;return this};$(document).on("click.alert.data-api",dismiss,Alert.prototype.close)}(window.jQuery);!function($){"use strict";var Button=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.button.defaults,options)};Button.prototype.setState=function(state){var d="disabled",$el=this.$element,data=$el.data(),val=$el.is("input")?"val":"html";state=state+"Text";data.resetText||$el.data("resetText",$el[val]());$el[val](data[state]||this.options[state]);setTimeout(function(){state=="loadingText"?$el.addClass(d).attr(d,d):$el.removeClass(d).removeAttr(d)},0)};Button.prototype.toggle=function(){var $parent=this.$element.closest('[data-toggle="buttons-radio"]');$parent&&$parent.find(".active").removeClass("active");this.$element.toggleClass("active")};var old=$.fn.button;$.fn.button=function(option){return this.each(function(){var $this=$(this),data=$this.data("button"),options=typeof option=="object"&&option;if(!data)$this.data("button",data=new Button(this,options));if(option=="toggle")data.toggle();else if(option)data.setState(option)})};$.fn.button.defaults={loadingText:"loading..."};$.fn.button.Constructor=Button;$.fn.button.noConflict=function(){$.fn.button=old;return this};$(document).on("click.button.data-api","[data-toggle^=button]",function(e){var $btn=$(e.target);if(!$btn.hasClass("btn"))$btn=$btn.closest(".btn");$btn.button("toggle")})}(window.jQuery);!function($){"use strict";var Carousel=function(element,options){this.$element=$(element);this.$indicators=this.$element.find(".carousel-indicators");this.options=options;this.options.pause=="hover"&&this.$element.on("mouseenter",$.proxy(this.pause,this)).on("mouseleave",$.proxy(this.cycle,this))};Carousel.prototype={cycle:function(e){if(!e)this.paused=false;if(this.interval)clearInterval(this.interval);this.options.interval&&!this.paused&&(this.interval=setInterval($.proxy(this.next,this),this.options.interval));return this},getActiveIndex:function(){this.$active=this.$element.find(".item.active");this.$items=this.$active.parent().children();return this.$items.index(this.$active)},to:function(pos){var activeIndex=this.getActiveIndex(),that=this;if(pos>this.$items.length-1||pos<0)return;if(this.sliding){return this.$element.one("slid",function(){that.to(pos)})}if(activeIndex==pos){return this.pause().cycle()}return this.slide(pos>activeIndex?"next":"prev",$(this.$items[pos]))},pause:function(e){if(!e)this.paused=true;if(this.$element.find(".next, .prev").length&&$.support.transition.end){this.$element.trigger($.support.transition.end);this.cycle(true)}clearInterval(this.interval);this.interval=null;return this},next:function(){if(this.sliding)return;return this.slide("next")},prev:function(){if(this.sliding)return;return this.slide("prev")},slide:function(type,next){var $active=this.$element.find(".item.active"),$next=next||$active[type](),isCycling=this.interval,direction=type=="next"?"left":"right",fallback=type=="next"?"first":"last",that=this,e;this.sliding=true;isCycling&&this.pause();$next=$next.length?$next:this.$element.find(".item")[fallback]();e=$.Event("slide",{relatedTarget:$next[0],direction:direction});if($next.hasClass("active"))return;if(this.$indicators.length){this.$indicators.find(".active").removeClass("active");this.$element.one("slid",function(){var $nextIndicator=$(that.$indicators.children()[that.getActiveIndex()]);$nextIndicator&&$nextIndicator.addClass("active")})}if($.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(e);if(e.isDefaultPrevented())return;$next.addClass(type);$next[0].offsetWidth;$active.addClass(direction);$next.addClass(direction);this.$element.one($.support.transition.end,function(){$next.removeClass([type,direction].join(" ")).addClass("active");$active.removeClass(["active",direction].join(" "));that.sliding=false;setTimeout(function(){that.$element.trigger("slid")},0)})}else{this.$element.trigger(e);if(e.isDefaultPrevented())return;$active.removeClass("active");$next.addClass("active");this.sliding=false;this.$element.trigger("slid")}isCycling&&this.cycle();return this}};var old=$.fn.carousel;$.fn.carousel=function(option){return this.each(function(){var $this=$(this),data=$this.data("carousel"),options=$.extend({},$.fn.carousel.defaults,typeof option=="object"&&option),action=typeof option=="string"?option:options.slide;if(!data)$this.data("carousel",data=new Carousel(this,options));if(typeof option=="number")data.to(option);else if(action)data[action]();else if(options.interval)data.pause().cycle()})};$.fn.carousel.defaults={interval:5e3,pause:"hover"};$.fn.carousel.Constructor=Carousel;$.fn.carousel.noConflict=function(){$.fn.carousel=old;return this};$(document).on("click.carousel.data-api","[data-slide], [data-slide-to]",function(e){var $this=$(this),href,$target=$($this.data("target")||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"")),options=$.extend({},$target.data(),$this.data()),slideIndex;$target.carousel(options);if(slideIndex=$this.attr("data-slide-to")){$target.data("carousel").pause().to(slideIndex).cycle()}e.preventDefault()})}(window.jQuery);!function($){"use strict";var Collapse=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.collapse.defaults,options);if(this.options.parent){this.$parent=$(this.options.parent)}this.options.toggle&&this.toggle()};Collapse.prototype={constructor:Collapse,dimension:function(){var hasWidth=this.$element.hasClass("width");return hasWidth?"width":"height"},show:function(){var dimension,scroll,actives,hasData;if(this.transitioning||this.$element.hasClass("in"))return;dimension=this.dimension();scroll=$.camelCase(["scroll",dimension].join("-"));actives=this.$parent&&this.$parent.find("> .accordion-group > .in");if(actives&&actives.length){hasData=actives.data("collapse");if(hasData&&hasData.transitioning)return;actives.collapse("hide");hasData||actives.data("collapse",null)}this.$element[dimension](0);this.transition("addClass",$.Event("show"),"shown");$.support.transition&&this.$element[dimension](this.$element[0][scroll])},hide:function(){var dimension;if(this.transitioning||!this.$element.hasClass("in"))return;dimension=this.dimension();this.reset(this.$element[dimension]());this.transition("removeClass",$.Event("hide"),"hidden");this.$element[dimension](0)},reset:function(size){var dimension=this.dimension();this.$element.removeClass("collapse")[dimension](size||"auto")[0].offsetWidth;this.$element[size!==null?"addClass":"removeClass"]("collapse");return this},transition:function(method,startEvent,completeEvent){var that=this,complete=function(){if(startEvent.type=="show")that.reset();that.transitioning=0;that.$element.trigger(completeEvent)};this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;this.transitioning=1;this.$element[method]("in");$.support.transition&&this.$element.hasClass("collapse")?this.$element.one($.support.transition.end,complete):complete()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var old=$.fn.collapse;$.fn.collapse=function(option){return this.each(function(){var $this=$(this),data=$this.data("collapse"),options=$.extend({},$.fn.collapse.defaults,$this.data(),typeof option=="object"&&option);if(!data)$this.data("collapse",data=new Collapse(this,options));if(typeof option=="string")data[option]()})};$.fn.collapse.defaults={toggle:true};$.fn.collapse.Constructor=Collapse;$.fn.collapse.noConflict=function(){$.fn.collapse=old;return this};$(document).on("click.collapse.data-api","[data-toggle=collapse]",function(e){var $this=$(this),href,target=$this.data("target")||e.preventDefault()||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,""),option=$(target).data("collapse")?"toggle":$this.data();$this[$(target).hasClass("in")?"addClass":"removeClass"]("collapsed");$(target).collapse(option)})}(window.jQuery);!function($){"use strict";var toggle="[data-toggle=dropdown]",Dropdown=function(element){var $el=$(element).on("click.dropdown.data-api",this.toggle);$("html").on("click.dropdown.data-api",function(){$el.parent().removeClass("open")})};Dropdown.prototype={constructor:Dropdown,toggle:function(e){var $this=$(this),$parent,isActive;if($this.is(".disabled, :disabled"))return;$parent=getParent($this);isActive=$parent.hasClass("open");clearMenus();if(!isActive){if("ontouchstart"in document.documentElement){$('<div class="dropdown-backdrop"/>').insertBefore($(this)).on("click",clearMenus)}$parent.toggleClass("open")}$this.focus();return false},keydown:function(e){var $this,$items,$active,$parent,isActive,index;if(!/(38|40|27)/.test(e.keyCode))return;$this=$(this);e.preventDefault();e.stopPropagation();if($this.is(".disabled, :disabled"))return;$parent=getParent($this);isActive=$parent.hasClass("open");if(!isActive||isActive&&e.keyCode==27){if(e.which==27)$parent.find(toggle).focus();
return $this.click()}$items=$("[role=menu] li:not(.divider):visible a",$parent);if(!$items.length)return;index=$items.index($items.filter(":focus"));if(e.keyCode==38&&index>0)index--;if(e.keyCode==40&&index<$items.length-1)index++;if(!~index)index=0;$items.eq(index).focus()}};function clearMenus(){$(".dropdown-backdrop").remove();$(toggle).each(function(){getParent($(this)).removeClass("open")})}function getParent($this){var selector=$this.data("target"),$parent;if(!selector){selector=$this.attr("href");selector=selector&&/#/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,"")}$parent=selector&&$(selector);if(!$parent||!$parent.length)$parent=$this.parent();return $parent}var old=$.fn.dropdown;$.fn.dropdown=function(option){return this.each(function(){var $this=$(this),data=$this.data("dropdown");if(!data)$this.data("dropdown",data=new Dropdown(this));if(typeof option=="string")data[option].call($this)})};$.fn.dropdown.Constructor=Dropdown;$.fn.dropdown.noConflict=function(){$.fn.dropdown=old;return this};$(document).on("click.dropdown.data-api",clearMenus).on("click.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api",toggle,Dropdown.prototype.toggle).on("keydown.dropdown.data-api",toggle+", [role=menu]",Dropdown.prototype.keydown)}(window.jQuery);!function($){"use strict";var Modal=function(element,options){this.options=options;this.$element=$(element).delegate('[data-dismiss="modal"]',"click.dismiss.modal",$.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};Modal.prototype={constructor:Modal,toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var that=this,e=$.Event("show");this.$element.trigger(e);if(this.isShown||e.isDefaultPrevented())return;this.isShown=true;this.escape();this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass("fade");if(!that.$element.parent().length){that.$element.appendTo(document.body)}that.$element.show();if(transition){that.$element[0].offsetWidth}that.$element.addClass("in").attr("aria-hidden",false);that.enforceFocus();transition?that.$element.one($.support.transition.end,function(){that.$element.focus().trigger("shown")}):that.$element.focus().trigger("shown")})},hide:function(e){e&&e.preventDefault();var that=this;e=$.Event("hide");this.$element.trigger(e);if(!this.isShown||e.isDefaultPrevented())return;this.isShown=false;this.escape();$(document).off("focusin.modal");this.$element.removeClass("in").attr("aria-hidden",true);$.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var that=this;$(document).on("focusin.modal",function(e){if(that.$element[0]!==e.target&&!that.$element.has(e.target).length){that.$element.focus()}})},escape:function(){var that=this;if(this.isShown&&this.options.keyboard){this.$element.on("keyup.dismiss.modal",function(e){e.which==27&&that.hide()})}else if(!this.isShown){this.$element.off("keyup.dismiss.modal")}},hideWithTransition:function(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end);that.hideModal()},500);this.$element.one($.support.transition.end,function(){clearTimeout(timeout);that.hideModal()})},hideModal:function(){var that=this;this.$element.hide();this.backdrop(function(){that.removeBackdrop();that.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null},backdrop:function(callback){var that=this,animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body);this.$backdrop.click(this.options.backdrop=="static"?$.proxy(this.$element[0].focus,this.$element[0]):$.proxy(this.hide,this));if(doAnimate)this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");if(!callback)return;doAnimate?this.$backdrop.one($.support.transition.end,callback):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one($.support.transition.end,callback):callback()}else if(callback){callback()}}};var old=$.fn.modal;$.fn.modal=function(option){return this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},$.fn.modal.defaults,$this.data(),typeof option=="object"&&option);if(!data)$this.data("modal",data=new Modal(this,options));if(typeof option=="string")data[option]();else if(options.show)data.show()})};$.fn.modal.defaults={backdrop:true,keyboard:true,show:true};$.fn.modal.Constructor=Modal;$.fn.modal.noConflict=function(){$.fn.modal=old;return this};$(document).on("click.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href=$this.attr("href"),$target=$($this.data("target")||href&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());e.preventDefault();$target.modal(option).one("hide",function(){$this.focus()})})}(window.jQuery);!function($){"use strict";var Tooltip=function(element,options){this.init("tooltip",element,options)};Tooltip.prototype={constructor:Tooltip,init:function(type,element,options){var eventIn,eventOut,triggers,trigger,i;this.type=type;this.$element=$(element);this.options=this.getOptions(options);this.enabled=true;triggers=this.options.trigger.split(" ");for(i=triggers.length;i--;){trigger=triggers[i];if(trigger=="click"){this.$element.on("click."+this.type,this.options.selector,$.proxy(this.toggle,this))}else if(trigger!="manual"){eventIn=trigger=="hover"?"mouseenter":"focus";eventOut=trigger=="hover"?"mouseleave":"blur";this.$element.on(eventIn+"."+this.type,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut+"."+this.type,this.options.selector,$.proxy(this.leave,this))}}this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(options){options=$.extend({},$.fn[this.type].defaults,this.$element.data(),options);if(options.delay&&typeof options.delay=="number"){options.delay={show:options.delay,hide:options.delay}}return options},enter:function(e){var defaults=$.fn[this.type].defaults,options={},self;this._options&&$.each(this._options,function(key,value){if(defaults[key]!=value)options[key]=value},this);self=$(e.currentTarget)[this.type](options).data(this.type);if(!self.options.delay||!self.options.delay.show)return self.show();clearTimeout(this.timeout);self.hoverState="in";this.timeout=setTimeout(function(){if(self.hoverState=="in")self.show()},self.options.delay.show)},leave:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(this.timeout)clearTimeout(this.timeout);if(!self.options.delay||!self.options.delay.hide)return self.hide();self.hoverState="out";this.timeout=setTimeout(function(){if(self.hoverState=="out")self.hide()},self.options.delay.hide)},show:function(){var $tip,pos,actualWidth,actualHeight,placement,tp,e=$.Event("show");if(this.hasContent()&&this.enabled){this.$element.trigger(e);if(e.isDefaultPrevented())return;$tip=this.tip();this.setContent();if(this.options.animation){$tip.addClass("fade")}placement=typeof this.options.placement=="function"?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;$tip.detach().css({top:0,left:0,display:"block"});this.options.container?$tip.appendTo(this.options.container):$tip.insertAfter(this.$element);pos=this.getPosition();actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;switch(placement){case"bottom":tp={top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2};break;case"top":tp={top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2};break;case"left":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth};break;case"right":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width};break}this.applyPlacement(tp,placement);this.$element.trigger("shown")}},applyPlacement:function(offset,placement){var $tip=this.tip(),width=$tip[0].offsetWidth,height=$tip[0].offsetHeight,actualWidth,actualHeight,delta,replace;$tip.offset(offset).addClass(placement).addClass("in");actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;if(placement=="top"&&actualHeight!=height){offset.top=offset.top+height-actualHeight;replace=true}if(placement=="bottom"||placement=="top"){delta=0;if(offset.left<0){delta=offset.left*-2;offset.left=0;$tip.offset(offset);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight}this.replaceArrow(delta-width+actualWidth,actualWidth,"left")}else{this.replaceArrow(actualHeight-height,actualHeight,"top")}if(replace)$tip.offset(offset)},replaceArrow:function(delta,dimension,position){this.arrow().css(position,delta?50*(1-delta/dimension)+"%":"")},setContent:function(){var $tip=this.tip(),title=this.getTitle();$tip.find(".tooltip-inner")[this.options.html?"html":"text"](title);$tip.removeClass("fade in top bottom left right")},hide:function(){var that=this,$tip=this.tip(),e=$.Event("hide");this.$element.trigger(e);if(e.isDefaultPrevented())return;$tip.removeClass("in");function removeWithAnimation(){var timeout=setTimeout(function(){$tip.off($.support.transition.end).detach()},500);$tip.one($.support.transition.end,function(){clearTimeout(timeout);$tip.detach()})}$.support.transition&&this.$tip.hasClass("fade")?removeWithAnimation():$tip.detach();this.$element.trigger("hidden");return this},fixTitle:function(){var $e=this.$element;if($e.attr("title")||typeof $e.attr("data-original-title")!="string"){$e.attr("data-original-title",$e.attr("title")||"").attr("title","")}},hasContent:function(){return this.getTitle()},getPosition:function(){var el=this.$element[0];return $.extend({},typeof el.getBoundingClientRect=="function"?el.getBoundingClientRect():{width:el.offsetWidth,height:el.offsetHeight},this.$element.offset())},getTitle:function(){var title,$e=this.$element,o=this.options;title=$e.attr("data-original-title")||(typeof o.title=="function"?o.title.call($e[0]):o.title);return title},tip:function(){return this.$tip=this.$tip||$(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(e){var self=e?$(e.currentTarget)[this.type](this._options).data(this.type):this;self.tip().hasClass("in")?self.hide():self.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var old=$.fn.tooltip;$.fn.tooltip=function(option){return this.each(function(){var $this=$(this),data=$this.data("tooltip"),options=typeof option=="object"&&option;if(!data)$this.data("tooltip",data=new Tooltip(this,options));if(typeof option=="string")data[option]()})};$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:false,container:false};$.fn.tooltip.noConflict=function(){$.fn.tooltip=old;return this}}(window.jQuery);!function($){"use strict";var Popover=function(element,options){this.init("popover",element,options)};Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype,{constructor:Popover,setContent:function(){var $tip=this.tip(),title=this.getTitle(),content=this.getContent();$tip.find(".popover-title")[this.options.html?"html":"text"](title);$tip.find(".popover-content")[this.options.html?"html":"text"](content);$tip.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var content,$e=this.$element,o=this.options;content=(typeof o.content=="function"?o.content.call($e[0]):o.content)||$e.attr("data-content");return content},tip:function(){if(!this.$tip){this.$tip=$(this.options.template)}return this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var old=$.fn.popover;$.fn.popover=function(option){return this.each(function(){var $this=$(this),data=$this.data("popover"),options=typeof option=="object"&&option;if(!data)$this.data("popover",data=new Popover(this,options));if(typeof option=="string")data[option]()})};$.fn.popover.Constructor=Popover;$.fn.popover.defaults=$.extend({},$.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});$.fn.popover.noConflict=function(){$.fn.popover=old;return this}}(window.jQuery);!function($){"use strict";function ScrollSpy(element,options){var process=$.proxy(this.process,this),$element=$(element).is("body")?$(window):$(element),href;this.options=$.extend({},$.fn.scrollspy.defaults,options);this.$scrollElement=$element.on("scroll.scroll-spy.data-api",process);this.selector=(this.options.target||(href=$(element).attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a";this.$body=$("body");this.refresh();this.process()}ScrollSpy.prototype={constructor:ScrollSpy,refresh:function(){var self=this,$targets;this.offsets=$([]);this.targets=$([]);$targets=this.$body.find(this.selector).map(function(){var $el=$(this),href=$el.data("target")||$el.attr("href"),$href=/^#\w/.test(href)&&$(href);return $href&&$href.length&&[[$href.position().top+(!$.isWindow(self.$scrollElement.get(0))&&self.$scrollElement.scrollTop()),href]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){self.offsets.push(this[0]);self.targets.push(this[1])})},process:function(){var scrollTop=this.$scrollElement.scrollTop()+this.options.offset,scrollHeight=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,maxScroll=scrollHeight-this.$scrollElement.height(),offsets=this.offsets,targets=this.targets,activeTarget=this.activeTarget,i;if(scrollTop>=maxScroll){return activeTarget!=(i=targets.last()[0])&&this.activate(i)}for(i=offsets.length;i--;){activeTarget!=targets[i]&&scrollTop>=offsets[i]&&(!offsets[i+1]||scrollTop<=offsets[i+1])&&this.activate(targets[i])}},activate:function(target){var active,selector;this.activeTarget=target;$(this.selector).parent(".active").removeClass("active");selector=this.selector+'[data-target="'+target+'"],'+this.selector+'[href="'+target+'"]';active=$(selector).parent("li").addClass("active");if(active.parent(".dropdown-menu").length){active=active.closest("li.dropdown").addClass("active")}active.trigger("activate")}};var old=$.fn.scrollspy;$.fn.scrollspy=function(option){return this.each(function(){var $this=$(this),data=$this.data("scrollspy"),options=typeof option=="object"&&option;if(!data)$this.data("scrollspy",data=new ScrollSpy(this,options));if(typeof option=="string")data[option]()})};$.fn.scrollspy.Constructor=ScrollSpy;$.fn.scrollspy.defaults={offset:10};$.fn.scrollspy.noConflict=function(){$.fn.scrollspy=old;return this};$(window).on("load",function(){$('[data-spy="scroll"]').each(function(){var $spy=$(this);$spy.scrollspy($spy.data())})})}(window.jQuery);!function($){"use strict";var Tab=function(element){this.element=$(element)};Tab.prototype={constructor:Tab,show:function(){var $this=this.element,$ul=$this.closest("ul:not(.dropdown-menu)"),selector=$this.data("target"),previous,$target,e;if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}if($this.parent("li").hasClass("active"))return;previous=$ul.find(".active:last a")[0];e=$.Event("show",{relatedTarget:previous});$this.trigger(e);if(e.isDefaultPrevented())return;$target=$(selector);this.activate($this.parent("li"),$ul);this.activate($target,$target.parent(),function(){$this.trigger({type:"shown",relatedTarget:previous})})},activate:function(element,container,callback){var $active=container.find("> .active"),transition=callback&&$.support.transition&&$active.hasClass("fade");function next(){$active.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");element.addClass("active");if(transition){element[0].offsetWidth;element.addClass("in")}else{element.removeClass("fade")}if(element.parent(".dropdown-menu")){element.closest("li.dropdown").addClass("active")}callback&&callback()}transition?$active.one($.support.transition.end,next):next();$active.removeClass("in")}};var old=$.fn.tab;$.fn.tab=function(option){return this.each(function(){var $this=$(this),data=$this.data("tab");if(!data)$this.data("tab",data=new Tab(this));if(typeof option=="string")data[option]()})};$.fn.tab.Constructor=Tab;$.fn.tab.noConflict=function(){$.fn.tab=old;return this};$(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault();$(this).tab("show")})}(window.jQuery);!function($){"use strict";var Typeahead=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.typeahead.defaults,options);this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.updater=this.options.updater||this.updater;this.source=this.options.source;this.$menu=$(this.options.menu);this.shown=false;this.listen()};Typeahead.prototype={constructor:Typeahead,select:function(){var val=this.$menu.find(".active").attr("data-value");this.$element.val(this.updater(val)).change();return this.hide()},updater:function(item){return item},show:function(){var pos=$.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});this.$menu.insertAfter(this.$element).css({top:pos.top+pos.height,left:pos.left}).show();this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this},lookup:function(event){var items;this.query=this.$element.val();if(!this.query||this.query.length<this.options.minLength){return this.shown?this.hide():this}items=$.isFunction(this.source)?this.source(this.query,$.proxy(this.process,this)):this.source;return items?this.process(items):this},process:function(items){var that=this;items=$.grep(items,function(item){return that.matcher(item)});items=this.sorter(items);if(!items.length){return this.shown?this.hide():this}return this.render(items.slice(0,this.options.items)).show()},matcher:function(item){return~item.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(items){var beginswith=[],caseSensitive=[],caseInsensitive=[],item;while(item=items.shift()){if(!item.toLowerCase().indexOf(this.query.toLowerCase()))beginswith.push(item);else if(~item.indexOf(this.query))caseSensitive.push(item);else caseInsensitive.push(item)}return beginswith.concat(caseSensitive,caseInsensitive)},highlighter:function(item){var query=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return item.replace(new RegExp("("+query+")","ig"),function($1,match){return"<strong>"+match+"</strong>"})},render:function(items){var that=this;items=$(items).map(function(i,item){i=$(that.options.item).attr("data-value",item);i.find("a").html(that.highlighter(item));return i[0]});items.first().addClass("active");this.$menu.html(items);return this},next:function(event){var active=this.$menu.find(".active").removeClass("active"),next=active.next();if(!next.length){next=$(this.$menu.find("li")[0])}next.addClass("active")},prev:function(event){var active=this.$menu.find(".active").removeClass("active"),prev=active.prev();if(!prev.length){prev=this.$menu.find("li").last()}prev.addClass("active")},listen:function(){this.$element.on("focus",$.proxy(this.focus,this)).on("blur",$.proxy(this.blur,this)).on("keypress",$.proxy(this.keypress,this)).on("keyup",$.proxy(this.keyup,this));if(this.eventSupported("keydown")){this.$element.on("keydown",$.proxy(this.keydown,this))}this.$menu.on("click",$.proxy(this.click,this)).on("mouseenter","li",$.proxy(this.mouseenter,this)).on("mouseleave","li",$.proxy(this.mouseleave,this))},eventSupported:function(eventName){var isSupported=eventName in this.$element;if(!isSupported){this.$element.setAttribute(eventName,"return;");isSupported=typeof this.$element[eventName]==="function"}return isSupported},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault();this.prev();break;case 40:e.preventDefault();this.next();break}e.stopPropagation()},keydown:function(e){this.suppressKeyPressRepeat=~$.inArray(e.keyCode,[40,38,9,13,27]);this.move(e)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation();e.preventDefault()},focus:function(e){this.focused=true},blur:function(e){this.focused=false;if(!this.mousedover&&this.shown)this.hide()},click:function(e){e.stopPropagation();e.preventDefault();this.select();this.$element.focus()},mouseenter:function(e){this.mousedover=true;this.$menu.find(".active").removeClass("active");$(e.currentTarget).addClass("active")},mouseleave:function(e){this.mousedover=false;if(!this.focused&&this.shown)this.hide()}};var old=$.fn.typeahead;$.fn.typeahead=function(option){return this.each(function(){var $this=$(this),data=$this.data("typeahead"),options=typeof option=="object"&&option;if(!data)$this.data("typeahead",data=new Typeahead(this,options));if(typeof option=="string")data[option]()})};$.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1};$.fn.typeahead.Constructor=Typeahead;$.fn.typeahead.noConflict=function(){$.fn.typeahead=old;return this};$(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(e){var $this=$(this);if($this.data("typeahead"))return;$this.typeahead($this.data())})}(window.jQuery);!function($){"use strict";var Affix=function(element,options){this.options=$.extend({},$.fn.affix.defaults,options);this.$window=$(window).on("scroll.affix.data-api",$.proxy(this.checkPosition,this)).on("click.affix.data-api",$.proxy(function(){setTimeout($.proxy(this.checkPosition,this),1)},this));this.$element=$(element);this.checkPosition()};Affix.prototype.checkPosition=function(){if(!this.$element.is(":visible"))return;var scrollHeight=$(document).height(),scrollTop=this.$window.scrollTop(),position=this.$element.offset(),offset=this.options.offset,offsetBottom=offset.bottom,offsetTop=offset.top,reset="affix affix-top affix-bottom",affix;if(typeof offset!="object")offsetBottom=offsetTop=offset;if(typeof offsetTop=="function")offsetTop=offset.top();if(typeof offsetBottom=="function")offsetBottom=offset.bottom();affix=this.unpin!=null&&scrollTop+this.unpin<=position.top?false:offsetBottom!=null&&position.top+this.$element.height()>=scrollHeight-offsetBottom?"bottom":offsetTop!=null&&scrollTop<=offsetTop?"top":false;if(this.affixed===affix)return;this.affixed=affix;this.unpin=affix=="bottom"?position.top-scrollTop:null;this.$element.removeClass(reset).addClass("affix"+(affix?"-"+affix:""))};var old=$.fn.affix;$.fn.affix=function(option){return this.each(function(){var $this=$(this),data=$this.data("affix"),options=typeof option=="object"&&option;if(!data)$this.data("affix",data=new Affix(this,options));if(typeof option=="string")data[option]()})};$.fn.affix.Constructor=Affix;$.fn.affix.defaults={offset:0};$.fn.affix.noConflict=function(){$.fn.affix=old;return this};$(window).on("load",function(){$('[data-spy="affix"]').each(function(){var $spy=$(this),data=$spy.data();data.offset=data.offset||{};data.offsetBottom&&(data.offset.bottom=data.offsetBottom);data.offsetTop&&(data.offset.top=data.offsetTop);$spy.affix(data)})})}(window.jQuery)}).call(context,context);(function(){(function(){var IS_NODE,data,fs,imjs,intermine,path,pkg,_ref,_ref1;IS_NODE=typeof exports!=="undefined";if(IS_NODE){imjs=exports}else{intermine=(_ref=this.intermine)!=null?_ref:this.intermine={};imjs=(_ref1=intermine.imjs)!=null?_ref1:intermine.imjs={}}imjs.VERSION="unknown";if(IS_NODE){fs=require("fs");path=require("path");if(process.mainModule!=null){data=fs.readFileSync(path.join(__dirname,"..","package.json"),"utf8");pkg=JSON.parse(data);imjs.VERSION=pkg.version}}else{imjs.VERSION="2.10.8"}}).call(this);(function(){var HAS_CONSOLE,HAS_JSON,IS_NODE,NOT_ENUM,hasDontEnumBug,hasOwnProperty,m,_fn,_i,_len,_ref,_ref1,_ref2,_ref3;IS_NODE=typeof exports!=="undefined";HAS_CONSOLE=typeof console!=="undefined";HAS_JSON=typeof JSON!=="undefined";NOT_ENUM=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];if(!IS_NODE){if(!HAS_JSON){jQuery.getScript("http://cdn.intermine.org/js/json3/3.2.2/json3.min.js")}if(Object.keys==null){hasOwnProperty=Object.prototype.hasOwnProperty;hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString");Object.keys=function(o){var keys,name,nonEnum,_i,_len;if(typeof o!=="object"&&typeof o!==""||o===null){throw new TypeError("Object.keys called on a non-object")}keys=function(){var _results;_results=[];for(name in o){if(hasOwnProperty.call(o,name)){_results.push(name)}}return _results}();if(hasDontEnumBug){for(_i=0,_len=NOT_ENUM.length;_i<_len;_i++){nonEnum=NOT_ENUM[_i];if(hasOwnProperty.call(o,nonEnum)){keys.push(nonEnum)}}}return keys}}if(Array.prototype.map==null){Array.prototype.map=function(f){var x,_i,_len,_results;_results=[];for(_i=0,_len=this.length;_i<_len;_i++){x=this[_i];_results.push(f(x))}return _results}}if(Array.prototype.filter==null){Array.prototype.filter=function(f){var x,_i,_len,_results;_results=[];for(_i=0,_len=this.length;_i<_len;_i++){x=this[_i];if(f(x)){_results.push(x)}}return _results}}if(Array.prototype.reduce==null){Array.prototype.reduce=function(f,initValue){var ret,x,xs,_i,_len;xs=this.slice();ret=arguments.length<2?xs.pop():initValue;for(_i=0,_len=xs.length;_i<_len;_i++){x=xs[_i];ret=f(ret,x)}return ret}}if(Array.prototype.forEach==null){Array.prototype.forEach=function(f,ctx){var i,x,_i,_len,_results;if(!f){throw new Error("No function provided")}_results=[];for(i=_i=0,_len=this.length;_i<_len;i=++_i){x=this[i];_results.push(f.call(ctx!=null?ctx:this,x,i,this))}return _results}}if(!HAS_CONSOLE){this.console={log:function(){},error:function(){},debug:function(){}};if(typeof window!=="undefined"&&window!==null){window.console=this.console}}if((_ref=console.log)==null){console.log=function(){}}if((_ref1=console.error)==null){console.error=function(){}}if((_ref2=console.debug)==null){console.debug=function(){}}if(console.log.apply==null){console.log("Your console needs patching.");_ref3=["log","error","debug"];_fn=function(m){var oldM;oldM=console[m];return console[m]=function(args){return oldM(args)}};for(_i=0,_len=_ref3.length;_i<_len;_i++){m=_ref3[_i];_fn(m)}}}}).call(this);(function(root,undefined){var _=root._,jQuery=root.jQuery;if(typeof jQuery==="undefined"){return null}var $=jQuery;if(!$.support.cors&&window.XDomainRequest){console.log("Patching IE x-domain request support");var httpRegEx=/^https?:\/\//i;var getOrPostRegEx=/^get|post$/i;var sameSchemeRegEx=new RegExp("^"+location.protocol,"i");var jsonRegEx=/\/json/i;var xmlRegEx=/\/xml/i;var XDomainTransporter=function(userOptions,options){this.userOptions=userOptions;this.options=options;this.userType=(userOptions.dataType||"").toLowerCase();_.bindAll(this)};XDomainTransporter.prototype.constructor=XDomainTransporter;XDomainTransporter.prototype.send=function(headers,complete){this.xdr=new XDomainRequest;this.complete=complete;var xdr=this.xdr;if(/^\d+$/.test(this.userOptions.timeout)){xdr.timeout=this.userOptions.timeout}xdr.ontimeout=function(){complete(500,"timeout")};xdr.onerror=function(){complete(500,"error",{text:xdr.responseText})};xdr.onload=this.onLoad;var postData=this.userOptions.data&&$.param(this.userOptions.data)||"";xdr.open(this.options.type,this.options.url);xdr.send(postData)};XDomainTransporter.prototype.respond=function(status,statusText,responses,responseHeaders){var xdr=this.xdr;xdr.onload=xdr.onerror=xdr.ontimeout=xdr.onprogress=jQuery.noop;delete this.xdr;jQuery.event.trigger("ajaxStop");this.complete(status,statusText,responses,responseHeaders)};XDomainTransporter.prototype.abort=function(){if(xdr){xdr.abort()}};XDomainTransporter.prototype.onLoad=function(){var xdr=this.xdr;var allResponseHeaders="Content-Length: "+xdr.responseText.length+"\r\nContent-Type: "+xdr.contentType;var status={code:200,message:"success"};var responses={text:xdr.responseText};try{if(this.userType==="json"||this.userType!=="text"&&jsonRegEx.test(xdr.contentType)){try{responses.json=$.parseJSON(xdr.responseText)}catch(e){status.code=500;status.message="parseerror"}}else if(this.userType==="xml"||this.userType!=="text"&&xmlRegEx.test(xdr.contentType)){var doc=new ActiveXObject("Microsoft.XMLDOM");doc.async=false;try{doc.loadXML(xdr.responseText)}catch(e){doc=undefined}if(!doc||!doc.documentElement||doc.getElementsByTagName("parsererror").length){status.code=500;status.message="parseerror";throw"Invalid XML: "+xdr.responseText}responses.xml=doc}}catch(parseMessage){throw parseMessage}finally{this.complete(status.code,status.message,responses,allResponseHeaders)}};jQuery.ajaxTransport("text html xml json",function(options,userOptions,jqXHR){if(options.crossDomain&&options.async&&getOrPostRegEx.test(options.type)&&httpRegEx.test(userOptions.url)&&sameSchemeRegEx.test(userOptions.url)){return new XDomainTransporter(userOptions,options)}});jQuery.support.cors=true}}).call(this,typeof exports==="undefined"?this:exports);(function(){var IS_NODE,constants,intermine,_ref,_ref1;IS_NODE=typeof exports!=="undefined";if(IS_NODE){constants=exports}else{intermine=(_ref=this.intermine)!=null?_ref:this.intermine={};constants=(_ref1=intermine.constants)!=null?_ref1:intermine.constants={}}constants.ACCEPT_HEADER={json:"application/json",jsonobjects:"application/json;type=objects",jsontable:"application/json;type=table",jsonrows:"application/json;type=rows",jsoncount:"application/json;type=count",jsonp:"application/javascript",jsonpobjects:"application/javascript;type=objects",jsonptable:"application/javascript;type=table",jsonprows:"application/javascript;type=rows",jsonpcount:"application/javascript;type=count"}}).call(this);(function(){var Deferred,IS_NODE,REQUIRES,curry,fold,id,pairFold,root,success,thenFold,_,_base,_ref,_ref1,__slice=[].slice,__hasProp={}.hasOwnProperty;IS_NODE=typeof exports!=="undefined";root=typeof exports!=="undefined"&&exports!==null?exports:this;if(IS_NODE){Deferred=require("underscore.deferred").Deferred;_=require("underscore")._}else{Deferred=root.jQuery.Deferred;_=root._;if((_ref=root.intermine)==null){root.intermine={}}if((_ref1=(_base=root.intermine).funcutils)==null){_base.funcutils={}}root=root.intermine.funcutils}root.curry=curry=function(){var args,f;f=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];return function(){var rest;rest=1<=arguments.length?__slice.call(arguments,0):[];return f.apply(null,args.concat(rest))}};root.error=function(e){return Deferred(function(){return this.reject(new Error(e))}).promise()};root.success=success=function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return Deferred(function(){return this.resolve.apply(this,args)}).promise()};root.fold=fold=function(f){return function(init,xs){var k,ret,v;if(arguments.length===1){xs=(init!=null?init.slice():void 0)||init;init=(xs!=null?xs.shift():void 0)||{}}if(xs==null){throw new Error("xs is null")}if(xs.reduce!=null){return xs.reduce(f,init)}else{ret=init;for(k in xs){v=xs[k];ret=ret!=null?f(ret,k,v):{k:v}
}return ret}}};root.take=function(n){return function(xs){if(n!=null){return xs.slice(0,n-1+1||9e9)}else{return xs}}};root.filter=function(f){return function(xs){var x,_i,_len,_results;_results=[];for(_i=0,_len=xs.length;_i<_len;_i++){x=xs[_i];if(f(x)){_results.push(x)}}return _results}};root.omap=function(f){var merger;merger=fold(function(a,oldk,oldv){var newk,newv,_ref2;_ref2=f(oldk,oldv),newk=_ref2[0],newv=_ref2[1];a[newk]=newv;return a});return function(xs){return merger({},xs)}};root.copy=root.omap(function(k,v){return[k,v]});root.partition=function(f){return function(xs){var falses,trues,x,_i,_len;trues=[];falses=[];for(_i=0,_len=xs.length;_i<_len;_i++){x=xs[_i];if(f(x)){trues.push(x)}else{falses.push(x)}}return[trues,falses]}};root.id=id=function(x){return x};root.concatMap=function(f){return function(xs){var fx,k,ret,v,x,_i,_len;ret=void 0;for(_i=0,_len=xs.length;_i<_len;_i++){x=xs[_i];fx=f(x);ret=function(){var _ref2;if(ret===void 0){return fx}else if((_ref2=typeof fx)==="string"||_ref2==="number"){return ret+fx}else if(fx.slice!=null){return ret.concat(fx)}else{for(k in fx){v=fx[k];ret[k]=v}return ret}}()}return ret}};root.flatMap=root.concatMap;root.sum=root.concatMap(id);root.AND=function(a,b){return a&&b};root.OR=function(a,b){return a||b};root.NOT=function(x){return!x};root.any=function(xs,f){var x,_i,_len;if(f==null){f=id}for(_i=0,_len=xs.length;_i<_len;_i++){x=xs[_i];if(f(x)){return true}}return false};root.invoke=function(){var args,name;name=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];return function(obj){var _ref2;if((_ref2=obj[name])!=null?_ref2.apply:void 0){return obj[name].apply(obj,args)}else{return Deferred().reject("No method: "+name).promise()}}};root.invokeWith=function(name,args,ctx){if(args==null){args=[]}if(ctx==null){ctx=null}return function(o){return o[name].apply(ctx||o,args)}};root.get=function(name){return function(obj){return obj[name]}};root.set=function(name,value){return function(obj){var k,v;if(arguments.length===2){obj[name]=value}else{for(k in name){if(!__hasProp.call(name,k))continue;v=name[k];obj[k]=v}}return obj}};root.flip=function(f){return function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return f.apply(null,args.reverse())}};REQUIRES=function(required,got){return"This service requires a service at version "+required+" or above. This one is at "+got};root.REQUIRES_VERSION=function(s,n,f){return s.fetchVersion().pipe(function(v){if(v>=n){return f()}else{return error(REQUIRES(n,v))}})};root.dejoin=function(q){var parts,view,_i,_len,_ref2;_ref2=q.views;for(_i=0,_len=_ref2.length;_i<_len;_i++){view=_ref2[_i];parts=view.split(".");if(parts.length>2){q.addJoin(parts.slice(1,-1).join("."))}}return q};thenFold=fold(function(p,f){return p.then(f)});root.sequence=function(){var fns;fns=1<=arguments.length?__slice.call(arguments,0):[];return thenFold(success(),_.flatten(fns))};pairFold=fold(function(o,_arg){var k,v;k=_arg[0],v=_arg[1];if(o[k]!=null){throw new Error("Duplicate key: "+k)}o[k]=v;return o});root.pairsToObj=function(pairs){return pairFold({},pairs)}}).call(this);(function(){var IS_NODE,buildArray,buildDict,intermine,__root__,_ref,__slice=[].slice;IS_NODE=typeof exports!=="undefined";__root__=typeof exports!=="undefined"&&exports!==null?exports:this;if(IS_NODE){intermine=__root__}else{intermine=__root__.intermine;if(intermine==null){intermine=__root__.intermine={}}}if((_ref=intermine.compression)==null){intermine.compression={}}buildDict=function(size){var dict,i,_i;dict={};for(i=_i=0;0<=size?_i<=size:_i>=size;i=0<=size?++_i:--_i){dict[String.fromCharCode(i)]=i}return dict};buildArray=function(size){var x,_i,_results;_results=[];for(x=_i=0;0<=size?_i<=size:_i>=size;x=0<=size?++_i:--_i){_results.push(String.fromCharCode(x))}return _results};intermine.compression.LZW={encode:function(s){var char,currPhrase,data,dict,dictSize,out,phrase,_i,_len;data=(s+"").split("");out=[];phrase="";dictSize=256;dict=buildDict(dictSize);for(_i=0,_len=data.length;_i<_len;_i++){char=data[_i];currPhrase=phrase+char;if(currPhrase in dict){phrase=currPhrase}else{out.push(dict[phrase]);dict[currPhrase]=dictSize++;phrase=String(char)}}if(phrase!==""){out.push(dict[phrase])}return out},decode:function(data){var code,dict,dictSize,entry,head,result,tail,word,_i,_len;dictSize=256;dict=buildArray(dictSize);entry="";head=data[0],tail=2<=data.length?__slice.call(data,1):[];word=String.fromCharCode(head);result=[word];for(_i=0,_len=tail.length;_i<_len;_i++){code=tail[_i];entry=function(){if(dict[code]){return dict[code]}else if(code===dictSize){return word+word.charAt(0)}else{throw new Error("Key is "+code)}}();result.push(entry);dict[dictSize++]=word+entry.charAt(0);word=entry}return result.join("")}}}).call(this);(function(){var ACCEPT_HEADER,CHECKING_PIPE,ERROR_PIPE,XDomainRequest,error,get,http,inIE9,intermine,jQuery,mappingForIE,wrapCbs,_,_ref,_ref1;jQuery=this.jQuery,_=this._,intermine=this.intermine,XDomainRequest=this.XDomainRequest;http=(_ref=intermine.http)!=null?_ref:intermine.http={};ACCEPT_HEADER=intermine.constants.ACCEPT_HEADER;_ref1=intermine.funcutils,get=_ref1.get,error=_ref1.error;(function(){var converters,format,header;converters={};for(format in ACCEPT_HEADER){header=ACCEPT_HEADER[format];converters["text "+format]=jQuery.parseJSON}return jQuery.ajaxSetup({accepts:ACCEPT_HEADER,contents:{json:/json/},converters:converters})})();CHECKING_PIPE=function(response){return jQuery.Deferred(function(){if(response.wasSuccessful){return this.resolve(response)}else{return this.reject(response.error,response)}})};ERROR_PIPE=function(f){if(f==null){f=function(){}}return function(xhr,textStatus,e){if((xhr!=null?xhr.status:void 0)===0){return}try{return f(JSON.parse(xhr.responseText).error)}catch(e){return f(textStatus)}}};inIE9=XDomainRequest!=null;mappingForIE={PUT:"POST",DELETE:"GET"};if(inIE9){http.getMethod=function(x){var _ref2;return(_ref2=mappingForIE[x])!=null?_ref2:x};http.supports=function(m){return!(m in mappingForIE)}}else{http.getMethod=function(x){return x};http.supports=function(){return true}}wrapCbs=function(cbs){var atEnd,doThis,err,_doThis;if(_.isArray(cbs)){if(!cbs.length){return[]}doThis=cbs[0],err=cbs[1],atEnd=cbs[2];_doThis=function(rows){return _.each(rows,doThis!=null?doThis:function(){})};return[_doThis,err,atEnd]}else{_doThis=function(rows){return _.each(rows,cbs!=null?cbs:function(){})};return[_doThis]}};http.iterReq=function(method,path,fmt){return function(q,page,doThis,onErr,onEnd){var req,_doThis,_ref2;if(page==null){page={}}if(doThis==null){doThis=function(){}}if(onErr==null){onErr=function(){}}if(onEnd==null){onEnd=function(){}}if(arguments.length===2&&_.isFunction(page)){_ref2=[page,{}],doThis=_ref2[0],page=_ref2[1]}req=_.extend({format:fmt},page,{query:q.toXML()});_doThis=function(rows){return rows.forEach(doThis)};return this.makeRequest(method,path,req).fail(onErr).pipe(get("results")).done(doThis).done(onEnd)}};http.doReq=function(opts){var def,errBack;errBack=opts.error||this.errorHandler;opts.error=ERROR_PIPE(errBack);def=jQuery.Deferred(function(){var resp,_this=this;resp=jQuery.ajax(opts);resp.then(function(){return _this.resolve.apply(_this,arguments)});return resp.fail(ERROR_PIPE(function(err){return _this.reject(err)}))});return def.promise()}}).call(this);(function(){var DOMParser,IS_NODE,domParser,intermine,jQuery,parse,__root__,_ref;IS_NODE=typeof exports!=="undefined";if(IS_NODE){DOMParser=require("xmldom").DOMParser;__root__=exports;domParser=new DOMParser;parse=function(xml){var ret;if(!(xml!=null?xml.match("<.*>"):void 0)){xml=xml+">"}try{if(xml){ret=domParser.parseFromString(xml,"text/xml")}}catch(e){ret=void 0}if(!ret||!ret.documentElement||ret.getElementsByTagName("parsererror").length){throw new Error("Invalid xml: "+xml)}return ret}}else{jQuery=this.jQuery,intermine=this.intermine;__root__=(_ref=intermine.xml)!=null?_ref:intermine.xml={};parse=jQuery.parseXML}__root__.parse=parse}).call(this);(function(){var IS_NODE,Table,merge,properties,__root__,_ref;IS_NODE=typeof exports!=="undefined";__root__=typeof exports!=="undefined"&&exports!==null?exports:(_ref=this.intermine)!=null?_ref:this.intermine={};merge=function(src,dest){var k,v,_results;_results=[];for(k in src){v=src[k];_results.push(dest[k]=v)}return _results};properties=["attributes","references","collections"];Table=function(){function Table(_arg){var c,prop,_,_i,_len,_ref1;this.name=_arg.name,this.attributes=_arg.attributes,this.references=_arg.references,this.collections=_arg.collections;this.fields={};this.__parents__=arguments[0]["extends"];for(_i=0,_len=properties.length;_i<_len;_i++){prop=properties[_i];merge(this[prop],this.fields)}_ref1=this.collections;for(_ in _ref1){c=_ref1[_];c.isCollection=true}}Table.prototype.toString=function(){var n,_;return"[Table name="+this.name+", fields=["+function(){var _ref1,_results;_ref1=this.fields;_results=[];for(n in _ref1){_=_ref1[n];_results.push(n)}return _results}.call(this)+"]]"};Table.prototype.parents=function(){var _ref1;return((_ref1=this.__parents__)!=null?_ref1:[]).slice()};return Table}();__root__.Table=Table}).call(this);(function(){var $,Deferred,IS_NODE,NAMES,PARSED,PathInfo,any,concatMap,copy,error,get,intermine,makeKey,set,success,utils,_,__root__,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};IS_NODE=typeof exports!=="undefined";__root__=typeof exports!=="undefined"&&exports!==null?exports:this;if(IS_NODE){intermine=__root__;_=require("underscore")._;Deferred=($=require("underscore.deferred")).Deferred;utils=require("./util")}else{_=__root__._;Deferred=($=__root__.jQuery).Deferred;intermine=__root__.intermine;utils=intermine.funcutils}concatMap=utils.concatMap,get=utils.get,any=utils.any,set=utils.set,copy=utils.copy,success=utils.success,error=utils.error;NAMES={};PARSED={};makeKey=function(model,path,subclasses){var k,v,_ref;return""+(model!=null?model.name:void 0)+"|"+(model!=null?(_ref=model.service)!=null?_ref.root:void 0:void 0)+"|"+path+":"+function(){var _results;_results=[];for(k in subclasses){v=subclasses[k];_results.push(""+k+"="+v)}return _results}()};PathInfo=function(){function PathInfo(_arg){var _ref;this.root=_arg.root,this.model=_arg.model,this.descriptors=_arg.descriptors,this.subclasses=_arg.subclasses,this.displayName=_arg.displayName,this.ident=_arg.ident;this.allDescriptors=__bind(this.allDescriptors,this);this.getChildNodes=__bind(this.getChildNodes,this);this.getDisplayName=__bind(this.getDisplayName,this);this.isa=__bind(this.isa,this);this.append=__bind(this.append,this);this.getParent=__bind(this.getParent,this);this.getEndClass=__bind(this.getEndClass,this);this.containsCollection=__bind(this.containsCollection,this);this.isCollection=__bind(this.isCollection,this);this.isReference=__bind(this.isReference,this);this.isClass=__bind(this.isClass,this);this.isAttribute=__bind(this.isAttribute,this);this.isRoot=__bind(this.isRoot,this);this.end=_.last(this.descriptors);if((_ref=this.ident)==null){this.ident=makeKey(this.model,this,this.subclasses)}}PathInfo.prototype.isRoot=function(){return this.descriptors.length===0};PathInfo.prototype.isAttribute=function(){return this.end!=null&&!(this.end.referencedType!=null)};PathInfo.prototype.isClass=function(){return this.isRoot()||this.end.referencedType!=null};PathInfo.prototype.isReference=function(){var _ref;return((_ref=this.end)!=null?_ref.referencedType:void 0)!=null};PathInfo.prototype.isCollection=function(){var _ref,_ref1;return(_ref=(_ref1=this.end)!=null?_ref1.isCollection:void 0)!=null?_ref:false};PathInfo.prototype.containsCollection=function(){return any(this.descriptors,function(x){return x.isCollection})};PathInfo.prototype.getEndClass=function(){var _ref;return this.model.classes[this.subclasses[this.toString()]||((_ref=this.end)!=null?_ref.referencedType:void 0)]||this.root};PathInfo.prototype.getParent=function(){var data;if(this.isRoot()){throw new Error("Root paths do not have parents")}data={root:this.root,model:this.model,descriptors:_.initial(this.descriptors),subclasses:this.subclasses};return new PathInfo(data)};PathInfo.prototype.append=function(attr){var data,fld;if(this.isAttribute()){throw new Error(""+this+" is an attribute.")}fld=_.isString(attr)?this.getType().fields[attr]:attr;if(fld==null){throw new Error(""+attr+" is not a field of "+this.getType())}data={root:this.root,model:this.model,descriptors:this.descriptors.concat(fld),subclasses:this.subclasses};return new PathInfo(data)};PathInfo.prototype.isa=function(clazz){var name,type;if(this.isAttribute()){return this.getType()===clazz}else{name=clazz.name?clazz.name:""+clazz;type=this.getType();return name===type.name||__indexOf.call(this.model.getAncestorsOf(type),name)>=0}};PathInfo.prototype.getDisplayName=function(cb){var cached,custom,params,path,_ref,_this=this;if(custom=this.displayName){return success(custom)}if((_ref=this.namePromise)==null){this.namePromise=(cached=NAMES[this.ident])?success(cached):!(this.model.service!=null)?error("No service"):(path="model"+concatMap(function(d){return"/"+d.name})(this.allDescriptors()),params=set({format:"json"})(copy(this.subclasses)),this.model.service.get(path,params).then(get("display")).done(function(n){var _name,_ref1;return(_ref1=NAMES[_name=_this.ident])!=null?_ref1:NAMES[_name]=n}))}return this.namePromise.done(cb)};PathInfo.prototype.getChildNodes=function(){var fld,name,_ref,_ref1,_results;_ref1=((_ref=this.getEndClass())!=null?_ref.fields:void 0)||{};_results=[];for(name in _ref1){fld=_ref1[name];_results.push(this.append(fld))}return _results};PathInfo.prototype.allDescriptors=function(){return[this.root].concat(this.descriptors)};PathInfo.prototype.toString=function(){return this.allDescriptors().map(get("name")).join(".")};PathInfo.prototype.equals=function(other){return other&&other.ident!=null&&this.ident===other.ident};PathInfo.prototype.getType=function(){var _ref,_ref1;return((_ref=this.end)!=null?(_ref1=_ref.type)!=null?_ref1.replace(/java\.lang\./,""):void 0:void 0)||this.getEndClass()};return PathInfo}();PathInfo.prototype.toPathString=PathInfo.prototype.toString;PathInfo.parse=function(model,path,subclasses){var cached,cd,descriptors,fld,ident,keyPath,part,parts,root;if(subclasses==null){subclasses={}}ident=makeKey(model,path,subclasses);if(cached=PARSED[ident]){return cached}parts=(path+"").split(".");root=cd=model.classes[parts.shift()];keyPath=root.name;descriptors=function(){var _i,_len,_ref,_results;_results=[];for(_i=0,_len=parts.length;_i<_len;_i++){part=parts[_i];fld=(cd!=null?cd.fields[part]:void 0)||((_ref=cd=model.classes[subclasses[keyPath]])!=null?_ref.fields[part]:void 0);if(!fld){throw new Error("Could not find "+part+" in "+cd+" when parsing "+path)}keyPath+="."+part;cd=model.classes[fld.type||fld.referencedType];_results.push(fld)}return _results}();return PARSED[ident]=new PathInfo({root:root,model:model,descriptors:descriptors,subclasses:subclasses,ident:ident})};PathInfo.flushCache=function(){PARSED={};return NAMES={}};intermine.PathInfo=PathInfo}).call(this);(function(){var $,Deferred,IS_NODE,Model,PathInfo,Table,flatten,intermine,intersection,liftToTable,omap,_,__root__,_ref,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};IS_NODE=typeof exports!=="undefined";__root__=typeof exports!=="undefined"&&exports!==null?exports:this;if(IS_NODE){intermine=__root__;_=require("underscore")._;Deferred=($=require("underscore.deferred")).Deferred;Table=require("./table").Table;PathInfo=require("./path").PathInfo;omap=require("./util").omap}else{_=__root__._;Deferred=($=__root__.jQuery).Deferred;intermine=(_ref=__root__.intermine)!=null?_ref:__root__.intermine={};Table=intermine.Table,PathInfo=intermine.PathInfo;omap=intermine.funcutils.omap}flatten=_.flatten,intersection=_.intersection;liftToTable=omap(function(k,v){return[k,new Table(v)]});Model=function(){function Model(_arg){var classes;this.name=_arg.name,classes=_arg.classes;this.findCommonType=__bind(this.findCommonType,this);this.findSharedAncestor=__bind(this.findSharedAncestor,this);this.getAncestorsOf=__bind(this.getAncestorsOf,this);this.getSubclassesOf=__bind(this.getSubclassesOf,this);this.getPathInfo=__bind(this.getPathInfo,this);this.classes=liftToTable(classes)}Model.prototype.getPathInfo=function(path,subcls){return PathInfo.parse(this,path,subcls)};Model.prototype.getSubclassesOf=function(cls){var cd,clazz,ret,_ref1,_ref2;clazz=cls&&cls.name?cls:this.classes[cls];if(clazz==null){throw new Error(""+cls+" is not a table")}ret=[clazz.name];_ref1=this.classes;for(_ in _ref1){cd=_ref1[_];if(_ref2=clazz.name,__indexOf.call(cd.parents(),_ref2)>=0){ret=ret.concat(this.getSubclassesOf(cd))}}return ret};Model.prototype.getAncestorsOf=function(cls){var ancestors,clazz,superC,_i,_len;clazz=cls&&cls.name?cls:this.classes[cls];if(clazz==null){throw new Error(""+cls+" is not a table")}ancestors=clazz.parents();for(_i=0,_len=ancestors.length;_i<_len;_i++){superC=ancestors[_i];ancestors.push(this.getAncestorsOf(superC))}return flatten(ancestors)};Model.prototype.findSharedAncestor=function(classA,classB){var a_ancestry,b_ancestry,_ref1;if(classB===null||classA===null){return null}if(classA===classB){return classA}a_ancestry=this.getAncestorsOf(classA);if(__indexOf.call(a_ancestry,classB)>=0){return classB}b_ancestry=this.getAncestorsOf(classB);if(__indexOf.call(b_ancestry,classA)>=0){return classA}return(_ref1=intersection(a_ancestry,b_ancestry).shift())!=null?_ref1:null};Model.prototype.findCommonType=function(xs){if(xs==null){xs=[]}return xs.reduce(this.findSharedAncestor)};return Model}();Model.prototype.makePath=Model.prototype.getPathInfo;Model.prototype.findCommonTypeOfMultipleClasses=Model.prototype.findCommonType;Model.load=function(data){return new Model(data)};Model.INTEGRAL_TYPES=["int","Integer","long","Long"];Model.FRACTIONAL_TYPES=["double","Double","float","Float"];Model.NUMERIC_TYPES=Model.INTEGRAL_TYPES.concat(Model.FRACTIONAL_TYPES);Model.BOOLEAN_TYPES=["boolean","Boolean"];intermine.Model=Model}).call(this);(function(){var Deferred,IS_NODE,User,do_pref_req,error,intermine,_,__root__,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};IS_NODE=typeof exports!=="undefined";__root__=typeof exports!=="undefined"&&exports!==null?exports:this;if(IS_NODE){Deferred=require("underscore.deferred").Deferred;_=require("underscore")._;error=require("./util").error;intermine=__root__}else{_=__root__._;Deferred=__root__.jQuery.Deferred;intermine=__root__.intermine;error=intermine.funcutils.error}do_pref_req=function(user,data,method){return user.service.manageUserPreferences(method,data).done(function(prefs){return user.preferences=prefs})};User=function(){function User(service,_arg){var _ref;this.service=service;this.username=_arg.username,this.preferences=_arg.preferences;this.refresh=__bind(this.refresh,this);this.clearPreferences=__bind(this.clearPreferences,this);this.clearPreference=__bind(this.clearPreference,this);this.setPreferences=__bind(this.setPreferences,this);this.setPreference=__bind(this.setPreference,this);this.hasPreferences=this.preferences!=null;if((_ref=this.preferences)==null){this.preferences={}}}User.prototype.setPreference=function(key,value){var data;if(_.isString(key)){data={};data[key]=value}else if(!(value!=null)){data=key}else{error("Incorrect arguments to setPreference")}return this.setPreferences(data)};User.prototype.setPreferences=function(prefs){return do_pref_req(this,prefs,"POST")};User.prototype.clearPreference=function(key){return do_pref_req(this,{key:key},"DELETE")};User.prototype.clearPreferences=function(){return do_pref_req(this,{},"DELETE")};User.prototype.refresh=function(){return do_pref_req(this,{},"GET")};return User}();intermine.User=User}).call(this);(function(){var INVITES,IS_NODE,List,REQUIRES_VERSION,SHARES,TAGS_PATH,dejoin,funcutils,get,getFolderName,intermine,invoke,isFolder,set,_,__root__,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};IS_NODE=typeof exports!=="undefined";__root__=typeof exports!=="undefined"&&exports!==null?exports:this;if(IS_NODE){_=require("underscore")._;funcutils=require("./util");intermine=__root__}else{_=__root__._,intermine=__root__.intermine;funcutils=intermine.funcutils}get=funcutils.get,invoke=funcutils.invoke,REQUIRES_VERSION=funcutils.REQUIRES_VERSION,set=funcutils.set,dejoin=funcutils.dejoin;TAGS_PATH="list/tags";SHARES="lists/shares";INVITES="lists/invitations";isFolder=function(t){return t.substr(0,t.indexOf(":"))==="__folder__"};getFolderName=function(t){return s.substr(t.indexOf(":")+1)};List=function(){function List(properties,service){var k,v;this.service=service;this.hasTag=__bind(this.hasTag,this);for(k in properties){if(!__hasProp.call(properties,k))continue;v=properties[k];this[k]=v}this.dateCreated=this.dateCreated!=null?new Date(this.dateCreated):null;this.folders=this.tags.filter(isFolder).map(getFolderName)}List.prototype.hasTag=function(t){return __indexOf.call(this.tags,t)>=0};List.prototype.query=function(view){if(view==null){view=["*"]}return this.service.query({select:view,from:this.type,where:[[this.type,"IN",this.name]]})};List.prototype.del=function(cb){return this.service.makeRequest("DELETE","lists",{name:this.name},cb)};List.prototype.fetchTags=function(cb){var _this=this;return this.service.makeRequest("GET","list/tags",{name:this.name}).pipe(function(resp){return resp.tags}).done(function(tags){_this.tags=tags;return _this.folders.filter(isFolder).map(getFolderName)}).done(cb)};List.prototype.addTags=function(tags,cb){var _this=this;return this.service.makeRequest("POST","list/tags",{name:this.name,tags:tags}).pipe(function(resp){return resp.tags}).done(function(tags){_this.tags=tags;return _this.folders.filter(isFolder).map(getFolderName)}).done(cb)};List.prototype.removeTags=function(tags,cb){var _this=this;return this.service.makeRequest("DELETE","list/tags",{name:this.name,tags:tags}).pipe(function(resp){return resp.tags}).done(function(tags){_this.tags=tags;return _this.folders.filter(isFolder).map(getFolderName)}).done(cb)};List.prototype.contents=function(cb){return this.query().pipe(dejoin).pipe(invoke("records")).done(cb)};List.prototype.rename=function(newName,cb){var _this=this;return this.service.post("lists/rename",{oldname:this.name,newname:newName}).pipe(get("listName")).done(function(n){return _this.name=n}).pipe(this.service.fetchList).done(cb)};List.prototype.copy=function(opts,cb){var baseName,name,query,tags,_ref,_ref1,_ref2,_this=this;if(opts==null){opts={}}if(cb==null){cb=function(){}}if(arguments.length===1&&_.isFunction(opts)){_ref=[{},opts],opts=_ref[0],cb=_ref[1]}if(_.isString(opts)){opts={name:""+opts}}name=baseName=(_ref1=opts.name)!=null?_ref1:""+this.name+"_copy";tags=this.tags.concat((_ref2=opts.tags)!=null?_ref2:[]);query=this.query(["id"]);return this.service.fetchLists().pipe(invoke("map",get("name"))).pipe(function(names){var c;c=1;while(__indexOf.call(names,name)>=0){name=""+baseName+"-"+c++}return query.pipe(invoke("saveAsList",{name:name,tags:tags,description:_this.description})).done(cb)})};List.prototype.enrichment=function(opts,cb){return this.service.enrichment(set({list:this.name})(opts),cb)};List.prototype.shareWithUser=function(recipient,cb){return this.service.post(SHARES,{list:this.name,"with":recipient}).done(cb)};List.prototype.inviteUserToShare=function(recipient,notify,cb){if(notify==null){notify=true}if(cb==null){cb=function(){}}return this.service.post(INVITES,{list:this.name,to:recipient,notify:!!notify}).done(cb)};return List}();intermine.List=List}).call(this);(function(){var CategoryResults,Deferred,IDResolutionJob,IS_NODE,IdResults,ONE_MINUTE,concatMap,fold,funcutils,get,id,intermine,__root__,__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};IS_NODE=typeof exports!=="undefined";__root__=typeof exports!=="undefined"&&exports!==null?exports:this;if(IS_NODE){Deferred=require("underscore.deferred").Deferred;funcutils=require("./util");intermine=__root__}else{Deferred=__root__.jQuery.Deferred;intermine=__root__.intermine;funcutils=intermine.funcutils}id=funcutils.id,get=funcutils.get,fold=funcutils.fold,concatMap=funcutils.concatMap;ONE_MINUTE=60*1e3;CategoryResults=function(){var getIssueMatches;function CategoryResults(results){var k,v;for(k in results){if(!__hasProp.call(results,k))continue;v=results[k];this[k]=v}}getIssueMatches=concatMap(get("matches"));CategoryResults.prototype.getMatches=function(k){var _ref;if(k==="MATCH"){return this.matches[k]}else{return(_ref=getIssueMatches(this.matches[k]))!=null?_ref:[]}};CategoryResults.prototype.getMatchIds=function(k){if(k!=null){return this.getMatches(k).map(get("id"))}else{return this.allMatchIds()}};CategoryResults.prototype.goodMatchIds=function(){return this.getMatchIds("MATCH")};CategoryResults.prototype.allMatchIds=function(){var combineIds,_this=this;combineIds=fold(function(res,issueSet){return res.concat(_this.getMatchIds(issueSet))});return combineIds(this.goodMatchIds(),["DUPLICATE","WILDCARD","TYPE_CONVERTED","OTHER"])};return CategoryResults}();IdResults=function(){var flatten,getReasons,isGood;function IdResults(results){var k,v;for(k in results){if(!__hasProp.call(results,k))continue;v=results[k];this[k]=v}}flatten=concatMap(id);getReasons=function(match){var k,vals;return flatten(function(){var _ref,_results;_ref=match.identifiers;_results=[];for(k in _ref){vals=_ref[k];_results.push(vals)}return _results}())};isGood=function(match,k){return!(k!=null)||__indexOf.call(getReasons(match),k)>=0};IdResults.prototype.getMatches=function(k){var match,_results;_results=[];for(id in this){if(!__hasProp.call(this,id))continue;match=this[id];if(isGood(match,k)){_results.push(match)}}return _results};IdResults.prototype.getMatchIds=function(k){var match,_results;_results=[];for(id in this){if(!__hasProp.call(this,id))continue;match=this[id];if(isGood(match,k)){_results.push(id)}}return _results};IdResults.prototype.goodMatchIds=function(){return this.getMatchIds("MATCH")};IdResults.prototype.allMatchIds=function(){return this.getMatchIds()};return IdResults}();IDResolutionJob=function(){function IDResolutionJob(uid,service){this.uid=uid;this.service=service;this.del=__bind(this.del,this);this.fetchResults=__bind(this.fetchResults,this);this.fetchErrorMessage=__bind(this.fetchErrorMessage,this);this.fetchStatus=__bind(this.fetchStatus,this)}IDResolutionJob.prototype.fetchStatus=function(cb){return this.service.get("ids/"+this.uid+"/status").pipe(get("status")).done(cb)};IDResolutionJob.prototype.fetchErrorMessage=function(cb){return this.service.get("ids/"+this.uid+"/status").pipe(get("message")).done(cb)};IDResolutionJob.prototype.fetchResults=function(cb){var gettingRes,gettingVer;gettingRes=this.service.get("ids/"+this.uid+"/result").pipe(get("results"));gettingVer=this.service.fetchVersion();return gettingVer.then(function(v){return gettingRes.then(function(results){if(v>=16){return new CategoryResults(results)}else{return new IdResults(results)}})})};IDResolutionJob.prototype.del=function(cb){return this.service.makeRequest("DELETE","ids/"+this.uid,{},cb)};IDResolutionJob.prototype.decay=50;IDResolutionJob.prototype.poll=function(onSuccess,onError,onProgress){var backOff,resp,ret,_this=this;ret=Deferred().done(onSuccess).fail(onError).progress(onProgress);resp=this.fetchStatus();resp.fail(ret.reject);backOff=this.decay;this.decay=Math.min(ONE_MINUTE,backOff*2);resp.done(function(status){ret.notify(status);switch(status){case"SUCCESS":return _this.fetchResults().then(ret.resolve,ret.reject);case"ERROR":return _this.fetchErrorMessage().then(ret.reject,ret.reject);default:return setTimeout(function(){return _this.poll(ret.resolve,ret.reject,ret.notify)},backOff)}});return ret.promise()};return IDResolutionJob}();IDResolutionJob.prototype.wait=IDResolutionJob.prototype.poll;IDResolutionJob.create=function(service){return function(uid){return new IDResolutionJob(uid,service)}};intermine.IDResolutionJob=IDResolutionJob;intermine.CategoryResults=CategoryResults;intermine.IdResults=IdResults}).call(this);(function(){var $,BASIC_ATTRS,CODES,Deferred,IS_NODE,LIST_PIPE,Query,RESULTS_METHODS,SIMPLE_ATTRS,conAttrs,conStr,conToJSON,conValStr,concatMap,copyCon,decapitate,didntRemove,f,filter,fold,get,get_canonical_op,headLess,id,idConStr,intermine,interpretConArray,interpretConstraint,invoke,jQuery,mth,multiConStr,noUndefVals,noValueConStr,pairsToObj,partition,removeIrrelevantSortOrders,simpleConStr,stringToSortOrder,take,toQueryString,typeConStr,_,__root__,_fn,_get_data_fetcher,_i,_j,_len,_len1,_ref,_ref1,_ref2,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__slice=[].slice,__hasProp={}.hasOwnProperty;IS_NODE=typeof exports!=="undefined";__root__=typeof exports!=="undefined"&&exports!==null?exports:this;if(IS_NODE){intermine=__root__;_=require("underscore")._;Deferred=($=require("underscore.deferred")).Deferred;toQueryString=require("querystring").stringify;intermine.xml=require("./xml");_ref=require("./util"),pairsToObj=_ref.pairsToObj,filter=_ref.filter,partition=_ref.partition,fold=_ref.fold,take=_ref.take,concatMap=_ref.concatMap,id=_ref.id,get=_ref.get,invoke=_ref.invoke}else{_=__root__._,jQuery=__root__.jQuery,intermine=__root__.intermine;_ref1=intermine.funcutils,pairsToObj=_ref1.pairsToObj,filter=_ref1.filter,partition=_ref1.partition,fold=_ref1.fold,take=_ref1.take,concatMap=_ref1.concatMap,id=_ref1.id,get=_ref1.get,invoke=_ref1.invoke;Deferred=($=jQuery).Deferred;toQueryString=function(obj){return jQuery.param(obj,true)}}get_canonical_op=function(orig){var canonical;canonical=_.isString(orig)?Query.OP_DICT[orig.toLowerCase()]:null;if(!canonical){throw new Error("Illegal constraint operator: "+orig)}return canonical};BASIC_ATTRS=["path","op","code"];SIMPLE_ATTRS=BASIC_ATTRS.concat(["value","extraValue"]);RESULTS_METHODS=["rowByRow","eachRow","recordByRecord","eachRecord","records","rows","table","tableRows"];LIST_PIPE=function(service){return _.compose(service.fetchList,get("listName"))};CODES=[null,"A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];decapitate=function(x){if(x==null){x=""}return x.substr(x.indexOf("."))};conValStr=function(v){if(v!=null){return"<value>"+_.escape(v)+"</value>"}else{return"<nullValue/>"}};conAttrs=function(c,names){var k,v;return function(){var _results;_results=[];for(k in c){v=c[k];if(__indexOf.call(names,k)>=0){_results.push(""+k+'="'+_.escape(v)+'" ')}}return _results}().join("")};noValueConStr=function(c){return"<constraint "+conAttrs(c,BASIC_ATTRS)+"/>"};typeConStr=function(c){return"<constraint "+conAttrs(c,["path","type"])+"/>"};simpleConStr=function(c){return"<constraint "+conAttrs(c,SIMPLE_ATTRS)+"/>"};multiConStr=function(c){return"<constraint "+conAttrs(c,BASIC_ATTRS)+">"+concatMap(conValStr)(c.values)+"</constraint>"};idConStr=function(c){return"<constraint "+conAttrs(c,BASIC_ATTRS)+'ids="'+c.ids.join(",")+'"/>'};conStr=function(c){var _ref2;if(c.values!=null){return multiConStr(c)}else if(c.ids!=null){return idConStr(c)}else if(!(c.op!=null)){return typeConStr(c)}else if(_ref2=c.op,__indexOf.call(Query.NULL_OPS,_ref2)>=0){return noValueConStr(c)}else{return simpleConStr(c)}};headLess=function(path){return path.replace(/^[^\.]+\./,"")};copyCon=function(con){var code,editable,extraValue,ids,op,path,switchable,switched,type,value,values;
path=con.path,type=con.type,op=con.op,value=con.value,values=con.values,extraValue=con.extraValue,ids=con.ids,code=con.code,editable=con.editable,switched=con.switched,switchable=con.switchable;ids=ids!=null?ids.slice():void 0;values=values!=null?values.slice():void 0;return noUndefVals({path:path,type:type,op:op,value:value,values:values,extraValue:extraValue,ids:ids,code:code,editable:editable,switched:switched,switchable:switchable})};conToJSON=function(con){var copy;copy=copyCon(con);copy.path=headLess(copy.path);return copy};noUndefVals=function(x){var k,v;for(k in x){v=x[k];if(v==null){delete x[k]}}return x};didntRemove=function(orig,reduced){return"Did not remove a single constraint. original = "+orig+", reduced = "+reduced};interpretConstraint=function(path,con){var constraint,k,keys,v,x,_ref2;constraint={path:path};if(con===null){constraint.op="IS NULL"}else if(_.isArray(con)){constraint.op="ONE OF";constraint.values=con}else if(_.isString(con)||_.isNumber(con)){if(_ref2=typeof con.toUpperCase==="function"?con.toUpperCase():void 0,__indexOf.call(Query.NULL_OPS,_ref2)>=0){constraint.op=con}else{constraint.op="=";constraint.value=con}}else{keys=function(){var _results;_results=[];for(k in con){x=con[k];_results.push(k)}return _results}();if(__indexOf.call(keys,"isa")>=0){if(_.isArray(con.isa)){constraint.op=k;constraint.values=con.isa}else{constraint.type=con.isa}}else{if(__indexOf.call(keys,"extraValue")>=0){constraint.extraValue=con.extraValue}for(k in con){v=con[k];if(!(k!=="extraValue")){continue}constraint.op=k;if(_.isArray(v)){constraint.values=v}else{constraint.value=v}}}}return constraint};interpretConArray=function(conArgs){var a0,constraint,v,_ref2;conArgs=conArgs.slice();constraint={path:conArgs.shift()};if(conArgs.length===1){a0=conArgs[0];if(_ref2=typeof a0.toUpperCase==="function"?a0.toUpperCase():void 0,__indexOf.call(Query.NULL_OPS,_ref2)>=0){constraint.op=a0}else{constraint.type=a0}}else if(conArgs.length>=2){constraint.op=conArgs[0];v=conArgs[1];if(_.isArray(v)){constraint.values=v}else{constraint.value=v}if(conArgs.length===3){constraint.extraValue=conArgs[2]}}return constraint};stringToSortOrder=function(str){var i,parts,pathIndices,x,_i,_len,_results;if(str==null){return[]}parts=str.split(/\s+/);pathIndices=function(){var _i,_ref2,_results;_results=[];for(x=_i=0,_ref2=parts.length/2;0<=_ref2?_i<_ref2:_i>_ref2;x=0<=_ref2?++_i:--_i){_results.push(x*2)}return _results}();_results=[];for(_i=0,_len=pathIndices.length;_i<_len;_i++){i=pathIndices[_i];_results.push([parts[i],parts[i+1]])}return _results};removeIrrelevantSortOrders=function(){var oe,oldOrder;oldOrder=this.sortOrder;this.sortOrder=function(){var _i,_len,_results;_results=[];for(_i=0,_len=oldOrder.length;_i<_len;_i++){oe=oldOrder[_i];if(this.isRelevant(oe.path)){_results.push(oe)}}return _results}.call(this);if(oldOrder.length!==this.sortOrder.length){return this.trigger("change:sortorder change:orderby",this.sortOrder.slice())}};Query=function(){var addPI,cAttrs,getPaths,kids,qAttrs,scFold,toAttrPairs,xmlAttr;Query.JOIN_STYLES=["INNER","OUTER"];Query.BIO_FORMATS=["gff3","fasta","bed"];Query.NULL_OPS=["IS NULL","IS NOT NULL"];Query.ATTRIBUTE_VALUE_OPS=["=","!=",">",">=","<","<=","CONTAINS","LIKE","NOT LIKE"];Query.MULTIVALUE_OPS=["ONE OF","NONE OF"];Query.TERNARY_OPS=["LOOKUP"];Query.LOOP_OPS=["=","!="];Query.LIST_OPS=["IN","NOT IN"];Query.OP_DICT={"=":"=","==":"==",eq:"=",eqq:"==","!=":"!=",ne:"!=",">":">",gt:">",">=":">=",ge:">=","<":"<",lt:"<","<=":"<=",le:"<=",contains:"CONTAINS",CONTAINS:"CONTAINS",like:"LIKE",LIKE:"LIKE","not like":"NOT LIKE","NOT LIKE":"NOT LIKE",lookup:"LOOKUP","IS NULL":"IS NULL","is null":"IS NULL","IS NOT NULL":"IS NOT NULL","is not null":"IS NOT NULL","ONE OF":"ONE OF","one of":"ONE OF","NONE OF":"NONE OF","none of":"NONE OF","in":"IN","not in":"NOT IN",IN:"IN","NOT IN":"NOT IN",WITHIN:"WITHIN",within:"WITHIN",OVERLAPS:"OVERLAPS",overlaps:"OVERLAPS",ISA:"ISA",isa:"ISA"};getPaths=function(){};Query.prototype.on=function(events,callback,context){var calls,ev,list,tail,_ref2,_ref3,_ref4;events=events.split(/\s+/);calls=(_ref2=this._callbacks)!=null?_ref2:this._callbacks={};while(ev=events.shift()){list=(_ref3=calls[ev])!=null?_ref3:calls[ev]={};tail=(_ref4=list.tail)!=null?_ref4:list.tail=list.next={};tail.callback=callback;tail.context=context;list.tail=tail.next={}}return this};Query.prototype.bind=function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return this.on.apply(this,args)};Query.prototype.off=function(events,callback,context){var calls,current,ev,last,linkedList,node,remove,_i,_len,_ref2;if(events==null){this._callbacks={};return this}events=events.split(/\s+/);calls=(_ref2=this._callbacks)!=null?_ref2:this._callbacks={};for(_i=0,_len=events.length;_i<_len;_i++){ev=events[_i];if(callback!=null){current=linkedList=calls[ev]||{};last=linkedList.tail;while((node=current.next)!==last){remove=(!(context!=null)||node.context===context)&&callback===node.callback;if(remove){current.next=node.next||last;node=current}else{current=node}}}else{delete calls[ev]}}return this};Query.prototype.unbind=function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return this.off.apply(this,args)};Query.prototype.once=function(events,callback,context){var f,_this=this;f=function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];callback.apply(context,args);return _this.off(events,f)};return this.on(events,f)};Query.prototype.emit=function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return this.trigger.apply(this,args)};Query.prototype.trigger=function(){var all,args,calls,event,events,node,rest,tail;events=arguments[0],rest=2<=arguments.length?__slice.call(arguments,1):[];calls=this._callbacks;if(!calls){return this}all=calls["all"];(events=events.split(/\s+/)).push(null);while(event=events.shift()){if(all){events.push({next:all.next,tail:all.tail,event:event})}if(!(node=calls[event])){continue}events.push({next:node.next,tail:node.tail})}while(node=events.pop()){tail=node.tail;args=node.event?[node.event].concat(rest):rest;while((node=node.next)!==tail){node.callback.apply(node.context||this,args)}}return this};qAttrs=["name","view","sortOrder","constraintLogic","title","description","comment"];cAttrs=["path","type","op","code","value","ids"];toAttrPairs=function(el,attrs){var x,_i,_len,_results;_results=[];for(_i=0,_len=attrs.length;_i<_len;_i++){x=attrs[_i];if(el.hasAttribute(x)){_results.push([x,el.getAttribute(x)])}}return _results};kids=function(el,name){var kid,_i,_len,_ref2,_results;_ref2=el.getElementsByTagName(name);_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){kid=_ref2[_i];_results.push(kid)}return _results};xmlAttr=function(name){return function(el){return el.getAttribute(name)}};Query.fromXML=function(xml){var con,dom,j,pathOf,q,query,styleOf;dom=intermine.xml.parse(xml);query=kids(dom,"query")[0]||kids(dom,"template")[0];if(!query){throw new Error("no query in xml")}pathOf=xmlAttr("path");styleOf=xmlAttr("style");q=pairsToObj(toAttrPairs(query,qAttrs));q.view=q.view.split(/\s+/);q.sortOrder=stringToSortOrder(q.sortOrder);q.joins=function(){var _i,_len,_ref2,_results;_ref2=kids(query,"join");_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){j=_ref2[_i];if(styleOf(j)==="OUTER"){_results.push(pathOf(j))}}return _results}();q.constraints=function(){var _i,_len,_ref2,_results;_ref2=kids(query,"constraint");_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){con=_ref2[_i];_results.push(function(con){var c,tn,v,values,x;c=pairsToObj(toAttrPairs(con,cAttrs));if(c.ids!=null){c.ids=function(){var _j,_len1,_ref3,_results1;_ref3=c.ids.split(",");_results1=[];for(_j=0,_len1=_ref3.length;_j<_len1;_j++){x=_ref3[_j];_results1.push(parseInt(x,10))}return _results1}()}values=kids(con,"value");if(values.length){c.values=function(){var _j,_len1,_results1;_results1=[];for(_j=0,_len1=values.length;_j<_len1;_j++){v=values[_j];_results1.push(function(){var _k,_len2,_ref3,_results2;_ref3=v.childNodes;_results2=[];for(_k=0,_len2=_ref3.length;_k<_len2;_k++){tn=_ref3[_k];_results2.push(tn.data)}return _results2}().join(""))}return _results1}()}return c}(con))}return _results}();return q};function Query(properties,service){this.addConstraint=__bind(this.addConstraint,this);this.expandStar=__bind(this.expandStar,this);this.adjustPath=__bind(this.adjustPath,this);this.select=__bind(this.select,this);var prop,_i,_len,_ref10,_ref11,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9,_this=this;_.defaults(this,{constraints:[],views:[],joins:{},constraintLogic:"",sortOrder:""});if(properties==null){properties={}}this.displayNames=_.extend({},(_ref2=(_ref3=properties.displayNames)!=null?_ref3:properties.aliases)!=null?_ref2:{});_ref4=["name","title","comment","description"];for(_i=0,_len=_ref4.length;_i<_len;_i++){prop=_ref4[_i];if(properties[prop]!=null){this[prop]=properties[prop]}}this.service=service!=null?service:{};this.model=(_ref5=properties.model)!=null?_ref5:{};this.summaryFields=(_ref6=properties.summaryFields)!=null?_ref6:{};this.root=(_ref7=properties.root)!=null?_ref7:properties.from;this.maxRows=(_ref8=(_ref9=properties.size)!=null?_ref9:properties.limit)!=null?_ref8:properties.maxRows;this.start=(_ref10=(_ref11=properties.start)!=null?_ref11:properties.offset)!=null?_ref10:0;this.select(properties.views||properties.view||properties.select||[]);this.addConstraints(properties.constraints||properties.where||[]);this.addJoins(properties.joins||properties.join||[]);this.orderBy(properties.sortOrder||properties.orderBy||[]);if(properties.constraintLogic!=null){this.constraintLogic=properties.constraintLogic}getPaths=function(root,depth){var cd,others,ret;cd=_this.getPathInfo(root).getEndClass();ret=[root];others=!(cd&&depth>0)?[]:_.flatten(_.map(cd.fields,function(r){return getPaths(""+root+"."+r.name,depth-1)}));return _.flatten(ret.concat(others))};this.on("change:views",removeIrrelevantSortOrders,this)}Query.prototype.removeFromSelect=function(unwanted){var mapFn,so,uw,v;unwanted=_.isString(unwanted)?[unwanted]:unwanted||[];mapFn=_.compose(this.expandStar,this.adjustPath);unwanted=_.flatten(function(){var _i,_len,_results;_results=[];for(_i=0,_len=unwanted.length;_i<_len;_i++){uw=unwanted[_i];_results.push(mapFn(uw))}return _results}());this.sortOrder=function(){var _i,_len,_ref2,_ref3,_results;_ref2=this.sortOrder;_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){so=_ref2[_i];if(!(_ref3=so.path,__indexOf.call(unwanted,_ref3)>=0)){_results.push(so)}}return _results}.call(this);this.views=function(){var _i,_len,_ref2,_results;_ref2=this.views;_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){v=_ref2[_i];if(!(__indexOf.call(unwanted,v)>=0)){_results.push(v)}}return _results}.call(this);this.trigger("remove:view",unwanted);return this.trigger("change:views",this.views)};Query.prototype.removeConstraint=function(con,silent){var c,iscon,orig,reduced;if(silent==null){silent=false}orig=this.constraints;iscon=typeof con==="string"?function(c){return c.code===con}:function(c){var _ref2,_ref3;return c.path===con.path&&c.op===con.op&&c.value===con.value&&c.extraValue===con.extraValue&&con.type===c.type&&((_ref2=c.values)!=null?_ref2.join("%%"):void 0)===((_ref3=con.values)!=null?_ref3.join("%%"):void 0)};reduced=function(){var _i,_len,_results;_results=[];for(_i=0,_len=orig.length;_i<_len;_i++){c=orig[_i];if(!iscon(c)){_results.push(c)}}return _results}();if(reduced.length!==orig.length-1){throw new Error(didntRemove(orig,reduced))}this.constraints=reduced;if(!silent){this.trigger("change:constraints");return this.trigger("removed:constraints",_.difference(orig,reduced))}};Query.prototype.addToSelect=function(views){var dups,p,toAdd,_i,_len;views=_.isString(views)?[views]:views||[];toAdd=_.flatten([_.map(views,_.compose(this.expandStar,this.adjustPath))]);dups=function(){var _i,_len,_results;_results=[];for(_i=0,_len=toAdd.length;_i<_len;_i++){p=toAdd[_i];if(__indexOf.call(this.views,p)>=0||_.indexOf(toAdd,p)!==_.lastIndexOf(toAdd,p)){_results.push(p)}}return _results}.call(this);if(dups.length){throw new Error(""+dups+" already in the select list")}for(_i=0,_len=toAdd.length;_i<_len;_i++){p=toAdd[_i];this.views.push(p)}return this.trigger("add:view change:views",toAdd)};Query.prototype.select=function(views){this.views=[];this.addToSelect(views);return this};Query.prototype.adjustPath=function(path){path=path&&path.name?path.name:""+path;if(this.root!=null){if(!path.match("^"+this.root)){path=this.root+"."+path}}else{this.root=path.split(".")[0]}return path};Query.prototype.getPossiblePaths=function(depth){var _base,_ref2,_ref3;if(depth==null){depth=3}if((_ref2=this._possiblePaths)==null){this._possiblePaths={}}return(_ref3=(_base=this._possiblePaths)[depth])!=null?_ref3:_base[depth]=getPaths(this.root,depth)};Query.prototype.getPathInfo=function(path){var adjusted,pi,_ref2;adjusted=this.adjustPath(path);pi=(_ref2=this.model)!=null?typeof _ref2.getPathInfo==="function"?_ref2.getPathInfo(adjusted,this.getSubclasses()):void 0:void 0;if(pi&&adjusted in this.displayNames){pi.displayName=this.displayNames[adjusted]}return pi};Query.prototype.makePath=Query.prototype.getPathInfo;scFold=_.compose(pairsToObj,filter(get(1)),invoke("map",function(c){return[c.path,c.type]}));Query.prototype.getSubclasses=function(){return scFold(this.constraints)};Query.prototype.getType=function(path){return this.getPathInfo(path).getType()};Query.prototype.getViewNodes=function(){var toParentNode,_this=this;toParentNode=function(v){return _this.getPathInfo(v).getParent()};return _.uniq(_.map(this.views,toParentNode),false,function(n){return n.toPathString()})};Query.prototype.isInView=function(path){var pi,pstr,_ref2;pi=this.getPathInfo(path);if(!pi){throw new Error("Invalid path: "+path)}if(pi.isAttribute()){return _ref2=pi.toString(),__indexOf.call(this.views,_ref2)>=0}else{pstr=pi.toString();return _.any(this.getViewNodes(),function(n){return n.toString()===pstr})}};Query.prototype.isConstrained=function(path,includeAttrs){var pi,test,_this=this;if(includeAttrs==null){includeAttrs=false}pi=this.getPathInfo(path);if(!pi){throw new Error("Invalid path: "+path)}test=function(c){return c.op!=null&&c.path===pi.toString()};if(!pi.isAttribute()&&includeAttrs){test=function(c){return c.op!=null&&(c.path===pi.toString()||pi.equals(_this.getPathInfo(c.path).getParent()))}}return _.any(this.constraints,test)};Query.prototype.canHaveMultipleValues=function(path){return this.getPathInfo(path).containsCollection()};Query.prototype.getQueryNodes=function(){var c,constrainedNodes,pi,viewNodes;viewNodes=this.getViewNodes();constrainedNodes=function(){var _i,_len,_ref2,_results;_ref2=this.constraints;_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){c=_ref2[_i];if(!!(c.type!=null)){continue}pi=this.getPathInfo(c.path);if(pi.isAttribute()){_results.push(pi.getParent())}else{_results.push(pi)}}return _results}.call(this);return _.uniq(viewNodes.concat(constrainedNodes),false,String)};Query.prototype.isInQuery=function(p){var c,pi,pstr,_i,_len,_ref2;pi=this.getPathInfo(p);if(pi){pstr=pi.toPathString();_ref2=this.views.concat(function(){var _j,_len,_ref2,_results;_ref2=this.constraints;_results=[];for(_j=0,_len=_ref2.length;_j<_len;_j++){c=_ref2[_j];if(!(c.type!=null)){_results.push(c.path)}}return _results}.call(this));for(_i=0,_len=_ref2.length;_i<_len;_i++){p=_ref2[_i];if(0===p.indexOf(pstr)){return true}}return false}return true};Query.prototype.isRelevant=function(path){var nodes,pi,sought;pi=this.getPathInfo(path);if(pi.isAttribute()){pi=pi.getParent()}sought=pi.toString();nodes=this.getViewNodes();return _.any(nodes,function(n){return n.toPathString()===sought})};Query.prototype.expandStar=function(path){var cd,expand,fn,n,pathStem;if(/\*$/.test(path)){pathStem=path.substr(0,path.lastIndexOf("."));expand=function(x){return pathStem+x};cd=this.getType(pathStem);if(/\.\*$/.test(path)){if(cd&&this.summaryFields[cd.name]){fn=_.compose(expand,decapitate);return function(){var _i,_len,_ref2,_results;_ref2=this.summaryFields[cd.name];_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){n=_ref2[_i];if(!this.hasView(n)){_results.push(fn(n))}}return _results}.call(this)}}if(/\.\*\*$/.test(path)){fn=_.compose(expand,function(a){return"."+a.name});return _.uniq(_.union(this.expandStar(pathStem+".*"),_.map(cd.attributes,fn)))}}return path};Query.prototype.isOuterJoin=function(p){return this.joins[this.adjustPath(p)]==="OUTER"};Query.prototype.hasView=function(v){return this.views&&_.include(this.views,this.adjustPath(v))};Query.prototype.count=function(cont){if(this.service.count){return this.service.count(this,cont)}else{throw new Error("This query has no service with count functionality attached.")}};Query.prototype.appendToList=function(target,cb){var name,req,toRun,updateTarget;name=target&&target.name?target.name:""+target;toRun=this.makeListQuery();req={listName:name,query:toRun.toXML()};updateTarget=(target!=null?target.name:void 0)?function(list){return target.size=list.size}:function(){};return this.service.post("query/append/tolist",req).pipe(LIST_PIPE(this.service)).done(cb,updateTarget)};Query.prototype.makeListQuery=function(){var n,toRun,_i,_len,_ref2;toRun=this.clone();if(toRun.views.length!==1||toRun.views[0]===null||!toRun.views[0].match(/\.id$/)){toRun.select(["id"])}_ref2=this.getViewNodes();for(_i=0,_len=_ref2.length;_i<_len;_i++){n=_ref2[_i];if(!this.isOuterJoined(n)){if(!toRun.isInView(n||toRun.isConstrained(n))&&n.getEndClass().fields.id!=null){toRun.addConstraint([n.append("id"),"IS NOT NULL"])}}}return toRun};Query.prototype.saveAsList=function(options,cb){var req,toRun;toRun=this.makeListQuery();req=_.clone(options);req.listName=req.listName||req.name;req.query=toRun.toXML();if(options.tags){req.tags=options.tags.join(";")}return this.service.post("query/tolist",req).pipe(LIST_PIPE(this.service)).done(cb)};Query.prototype.summarise=function(path,limit,cont){return this.filterSummary(path,"",limit,cont)};Query.prototype.summarize=function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return this.summarise.apply(this,args)};Query.prototype.filterSummary=function(path,term,limit,cont){var parse,req,toRun,_ref2;if(cont==null){cont=function(){}}if(_.isFunction(limit)){_ref2=[limit,null],cont=_ref2[0],limit=_ref2[1]}path=this.adjustPath(path);toRun=this.clone();if(!_.include(toRun.views,path)){toRun.views.push(path)}req={query:toRun.toXML(),summaryPath:path,format:"jsonrows"};if(limit){req.size=limit}if(term){req.filterTerm=term}parse=function(data){return Deferred(function(){var results,stats,_ref3;results=data.results.map(function(x){x.count=parseInt(x.count,10);return x});stats={uniqueValues:data.uniqueValues};if(((_ref3=results[0])!=null?_ref3.max:void 0)!=null){_.extend(stats,results[0])}return this.resolve(results,stats,data.filteredCount)})};return this.service.post("query/results",req).pipe(parse).done(cont)};Query.prototype.clone=function(cloneEvents){var cloned,k,v,_ref2,_ref3;cloned=new Query(this,this.service);if((_ref2=cloned._callbacks)==null){cloned._callbacks={}}if(cloneEvents){_ref3=this._callbacks;for(k in _ref3){if(!__hasProp.call(_ref3,k))continue;v=_ref3[k];cloned._callbacks[k]=v}cloned.off("change:views",removeIrrelevantSortOrders,this)}return cloned};Query.prototype.next=function(){var clone;clone=this.clone();if(this.maxRows){clone.start=this.start+this.maxRows}return clone};Query.prototype.previous=function(){var clone;clone=this.clone();if(this.maxRows){clone.start=this.start-this.maxRows}else{clone.start=0}return clone};Query.prototype.getSortDirection=function(path){var dir,so,_i,_len,_ref2;path=this.adjustPath(path);_ref2=this.sortOrder;for(_i=0,_len=_ref2.length;_i<_len;_i++){so=_ref2[_i];if(so.path===path){dir=so.direction}}return dir};Query.prototype.isOuterJoined=function(path){path=this.adjustPath(path);return _.any(this.joins,function(d,p){return d==="OUTER"&&path.indexOf(p)===0})};Query.prototype.getOuterJoin=function(path){var joinPaths,_this=this;path=this.adjustPath(path);joinPaths=_.sortBy(_.keys(this.joins),get("length")).reverse();return _.find(joinPaths,function(p){return _this.joins[p]==="OUTER"&&path.indexOf(p)===0})};Query.prototype._parse_sort_order=function(input){var direction,path,so;so=input;if(_.isString(input)){so={path:input,direction:"ASC"}}else if(_.isArray(input)){path=input[0],direction=input[1];so={path:path,direction:direction}}else if(!(input.path!=null)){path=_.keys(input)[0];direction=_.values(input)[0];so={path:path,direction:direction}}so.path=this.adjustPath(so.path);so.direction=so.direction.toUpperCase();return so};Query.prototype.addOrSetSortOrder=function(so){var currentDirection,oe,_i,_len,_ref2;so=this._parse_sort_order(so);currentDirection=this.getSortDirection(so.path);if(!(currentDirection!=null)){return this.addSortOrder(so)}else if(currentDirection!==so.direction){_ref2=this.sortOrder;for(_i=0,_len=_ref2.length;_i<_len;_i++){oe=_ref2[_i];if(oe.path===so.path){oe.direction=so.direction}}return this.trigger("change:sortorder",this.sortOrder)}};Query.prototype.addSortOrder=function(so){this.sortOrder.push(this._parse_sort_order(so));this.trigger("add:sortorder",so);return this.trigger("change:sortorder",this.sortOrder)};Query.prototype.orderBy=function(oes){var oe,_i,_len;this.sortOrder=[];for(_i=0,_len=oes.length;_i<_len;_i++){oe=oes[_i];this.addSortOrder(this._parse_sort_order(oe))}return this.trigger("set:sortorder change:sortorder",this.sortOrder)};Query.prototype.addJoins=function(joins){var j,k,v,_i,_len,_results,_results1;if(_.isArray(joins)){_results=[];for(_i=0,_len=joins.length;_i<_len;_i++){j=joins[_i];_results.push(this.addJoin(j))}return _results}else{_results1=[];for(k in joins){v=joins[k];_results1.push(this.addJoin({path:k,style:v}))}return _results1}};Query.prototype.addJoin=function(join){var _ref2,_ref3,_ref4;if(_.isString(join)){join={path:join,style:"OUTER"}}join.path=this.adjustPath(join.path);join.style=(_ref2=(_ref3=join.style)!=null?_ref3.toUpperCase():void 0)!=null?_ref2:join.style;if(_ref4=join.style,__indexOf.call(Query.JOIN_STYLES,_ref4)<0){throw new Error("Invalid join style: "+join.style)}this.joins[join.path]=join.style;return this.trigger("set:join",join.path,join.style)};Query.prototype.setJoinStyle=function(path,style){if(style==null){style="OUTER"}path=this.adjustPath(path);style=style.toUpperCase();if(this.joins[path]!==style){this.joins[path]=style;this.trigger("change:joins",{path:path,style:style})}return this};Query.prototype.addConstraints=function(constraints){var c,con,path,_fn,_i,_len,_this=this;this.__silent__=true;if(_.isArray(constraints)){for(_i=0,_len=constraints.length;_i<_len;_i++){c=constraints[_i];this.addConstraint(c)}}else{_fn=function(path,con){return _this.addConstraint(interpretConstraint(path,con))};for(path in constraints){con=constraints[path];_fn(path,con)}}this.__silent__=false;this.trigger("add:constraint");return this.trigger("change:constraints")};Query.prototype.addConstraint=function(constraint){if(_.isArray(constraint)){constraint=interpretConArray(constraint)}else{constraint=copyCon(constraint)}if(constraint.switched==="OFF"){return this}constraint.path=this.adjustPath(constraint.path);if(constraint.type==null){try{constraint.op=get_canonical_op(constraint.op)}catch(error){throw new Error("Illegal operator: "+constraint.op)}}this.constraints.push(constraint);if(this.constraintLogic!=null&&this.constraintLogic!==""){this.constraintLogic="("+this.constraintLogic+") and "+CODES[this.constraints.length]}if(!this.__silent__){this.trigger("add:constraint",constraint);this.trigger("change:constraints")}return this};Query.prototype.getSorting=function(){var oe;return function(){var _i,_len,_ref2,_results;_ref2=this.sortOrder;_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){oe=_ref2[_i];_results.push(""+oe.path+" "+oe.direction)}return _results}.call(this).join(" ")};Query.prototype.getConstraintXML=function(){var c,toSerialise;toSerialise=function(){var _i,_len,_ref2,_results;_ref2=this.constraints;_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){c=_ref2[_i];if(!(c.type!=null)||this.isInQuery(c.path)){_results.push(c)}}return _results}.call(this);if(toSerialise.length){return concatMap(conStr)(concatMap(id)(partition(function(c){return c.type!=null})(toSerialise)))}else{return""}};Query.prototype.getJoinXML=function(){var p,s,strs;strs=function(){var _ref2,_results;_ref2=this.joins;_results=[];for(p in _ref2){s=_ref2[p];if(this.isInQuery(p)&&s==="OUTER"){_results.push('<join path="'+p+'" style="OUTER"/>')}}return _results}.call(this);return strs.join("")};Query.prototype.toXML=function(){var attrs,headAttrs,k,v;attrs={model:this.model.name,view:this.views.join(" "),sortOrder:this.getSorting(),constraintLogic:this.constraintLogic};if(this.name!=null){attrs.name=this.name}headAttrs=function(){var _results;_results=[];for(k in attrs){v=attrs[k];if(v){_results.push(k+'="'+v+'"')}}return _results}().join(" ");return"<query "+headAttrs+" >"+this.getJoinXML()+this.getConstraintXML()+"</query>"};Query.prototype.toJSON=function(){var c,direction,path,style,v;return noUndefVals({name:this.name,title:this.title,comment:this.comment,description:this.description,constraintLogic:this.constraintLogic,from:this.root,select:function(){var _i,_len,_ref2,_results;_ref2=this.views;_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){v=_ref2[_i];_results.push(headLess(v))}return _results}.call(this),orderBy:function(){var _i,_len,_ref2,_ref3,_results;_ref2=this.sortOrder;_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){_ref3=_ref2[_i],path=_ref3.path,direction=_ref3.direction;_results.push({path:headLess(path),direction:direction})}return _results}.call(this),joins:function(){var _ref2,_results;_ref2=this.joins;_results=[];for(path in _ref2){style=_ref2[path];if(style==="OUTER"){_results.push(headLess(path))}}return _results}.call(this),where:function(){var _i,_len,_ref2,_results;_ref2=this.constraints;_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){c=_ref2[_i];_results.push(conToJSON(c))}return _results}.call(this)})};Query.prototype.fetchCode=function(lang,cb){var req;req={query:this.toXML(),lang:lang};return this.service.post("query/code",req).pipe(this.service.VERIFIER).pipe(get("code")).done(cb)};Query.prototype.save=function(name,cb){var req,_this=this;if(name!=null){this.name=name}req={data:this.toXML(),contentType:"application/xml; charset=UTF-8",url:this.service.root+"query",type:"POST",dataType:"json"};return this.service.doReq(req).pipe(this.service.VERIFIER).pipe(get("name")).done(cb,function(name){return _this.name=name})};Query.prototype.getCodeURI=function(lang){var req,_ref2;req={query:this.toXML(),lang:lang,format:"text"};if(((_ref2=this.service)!=null?_ref2.token:void 0)!=null){req.token=this.service.token}return""+this.service.root+"query/code?"+toQueryString(req)};Query.prototype.getExportURI=function(format){var req,_ref2;if(format==null){format="tab"}if(__indexOf.call(Query.BIO_FORMATS,format)>=0){return this["get"+format.toUpperCase()+"URI"]()}req={query:this.toXML(),format:format};if(((_ref2=this.service)!=null?_ref2.token:void 0)!=null){req.token=this.service.token}return""+this.service.root+"query/results?"+toQueryString(req)};Query.prototype.fetchQID=function(cb){return this.service.post("queries",{query:this.toXML()}).then(function(resp){return resp.id}).done(cb)};addPI=function(p){return p.append("primaryIdentifier").toString()};Query.prototype.__bio_req=function(types,n){var isSuitable,toRun;toRun=this.makeListQuery();isSuitable=function(p){return _.any(types,function(t){return p.isa(t)})};toRun.views=take(n)(function(){var _i,_len,_ref2,_results;_ref2=this.getViewNodes();_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){n=_ref2[_i];if(isSuitable(n)){_results.push(addPI(n))}}return _results}.call(this));return{query:toRun.toXML(),format:"text"}};Query.prototype._fasta_req=function(){return this.__bio_req(["SequenceFeature","Protein"],1)};Query.prototype._gff3_req=function(){return this.__bio_req(["SequenceFeature"])};Query.prototype._bed_req=Query.prototype._gff3_req;return Query}();Query.ATTRIBUTE_OPS=_.union(Query.ATTRIBUTE_VALUE_OPS,Query.MULTIVALUE_OPS,Query.NULL_OPS);Query.REFERENCE_OPS=_.union(Query.TERNARY_OPS,Query.LOOP_OPS,Query.LIST_OPS);_ref2=Query.BIO_FORMATS;_fn=function(f){var getMeth,reqMeth,uriMeth;reqMeth="_"+f+"_req";getMeth="get"+f.toUpperCase();uriMeth=getMeth+"URI";Query.prototype[getMeth]=function(opts,cb){var req,v,_ref3;if(opts==null){opts={}}if(cb==null){cb=function(){}}if(_.isFunction(opts)){_ref3=[{},opts],opts=_ref3[0],cb=_ref3[1]}if((opts!=null?opts.view:void 0)!=null){opts.view=function(){var _j,_len1,_ref4,_results;_ref4=opts.view;_results=[];for(_j=0,_len1=_ref4.length;_j<_len1;_j++){v=_ref4[_j];_results.push(this.getPathInfo(v).toString())}return _results}.call(this)}req=_.extend(this[reqMeth](),opts);return this.service.post("query/results/"+f,req).done(cb)};return Query.prototype[uriMeth]=function(opts,cb){var req,v,_ref3;if(opts==null){opts={}}if(_.isFunction(opts)){_ref3=[{},opts],opts=_ref3[0],cb=_ref3[1]}if((opts!=null?opts.view:void 0)!=null){opts.view=function(){var _j,_len1,_ref4,_results;_ref4=opts.view;_results=[];for(_j=0,_len1=_ref4.length;_j<_len1;_j++){v=_ref4[_j];_results.push(this.getPathInfo(v).toString())}return _results}.call(this)}req=_.extend(this[reqMeth](),opts);if(this.service.token!=null){req.token=this.service.token}return""+this.service.root+"query/results/"+f+"?"+toQueryString(req)}};for(_i=0,_len=_ref2.length;_i<_len;_i++){f=_ref2[_i];_fn(f)}_get_data_fetcher=function(server_fn){return function(){var cbs,page,x,_ref3;page=arguments[0],cbs=2<=arguments.length?__slice.call(arguments,1):[];if(this.service[server_fn]){if(!(page!=null)){page={}}else if(_.isFunction(page)){page={};cbs=function(){var _j,_len1,_results;_results=[];for(_j=0,_len1=arguments.length;_j<_len1;_j++){x=arguments[_j];_results.push(x)}return _results}.apply(this,arguments)}_.defaults(page,{start:this.start,size:this.maxRows});return(_ref3=this.service)[server_fn].apply(_ref3,[this,page].concat(__slice.call(cbs)))}else{throw new Error("Service does not provide '"+server_fn+"'.")}}};for(_j=0,_len1=RESULTS_METHODS.length;_j<_len1;_j++){mth=RESULTS_METHODS[_j];Query.prototype[mth]=_get_data_fetcher(mth)}intermine.Query=Query}).call(this);(function(){var $,DEFAULT_ERROR_HANDLER,DEFAULT_PROTOCOL,Deferred,ENRICHMENT_PATH,HAS_PROTOCOL,HAS_SUFFIX,IDENTITY,IDResolutionJob,IS_NODE,LISTS_PATH,LIST_OPERATION_PATHS,LIST_PIPE,List,MODELS,MODEL_PATH,Model,PATH_VALUES_PATH,PREF_PATH,QUERY_RESULTS_PATH,QUICKSEARCH_PATH,Query,REQUIRES_VERSION,SUBTRACT_PATH,SUFFIX,SUMMARYFIELDS_PATH,SUMMARY_FIELDS,Service,TABLE_ROW_PATH,TEMPLATES_PATH,TO_NAMES,User,VERSIONS,VERSION_PATH,WHOAMI_PATH,WIDGETS,WIDGETS_PATH,WITH_OBJ_PATH,dejoin,error,funcutils,get,getListFinder,http,intermine,invoke,jQuery,omap,pairsToObj,set,success,to_query_string,_,__root__,_get_or_fetch,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__slice=[].slice;IS_NODE=typeof exports!=="undefined";__root__=typeof exports!=="undefined"&&exports!==null?exports:this;if(IS_NODE){_=require("underscore")._;Deferred=($=require("underscore.deferred")).Deferred;Model=require("./model").Model;Query=require("./query").Query;List=require("./lists").List;User=require("./user").User;IDResolutionJob=require("./id-resolution-job").IDResolutionJob;funcutils=require("./util");to_query_string=require("querystring").stringify;http=require("./http");intermine=exports}else{_=__root__._,jQuery=__root__.jQuery,intermine=__root__.intermine;Deferred=($=jQuery).Deferred;to_query_string=function(obj){return jQuery.param(obj,true)};Model=intermine.Model,Query=intermine.Query,List=intermine.List,User=intermine.User,IDResolutionJob=intermine.IDResolutionJob,funcutils=intermine.funcutils,http=intermine.http}pairsToObj=funcutils.pairsToObj,omap=funcutils.omap,get=funcutils.get,set=funcutils.set,invoke=funcutils.invoke,success=funcutils.success,error=funcutils.error,REQUIRES_VERSION=funcutils.REQUIRES_VERSION,dejoin=funcutils.dejoin;
VERSIONS={};MODELS={};SUMMARY_FIELDS={};WIDGETS={};DEFAULT_PROTOCOL="http://";VERSION_PATH="version";TEMPLATES_PATH="templates";LISTS_PATH="lists";MODEL_PATH="model";SUMMARYFIELDS_PATH="summaryfields";QUERY_RESULTS_PATH="query/results";QUICKSEARCH_PATH="search";WIDGETS_PATH="widgets";ENRICHMENT_PATH="list/enrichment";WITH_OBJ_PATH="listswithobject";LIST_OPERATION_PATHS={union:"lists/union",intersection:"lists/intersect",difference:"lists/diff"};SUBTRACT_PATH="lists/subtract";WHOAMI_PATH="user/whoami";TABLE_ROW_PATH=QUERY_RESULTS_PATH+"/tablerows";PREF_PATH="user/preferences";PATH_VALUES_PATH="path/values";IDENTITY=function(x){return x};HAS_PROTOCOL=/^https?:\/\//i;HAS_SUFFIX=/service\/?$/i;SUFFIX="/service/";DEFAULT_ERROR_HANDLER=function(e){var args,_ref;if(IS_NODE&&e.stack!=null){return console.error(e.stack)}else{args=(e!=null?e.stack:void 0)?[e.stack]:arguments;if(typeof console!=="undefined"&&console!==null){return(_ref=console.error||console.log)!=null?_ref.apply(console,args):void 0}}};_get_or_fetch=function(propName,store,path,key,cb){var prop,value,_ref,_this=this;prop=(_ref=this[propName])!=null?_ref:this[propName]=this.useCache&&(value=store[this.root])?success(value):this.get(path).pipe(get(key)).done(function(x){return store[_this.root]=x});return prop.done(cb)};getListFinder=function(name){return function(lists){return Deferred(function(){var list;if(list=_.find(lists,function(l){return l.name===name})){return this.resolve(list)}else{return this.reject('List "'+name+'" not found among: '+lists.map(get("name")))}})}};LIST_PIPE=function(service,prop){if(prop==null){prop="listName"}return _.compose(service.fetchList,get(prop))};TO_NAMES=function(xs){var x,_i,_len,_ref,_ref1,_results;if(xs==null){xs=[]}_ref=_.isArray(xs)?xs:[xs];_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){x=_ref[_i];_results.push((_ref1=x.name)!=null?_ref1:x)}return _results};Service=function(){var toMapByName;Service.prototype.doReq=http.doReq;function Service(_arg){var loc,noCache,_ref,_ref1,_this=this;this.root=_arg.root,this.token=_arg.token,this.errorHandler=_arg.errorHandler,this.DEBUG=_arg.DEBUG,this.help=_arg.help,noCache=_arg.noCache;this.createList=__bind(this.createList,this);this.resolveIds=__bind(this.resolveIds,this);this.query=__bind(this.query,this);this.fetchWidgetMap=__bind(this.fetchWidgetMap,this);this.fetchWidgets=__bind(this.fetchWidgets,this);this.complement=__bind(this.complement,this);this.fetchListsContaining=__bind(this.fetchListsContaining,this);this.fetchList=__bind(this.fetchList,this);this.findLists=__bind(this.findLists,this);this.fetchLists=__bind(this.fetchLists,this);this.fetchTemplates=__bind(this.fetchTemplates,this);this.tableRows=__bind(this.tableRows,this);this.values=__bind(this.values,this);this.rows=__bind(this.rows,this);this.records=__bind(this.records,this);this.table=__bind(this.table,this);this.pathValues=__bind(this.pathValues,this);this.fetchUser=__bind(this.fetchUser,this);this.whoami=__bind(this.whoami,this);this.findById=__bind(this.findById,this);this.count=__bind(this.count,this);this.enrichment=__bind(this.enrichment,this);if(this.root==null){throw new Error("No service root provided. This is required")}if(!HAS_PROTOCOL.test(this.root)){this.root=DEFAULT_PROTOCOL+this.root}if(!HAS_SUFFIX.test(this.root)){this.root=this.root+SUFFIX}this.root=this.root.replace(/ice$/,"ice/");if((_ref=this.errorHandler)==null){this.errorHandler=DEFAULT_ERROR_HANDLER}if((_ref1=this.help)==null){this.help="no.help.available@dev.null"}this.useCache=!noCache;loc=IS_NODE?"":location.protocol+"//"+location.host;this.getFormat=function(intended){if(intended==null){intended="json"}if(!/jsonp/.test(intended)){if(!(IS_NODE||jQuery.support.cors)){if(loc.substring(0,_this.root.length)!==_this.root){return intended.replace("json","jsonp")}}}return intended}}Service.prototype.post=function(path,data){if(data==null){data={}}return this.makeRequest("POST",path,data)};Service.prototype.get=function(path,data){return this.makeRequest("GET",path,data)};Service.prototype.makeRequest=function(method,path,data,cb,indiv){var dataType,errBack,opts,url,_ref,_ref1;if(method==null){method="GET"}if(path==null){path=""}if(data==null){data={}}if(cb==null){cb=function(){}}if(indiv==null){indiv=false}if(_.isArray(cb)){_ref=cb,cb=_ref[0],errBack=_ref[1]}if(_.isArray(data)){data=pairsToObj(data)}url=this.root+path;if(errBack==null){errBack=this.errorHandler}if(this.token){data.token=this.token}data.format=this.getFormat(data.format);if(/jsonp/.test(data.format)){data.method=method;method="GET";url+="?callback=?"}dataType=/json/.test(data.format)?"json":"text";if(!http.supports(method)){_ref1=[method,http.getMethod(method)],data.method=_ref1[0],method=_ref1[1]}if(method==="DELETE"){url+="?"+to_query_string(data)}opts={data:data,dataType:dataType,success:cb,error:errBack,url:url,type:method};return this.doReq(opts,indiv)};Service.prototype.enrichment=function(opts,cb){var _this=this;return REQUIRES_VERSION(this,8,function(){return _this.get(ENRICHMENT_PATH,_.defaults({},opts,{maxp:.05,correction:"Holm-Bonferroni"})).pipe(get("results")).done(cb)})};Service.prototype.search=function(options,cb){var _this=this;if(options==null){options={}}if(cb==null){cb=function(){}}return REQUIRES_VERSION(this,9,function(){var k,parse,req,v,_ref,_ref1;if(_.isFunction(options)){_ref=[options,{}],cb=_ref[0],options=_ref[1]}if(_.isString(options)){options={q:options}}req=_.defaults({},options,{q:""});delete req.facets;if(options.facets){_ref1=options.facets;for(k in _ref1){v=_ref1[k];req["facet_"+k]=v}}parse=function(response){return success(response.results,response.facets)};return _this.post(QUICKSEARCH_PATH,req).pipe(parse).done(cb)})};Service.prototype.count=function(q,cb){var p,req;if(cb==null){cb=function(){}}if(!q){return error("Not enough arguments")}else if(q.toPathString!=null){p=q.isClass()?q.append("id"):q;return this.pathValues(p,"count").done(cb)}else if(q.toXML!=null){req={query:q.toXML(),format:"jsoncount"};return this.post(QUERY_RESULTS_PATH,req).pipe(get("count")).done(cb)}else if(_.isString(q)){return this.fetchModel().pipe(invoke("makePath",q.replace(/\.\*$/,".id"))).pipe(this.count).done(cb)}else{return this.query(q).pipe(this.count).done(cb)}};Service.prototype.findById=function(type,id,cb){return this.query({from:type,select:["**"],where:{id:id}}).pipe(dejoin).pipe(invoke("records")).pipe(get(0)).done(cb)};Service.prototype.find=function(type,term,cb){return this.query({from:type,select:["**"],where:[[type,"LOOKUP",term]]}).pipe(dejoin).pipe(invoke("records")).done(cb)};Service.prototype.whoami=function(cb){var _this=this;return REQUIRES_VERSION(this,9,function(){return _this.get(WHOAMI_PATH).pipe(get("user")).pipe(function(x){return new User(_this,x)}).done(cb)})};Service.prototype.fetchUser=function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return this.whoami.apply(this,args)};Service.prototype.pathValues=function(path,typeConstraints,cb){var _this=this;if(typeConstraints==null){typeConstraints={}}if(cb==null){cb=function(){}}return REQUIRES_VERSION(this,6,function(){var wanted,_pathValues;if(_.isString(typeConstraints)){wanted=typeConstraints;typeConstraints={}}if(wanted!=="count"){wanted="results"}_pathValues=function(path){var format,req;format=wanted==="count"?"jsoncount":"json";req={format:format,path:path.toString(),typeConstraints:JSON.stringify(path.subclasses)};return _this.post(PATH_VALUES_PATH,req).pipe(get(wanted))};try{return _this.fetchModel().pipe(invoke("makePath",path,path.subclasses||typeConstraints)).pipe(_pathValues).done(cb)}catch(e){return error(e)}})};Service.prototype.doPagedRequest=function(q,path,page,format,cb){var req,_ref,_this=this;if(page==null){page={}}if(cb==null){cb=function(){}}if(q.toXML!=null){if(_.isFunction(page)){_ref=[page,{}],cb=_ref[0],page=_ref[1]}req=_.defaults({},{query:q.toXML(),format:format},page);return this.post(path,req).pipe(function(resp){return success(resp.results,resp)}).done(cb)}else{return this.query(q).pipe(function(query){return _this.doPagedRequest(query,path,page,format,cb)})}};Service.prototype.table=function(q,page,cb){return this.doPagedRequest(q,QUERY_RESULTS_PATH,page,"jsontable",cb)};Service.prototype.records=function(q,page,cb){return this.doPagedRequest(q,QUERY_RESULTS_PATH,page,"jsonobjects",cb)};Service.prototype.rows=function(q,page,cb){return this.doPagedRequest(q,QUERY_RESULTS_PATH,page,"json",cb)};Service.prototype.values=function(q,opts,cb){var _this=this;if(cb==null){cb=function(){}}if(!(q!=null)){return error("No query term supplied")}else if(q.descriptors!=null||_.isString(q)){return this.pathValues(q,opts,cb)}else{return this.query(q).then(function(query){if(query.views.length!==1){return error("Expected one column, got "+q.views.length)}else{return _this.rows(query,opts).then(invoke("map",get(0))).done(cb)}})}};Service.prototype.tableRows=function(q,page,cb){return this.doPagedRequest(q,TABLE_ROW_PATH,page,"json",cb)};Service.prototype.fetchTemplates=function(cb){return this.get(TEMPLATES_PATH).pipe(get("templates")).done(cb)};Service.prototype.fetchLists=function(cb){return this.findLists("",cb)};Service.prototype.findLists=function(name,cb){var _this=this;if(name==null){name=""}if(cb==null){cb=function(){}}return this.fetchVersion().pipe(function(v){var fn;if(name&&v<13){return error("Finding lists by name on the server requires version 13. This is only "+v)}else{fn=function(ls){var data,_i,_len,_results;_results=[];for(_i=0,_len=ls.length;_i<_len;_i++){data=ls[_i];_results.push(new List(data,_this))}return _results};return _this.get(LISTS_PATH,{name:name}).pipe(get("lists")).pipe(fn).done(cb)}})};Service.prototype.fetchList=function(name,cb){var _this=this;return this.fetchVersion().pipe(function(v){if(v<13){return _this.findLists().pipe(getListFinder(name)).done(cb)}else{return _this.findLists(name).pipe(get(0)).done(cb)}})};Service.prototype.fetchListsContaining=function(opts,cb){var fn,_this=this;fn=function(xs){var x,_i,_len,_results;_results=[];for(_i=0,_len=xs.length;_i<_len;_i++){x=xs[_i];_results.push(new List(x,_this))}return _results};return this.get(WITH_OBJ_PATH,opts).pipe(get("lists")).pipe(fn).done(cb)};Service.prototype.combineLists=function(operation,options,cb){var req,_ref;req=_.pick(options,"name","description");if((_ref=req.description)==null){req.description=""+operation+" of "+options.lists.join(", ")}req.tags=(options.tags||[]).join(";");req.lists=(options.lists||[]).join(";");return this.get(LIST_OPERATION_PATHS[operation],req).pipe(LIST_PIPE(this)).done(cb)};Service.prototype.merge=function(){return this.combineLists.apply(this,["union"].concat(__slice.call(arguments)))};Service.prototype.intersect=function(){return this.combineLists.apply(this,["intersection"].concat(__slice.call(arguments)))};Service.prototype.diff=function(){return this.combineLists.apply(this,["difference"].concat(__slice.call(arguments)))};Service.prototype.complement=function(options,cb){var defaultDesc,description,exclude,from,lists,name,references,req,tags;if(options==null){options={}}if(cb==null){cb=function(){}}from=options.from,exclude=options.exclude,name=options.name,description=options.description,tags=options.tags;defaultDesc=function(){return"Relative complement of "+lists.join(" and ")+" in "+references.join(" and ")};references=TO_NAMES(from);lists=TO_NAMES(exclude);if(name==null){name=defaultDesc()}if(description==null){description=defaultDesc()}if(tags==null){tags=[]}req={name:name,description:description,tags:tags,lists:lists,references:references};return this.post(SUBTRACT_PATH,req).pipe(LIST_PIPE(this)).done(cb)};Service.prototype.fetchWidgets=function(cb){var _this=this;return REQUIRES_VERSION(this,8,function(){return _get_or_fetch.call(_this,"widgets",WIDGETS,WIDGETS_PATH,"widgets",cb)})};toMapByName=omap(function(w){return[w.name,w]});Service.prototype.fetchWidgetMap=function(cb){var _this=this;return REQUIRES_VERSION(this,8,function(){var _ref;return((_ref=_this.__wmap__)!=null?_ref:_this.__wmap__=_this.fetchWidgets().then(toMapByName)).done(cb)})};Service.prototype.fetchModel=function(cb){return _get_or_fetch.call(this,"model",MODELS,MODEL_PATH,"model").pipe(Model.load).pipe(set({service:this})).done(cb)};Service.prototype.fetchSummaryFields=function(cb){return _get_or_fetch.call(this,"summaryFields",SUMMARY_FIELDS,SUMMARYFIELDS_PATH,"classes",cb)};Service.prototype.fetchVersion=function(cb){return _get_or_fetch.call(this,"version",VERSIONS,VERSION_PATH,"version",cb)};Service.prototype.query=function(options,cb){var _this=this;return $.when(this.fetchModel(),this.fetchSummaryFields()).pipe(function(m,sfs){var args,service;args=_.extend({},options,{model:m,summaryFields:sfs});service=_this;return Deferred(function(){this.fail(service.errorHandler);this.done(cb);try{return this.resolve(new Query(args,service))}catch(e){return this.reject(e)}})})};Service.prototype.manageUserPreferences=function(method,data){var _this=this;return REQUIRES_VERSION(this,11,function(){return _this.makeRequest(method,PREF_PATH,data).pipe(get("preferences"))})};Service.prototype.resolveIds=function(opts,cb){var _this=this;return REQUIRES_VERSION(this,10,function(){var req;req={type:"POST",url:_this.root+"ids",contentType:"application/json",data:JSON.stringify(opts),dataType:"json"};return _this.doReq(req).pipe(get("uid")).pipe(IDResolutionJob.create(_this)).done(cb)})};Service.prototype.createList=function(opts,ids,cb){var adjust,req,_this=this;if(opts==null){opts={}}if(ids==null){ids=""}if(cb==null){cb=function(){}}adjust=function(x){return _.defaults({token:_this.token,tags:opts.tags||[]},x)};req={data:_.isArray(ids)?ids.map(function(x){return'"'+x+'"'}).join("\n"):ids,dataType:"json",url:""+this.root+"lists?"+to_query_string(adjust(opts)),type:"POST",contentType:"text/plain"};return this.doReq(req).pipe(LIST_PIPE(this)).done(cb)};return Service}();Service.prototype.rowByRow=function(){var args,f,q,_this=this;q=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];f=http.iterReq("POST",QUERY_RESULTS_PATH,"json");if(q.toXML!=null){return f.apply(this,arguments)}else{return this.query(arguments[0]).then(function(query){return _this.rowByRow.apply(_this,[query].concat(__slice.call(args)))})}};Service.prototype.eachRow=Service.prototype.rowByRow;Service.prototype.recordByRecord=function(){var args,f,q,_this=this;q=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];f=http.iterReq("POST",QUERY_RESULTS_PATH,"jsonobjects");if(q.toXML!=null){return f.apply(this,arguments)}else{return this.query(arguments[0]).then(function(query){return _this.recordByRecord.apply(_this,[query].concat(__slice.call(args)))})}};Service.prototype.eachRecord=Service.prototype.recordByRecord;Service.prototype.union=Service.prototype.merge;Service.prototype.difference=Service.prototype.diff;Service.prototype.symmetricDifference=Service.prototype.diff;Service.prototype.relativeComplement=Service.prototype.complement;Service.prototype.subtract=Service.prototype.complement;Service.flushCaches=function(){MODELS={};VERSIONS={};SUMMARY_FIELDS={};return WIDGETS={}};Service.connect=function(opts){if(opts==null){opts={}}return new Service(opts)};intermine.Service=Service}).call(this)}).call(context);(function(){var jQuery=context.jQuery;var Backbone=context.Backbone;var $=jQuery;var _=context._;var intermine=context.intermine;(function(){var $,bio_formatters,define,end_of_definitions,reqs,require,root,scope,stope,using,x,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};if(Array.prototype.filter==null){Array.prototype.filter=function(test){var x,_i,_len,_results;_results=[];for(_i=0,_len=this.length;_i<_len;_i++){x=this[_i];if(test(x)){_results.push(x)}}return _results}}if(Array.prototype.map==null){Array.prototype.map=function(transform){var x,_i,_len,_results;_results=[];for(_i=0,_len=this.length;_i<_len;_i++){x=this[_i];_results.push(transform(x))}return _results}}if(Array.prototype.indexOf==null){Array.prototype.indexOf=function(elem){var i,x,_i,_len;for(i=_i=0,_len=this.length;_i<_len;i=++_i){x=this[i];if(x===elem){return i}}}}$=jQuery;if(Backbone.View.prototype.make==null){Backbone.View.prototype.make=function(elemName,attrs,content){var $el,el,name,value,x,_i,_len;el=document.createElement(elemName);$el=$(el);if(attrs!=null){for(name in attrs){value=attrs[name];if(name==="class"){$el.addClass(value)}else{$el.attr(name,value)}}}if(content!=null){if(_.isArray(content)){for(_i=0,_len=content.length;_i<_len;_i++){x=content[_i];$el.append(x)}}else{$el.append(content)}}return el}}(function($){var oldToggle;oldToggle=$.fn.dropdown.Constructor.prototype.toggle;return $.fn.dropdown.Constructor.prototype.toggle=function(e){oldToggle.call(this,e);$(this).trigger("toggle",$(this).closest(".dropdown").hasClass("open"));return false}})(jQuery);(function($){var oldPos;oldPos=$.fn.tooltip.Constructor.prototype.getPosition;return $.fn.tooltip.Constructor.prototype.getPosition=function(){var el,height,ret,width,_ref,_ref1;ret=oldPos.apply(this,arguments);el=this.$element[0];if(!ret.width&&!ret.height&&"http://www.w3.org/2000/svg"===el.namespaceURI){_ref1=(_ref=typeof el.getBoundingClientRect==="function"?el.getBoundingClientRect():void 0)!=null?_ref:el.getBBox(),width=_ref1.width,height=_ref1.height;return $.extend(ret,{width:width,height:height})}else{return ret}}})(jQuery);root=this;if(!root.console){root.console={log:function(){},debug:function(){},error:function(){}}}stope=function(f){return function(e){e.stopPropagation();e.preventDefault();return f(e)}};scope=function(path,code,overwrite){var name,ns,part,parts,value,_i,_len;if(code==null){code={}}if(overwrite==null){overwrite=false}parts=path.split(".");ns=root;for(_i=0,_len=parts.length;_i<_len;_i++){part=parts[_i];ns=ns[part]!=null?ns[part]:ns[part]={}}for(name in code){value=code[name];if(overwrite||ns[name]==null){ns[name]=value}}return ns};define=function(){};using=function(){};end_of_definitions=function(){};require=function(){};(function(){var define_pending_modules,defined_modules,pending_modules,sweep_pending;pending_modules={};defined_modules={};require=function(name){return defined_modules[name]};sweep_pending=function(){var name,newDefs,obj,pending;newDefs=0;for(name in pending_modules){pending=pending_modules[name];obj=pending();if(obj!=null){defined_modules[name]=obj;delete pending_modules[name];newDefs++}}return newDefs};define_pending_modules=function(){var _results;_results=[];while(sweep_pending()){_results.push(1)}return _results};define=function(name,f){if(name in pending_modules||name in defined_modules){throw new Error("Duplicate definition for "+name)}pending_modules[name]=f;define_pending_modules();return null};using=function(){var f,names,_i;names=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),f=arguments[_i++];return function(eof){var name,objs,_j,_len,_results;if(eof==null){eof=false}objs=function(){var _j,_len,_results;_results=[];for(_j=0,_len=names.length;_j<_len;_j++){name=names[_j];if(name in defined_modules){_results.push(defined_modules[name])}}return _results}();if(objs.length===names.length){return f.apply(null,objs)||true}else if(eof){_results=[];for(_j=0,_len=names.length;_j<_len;_j++){name=names[_j];if(!(name in defined_modules)){_results.push(name)}}return _results}else{return null}}};return end_of_definitions=function(){var err,name,pending,problems;pending=function(){var _results;_results=[];for(name in pending_modules){_results.push(name)}return _results}();if(pending.length){err="The following modules have unmet dependencies";problems=function(){var _i,_len,_results;_results=[];for(_i=0,_len=pending.length;_i<_len;_i++){name=pending[_i];_results.push(""+name+" needs ["+pending_modules[name](true)+"]")}return _results}();throw new Error(""+err+": "+problems.join(", "))}}})();scope("intermine",{scope:scope},true);(function($){var ClosableCollection,ERROR,ItemView,Tab,addStylePrefix,copy,getContainer,getOrganisms,getParameter,getReplacedTest,longestCommonPrefix,modelIsBio,numToString,openWindowWithPost,organisable,pluralise,renderError,requiresAuthentication,uniquelyFlat,walk,_ref,_ref1;walk=function(obj,f){var k,v,_results;_results=[];for(k in obj){if(!__hasProp.call(obj,k))continue;v=obj[k];if(_.isObject(v)){_results.push(walk(v,f))}else{_results.push(f(obj,k,v))}}return _results};copy=function(obj){var dup,duped,k,v,x,_i,_len;if(!_.isObject(obj)){return obj}dup=_.isArray(obj)?[]:{};for(k in obj){if(!__hasProp.call(obj,k))continue;v=obj[k];if(_.isArray(v)){duped=[];for(_i=0,_len=v.length;_i<_len;_i++){x=v[_i];duped.push(copy(x))}dup[k]=duped}else if(!_.isObject(v)){dup[k]=v}else{dup[k]=copy(v)}}return dup};getContainer=function(el){return el.closest("."+intermine.options.StylePrefix)};addStylePrefix=function(x){return function(elem){$(elem).addClass(intermine.options.StylePrefix);return x}};pluralise=function(word,count){if(count===1){return word}else if(word.match(/(s|x|ch)$/)){return word+"es"}else if(word.match(/[^aeiou]y$/)){return word.replace(/y$/,"ies")}else{return word+"s"}};numToString=function(num,sep,every){var chars,groups,i,len,rets;rets=[];i=0;chars=(num+"").split("");len=chars.length;groups=_(chars).groupBy(function(c,i){return Math.floor((len-(i+1))/every).toFixed()});while(groups[i]){rets.unshift(groups[i].join(""));i++}return rets.join(sep)};getParameter=function(params,name){return _(params).chain().select(function(p){return p.name===name}).pluck("value").first().value()};modelIsBio=function(model){return!!(model!=null?model.classes["Gene"]:void 0)};requiresAuthentication=function(q){return _.any(q.constraints,function(c){var _ref;return(_ref=c.op)==="NOT IN"||_ref==="IN"})};organisable=function(path){return path.getEndClass().name==="Organism"||path.getType().fields["organism"]!=null};uniquelyFlat=_.compose(_.uniq,_.flatten);longestCommonPrefix=function(paths){var nextPrefix,part,parts,prefix,prefixesAll,_i,_len;parts=paths[0].split(/\./);prefix=parts.shift();prefixesAll=function(pf){return _.all(paths,function(path){return 0===path.indexOf(pf)})};for(_i=0,_len=parts.length;_i<_len;_i++){part=parts[_i];if(prefixesAll(nextPrefix=""+prefix+"."+part)){prefix=nextPrefix}}return prefix};getReplacedTest=function(replacedBy,explicitReplacements){return function(col){var p,replacer;p=col.path;if(!(intermine.results.shouldFormat(p)||explicitReplacements[p])){return false}replacer=replacedBy[p];if(p.isAttribute()&&p.end.name==="id"){if(replacer==null){replacer=replacedBy[p.getParent()]}}return replacer&&replacer.formatter!=null&&col!==replacer}};getOrganisms=function(q,cb){return $.when(q).then(function(query){var c,def,done,mustBe,n,newView,opath,toRun;def=$.Deferred();if(cb!=null){def.done(cb)}done=_.compose(def.resolve,uniquelyFlat);mustBe=function(){var _i,_len,_ref,_ref1,_results;_ref=query.constraints;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){c=_ref[_i];if(((_ref1=c.op)==="="||_ref1==="ONE OF"||_ref1==="LOOKUP")&&c.path.match(/(o|O)rganism(\.\w+)?$/)){_results.push(c.value||c.values)}}return _results}();if(mustBe.length){done(mustBe)}else{toRun=query.clone();newView=function(){var _i,_len,_ref,_results;_ref=toRun.getViewNodes();_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){n=_ref[_i];if(!organisable(n)){continue}opath=n.getEndClass().name==="Organism"?n:n.append("organism");_results.push(opath.append("shortName"))}return _results}();if(newView.length){toRun.select(_.uniq(newView,String)).orderBy([]).rows().then(done,function(){return done([])})}else{done([])}}return def.promise()})};openWindowWithPost=function(uri,name,params){var addInput,form,k,v,w,_fn;form=$('<form style="display;none" method="POST" action="'+uri+'" \n     target="'+name+(new Date).getTime()+'">');addInput=function(k,v){var input;input=$('<input name="'+k+'" type="hidden">');form.append(input);return input.val(v)};_fn=function(k,v){var v_,_i,_len,_results;if(_.isArray(v)){_results=[];for(_i=0,_len=v.length;_i<_len;_i++){v_=v[_i];_results.push(addInput(k,v_))}return _results}else{return addInput(k,v)}};for(k in params){v=params[k];_fn(k,v)}form.appendTo("body");w=window.open("someNonExistantPathToSomeWhere",name);form.submit();form.remove();return w.close()};ERROR=_.template('<div class="alert alert-error">\n  <p class="apology">Could not fetch summary</p>\n  <pre><%- message %></pre>\n</div>');renderError=function(dest){return function(response,err){var $el,e,message;$el=$(dest).empty();message=function(){var _ref;try{return JSON.parse(response.responseText).error}catch(_error){e=_error;return(_ref=response!=null?response.responseText:void 0)!=null?_ref:err}}();return $el.append(ERROR({message:message}))}};ItemView=function(_super){__extends(ItemView,_super);function ItemView(){_ref=ItemView.__super__.constructor.apply(this,arguments);return _ref}ItemView.prototype.initialize=function(){if(this.model.toJSON==null){return this.model=new Backbone.Model(this.model)}};ItemView.prototype.renderError=function(resp){return renderError(this.el)(resp)};ItemView.prototype.render=function(){if(this.template!=null){this.$el.html(this.template(this.model.toJSON()))}this.trigger("rendered");return this};return ItemView}(Backbone.View);ClosableCollection=function(_super){__extends(ClosableCollection,_super);function ClosableCollection(){_ref1=ClosableCollection.__super__.constructor.apply(this,arguments);return _ref1}ClosableCollection.prototype.close=function(){this.each(function(m){m.destroy();return m.off()});this.reset();return this};return ClosableCollection}(Backbone.Collection);Tab=jQuery.fn.tab.noConflict();scope("intermine.bootstrap",{Tab:Tab});scope("intermine.views",{ItemView:ItemView});scope("intermine.models",{ClosableCollection:ClosableCollection});return scope("intermine.utils",{copy:copy,walk:walk,getOrganisms:getOrganisms,requiresAuthentication:requiresAuthentication,modelIsBio:modelIsBio,renderError:renderError,getParameter:getParameter,numToString:numToString,pluralise:pluralise,addStylePrefix:addStylePrefix,getContainer:getContainer,openWindowWithPost:openWindowWithPost,longestCommonPrefix:longestCommonPrefix,getReplacedTest:getReplacedTest})})(jQuery);scope("intermine.options",{INITIAL_SUMMARY_ROWS:1e3,NUM_SEPARATOR:",",NUM_CHUNK_SIZE:3,MAX_PIE_SLICES:15,DefaultCodeLang:"py",ListFreshness:250,MaxSuggestions:1e3,ListCategorisers:["organism.name","department.company.name"],PieColors:"category20",CellPreviewTrigger:"hover",IndicateOffHostLinks:true,ExternalLinkIcons:{"http://some.host.somewhere":"http://some.host.somewhere/logo.png"},StylePrefix:"intermine",GalaxyMain:"http://main.g2.bx.psu.edu",GalaxyCurrent:null,GalaxyTool:"flymine",GenomeSpaceUpload:"https://gsui.genomespace.org/jsui/upload/loadUrlToGenomespace.html",ExternalExportDestinations:{Galaxy:true,Genomespace:true},ShowId:false,TableWidgets:["Pagination","PageSizer","TableSummary","ManagementTools","ScrollBar"],CellCutoff:100,Style:{icons:"fontawesome"},CDN:{server:"http://cdn.intermine.org",tests:{fontawesome:/font-awesome/,glyphicons:/bootstrap-icons/},resources:{prettify:["/js/google-code-prettify/latest/prettify.js","/js/google-code-prettify/latest/prettify.css"],d3:"/js/d3/3.0.6/d3.v3.min.js",glyphicons:"/css/bootstrap/2.3.2/css/bootstrap-icons.css",fontawesome:"/css/font-awesome/4.x/css/font-awesome.min.css",filesaver:"/js/filesaver.js/FileSaver.min.js"}},D3:{Transition:{Easing:"elastic",Duration:750}},brand:{"http://www.flymine.org":"FlyMine","http://preview.flymine.org":"FlyMine-Preview","http://www.mousemine.org":"MouseMine (MGI)"},preview:{count:{"http://localhost/intermine-test/service/":{Department:["employees"],Company:["departments",{label:"employees",query:{select:"*",from:"Employee",where:{"department.company.id":"{{ID}}"}}}]},"http://preview.flymine.org/preview/service/":{Organism:[{label:"Genes",query:{select:"*",from:"Gene",where:{"organism.id":"{{ID}}"}}}],Gene:["pathways","proteins","publications","transcripts","homologues"]}}}});(function(){return scope("intermine",{setOptions:function(opts,ns){if(ns==null){ns=""}ns=ns===""||/^\./.test(ns)?"intermine.options"+ns:ns;return scope(ns,opts,true)}})})();(function(){var asArray,hasStyle,loader,parallel;asArray=function(things){return[].slice.call(things)};hasStyle=function(pattern){var links;if(pattern==null){return false}links=asArray(document.querySelectorAll('link[rel="stylesheet"]'));return _.any(links,function(link){return pattern.test(link.href)})};parallel=function(promises){return jQuery.when.apply(jQuery,promises)};loader=function(server){return function(resource,resourceRegex){var fetch,link,resolution;resolution=jQuery.Deferred(function(){return _.delay(this.resolve,50,true)});if(/\.css$/.test(resource)){if(hasStyle(resourceRegex)){return resolution}link=jQuery('<link type="text/css" rel="stylesheet">');link.appendTo("head").attr({href:server+resource});return resolution}else{fetch=jQuery.ajax({url:server+resource,cache:true,dataType:"script"});return fetch.then(function(){return resolution})}}};return scope("intermine.cdn",{load:function(ident){var conf,load,resources,server,test,tests,_ref;_ref=intermine.options.CDN,server=_ref.server,tests=_ref.tests,resources=_ref.resources;conf=resources[ident];test=tests[ident];load=loader(server);if(!conf){return jQuery.Deferred(function(){return this.reject("No resource is configured for "+ident)})}else if(_.isArray(conf)){return parallel(conf.map(function(c){return load(c)}))}else{return load(conf,test)}}})})();scope("intermine.css",{unsorted:"icon-resize-vertical fa-unsorted",sortedASC:"icon-arrow-up fa-sort-up",sortedDESC:"icon-arrow-down fa-sort-down",headerIcon:"im-header-icon",headerIconRemove:"icon-remove fa-times",headerIconHide:"icon-minus fa-ellipsis-h",headerIconReveal:"icon-fullscreen fa-arrows-h"});scope("intermine.icons",{Base:"icon fa",Yes:"icon-star fa fa-star",No:"icon-star-empty fa fa-star-o",Table:"icon-list fa fa-list",Script:"icon-cog fa fa-cog",Export:"icon-download-alt fa fa-cloud-download",Remove:"icon-minus-sign fa fa-minus-sign",Check:"icon-ok fa fa-ok",UnCheck:"icon-none fa fa-none",CheckUnCheck:"icon-ok icon-none fa-none fa-ok",Add:"icon-plus-sign fa fa-plus",Move:"icon-move fa fa-move",More:"icon-plus-sign fa fa-plus-sign",Filter:"icon-filter fa fa-filter",Summary:"icon-eye-open fa fa-bar-chart-o",Undo:"icon-refresh fa fa-refresh",Columns:"icon-wrench fa fa-wrench",Collapsed:"icon-chevron-right fa fa-chevron-right",Expanded:"icon-chevron-down fa fa-chevron-down",MoveDown:"icon-chevron-down fa fa-chevron-down",MoveUp:"icon-chevron-up fa fa-chevron-up",Toggle:"icon-retweet fa fa-retweet",ExpandCollapse:"icon-angle-right icon-angle-down fa-angle-right fa-angle-down",Help:"icon-question-sign fa fa-question-sign",ReverseRef:"icon-retweet fa fa-retweet",Reorder:"icon-reorder fa fa-reorder",Edit:"icon-edit fa fa-edit",Download:"icon-file fa fa-file-archive-o",ClipBoard:"icon-paper-clip fa fa-paper-clip",Composed:"icon-tags fa fa-tags",tsv:"icon-list fa fa-list",csv:"icon-list fa fa-list",xml:"icon-xml fa fa-xml",json:"icon-json fa fa-json"});scope("intermine.messages.actions",{ListNameDuplicate:"List names must be unique. This name is already taken",ListNameEmpty:"Lists must have names. Please enter one",ListNameIllegal:_.template("Some characters are not allowed in list names. This name contains the following\nillegal characters: <%- illegals.join(', ') %>. Please remove them."),ExportTitle:"Download Results",ConfigureExport:"Configure Export",GetData:"Download Data",ExportHelp:"Download file containing results to your computer",ExportButton:"Download",ExportFormat:"Format",Cancel:"Cancel",Clear:"Clear",Export:"Download","download-file":"Download File",Galaxy:"Send to Galaxy",Genomespace:"Upload to Genomespace","Destdownload-file":"File",DestGalaxy:"Galaxy",DestGenomespace:"Genomespace",ExportAlt:"Send Data Somewhere Else",ExportLong:'<span class="hidden-tablet">Download</span>\nFile\n<span class="im-only-widescreen">to your Computer</span>',SendToGalaxy:'<span class="hidden-tablet">Send to</span>\nGalaxy\n<span class="im-only-widescreen">for analysis</span>',SendToGenomespace:'<span class="hidden-tablet">Upload to</span>\n<span class="im-only-widescreen">your</span>\nGenomespace\n<span class="im-only-widescreen">account</span>',MyGalaxy:"Send to your Galaxy",ForgetGalaxy:"Clear this galaxy URL",GalaxyHelp:"Start a file upload job within Galaxy",GalaxyURILabel:"Galaxy Location:",GalaxyAlt:"Send to a specific Galaxy",SaveGalaxyURL:"Make this my default Galaxy",WhatIsGalaxy:"What is Galaxy?",WhatIsGalaxyURL:"http://wiki.g2.bx.psu.edu/",GalaxyAuthExplanation:"If you have already logged into Galaxy with this browser, then the data\nwill be sent into your active account. Otherwise it will appear in a \ntemporary anonymous account.",CopyToClipBoard:"Copy to clipboard: <CTL>+C, <ENTER>",IsPrivateData:"This link provides access to data stored in your private lists. In order to do so\nit uses the API access token provided on initialisation. If this is your permanent\nAPI token you should be as careful of this link as you would of the data is provides\naccess to. If this is just a 24 hour access token, then you will need to replace it\nonce it becomes invalid.",LongURI:"The normal URI for this query (which includes the full query XML in the \nparameters) is too long for a GET request. The URI you can see here uses a\nquery-id, which has a limited validity. You should not store this URI for long\nterm use.",SendToOtherGalaxy:"Send",AllRows:"Whole Result Set",SomeRows:"Specific Range",WhichRows:"Rows to Export",RowsHelp:"Export all rows, or define a range of rows to export.",AllColumns:"All Current Columns",SomeColumns:"Choose Columns",CompressResults:"Compress results",NoCompression:"No compression",GZIPCompression:"GZIP",ZIPCompression:"ZIP",Copy:"copy to clip-board",ResultsPermaLink:"Perma-link to results",ResultsPermaLinkText:"Results URI",QueryXML:"Query XML",ResultsPermaLinkTitle:"Get a permanent URL for these results, suitable for your own use",ResultsPermaLinkShareTitle:"Get a permanent URL for these results, suitable for sharing with others",ColumnsHelp:"Export all columns, or choose specific columns to export.",WhichColumns:"Columns to Export",ResetColumns:"Reset Columns.",FirstRow:"From",LastRow:"To",SpreadsheetOptions:"Spreadsheet Options",ColumnHeaders:"Include Column Headers",PossibleColumns:"You can add any attribute from these nodes without changing your results:",ExportedColumns:"Exported Columns (drag to reorder)",ChangeColumns:"You may add any of the columns in the right hand box by clicking on the\nplus sign. You may remove unwanted columns by clicking on the minus signs\nin the left hand box. Note that while adding these columns will not alter your query,\nif you remove all the attributes from an item, then you <b>may change</b> the results\nyou receive.",OuterJoinWarning:"This query has outer-joined collections. This means that the number of rows in \nthe table is likely to be different from the number of rows in the exported results.\n<b>You are strongly discouraged from specifying specific ranges for export</b>. If\nyou do specify a certain range, please check that you did in fact get all the \nresults you wanted.",IncludedFeatures:"Exportable parts of this Query - <strong>choose at least one</strong>:",FastaFeatures:"Features with Sequences in this Query - <strong>select one</strong>:",FastaOptions:"FASTA Specific Options",FastaExtension:"Extension (eg: 100/100bp/5kbp/0.5mbp):",ExtraAttributes:"Columns to include as extra attributes on each exported record:",NoSuitableColumns:"There are no columns of a suitable type for this format.",BEDOptions:"BED Specific Options",Gff3Options:"GFF3 Specific Options",ChrPrefix:'Prefix "chr" to the chromosome identifier as per UCSC convention (eg: chr2)',ConfigureExportHelp:"Configure the export options in these categories"});
scope("intermine.messages.cell",{RelatedItems:"Related item counts:"});scope("intermine.messages.columns",{FindColumnToAdd:"Add a new Column",OrderVerb:"Add / Remove / Re-Arrange",OrderTitle:"Columns",SortVerb:"Configure",SortTitle:"Sort-Order",OnlyColsInView:"Only show columns in the table:",SortingHelpTitle:"What Columns Can I Sort by?",SortingHelpContent:'A table can be sorted by any of the attributes of the objects\nwhich are in the output columns or constrained by a filter, so\nlong as they haven\'t been declared to be optional parts of the\nquery. So if you are displaying <span class="label path">Gene > Name</span>\nand <span class="label path">Gene > Exons > Symbol</span>, and also\n<span class="label path">Gene > Proteins > Name</span> if the gene\nhas any proteins (ie. the proteins part of the query is optional), then\nyou can sort by any of the attributes attached to\n<span class="label path available">Gene</span>\nor <span class="label path available">Gene > Exons</span>,\nwhether or not you have selected them for output, but you could not sort by\nany of the attributes of <span class="label path available">Gene > Proteins</span>,\nsince these items may not be present in the results.'});scope("intermine.messages.facets",{DownloadData:"Save",DownloadFormat:"As",More:"Load more items",Include:"Restrict table to matching rows",Exclude:"Exclude matching rows from table",Reset:"Reset selection",ToggleSelection:"Toggle selection"});scope("intermine.messages.constraints",{BrowseForColumn:"Browse for Column",AddANewFilter:"Add a new filter",Filter:"Filter"});(function(){var Attribute,CONSTRAINT_ADDER_HTML,ConstraintAdder,PATH_HIGHLIGHTER,PATH_LEN_SORTER,PATH_MATCHER,PathChooser,Reference,ReverseReference,RootClass,pathLen,pos,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;pos=function(substr){return _.memoize(function(str){return str.toLowerCase().indexOf(substr)})};pathLen=_.memoize(function(str){return str.split(".").length});CONSTRAINT_ADDER_HTML='<input type="text" placeholder="'+intermine.messages.constraints.AddANewFilter+'"\n        class="im-constraint-adder span9">\n<button disabled class="btn btn-primary span2" type="submit">\n  '+intermine.messages.constraints.Filter+"\n</button>";PATH_LEN_SORTER=function(items){var getPos;getPos=pos(this.query.toLowerCase());items.sort(function(a,b){if(a===b){return 0}else{return getPos(a)-getPos(b)||pathLen(a)-pathLen(b)||(a<b?-1:1)}});return items};PATH_MATCHER=function(item){var lci,term,terms;lci=item.toLowerCase();terms=function(){var _i,_len,_ref,_results;_ref=this.query.toLowerCase().split(/\s+/);_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){term=_ref[_i];if(term){_results.push(term)}}return _results}.call(this);return item&&_.all(terms,function(t){return lci.match(t)})};PATH_HIGHLIGHTER=function(item){var term,terms,_i,_len;terms=this.query.toLowerCase().split(/\s+/);for(_i=0,_len=terms.length;_i<_len;_i++){term=terms[_i];if(term){item=item.replace(new RegExp(term,"gi"),function(match){return"<>"+match+"</>"})}}return item.replace(/>/g,"strong>")};Attribute=function(_super){__extends(Attribute,_super);function Attribute(){_ref=Attribute.__super__.constructor.apply(this,arguments);return _ref}Attribute.prototype.tagName="li";Attribute.prototype.events={"click a":"handleClick"};Attribute.prototype.handleClick=function(e){var isNewChoice;e.stopPropagation();e.preventDefault();if(!this.getDisabled(this.path)){isNewChoice=!this.$el.is(".active");return this.evts.trigger("chosen",this.path,isNewChoice)}};Attribute.prototype.initialize=function(query,path,depth,evts,getDisabled,multiSelect){var _this=this;this.query=query;this.path=path;this.depth=depth;this.evts=evts;this.getDisabled=getDisabled;this.multiSelect=multiSelect;this.listenTo(this.evts,"remove",function(){return _this.remove()});this.listenTo(this.evts,"chosen",function(p,isNewChoice){if(p.toString()===_this.path.toString()){return _this.$el.toggleClass("active",isNewChoice)}else{if(!_this.multiSelect){return _this.$el.removeClass("active")}}});return this.listenTo(this.evts,"filter:paths",function(terms){var lastMatch,matches,t,_i,_len;terms=function(){var _i,_len,_results;_results=[];for(_i=0,_len=terms.length;_i<_len;_i++){t=terms[_i];if(t){_results.push(new RegExp(t,"i"))}}return _results}();if(terms.length){matches=0;lastMatch=null;for(_i=0,_len=terms.length;_i<_len;_i++){t=terms[_i];if(t.test(_this.path.toString())||t.test(_this.displayName)){matches+=1;lastMatch=t}}return _this.matches(matches,terms,lastMatch)}else{return _this.$el.show()}})};Attribute.prototype.remove=function(){var prop,_i,_len,_ref1;_ref1=["query","path","depth","evts","getDisabled","multiSelect"];for(_i=0,_len=_ref1.length;_i<_len;_i++){prop=_ref1[_i];delete this[prop]}return Attribute.__super__.remove.apply(this,arguments)};Attribute.prototype.template=_.template('<a href="#" title="<%- path %> (<%- type %>)"><span><%- name %></span></a>');Attribute.prototype.matches=function(matches,terms){var _this=this;if(matches===terms.length){this.evts.trigger("matched",this.path.toString());this.path.getDisplayName(function(name){var hl,matchesOnPath,term,_i,_len;hl=_this.depth>0?name.replace(/^.*>\s*/,""):name;for(_i=0,_len=terms.length;_i<_len;_i++){term=terms[_i];hl=hl.replace(term,function(match){return"<strong>"+match+"</strong>"})}matchesOnPath=_.any(terms,function(t){return!!_this.path.end.name.match(t)});return _this.$("a span").html(hl.match(/strong/)||!matchesOnPath?hl:"<strong>"+hl+"</strong>")})}return this.$el.toggle(!!(matches===terms.length))};Attribute.prototype.rendered=false;Attribute.prototype.render=function(){var disabled,_this=this;disabled=this.getDisabled(this.path);if(disabled){this.$el.addClass("disabled")}this.rendered=true;this.path.getDisplayName().then(function(name){var a;_this.displayName=name;name=name.replace(/^.*\s*>/,"");a=$(_this.template(_.extend({},_this,{name:name,path:_this.path,type:_this.path.getType()})));a.appendTo(_this.el);return _this.addedLiContent(a)});return this};Attribute.prototype.addedLiContent=function(a){if(intermine.options.ShowId){return a.tooltip({placement:"bottom"}).appendTo(this.el)}else{return a.attr({title:""})}};return Attribute}(Backbone.View);RootClass=function(_super){__extends(RootClass,_super);function RootClass(){_ref1=RootClass.__super__.constructor.apply(this,arguments);return _ref1}RootClass.prototype.className="im-rootclass";RootClass.prototype.initialize=function(query,cd,evts,multiSelect){this.query=query;this.cd=cd;this.evts=evts;this.multiSelect=multiSelect;return RootClass.__super__.initialize.call(this,this.query,this.query.getPathInfo(this.cd.name),0,this.evts,function(){return false},this.multiSelect)};RootClass.prototype.template=_.template('<a href="#">\n  <i class="icon-stop"></i>\n  <span><%- name %></span>\n</a>');return RootClass}(Attribute);Reference=function(_super){__extends(Reference,_super);function Reference(){this.collapse=__bind(this.collapse,this);_ref2=Reference.__super__.constructor.apply(this,arguments);return _ref2}Reference.prototype.initialize=function(query,path,depth,evts,getDisabled,multiSelect,isSelectable){var _this=this;this.query=query;this.path=path;this.depth=depth;this.evts=evts;this.getDisabled=getDisabled;this.multiSelect=multiSelect;this.isSelectable=isSelectable;Reference.__super__.initialize.call(this,this.query,this.path,this.depth,this.evts,this.getDisabled,this.multiSelect);this.evts.on("filter:paths",function(terms){return _this.$el.hide()});this.evts.on("matched",function(path){if(path.match(_this.path.toString())){_this.$el.show();if(!_this.$el.is(".open")){return _this.openSubFinder()}}});return this.evts.on("collapse:tree-branches",this.collapse)};Reference.prototype.collapse=function(){var _ref3;if((_ref3=this.subfinder)!=null){_ref3.remove()}this.$el.removeClass("open");return this.$("i.im-has-fields").removeClass(intermine.icons.Expanded).addClass(intermine.icons.Collapsed)};Reference.prototype.remove=function(){this.collapse();return Reference.__super__.remove.call(this)};Reference.prototype.openSubFinder=function(){this.$el.addClass("open");this.$("i.im-has-fields").removeClass(intermine.icons.Collapsed).addClass(intermine.icons.Expanded);this.subfinder=new PathChooser(this.query,this.path,this.depth+1,this.evts,this.getDisabled,this.isSelectable,this.multiSelect);this.subfinder.allowRevRefs(this.allowRevRefs);return this.$el.append(this.subfinder.render().el)};Reference.prototype.template=_.template('<a href="#">\n  <i class="'+intermine.icons.Collapsed+' im-has-fields"></i>\n  <% if (isLoop) { %>\n    <i class="'+intermine.icons.ReverseRef+'"></i>\n  <% } %>\n  <span><%- name %></span>\n</a>');Reference.prototype.iconClasses=intermine.icons.ExpandCollapse;Reference.prototype.toggleFields=function(){if(this.$el.is(".open")){return this.collapse()}else{return this.openSubFinder()}};Reference.prototype.handleClick=function(e){e.preventDefault();e.stopPropagation();if($(e.target).is(".im-has-fields")||!this.isSelectable){return this.toggleFields()}else{return Reference.__super__.handleClick.call(this,e)}};Reference.prototype.addedLiContent=function(a){var prefix;prefix=new RegExp("^"+this.path+"\\.");if(_.any(this.query.views,function(v){return v.match(prefix)})){this.toggleFields();return this.$el.addClass("im-in-view")}};return Reference}(Attribute);ReverseReference=function(_super){__extends(ReverseReference,_super);function ReverseReference(){_ref3=ReverseReference.__super__.constructor.apply(this,arguments);return _ref3}ReverseReference.prototype.template=_.template('<a href="#">\n  <i class="'+intermine.icons.ReverseRef+' im-has-fields"></i>\n  <span><%- name %></span>\n</a>');ReverseReference.prototype.toggleFields=function(){};ReverseReference.prototype.handleClick=function(e){e.preventDefault();e.stopPropagation();return this.$el.tooltip("hide")};ReverseReference.prototype.render=function(){ReverseReference.__super__.render.call(this);this.$el.attr({title:"Refers back to "+this.path.getParent().getParent()}).tooltip();return this};return ReverseReference}(Reference);PathChooser=function(_super){__extends(PathChooser,_super);function PathChooser(){this.allowRevRefs=__bind(this.allowRevRefs,this);this.searchFor=__bind(this.searchFor,this);_ref4=PathChooser.__super__.constructor.apply(this,arguments);return _ref4}PathChooser.prototype.tagName="ul";PathChooser.prototype.dropDownClasses="";PathChooser.prototype.searchFor=function(terms){var m,matches,p,_i,_len,_results;this.evts.trigger("filter:paths",terms);matches=function(){var _i,_len,_ref5,_results,_this=this;_ref5=this.query.getPossiblePaths(3);_results=[];for(_i=0,_len=_ref5.length;_i<_len;_i++){p=_ref5[_i];if(_.all(terms,function(t){return p.match(new RegExp(t,"i"))})){_results.push(p)}}return _results}.call(this);_results=[];for(_i=0,_len=matches.length;_i<_len;_i++){m=matches[_i];_results.push(this.evts.trigger("matched",m,terms))}return _results};PathChooser.prototype.initialize=function(query,path,depth,events,getDisabled,canSelectRefs,multiSelect){var attr,cd,coll,name,ref,toPath,_this=this;this.query=query;this.path=path;this.depth=depth;this.getDisabled=getDisabled;this.canSelectRefs=canSelectRefs;this.multiSelect=multiSelect;this.state=new Backbone.Model({allowRevRefs:false});this.leaves=[];this.evts=this.depth===0?_.extend({},Backbone.Events):events;cd=this.path.getEndClass();toPath=function(f){return _this.path.append(f)};this.attributes=function(){var _ref5,_results;_ref5=cd.attributes;_results=[];for(name in _ref5){attr=_ref5[name];_results.push(toPath(attr))}return _results}();this.references=function(){var _ref5,_results;_ref5=cd.references;_results=[];for(name in _ref5){ref=_ref5[name];_results.push(toPath(ref))}return _results}();this.collections=function(){var _ref5,_results;_ref5=cd.collections;_results=[];for(name in _ref5){coll=_ref5[name];_results.push(toPath(coll))}return _results}();if(this.depth===0){this.evts.on("chosen",events)}this.on("collapse:tree-branches",function(){return _this.evts.trigger("collapse:tree-branches")});return this.state.on("change:allowRevRefs",function(){if(_this.rendered){return _this.render()}})};PathChooser.prototype.allowRevRefs=function(allowed){return this.state.set({allowRevRefs:allowed})};PathChooser.prototype.remove=function(){if(this.depth===0){this.evts.off()}this.state.off();return PathChooser.__super__.remove.call(this)};PathChooser.prototype.reset=function(){var leaf,_ref5,_results;if((_ref5=this.$root)!=null){_ref5.remove()}_results=[];while(leaf=this.leaves.pop()){_results.push(leaf.remove())}return _results};PathChooser.prototype.render=function(){var allowingRevRefs,apath,attr,cd,isLoop,leaf,ref,rpath,_i,_j,_k,_len,_len1,_len2,_ref5,_ref6,_ref7;this.reset();this.rendered=true;cd=this.path.getEndClass();if(this.depth===0&&this.canSelectRefs){this.$root=new RootClass(this.query,cd,this.evts,this.multiSelect);this.$el.append(this.$root.render().el)}_ref5=this.attributes;for(_i=0,_len=_ref5.length;_i<_len;_i++){apath=_ref5[_i];if(intermine.options.ShowId||apath.end.name!=="id"){attr=new Attribute(this.query,apath,this.depth,this.evts,this.getDisabled,this.multiSelect);this.leaves.push(attr)}}_ref6=this.references.concat(this.collections);for(_j=0,_len1=_ref6.length;_j<_len1;_j++){rpath=_ref6[_j];isLoop=false;if(rpath.end.reverseReference!=null&&this.path.isReference()){if(this.path.getParent().isa(rpath.end.referencedType)){if(this.path.end.name===rpath.end.reverseReference){isLoop=true}}}allowingRevRefs=this.state.get("allowRevRefs");ref=isLoop&&!allowingRevRefs?new ReverseReference(this.query,rpath,this.depth,this.evts,function(){return true},this.multiSelect,this.canSelectRefs):new Reference(this.query,rpath,this.depth,this.evts,this.getDisabled,this.multiSelect,this.canSelectRefs);ref.allowRevRefs=allowingRevRefs;ref.isLoop=isLoop;this.leaves.push(ref)}_ref7=this.leaves;for(_k=0,_len2=_ref7.length;_k<_len2;_k++){leaf=_ref7[_k];this.$el.append(leaf.render().el)}if(this.depth===0){this.$el.addClass(this.dropDownClasses)}this.$el.show();return this};return PathChooser}(Backbone.View);ConstraintAdder=function(_super){var VALUE_OPS;__extends(ConstraintAdder,_super);function ConstraintAdder(){this.showTree=__bind(this.showTree,this);this.handleChoice=__bind(this.handleChoice,this);this.handleSubmission=__bind(this.handleSubmission,this);_ref5=ConstraintAdder.__super__.constructor.apply(this,arguments);return _ref5}ConstraintAdder.prototype.tagName="form";ConstraintAdder.prototype.className="form im-constraint-adder row-fluid im-constraint";ConstraintAdder.prototype.initialize=function(query){this.query=query};ConstraintAdder.prototype.events=function(){return{submit:"handleSubmission","click .im-collapser":"collapseBranches","change .im-allow-rev-ref":"allowReverseRefs"}};ConstraintAdder.prototype.collapseBranches=function(){var _ref6;return(_ref6=this.$pathfinder)!=null?_ref6.trigger("collapse:tree-branches"):void 0};ConstraintAdder.prototype.allowReverseRefs=function(){var _ref6;return(_ref6=this.$pathfinder)!=null?_ref6.allowRevRefs(this.$(".im-allow-rev-ref").is(":checked")):void 0};ConstraintAdder.prototype.handleClick=function(e){e.preventDefault();if(!$(e.target).is("button")){e.stopPropagation()}if($(e.target).is("button.btn-primary")){return this.handleSubmission(e)}};ConstraintAdder.prototype.handleSubmission=function(e){var con,_ref6;e.preventDefault();e.stopPropagation();if(this.chosen!=null){con={path:this.chosen.toString()};this.newCon=new intermine.query.NewConstraint(this.query,con);this.newCon.render().$el.insertAfter(this.el);this.$(".btn-primary").fadeOut("fast");if((_ref6=this.$pathfinder)!=null){_ref6.remove()}this.$pathfinder=null;return this.query.trigger("editing-constraint")}else{return console.log("Nothing chosen")}};ConstraintAdder.prototype.handleChoice=function(path,isNewChoice){if(isNewChoice){this.chosen=path;return this.$(".btn-primary").fadeIn("slow")}else{this.chosen=null;return this.$(".btn-primary").fadeOut("slow")}};ConstraintAdder.prototype.isDisabled=function(path){return false};ConstraintAdder.prototype.getTreeRoot=function(){return this.query.getPathInfo(this.query.root)};ConstraintAdder.prototype.refsOK=true;ConstraintAdder.prototype.multiSelect=false;ConstraintAdder.prototype.reset=function(){var _ref6;this.trigger("resetting:tree");if((_ref6=this.$pathfinder)!=null){_ref6.remove()}this.$pathfinder=null;return this.$(".im-tree-option").addClass("hidden")};ConstraintAdder.prototype.showTree=function(e){var pathFinder,treeRoot;this.$(".im-tree-option").removeClass("hidden");this.trigger("showing:tree");if(this.$pathfinder!=null){return this.reset()}else{treeRoot=this.getTreeRoot();pathFinder=new PathChooser(this.query,treeRoot,0,this.handleChoice,this.isDisabled,this.refsOK,this.multiSelect);pathFinder.render();this.$el.append(pathFinder.el);pathFinder.$el.show().css({top:this.$el.height()});return this.$pathfinder=pathFinder}};VALUE_OPS=intermine.Query.ATTRIBUTE_VALUE_OPS.concat(intermine.Query.REFERENCE_OPS);ConstraintAdder.prototype.isValid=function(){var _ref6,_ref7;if(this.newCon!=null){if(!this.newCon.con.has("op")){return false}if(_ref6=this.newCon.con.get("op"),__indexOf.call(VALUE_OPS,_ref6)>=0){return this.newCon.con.has("value")}if(_ref7=this.newCon.con.get("op"),__indexOf.call(intermine.Query.MULTIVALUE_OPS,_ref7)>=0){return this.newCon.con.has("values")}return true}else{return false}};ConstraintAdder.prototype.render=function(){var approver,browser;browser=$('<button type="button" class="btn btn-chooser" data-toggle="button">\n  <i class="icon-sitemap"></i>\n  <span>'+intermine.messages.constraints.BrowseForColumn+"</span>\n</button>");approver=$(this.make("button",{type:"button","class":"btn btn-primary"},"Choose"));this.$el.append(browser);this.$el.append(approver);approver.click(this.handleSubmission);browser.click(this.showTree);this.$(".btn-chooser").after('<label class="im-tree-option hidden">\n  '+intermine.messages.columns.AllowRevRef+'\n  <input type="checkbox" class="im-allow-rev-ref">\n</label>\n<button class="btn im-collapser im-tree-option hidden" type="button" >\n  '+intermine.messages.columns.CollapseAll+"\n</button>");return this};return ConstraintAdder}(Backbone.View);return scope("intermine.query",{PATH_LEN_SORTER:PATH_LEN_SORTER,PATH_MATCHER:PATH_MATCHER,PATH_HIGHLIGHTER:PATH_HIGHLIGHTER,ConstraintAdder:ConstraintAdder})})();reqs=["actions","actions/list-manager","actions/code-gen","actions/export-manager"];define("actions/actionbar",using.apply(null,__slice.call(reqs).concat([function(Actions,Lists,CodeGen,Exports){var ActionBar,_ref;ActionBar=function(_super){__extends(ActionBar,_super);function ActionBar(){_ref=ActionBar.__super__.constructor.apply(this,arguments);return _ref}ActionBar.prototype.extraClass="im-action";ActionBar.prototype.actionClasses=function(){return[Lists,CodeGen,Exports]};return ActionBar}(Actions);scope("intermine.query.actions",{ActionBar:ActionBar});return ActionBar}])));define("actions/code-gen",using("perma-query","html/code-gen",function(getPermaQuery,HTML){var CODE_GEN_LANGS,CodeGenerator,alreadyDone,alreadyRejected,defer,get,indent,invoke,_ref,_ref1;CODE_GEN_LANGS=[{name:"Perl",extension:"pl"},{name:"Python",extension:"py"},{name:"Ruby",extension:"rb"},{name:"Java",extension:"java"},{name:"JavaScript",extension:"js"},{name:"XML",extension:"xml"}];indent=function(xml){var buffer,indentLevel,isClosing,isOneLiner,isOpening,line,lines,_i,_len;lines=xml.split(/></);indentLevel=1;buffer=[];for(_i=0,_len=lines.length;_i<_len;_i++){line=lines[_i];if(!/>$/.test(line)){line=line+">"}if(!/^</.test(line)){line="<"+line}isClosing=/^<\/\w+\s*>/.test(line);isOneLiner=/\/>$/.test(line)||!isClosing&&/<\/\w+>$/.test(line);isOpening=!(isOneLiner||isClosing);if(isClosing){indentLevel--}buffer.push(new Array(indentLevel).join("  ")+line);if(isOpening){indentLevel++}}return buffer.join("\n")};_ref=intermine.funcutils,get=_ref.get,invoke=_ref.invoke;defer=function(x){return jQuery.Deferred(function(){return this.resolve(x)})};alreadyDone=defer(true);alreadyRejected=jQuery.Deferred(function(){return this.reject("not available")});return CodeGenerator=function(_super){var canSaveFromMemory;__extends(CodeGenerator,_super);function CodeGenerator(){this.expand=__bind(this.expand,this);this.compact=__bind(this.compact,this);this.doMainAction=__bind(this.doMainAction,this);this.displayLang=__bind(this.displayLang,this);this.showComments=__bind(this.showComments,this);this.render=__bind(this.render,this);_ref1=CodeGenerator.__super__.constructor.apply(this,arguments);return _ref1}CodeGenerator.prototype.tagName="li";CodeGenerator.prototype.className="im-code-gen";CodeGenerator.prototype.html=HTML({langs:CODE_GEN_LANGS});CodeGenerator.prototype.initialize=function(states){var l,lang,_i,_len;this.states=states;this.model=new Backbone.Model;for(_i=0,_len=CODE_GEN_LANGS.length;_i<_len;_i++){l=CODE_GEN_LANGS[_i];if(l.extension===intermine.options.DefaultCodeLang){lang=l}}if(lang==null){lang=CODE_GEN_LANGS[0]}this.model.set({lang:lang});return this.model.on("set:lang",this.displayLang)};CodeGenerator.prototype.render=function(){this.$el.append(this.html);this.$(".modal").hide();return this};CodeGenerator.prototype.events={"click .im-show-comments":"showComments","click .dropdown-menu a":"setLang","click .btn-action":"doMainAction"};CodeGenerator.prototype.showComments=function(e){if($(e.target).is(".active")){return this.compact()}else{return this.expand()}};CodeGenerator.prototype.setLang=function(e){var $t,desired,l,lang,_i,_len;$t=$(e.target);desired=$t.data("lang");for(_i=0,_len=CODE_GEN_LANGS.length;_i<_len;_i++){l=CODE_GEN_LANGS[_i];if(l.extension===desired){lang=l}}if(lang!=null){this.model.set({lang:lang},{silent:true});return this.model.trigger("set:lang")}};canSaveFromMemory=function(){if(typeof Blob==="undefined"||Blob===null){alreadyRejected}if(typeof saveAs!=="undefined"&&saveAs!==null){return alreadyDone}else{return intermine.cdn.load("filesaver")}};CodeGenerator.prototype.displayLang=function(){var $modal,code,ext,href,isJS,isXML,lang,pq,query,ready,saveBtn,_this=this;lang=this.model.get("lang")||CODE_GEN_LANGS[0];query=this.states.currentQuery;pq=getPermaQuery(query);isJS=lang.extension==="js";isXML=lang.extension==="xml";ext=isJS?"html":lang.extension;href=isXML?"":query.getCodeURI(lang.extension);ready=typeof prettyPrintOne!=="undefined"&&prettyPrintOne!==null?alreadyDone:intermine.cdn.load("prettify");$modal=this.$(".modal");saveBtn=this.$(".modal .btn-save").removeClass("disabled").unbind("click").attr({href:null});code=isXML?pq.then(invoke("toXML")).then(indent):pq.then(invoke("fetchCode",lang.extension));this.$(".im-code-lang").text(lang.name);if(isXML){saveBtn.addClass("disabled");jQuery.when(code,canSaveFromMemory()).done(function(xml){return saveBtn.removeClass("disabled").click(function(){var blob;blob=new Blob([xml],{type:"application/xml;charset=utf8"});return saveAs(blob,"query.xml")})})}else{pq.then(invoke("getCodeURI",lang.extension)).then(function(href){return saveBtn.attr({href:href})})}return jQuery.when(code,ready).fail(function(e){return _this.states.trigger("error",e)}).then(function(code){var formatted;formatted=prettyPrintOne(_.escape(code),ext);$modal.find("pre").html(formatted);return $modal.modal("show")})};CodeGenerator.prototype.doMainAction=function(e){if(this.model.has("lang")){return this.displayLang()}else{return $(e.target).next().dropdown("toggle")}};CodeGenerator.prototype.compact=function(){var $m;$m=this.$(".modal");$m.find("span.com").closest("li").slideUp();return $m.find(".linenums li").filter(function(){return $(this).text().replace(/\s+/g,"")===""}).slideUp()};CodeGenerator.prototype.expand=function(){var $m;$m=this.$(".modal");return $m.find("linenums li").slideDown()};return CodeGenerator}(Backbone.View)}));define("actions/export-manager",function(){var ExportManager,_ref;return ExportManager=function(_super){__extends(ExportManager,_super);function ExportManager(){_ref=ExportManager.__super__.constructor.apply(this,arguments);return _ref}ExportManager.prototype.tagName="li";ExportManager.prototype.className="im-data-export";ExportManager.prototype.initialize=function(states){this.states=states;return ExportManager.__super__.initialize.call(this)};ExportManager.prototype.template=_.template('<a class="btn im-open-dialogue">\n  <i class="'+intermine.icons.Export+'"></i>\n  <span class="visible-desktop">'+intermine.messages.actions.ExportButton+"</span>\n</a>");ExportManager.prototype.events=function(){return{"click .im-open-dialogue":"openDialogue"}};ExportManager.prototype.openDialogue=function(){var _ref1;if((_ref1=this.dialogue)!=null){_ref1.remove()}this.dialogue=new intermine.query["export"].ExportDialogue(this.states.currentQuery);this.$el.append(this.dialogue.render().el);return this.dialogue.show()};return ExportManager}(intermine.views.ItemView)});define("actions/list-append-dialogue",using("actions/list-dialogue","html/append-list",function(ListDialogue,HTML){var ListAppender,OPTION_TEMPLATE,makeOption,_ref;OPTION_TEMPLATE=_.template('<option value="<%- name %>">\n  <%- name %> (<%= size %> <%- things %>)\n</option>');makeOption=function(list){return OPTION_TEMPLATE(_.extend({},list,{things:intermine.utils.pluralise(list.type,list.size)}))};ListAppender=function(_super){__extends(ListAppender,_super);function ListAppender(){_ref=ListAppender.__super__.constructor.apply(this,arguments);return _ref}ListAppender.prototype.html=HTML;ListAppender.prototype.events=function(){return _.extend(ListAppender.__super__.events.call(this),{"change select":"setTarget"})};ListAppender.prototype.setTarget=function(){var l,name;name=this.$("select").val();return this.listOptions.set({list:function(){var _i,_len,_ref1,_results;_ref1=this.__ls;_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){l=_ref1[_i];if(name===l.name){_results.push(l)}}return _results}.call(this)[0]})};ListAppender.prototype.displayType=function(){var estSize,type,_ref1;_ref1=this.listOptions.toJSON(),estSize=_ref1.estSize,type=_ref1.type;return this.$(".im-item-type").text(intermine.utils.pluralise(type,estSize))};ListAppender.prototype.initialize=function(){var _this=this;ListAppender.__super__.initialize.apply(this,arguments);this.listOptions.on("change:estSize",function(opts,n){return _this.$(".im-item-count").text(n)});this.listOptions.on("change:type",this.displayType,this);return this.listOptions.on("change:type",this.onlyShowCompatibleOptions,this)};ListAppender.prototype.nothingSelected=function(){var _this=this;ListAppender.__super__.nothingSelected.call(this);return this.$("form select option").each(function(i,elem){return $(elem).attr({disabled:false})})};ListAppender.prototype.getSuitabilityFilter=function(){var model,pi,type;model=this.query.model;type=this.listOptions.toJSON().type;pi=model.getPathInfo(type);return function(list){return list.authorized&&pi.isa(list.type)}};ListAppender.prototype.onlyShowCompatibleOptions=function(){var list,select,service,type,_ref1,_this=this;_ref1=this.listOptions.toJSON(),list=_ref1.list,type=_ref1.type;service=this.query.service;select=this.$("form select");select.empty();return service.fetchLists().done(function(ls){var l,opt,suitable,_i,_len;_this.__ls=ls;suitable=ls.filter(_this.getSuitabilityFilter());for(_i=0,_len=suitable.length;_i<_len;_i++){l=suitable[_i];opt=$(makeOption(l));select.append(opt)}if(list){select.val(list.name)}else{_this.listOptions.set({list:suitable[0]})}_this.$(".btn-primary").attr({disabled:suitable.length<1});return _this.$(".im-none-compatible-error").toggle(suitable.length<1)})};ListAppender.prototype.doAppend=function(){var ids,list,listQ,query,service,_ref1;ids=_.keys(this.types);_ref1=this.listOptions.toJSON(),query=_ref1.query,list=_ref1.list;service=this.query.service;listQ=query||{select:["id"],from:list.type,where:{id:ids}};return service.query(listQ).then(function(q){return q.appendToList(list.name)})};ListAppender.prototype.create=function(){var backToNormal,cg,ilh,promise,_this=this;if(!this.listOptions.has("list")){cg=this.$(".im-receiving-list").closest(".control-group").addClass("error");ilh=this.$(".help-inline").text("No receiving list selected").show();backToNormal=function(){return ilh.fadeOut(1e3,function(){ilh.text("");return cg.removeClass("error")})};_.delay(backToNormal,5e3);return false}promise=this.doAppend();promise.done(function(updated){var added;added=updated.size-_this.listOptions.get("list").size;_this.query.trigger("list-update:success",updated,added);return _this.stop()});return promise.fail(function(xhr,level,message){var e,err;err=function(){try{return JSON.parse(xhr.responseText).error}catch(_error){e=_error;return message}}();return _this.query.trigger("list-update:failure",err)})};ListAppender.prototype.render=function(){ListAppender.__super__.render.call(this);return this};ListAppender.prototype.startPicking=function(){ListAppender.__super__.startPicking.call(this);return this.$(".im-none-compatible-error").hide()};return ListAppender}(ListDialogue);scope("intermine.actions.lists",{ListAppender:ListAppender});return ListAppender}));define("actions/list-dialogue",function(){var ListDialogue,_ref;return ListDialogue=function(_super){__extends(ListDialogue,_super);function ListDialogue(){_ref=ListDialogue.__super__.constructor.apply(this,arguments);return _ref}ListDialogue.prototype.tagName="li";ListDialogue.prototype.className="im-list-dialogue dropdown";ListDialogue.prototype.usingDefaultName=true;ListDialogue.prototype.initialize=function(query){var opts,_this=this;this.query=query;this.listOptions=opts=new Backbone.Model;this.types={};this.query.on("imo:selected",function(type,id,selected){var commonType,m,types;if(_this.listOptions==null){return}if(selected){_this.types[id]=type}else{delete _this.types[id]}types=_.values(_this.types);opts.set({estSize:types.length});if(types.length>0){m=_this.query.model;commonType=m.findCommonTypeOfMultipleClasses(types);return opts.set({type:commonType})}});opts.on("change:query",function(_,q){return q.count(function(n){return opts.set({estSize:n})})});opts.on("change:query",function(){return _this.$(".modal").modal("show").find("form").show()});opts.on("change:name",this.updateNameDisplay,this);opts.on("change:name",this.checkName,this);opts.on("change:type",this.newCommonType,this);return opts.on("change:estSize",this.bindEstSize,this)};ListDialogue.prototype.updateNameDisplay=function(){console.log("Updating name to "+this.listOptions.get("name"));return this.$(".im-list-name").val(this.listOptions.get("name"))};ListDialogue.prototype.remove=function(){var thing,_i,_len,_ref1;_ref1=["listOptions"];for(_i=0,_len=_ref1.length;_i<_len;_i++){thing=_ref1[_i];this[thing].off();delete this[thing]}return ListDialogue.__super__.remove.call(this)};ListDialogue.prototype.bindEstSize=function(){var estSize,hasSelectedItems;estSize=this.listOptions.get("estSize");hasSelectedItems=estSize>0;this.$(".btn-primary").attr({disabled:!hasSelectedItems});this.$(".im-selection-instruction").hide();this.$("form").show();this.$el.addClass("im-picked");if(!hasSelectedItems){return this.nothingSelected()}};ListDialogue.prototype.newCommonType=function(){return this.query.trigger("common:type:selected",this.listOptions.get("type"))};ListDialogue.prototype.nothingSelected=function(){this.$(".im-selection-instruction").slideDown();this.$("form").hide();this.$el.removeClass("im-picked");return this.query.trigger("selection:cleared")};ListDialogue.prototype.events=function(){return{hidden:"onHidden","change .im-list-name":"listNameChanged","submit form":"ignore","click form":"ignore","click .btn-cancel":"stop","click .btn-primary":"create","click .im-minimise":"minimise"}};ListDialogue.prototype.minimise=function(){this.$(".control-group").slice(1).slideToggle();return this.$(".im-minimise").toggleClass("im-collapsed")};ListDialogue.prototype.onHidden=function(e){if(e&&$(e.target).is(".modal")){return this.remove()}};ListDialogue.prototype.startPicking=function(){var headAndFoot,m;
this.$(".modal").addClass("im-picking-list-items");headAndFoot=this.$(".modal-header").add(".modal-footer",this.el).addClass("im-handle");this.query.trigger("start:list-creation");this.nothingSelected();m=this.$(".modal").show(function(){return $(this).addClass("in").draggable({handle:".im-handle"})});return headAndFoot.css({cursor:"move"}).tooltip({title:"Drag me around!",placement:"bottom"})};ListDialogue.prototype.stop=function(e){var modal;this.query.trigger("stop:list-creation");modal=this.$(".modal");if(modal.is(".ui-draggable")){return this.remove()}else{return modal.modal("hide")}};ListDialogue.prototype.ignore=function(e){e.preventDefault();return e.stopPropagation()};ListDialogue.prototype.listNameChanged=function(e){return this.listOptions.set({customName:true,name:$(e.target).val()})};ListDialogue.prototype.getLists=function(){var now;now=(new Date).getTime();if(!this.listPromise||this.listPromise.made_at<now-intermine.options.ListFreshness){this.listPromise=this.query.service.fetchLists();this.listPromise.made_at=now}return this.listPromise};ListDialogue.prototype.checkName=function(){var message,selector,_this=this;selector=".im-list-name";message=intermine.messages.actions.ListNameDuplicate;this.clearError(selector);return this.getLists().done(function(ls){var chosen,isDup;chosen=_this.listOptions.get("name");isDup=_.any(ls,function(l){return l.authorized&&l.name===chosen});if(isDup){return _this.setError(selector,message)}})};ListDialogue.prototype.setError=function(selector,message){var $input;$input=this.$(selector);$input.next().text(message);return $input.parent().addClass("error")};ListDialogue.prototype.clearError=function(selector){var $input;$input=this.$(selector);$input.next().text("");return $input.parent().removeClass("error")};ListDialogue.prototype.create=function(){throw new Error("Override me!")};ListDialogue.prototype.openDialogue=function(type,q){if(type==null){type=this.query.root}if(q==null){q=this.query.clone()}return this.listOptions.set({query:q,type:type})};ListDialogue.prototype.render=function(){this.$el.append(this.html);this.$(".modal").modal({show:false});return this};return ListDialogue}(Backbone.View)});define("actions/list-manager",using("actions/list-append-dialogue","actions/new-list-dialogue",function(ListAppender,ListCreator){var ListManager,_ref;return ListManager=function(_super){var descendedFrom,pathOf;__extends(ListManager,_super);function ListManager(){this.updateTypeOptions=__bind(this.updateTypeOptions,this);this.changeAction=__bind(this.changeAction,this);_ref=ListManager.__super__.constructor.apply(this,arguments);return _ref}ListManager.prototype.tagName="li";ListManager.prototype.className="im-list-management dropdown";ListManager.prototype.initialize=function(states){this.states=states;this.states.on("add reverted",this.updateTypeOptions);this.action=ListManager.actions.create;return this.disabled=this.states.currentQuery.service.token==null};ListManager.prototype.html='<a class="btn" data-toggle="dropdown">\n    <i class="icon-list-alt"></i>\n    <span class="im-only-widescreen">Create / Add to</span>\n    List\n    <b class="caret"></b>\n</a>\n<ul class="dropdown-menu im-type-options pull-right">\n    <div class="btn-group" data-toggle="buttons-radio">\n        <button class="btn active im-list-action-chooser" data-action="create">\n            Create New List\n        </button>\n        <button class="btn im-list-action-chooser" data-action="append">\n            Add to Existing List\n        </button>\n    </div>\n</ul>';ListManager.prototype.events={"click .btn-group > .im-list-action-chooser":"changeAction","click .im-pick-and-choose":"startPicking"};ListManager.actions={create:ListCreator,append:ListAppender};ListManager.prototype.changeAction=function(e){var $t;e.stopPropagation();e.preventDefault();$t=$(e.target).button("toggle");return this.action=ListManager.actions[$t.data("action")]};ListManager.prototype.openDialogue=function(type,q){var dialog;dialog=new this.action(this.states.currentQuery);dialog.render().$el.appendTo(this.el);return dialog.openDialogue(type,q)};ListManager.prototype.startPicking=function(){var dialog;dialog=new this.action(this.states.currentQuery);dialog.render().$el.appendTo(this.el);return dialog.startPicking()};descendedFrom=function(putativeParent){var prefix;if(putativeParent.isAttribute()){return function(){return false}}else{prefix=putativeParent+".";return function(suspectedChild){return suspectedChild.substring(0,prefix.length)===prefix}}};pathOf=intermine.funcutils.get("path");ListManager.prototype.updateTypeOptions=function(){var node,query,ul,viewNodes,_fn,_i,_len,_this=this;ul=this.$(".im-type-options");ul.find("li").remove();query=this.states.currentQuery;viewNodes=query.getViewNodes();_fn=function(node){var countQuery,err,inCons,li,missingNode,needsAsserting,unselected,_j,_len1;li=$("<li></li>");ul.append(li);countQuery=query.clone();try{countQuery.select([node.append("id").toPathString()])}catch(_error){err=_error;console.error(err);return}if(query.isOuterJoined(countQuery.views[0])){(function(path){var style,_results;style="INNER";_results=[];while(!path.isRoot()){countQuery.addJoin({path:path,style:style});_results.push(path=path.getParent())}return _results})(node)}unselected=viewNodes.filter(function(n){return n!==node});for(_j=0,_len1=unselected.length;_j<_len1;_j++){missingNode=unselected[_j];inCons=_.any(countQuery.constraints,_.compose(descendedFrom(missingNode),pathOf));needsAsserting=!inCons||query.isOuterJoined(missingNode);if(needsAsserting){countQuery.addConstraint([missingNode.append("id"),"IS NOT NULL"])}}countQuery.orderBy([]);li.click(function(){return _this.openDialogue(node.getType().name,countQuery)});li.mouseover(function(){return query.trigger("start:highlight:node",node)});li.mouseout(function(){return query.trigger("stop:highlight")});return countQuery.count().then(function(n){var quantifier,typeName;if(n<1){return li.remove()}quantifier=function(){switch(n){case 1:return"The";case 2:return"Both";default:return"All "+n}}();typeName=intermine.utils.pluralise(node.getType().name,n);return li.append("<a>"+quantifier+" "+typeName+"</a>")})};for(_i=0,_len=viewNodes.length;_i<_len;_i++){node=viewNodes[_i];_fn(node)}return ul.append('<li class="im-pick-and-choose">\n    <a>Choose individual items from the table</a>\n</li>')};ListManager.prototype.render=function(){this.$el.append(this.html);this.updateTypeOptions();return this};return ListManager}(Backbone.View)}));define("actions/new-list-dialogue",using("actions/list-dialogue","models/uniq-items","html/new-list",function(ListDialogue,UniqItems,HTML){var CATEGORY_FROM_ROWS,CATEGORY_FROM_SUMMARY,ILLEGAL_LIST_NAME_CHARS,ListCreator,_ref;ILLEGAL_LIST_NAME_CHARS=/[^\w\s\(\):+\.-]/g;CATEGORY_FROM_SUMMARY=function(items,_arg){var uniqueValues;uniqueValues=_arg.uniqueValues;return[uniqueValues,items,"item"]};CATEGORY_FROM_ROWS=function(rows){return[rows.length,rows,0]};ListCreator=function(_super){var TAG_ILLEGALS;__extends(ListCreator,_super);function ListCreator(){this.updateTagBox=__bind(this.updateTagBox,this);this.handleFailure=__bind(this.handleFailure,this);this.handleSuccess=__bind(this.handleSuccess,this);_ref=ListCreator.__super__.constructor.apply(this,arguments);return _ref}ListCreator.prototype.html=HTML;ListCreator.prototype.initialize=function(query){var _this=this;this.query=query;ListCreator.__super__.initialize.call(this,this.query);this.query.service.whoami(function(me){_this.canTag=me.username!=null;if(_this.rendered&&!_this.canTag){return _this.hideTagOptions()}});this.tags=new UniqItems;this.suggestedTags=new UniqItems;this.tags.on("add",this.updateTagBox);this.suggestedTags.on("add",this.updateTagBox);this.tags.on("remove",this.updateTagBox);return this.initTags()};ListCreator.prototype.hideTagOptions=function(){return this.$(".im-tag-options").hide()};ListCreator.prototype.newCommonType=function(){var categoriser,cd,dateStr,first,ids,model,now,oq,querying,rest,service,summPath,text,type,viewNode,_i,_len,_ref1,_ref2,_ref3,_this=this;ListCreator.__super__.newCommonType.call(this);if(this.listOptions.get("customName")){return}type=this.listOptions.get("type");_ref1=this.query,service=_ref1.service,model=_ref1.model;now=new Date;dateStr=(""+now).replace(/\s\d\d:\d\d:\d\d\s.*$/,"");text=""+type+" list - "+dateStr;cd=model.classes[type];ids=_.keys(this.types);this.listOptions.set({name:text,customName:false});_ref2=intermine.options.ListCategorisers;for(_i=0,_len=_ref2.length;_i<_len;_i++){categoriser=_ref2[_i];_ref3=categoriser.split(/\./),first=_ref3[0],rest=2<=_ref3.length?__slice.call(_ref3,1):[];if(first in cd.fields){if(ids!=null?ids.length:void 0){oq={select:categoriser,from:type,where:{id:ids}};querying=service.rows(oq).then(CATEGORY_FROM_ROWS)}else{oq=(this.listOptions.get("query")||this.query).clone();viewNode=oq.getViewNodes()[0];summPath=""+viewNode+"."+categoriser;if(first in viewNode.getType().fields){querying=oq.summarise(summPath,1).then(CATEGORY_FROM_SUMMARY)}}querying.done(function(_arg){var category,key,n,name,xs;n=_arg[0],xs=_arg[1],key=_arg[2];if(n===1){category=xs[0][key];name=""+type+" list for "+category+" - "+dateStr;return _this.listOptions.set({name:name,customName:false})}});querying.always(function(){return _this.avoidNameDuplication()});return}}return this.avoidNameDuplication()};ListCreator.prototype.avoidNameDuplication=function(){var copyNo,model,service,text,textBase,_ref1,_this=this;text=textBase=this.listOptions.get("name");copyNo=1;_ref1=this.query,service=_ref1.service,model=_ref1.model;return this.getLists().done(function(ls){var l,_i,_len,_ref2,_results;_ref2=_.sortBy(ls,function(l){return l.name});_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){l=_ref2[_i];if(l.name===text){text=""+textBase+" ("+copyNo++ +")";_results.push(_this.listOptions.set({name:text,customName:false}))}else{_results.push(void 0)}}return _results})};ListCreator.prototype.openDialogue=function(type,q){ListCreator.__super__.openDialogue.call(this,type,q);return this.initTags()};TAG_ILLEGALS=/[^\w\d\s.,:-]/g;ListCreator.prototype.initTags=function(){var add,c,now,_fn,_i,_len,_ref1,_this=this;this.tags.reset();this.suggestedTags.reset();add=function(tag){return _this.suggestedTags.add(tag.replace(TAG_ILLEGALS," "),{silent:true})};_ref1=this.query.constraints;_fn=function(c){var title;title=c.title||c.path.replace(/^[^\.]+\./,"");if(c.op==="IN"){return add("source: "+c.value)}else if(c.op==="="){return add(""+title+": "+c.value)}else if(c.op==="<"){return add(""+title+" below "+c.value)}else if(c.op===">"){return add(""+title+" above "+c.value)}else if(c.type){return add(""+title+" is a "+c.type)}else{return add(""+title+" "+c.op+" "+(c.value||c.values))}};for(_i=0,_len=_ref1.length;_i<_len;_i++){c=_ref1[_i];_fn(c)}now=new Date;add("month: "+now.getFullYear()+"-"+(now.getMonth()+1));add("year: "+now.getFullYear());add("day: "+now.getFullYear()+"-"+(now.getMonth()+1)+"-"+now.getDate());return this.updateTagBox()};ListCreator.prototype.events=function(){return _.extend(ListCreator.__super__.events.call(this),{"click .remove-tag":"removeTag","click .accept-tag":"acceptTag","click .im-confirm-tag":"addTag","click .btn-reset":"reset","click .control-group h5":"rollUpNext","change .im-list-desc":"updateDesc"})};ListCreator.prototype.updateDesc=function(e){return this.listOptions.set({description:$(e.target).val()})};ListCreator.prototype.rollUpNext=function(e){$(e.target).next().slideToggle();return $(e.target).find("i").toggleClass("icon-chevron-right icon-chevron-down")};ListCreator.prototype.reset=function(){var field,_i,_len,_ref1;_ref1=["name","desc","type"];for(_i=0,_len=_ref1.length;_i<_len;_i++){field=_ref1[_i];this.$(".im-list-"+field).val("")}return this.initTags()};ListCreator.prototype.create=function(){var description,illegals,listQ,name,opts,query,tags,type,_ref1;_ref1=this.listOptions.toJSON(),query=_ref1.query,name=_ref1.name,type=_ref1.type,description=_ref1.description;tags=this.tags.map(function(t){return t.get("item")});if(!(name&&/\w/.test(name))){return this.setError(".im-list-name",intermine.messages.actions.ListNameEmpty)}if(illegals=name.match(ILLEGAL_LIST_NAME_CHARS)){return this.setError(".im-list-name",intermine.messages.actions.ListNameIllegal({illegals:illegals}))}listQ=query||{select:["id"],from:type,where:{id:_(this.types).keys()}};opts={name:name,description:description,tags:tags};return this.makeNewList(listQ,opts)};ListCreator.prototype.makeNewList=function(query,opts){var saving,_this=this;if(query.saveAsList!=null){saving=query.saveAsList(opts);saving.done(this.handleSuccess);saving.fail(this.handleFailure);return this.stop()}else{return this.query.service.query(query,function(q){return _this.makeNewList(q,opts)})}};ListCreator.prototype.handleSuccess=function(list){console.log("Created a list",list);return this.query.trigger("list-creation:success",list)};ListCreator.prototype.handleFailure=function(xhr,level,message){if(xhr.responseText){message=JSON.parse(xhr.responseText).error}return this.query.trigger("list-creation:failure",message)};ListCreator.prototype.removeTag=function(e){var tag;tag=$(e.target).closest(".label").find(".tag-text").text();this.tags.remove(tag);this.suggestedTags.add(tag);return $(".tooltip").remove()};ListCreator.prototype.acceptTag=function(e){var tag;console.log("Accepting",e);tag=$(e.target).closest(".label").find(".tag-text").text();$(".tooltip").remove();this.suggestedTags.remove(tag);return this.tags.add(tag)};ListCreator.prototype.updateTagBox=function(){var box;box=this.$(".im-list-tags.choices");box.empty();this.tags.each(function(t){var $li;$li=$('<li title="'+t.escape("item")+'">\n    <span class="label label-warning">\n        <i class="icon-tag icon-white"></i>\n        <span class="tag-text">'+t.escape("item")+'</span>\n        <a href="#">\n            <i class="icon-remove-circle icon-white remove-tag"></i>\n        </a>\n    </span>\n</li>');return $li.tooltip({placement:"top"}).appendTo(box)});box.append('<div style="clear:both"></div>');box=this.$(".im-list-tags.suggestions");box.empty();this.suggestedTags.each(function(t){var $li;$li=$('<li title="This tag is a suggestion. Click the \'ok\' sign to add it">\n    <span class="label">\n        <i class="icon-tag icon-white"></i>\n        <span class="tag-text">'+t.escape("item")+'</span>\n        <a href="#" class="accept-tag">\n            <i class="icon-ok-circle icon-white"></i>\n        </a>\n    </span>\n</li>');return $li.tooltip({placement:"top"}).appendTo(box)});return box.append('<div style="clear:both"></div>')};ListCreator.prototype.addTag=function(e){var tagAdder;e.preventDefault();tagAdder=this.$(".im-available-tags");this.tags.add(tagAdder.val());tagAdder.val("");return tagAdder.next().attr({disabled:true})};ListCreator.prototype.rendered=false;ListCreator.prototype.render=function(){var tagAdder,_this=this;ListCreator.__super__.render.call(this);this.updateTagBox();tagAdder=this.$(".im-available-tags");this.$("a").button();this.getLists().done(function(ls){return tagAdder.typeahead({source:_.reduce(ls,function(a,l){return _.union(a,l.tags)},[]),items:10,matcher:function(item){if(!this.query){return true}return this.constructor.prototype.matcher.call(this,item)}})});tagAdder.keyup(function(e){_this.$(".im-confirm-tag").attr("disabled",false);if(e.which===13){return _this.addTag(e)}});if(this.canTag!=null&&!this.canTag){this.hideTagOptions()}this.rendered=true;return this};return ListCreator}(ListDialogue);scope("intermine.query.actions",{ListCreator:ListCreator});scope("intermine.actions.lists",{ListCreator:ListCreator});return ListCreator}));define("actions",using("actions/list-manager","actions/code-gen",function(ListManager,CodeGenerator){var Actions,_ref;Actions=function(_super){__extends(Actions,_super);function Actions(){_ref=Actions.__super__.constructor.apply(this,arguments);return _ref}Actions.prototype.className="im-query-actions row-fluid";Actions.prototype.tagName="ul";Actions.prototype.initialize=function(states){this.states=states};Actions.prototype.actionClasses=function(){return[ListManager,CodeGenerator]};Actions.prototype.extraClass="im-action";Actions.prototype.render=function(){var action,cls,_i,_len,_ref1;_ref1=this.actionClasses();for(_i=0,_len=_ref1.length;_i<_len;_i++){cls=_ref1[_i];action=new cls(this.states);if(!action.disabled){action.render().$el.addClass(this.extraClass).appendTo(this.el)}}return this};return Actions}(Backbone.View);scope("intermine.query.actions",{Actions:Actions});return Actions}));(function(){var PossibleColumns,_ref;PossibleColumns=function(_super){__extends(PossibleColumns,_super);function PossibleColumns(){_ref=PossibleColumns.__super__.constructor.apply(this,arguments);return _ref}PossibleColumns.prototype.initialize=function(_,_arg){var _this=this;this.exported=_arg.exported;return this.on("close",function(){return _this.each(function(m){return m.destroy()})})};return PossibleColumns}(Backbone.Collection);return scope("intermine.columns.models",{PossibleColumns:PossibleColumns})})();scope("intermine.messages.results",{ReorderHelp:"Drag the columns to reorder them"});scope("intermine.messages.columns",{AllowRevRef:"Allow reverse references",CollapseAll:"Collapse all branches"});(function(){var ColumnAdder,ColumnsDialogue,NewViewNodes,Tab,ViewNode,byEl,_ref,_ref1,_ref2,_ref3;byEl=function(el){return function(nv){return nv.el===el}};Tab=intermine.bootstrap.Tab;ColumnAdder=function(_super){__extends(ColumnAdder,_super);function ColumnAdder(){this.isDisabled=__bind(this.isDisabled,this);this.handleSubmission=__bind(this.handleSubmission,this);this.handleChoice=__bind(this.handleChoice,this);_ref=ColumnAdder.__super__.constructor.apply(this,arguments);return _ref}ColumnAdder.prototype.className="form node-adder form-horizontal";ColumnAdder.prototype.initialize=function(query,newView){this.newView=newView;ColumnAdder.__super__.initialize.call(this,query);return this.chosen=[]};ColumnAdder.prototype.handleChoice=function(path){var $b;if(__indexOf.call(this.chosen,path)>=0){this.chosen=_.without(this.chosen,path)}else{this.chosen.push(path)}this.applyChanges();$b=this.$(".btn-chooser");if($b.is(".active")){return $b.button("toggle")}};ColumnAdder.prototype.handleSubmission=function(e){e.preventDefault();e.stopPropagation();return this.applyChanges()};ColumnAdder.prototype.applyChanges=function(){this.newView.addPaths(this.chosen);return this.reset()};ColumnAdder.prototype.reset=function(){ColumnAdder.__super__.reset.call(this);return this.chosen=[]};ColumnAdder.prototype.refsOK=false;ColumnAdder.prototype.multiSelect=true;ColumnAdder.prototype.isDisabled=function(path){var _ref1;return _ref1=path.toString(),__indexOf.call(this.query.views,_ref1)>=0};ColumnAdder.prototype.render=function(){ColumnAdder.__super__.render.call(this);this.$("input").remove();this.$(".btn-chooser > span").text(intermine.messages.columns.FindColumnToAdd);return this};ColumnAdder.prototype.showTree=function(e){var _ref1;ColumnAdder.__super__.showTree.call(this,e);return(_ref1=this.$pathfinder)!=null?_ref1.$el.removeClass(this.$pathfinder.dropDownClasses):void 0};return ColumnAdder}(intermine.query.ConstraintAdder);ViewNode=function(_super){__extends(ViewNode,_super);function ViewNode(){_ref1=ViewNode.__super__.constructor.apply(this,arguments);return _ref1}ViewNode.prototype.initialize=function(){if(!this.has("isNew")){this.set({isNew:false})}if(!this.has("replaces")){this.set({replaces:[]})}if(!this.has("isFormatted")){return this.set({isFormatted:intermine.results.shouldFormat(this.get("path"))})}};ViewNode.prototype.addPath=function(path){return this.set({replaces:this.get("replaces").concat([path])})};ViewNode.prototype.getViews=function(){if(this.get("replaces").length){return this.get("replaces")}else{return[this.get("path")]}};ViewNode.prototype.isAbove=function(path,query){var base,myformatter,theirformatter;base=this.get("path");if(base.isAttribute()){false}if(path.toString().indexOf(base.toString())!==0){return false}else if(this.get("isFormatted")&&intermine.results.shouldFormat(path)){myformatter=intermine.results.getFormatter(base.append("id"));theirformatter=intermine.results.getFormatter(path);return myformatter===theirformatter}else if(path.containsCollection()&&query.isOuterJoined(path)){return true}else{return false}};return ViewNode}(Backbone.Model);NewViewNodes=function(_super){var lengthOfPath;__extends(NewViewNodes,_super);function NewViewNodes(){_ref2=NewViewNodes.__super__.constructor.apply(this,arguments);return _ref2}NewViewNodes.prototype.model=ViewNode;NewViewNodes.prototype.close=function(){this.off();return this.each(function(vn){if(vn!=null){vn.off()}return vn!=null?vn.destroy():void 0})};lengthOfPath=function(vn){return vn.get("path").allDescriptors().length};NewViewNodes.prototype.initialize=function(_,options){this.options=options};NewViewNodes.prototype.addPaths=function(paths){var group,path,_i,_len,_results;_results=[];for(_i=0,_len=paths.length;_i<_len;_i++){path=paths[_i];group=this.getGroup(path);if(group!=null){_results.push(group.addPath(path))}else{_results.push(this.add({path:path,isNew:true}))}}return _results};NewViewNodes.prototype.getGroup=function(path){var bestMatch,matches,q;q=this.options.query;matches=this.filter(function(vn){return vn.isAbove(path,q)});bestMatch=_.last(_.sortBy(matches,lengthOfPath));return bestMatch};return NewViewNodes}(Backbone.Collection);ColumnsDialogue=function(_super){__extends(ColumnsDialogue,_super);function ColumnsDialogue(){this.addPossibleSortElement=__bind(this.addPossibleSortElement,this);this.addSortElement=__bind(this.addSortElement,this);_ref3=ColumnsDialogue.__super__.constructor.apply(this,arguments);return _ref3}ColumnsDialogue.prototype.tagName="div";ColumnsDialogue.prototype.className="im-column-dialogue modal";ColumnsDialogue.prototype.initialize=function(query,columnHeaders){var _ref4,_this=this;this.query=query;this.columnHeaders=columnHeaders;if((_ref4=this.columnHeaders)==null){this.columnHeaders=new Backbone.Collection}this.sortOpts=new Backbone.Model;this.sortOrder=new intermine.columns.collections.SortOrder;this.sortPossibles=new intermine.columns.collections.PossibleOrderElements;this.newView=new NewViewNodes([],{query:this.query});this.sortOrder.on("add",this.addSortElement);this.sortPossibles.on("add",this.addPossibleSortElement);this.sortOpts.on("change:onlyInView",function(m,only){return _this.sortPossibles.each(function(m){return m.trigger("only-in-view",only)})});this.sortOpts.on("change:filterTerm",function(m,re){return _this.sortPossibles.each(function(m){return m.trigger("filter",re)})});this.sortOrder.on("destroy",function(m){return _this.sortPossibles.add({path:m.get("path"),query:_this.query})});this.newView.on("add remove change",this.drawOrder,this);return this.newView.on("destroy",function(nv){return _this.newView.remove(nv)})};ColumnsDialogue.prototype.html=function(){return intermine.columns.snippets.ColumnsDialogue};ColumnsDialogue.prototype.render=function(){var _this=this;this.$el.append(this.html());this.initOrdering();this.initSorting();this.sortOpts.set({onlyInView:true});this.$("i.im-sorting-help").popover({placement:function(popover){$(popover).addClass("bootstrap");return"left"},trigger:"hover",html:true,title:intermine.messages.columns.SortingHelpTitle,content:intermine.messages.columns.SortingHelpContent});this.$(".nav-tabs li a").each(function(i,e){var $elem;$elem=$(e);return $elem.data({target:_this.$($elem.data("target"))})});return this};ColumnsDialogue.prototype.events={hidden:"onHidden","click .btn-cancel":"hideModal","click .btn-primary":"applyChanges","click .nav-tabs li a":"changeTab","change input.im-only-in-view":"onlyShowOptionsInView","change .im-sortables-filter":"filterSortables","keyup .im-sortables-filter":"filterSortables","sortstop .im-sorting-container":"onSortStop","sortupdate .im-reordering-container":"updateOrder","sortupdate .im-sorting-container":"updateSorting"};ColumnsDialogue.prototype.onSortStop=function(e,ui){var left,oe,removed,top,well,wtop,_ref4;_ref4=ui.offset,top=_ref4.top,left=_ref4.left;well=ui.item.closest(".well");wtop=well.offset().top;removed=top+ui.item.height()<wtop||top>wtop+well.height();oe=this.sortOrder.find(byEl(ui.item[0]));if(removed){return _.defer(function(){return oe.destroy()})}};ColumnsDialogue.prototype.onHidden=function(e){if(this.el!==(e!=null?e.target:void 0)){return false}return this.remove()};ColumnsDialogue.prototype.remove=function(){this.sortOpts.off();this.sortOrder.off();this.sortPossibles.off();this.newView.close();delete this.newView;delete this.columnHeaders;delete this.sortOpts;delete this.sortOrder;delete this.sortPossibles;this.$el.empty();this.undelegateEvents();this.off();return ColumnsDialogue.__super__.remove.call(this)};ColumnsDialogue.prototype.getFilterTerm=function(e){var $input,pattern,term;$input=$(e.currentTarget);term=$input.val();if(!term){return}pattern=term.split(/\s+/).join(".*");return new RegExp(pattern,"i")};ColumnsDialogue.prototype.filterSortables=function(e){return this.sortOpts.set({filterTerm:this.getFilterTerm(e)})};ColumnsDialogue.prototype.onlyShowOptionsInView=function(e){return this.sortOpts.set({onlyInView:$(e.currentTarget).is(":checked")})};ColumnsDialogue.prototype.changeTab=function(e){return Tab.call($(e.currentTarget),"show")};ColumnsDialogue.prototype.initOrdering=function(){var model;this.newView.reset(function(){var _i,_len,_ref4,_results;_ref4=this.columnHeaders.models;_results=[];for(_i=0,_len=_ref4.length;_i<_len;_i++){model=_ref4[_i];_results.push(model.toJSON())}return _results}.call(this));this.drawOrder();return this.drawSelector()};ColumnsDialogue.prototype.drawOrder=function(){var colContainer,_this=this;colContainer=this.$(".im-reordering-container");colContainer.empty();colContainer.tooltip({title:intermine.messages.results.ReorderHelp,placement:intermine.utils.addStylePrefix("top")});this.newView.each(function(model){var view;view=new intermine.columns.views.ViewElement({model:model});return colContainer.append(view.render().el)});return colContainer.sortable({items:"li.im-reorderable",axis:"y",forcePlaceholderSize:true,placeholder:"im-resorting-placeholder"})};ColumnsDialogue.prototype.drawSelector=function(){var ca,nodeAdder,selector,_ref4,_this=this;selector=".im-reordering .well";nodeAdder=this.$(".node-adder");if((_ref4=this.ca)!=null){_ref4.remove()}ca=new ColumnAdder(this.query,this.newView);nodeAdder.empty().append(ca.render().el);ca.on("showing:tree",function(){return _this.$(selector).slideUp()});ca.on("resetting:tree",function(){return _this.$(selector).slideDown()});return this.ca=ca};ColumnsDialogue.prototype.updateOrder=function(e,ui){var el,lis,reorderedState;lis=this.$(".im-view-element");byEl=function(el){return function(nv){return nv.el===el}};reorderedState=function(){var _i,_len,_ref4,_results;_ref4=lis.get();_results=[];for(_i=0,_len=_ref4.length;_i<_len;_i++){el=_ref4[_i];_results.push(this.newView.find(byEl(el)))}return _results}.call(this);return this.newView.reset(reorderedState)};ColumnsDialogue.prototype.updateSorting=function(e,ui){var el,lis,reorderedState;lis=this.$(".im-in-order");byEl=function(el){return function(oe){return oe.el===el}};reorderedState=function(){var _i,_len,_ref4,_results;_ref4=lis.get();_results=[];for(_i=0,_len=_ref4.length;_i<_len;_i++){el=_ref4[_i];_results.push(this.sortOrder.find(byEl(el)))}return _results}.call(this);return this.sortOrder.reset(reorderedState)};ColumnsDialogue.prototype.sortingPlaceholder='<div class="placeholder">\n    Drop columns here.\n</div>';ColumnsDialogue.prototype.makeSortOrderElem=function(model){var possibles,soe;possibles=this.sortPossibles;soe=new intermine.columns.views.OrderElement({model:model,possibles:possibles});return soe.render().el};ColumnsDialogue.prototype.makeSortOption=function(model){var option;option=new intermine.columns.views.PossibleOrderElement({model:model,sortOrder:this.sortOrder});return option.render().el};ColumnsDialogue.prototype.initSorting=function(){var container;container=this.$(".im-sorting-container").empty().append(this.sortingPlaceholder);this.$(".im-sorting-container-possibilities").empty();container.sortable();container.parent().droppable({drop:function(event,ui){return $(ui.draggable).trigger("dropped")}});this.buildSortOrder();return this.buildPossibleSortOrder()};ColumnsDialogue.prototype.buildSortOrder=function(){var direction,i,path,so,_i,_len,_ref4,_results;this.sortOrder.reset([]);_ref4=this.query.sortOrder||[];_results=[];for(i=_i=0,_len=_ref4.length;_i<_len;i=++_i){so=_ref4[i];path=so.path,direction=so.direction;_results.push(this.sortOrder.add({path:this.query.getPathInfo(path),direction:direction}))}return _results};ColumnsDialogue.prototype.buildPossibleSortOrder=function(){var inView,isOuter,isSorted,n,path,test0,test1,_i,_j,_len,_len1,_ref4,_ref5,_results,_this=this;this.sortPossibles.reset([]);isSorted=function(v){return _this.query.getSortDirection(v)};isOuter=function(v){return _this.query.isOuterJoined(v)};inView=function(v){var _ref4;return _ref4=""+v,__indexOf.call(_this.query.views,_ref4)>=0};test0=function(path){return!isSorted(path)&&!isOuter(path)};test1=function(p){return p.isAttribute()&&!inView(p)&&!isSorted(p)};_ref4=this.query.views;for(_i=0,_len=_ref4.length;_i<_len;_i++){path=_ref4[_i];if(test0(path)){this.sortPossibles.add({path:path,query:this.query})}}_ref5=this.query.getViewNodes();_results=[];for(_j=0,_len1=_ref5.length;_j<_len1;_j++){n=_ref5[_j];if(!isOuter(n)){_results.push(function(){var _k,_len2,_ref6,_results1;_ref6=n.getChildNodes();_results1=[];for(_k=0,_len2=_ref6.length;_k<_len2;_k++){path=_ref6[_k];if(test1(path)){_results1.push(this.sortPossibles.add({path:path,query:this.query}))}}return _results1}.call(this))}}return _results};ColumnsDialogue.prototype.addSortElement=function(m){var container,elem;container=this.$(".im-sorting-container");elem=this.makeSortOrderElem(m);return container.append(elem)};ColumnsDialogue.prototype.addPossibleSortElement=function(m){var elem,possibilities;possibilities=this.$(".im-sorting-container-possibilities");elem=this.makeSortOption(m);return possibilities.append(elem)};ColumnsDialogue.prototype.hideModal=function(){return this.$el.modal("hide")};ColumnsDialogue.prototype.showModal=function(){return this.$el.modal({show:true})};ColumnsDialogue.prototype.applyChanges=function(e){if(this.$(".im-reordering").is(".active")){return this.changeOrder(e)}else{return this.changeSorting(e)}};ColumnsDialogue.prototype.changeOrder=function(e){var newViews;newViews=_.flatten(this.newView.map(function(v){return v.getViews()}));this.hideModal();return this.query.select(newViews)};ColumnsDialogue.prototype.changeSorting=function(e){var newSO,so;newSO=function(){var _i,_len,_ref4,_results;_ref4=this.sortOrder.models;_results=[];for(_i=0,_len=_ref4.length;_i<_len;_i++){so=_ref4[_i];_results.push(so.toJSON())}return _results}.call(this);this.hideModal();return this.query.orderBy(newSO)};return ColumnsDialogue}(Backbone.View);return scope("intermine.query.results.table",{ColumnsDialogue:ColumnsDialogue})})();(function(){var ATTR_HTML,Columns,CurrentColumns,JOIN_TOGGLE_HTML,Selectable,_ref,_ref1,_ref2;JOIN_TOGGLE_HTML=_.template('<form class="form-inline pull-right im-join">\n<div class="btn-group" data-toggle="buttons-radio">\n    <button data-style="INNER" class="btn btn-small <% print(outer ? "" : "active") %>">\n    Required\n    </button>\n    <button data-style="OUTER" class="btn btn-small <% print(outer ? "active" : "") %>">\n    Optional\n    </button>\n</div></form>');ATTR_HTML=_.template('<input type="checkbox" \n    data-path="<%= path %>"\n    <% inQuery ? print("checked") : "" %> >\n<span class="im-view-option">\n    <%= name %> (<% print(type.replace("java.lang.", "")) %>)\n</span>');CurrentColumns=function(_super){__extends(CurrentColumns,_super);function CurrentColumns(){_ref=CurrentColumns.__super__.constructor.apply(this,arguments);
return _ref}CurrentColumns.prototype.className="node-remover";CurrentColumns.prototype.tagName="dl";CurrentColumns.prototype.initialize=function(query){this.query=query};CurrentColumns.prototype.render=function(){var cd,rootSel,subnodes,_this=this;cd=this.query.service.model.classes[this.query.root];rootSel=new Selectable(this.query,cd);rootSel.render().$el.appendTo(this.el);subnodes=_({}).extend(cd.references,cd.collections);_(subnodes).chain().values().sortBy(function(f){return f.name}).each(function(f){var sel,type;type=_this.query.getPathInfo(f).getEndClass();sel=new Selectable(_this.query,type,f);return sel.render().$el.appendTo(_this.el)});return this};return CurrentColumns}(Backbone.View);Selectable=function(_super){__extends(Selectable,_super);function Selectable(){this.render=__bind(this.render,this);this.setCheckBoxState=__bind(this.setCheckBoxState,this);_ref1=Selectable.__super__.constructor.apply(this,arguments);return _ref1}Selectable.prototype.tagName="dl";Selectable.prototype.className="im-selectable-node";Selectable.prototype.initialize=function(query,table,field){this.query=query;this.table=table;this.field=field;this.path=this.query.root+(this.field?"."+this.field.name:"");return this.query.on("change:views",this.setCheckBoxState)};Selectable.prototype.events={"click dt":"toggleFields",'change input[type="checkbox"]':"changeView"};Selectable.prototype.toggleFields=function(e){return this.$("dd").slideToggle()};Selectable.prototype.changeView=function(e){var $t,path;$t=$(e.target);path=$t.data("path");if($t.attr("checked")){return this.query.addToSelect(path)}else{return this.query.removeFromSelect(path)}};Selectable.prototype.setCheckBoxState=function(e){var _this=this;return this.$("dd input").each(function(i,cbx){var $cbx,path;$cbx=$(cbx);path=$cbx.data("path");return $cbx.attr({checked:_this.query.hasView(path)})})};Selectable.prototype.render=function(){var attr,dt,icon,isInView,name,title,_fn,_ref2,_ref3,_this=this;this.$el.empty();title=this.make("h4",{},((_ref2=this.field)!=null?_ref2.name:void 0)||this.table.name);dt=this.make("dt",{"class":"im-column-group"},title);this.$el.append(dt);isInView=_(this.query.views).any(function(v){return this.path===v.substring(0,v.lastIndexOf("."))});icon=isInView?"minus":"plus";$('<i class="icon-'+icon+'-sign"></i>').css({cursor:"pointer"}).appendTo(title);if(isInView&&this.path!==this.query.root){$(JOIN_TOGGLE_HTML({outer:this.query.isOuterJoin(this.path)})).submit(function(e){var _this=this;return e.preventDefault().css("display","inline-block".appendTo(title.find(".btn".click(function(e){var style;e.stopPropagation();style=$(e.target).data("style");return _this.query.setJoinStyle(_this.path,style.button())}))))})}_ref3=this.table.attributes;_fn=function(attr){return _this.addAttribute(attr)};for(name in _ref3){attr=_ref3[name];_fn(attr)}return this};Selectable.prototype.addAttribute=function(a){var ctx,dd,p;if(a.name!=="id"){dd=this.make("dd");p=""+this.path+"."+a.name;ctx={path:p,inQuery:__indexOf.call(this.query.views,p)>=0};_(ctx).extend(a);return $(dd).append(ATTR_HTML(ctx)).appendTo(this.el)}};return Selectable}(Backbone.View);Columns=function(_super){__extends(Columns,_super);function Columns(){_ref2=Columns.__super__.constructor.apply(this,arguments);return _ref2}Columns.prototype.className="im-query-columns";Columns.prototype.initialize=function(query){this.query=query};Columns.prototype.render=function(){var cls,_fn,_i,_len,_ref3,_this=this;_ref3=[ColumnAdder,CurrentColumns];_fn=function(cls){var inst;inst=new cls(_this.query);return _this.$el.append(inst.render().el)};for(_i=0,_len=_ref3.length;_i<_len;_i++){cls=_ref3[_i];_fn(cls)}return this};return Columns}(Backbone.View);return scope("intermine.query.columns",{Columns:Columns})})();scope("intermine.columns.snippets",{ColumnsDialogue:'<div class="modal-header">\n  <a class="close" data-dismiss="modal">close</a>\n  <h3>Manage Columns</h3>\n</div>\n<div class="modal-body">\n  <ul class="nav nav-tabs">\n    <li class="active">\n      <a data-target=".im-reordering">\n        <span class="hidden-tablet">\n          '+intermine.messages.columns.OrderVerb+"\n        </span>\n        "+intermine.messages.columns.OrderTitle+'\n      </a>\n    </li>\n    <li>\n      <a data-target=".im-sorting" >\n        <span class="hidden-tablet">\n          '+intermine.messages.columns.SortVerb+"\n        </span>\n        "+intermine.messages.columns.SortTitle+'\n      </a>\n    </li>\n  </ul>\n  <div class="tab-content">\n    <div class="tab-pane fade im-reordering active in">\n      <div class="node-adder"></div>\n      <div class="well">\n      <ul class="im-reordering-container nav nav-tabs nav-stacked"></ul>\n      </div>\n    </div>\n    <div class="tab-pane fade im-sorting">\n      <div class="well">\n      <ul class="im-sorting-container nav nav-tabs nav-stacked"></ul>\n      </div>\n      <form class="form-search">\n      <i class="'+intermine.icons.Help+' pull-right im-sorting-help"></i>\n      <div class="input-prepend">\n        <span class="add-on">filter</span>\n        <input type="text" class="search-query im-sortables-filter">\n      </div>\n      <label class="im-only-in-view">\n        '+intermine.messages.columns.OnlyColsInView+'\n        <input class="im-only-in-view" type="checkbox" checked>\n      </label>\n      </form>\n      <div class="well">\n      <ul class="im-sorting-container-possibilities nav nav-tabs nav-stacked"></ul>\n      </div>\n    </div>\n  </div>\n</div>\n<div class="modal-footer">\n  <a class="btn btn-cancel">\n    Cancel\n  </a>\n  <a class="btn pull-right btn-primary">\n    Apply\n  </a>\n</div>'});(function(){var NODE_TEMPLATE,PopOver,PossibleColumn,PossibleColumns,QueryNode,_ref,_ref1,_ref2,_ref3;NODE_TEMPLATE=_.template('<h4><%- node %></h4>\n<ul class="im-possible-attributes"></ul>');PossibleColumn=function(_super){__extends(PossibleColumn,_super);function PossibleColumn(){_ref=PossibleColumn.__super__.constructor.apply(this,arguments);return _ref}PossibleColumn.prototype.tagName="li";PossibleColumn.prototype.className="im-possible-column";PossibleColumn.prototype.initialize=function(options){this.options=options;this.on("rendered",this.showDisplayName,this);this.on("rendered",this.setClassName,this);return this.model.on("destroy",this.remove,this)};PossibleColumn.prototype.events={click:"addToExportedList"};PossibleColumn.prototype.addToExportedList=function(){if(!this.model.get("alreadySelected")){return this.model.trigger("selected",this.model)}};PossibleColumn.prototype.setClassName=function(){return this.$el.toggleClass("disabled",this.model.get("alreadySelected"))};PossibleColumn.prototype.showDisplayName=function(){var basicPath,canonical,path,_this=this;path=this.model.get("path");basicPath=""+path.getParent().getType().name+"."+path.end.name;canonical=path.model.getPathInfo(basicPath);return canonical.getDisplayName().done(function(name){_this.$(".im-field-name").text(name.split(" > ").pop());return _this.model.trigger("displayed-name")})};PossibleColumn.prototype.template=_.template('<a>\n  <i class="<% if (alreadySelected) { %>'+intermine.icons.Check+"<% } else { %>"+intermine.icons.UnCheck+'<% } %>"></i>\n  <span class="im-field-name"><%- path %></span>\n</a>');return PossibleColumn}(intermine.views.ItemView);PopOver=function(_super){__extends(PopOver,_super);function PopOver(){_ref1=PopOver.__super__.constructor.apply(this,arguments);return _ref1}PopOver.prototype.tagName="ul";PopOver.prototype.className="im-possible-attributes";PopOver.prototype.initialize=function(options){this.options=options;this.collection=new Backbone.Collection;this.collection.on("selected",this.selectPathForExport,this);this.collection.on("displayed-name",this.sortUL,this);return this.initFields()};PopOver.prototype.initFields=function(){var alreadySelected,path,_i,_len,_ref2,_results;this.collection.reset();_ref2=this.options.node.getChildNodes();_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){path=_ref2[_i];if(!this.isSuitable(path)){continue}alreadySelected=this.options.exported.any(function(x){return path.equals(x.get("path"))});_results.push(this.collection.add({path:path,alreadySelected:alreadySelected}))}return _results};PopOver.prototype.isSuitable=function(p){var ok;return ok=p.isAttribute()&&(intermine.options.ShowId||p.end.name!=="id")};PopOver.prototype.remove=function(){this.collection.each(function(m){if(m!=null){m.destroy()}return m!=null?m.off():void 0});this.collection.off();return PopOver.__super__.remove.apply(this,arguments)};PopOver.prototype.sortUL=function(){var $lis,lis,sorted;$lis=this.$("li");$lis.detach();lis=$lis.get();sorted=_.sortBy(lis,function(li){return $(li).find(".im-field-name").text()});this.$el.append(sorted);return this.trigger("needs-repositioning")};PopOver.prototype.selectPathForExport=function(model){console.log("We want "+model.get("path"));this.collection.remove(model);this.options.exported.add({path:model.get("path")});model.destroy();return model.off()};PopOver.prototype.render=function(){var _this=this;this.collection.each(function(model){var item;item=new PossibleColumn({model:model});item.render();return _this.$el.append(item.el)});return this};return PopOver}(Backbone.View);QueryNode=function(_super){__extends(QueryNode,_super);function QueryNode(){_ref2=QueryNode.__super__.constructor.apply(this,arguments);return _ref2}QueryNode.prototype.tagName="div";QueryNode.prototype.className="im-query-node btn";QueryNode.prototype.initialize=function(options){var exported,node,_this=this;this.options=options;exported=this.model.collection.exported;node=this.model.get("node");this.content=new PopOver({node:node,exported:exported});this.listenTo(exported,"add remove",this.render,this);this.listenTo(this.content,"needs-repositioning",function(){var _ref3;return(_ref3=_this.popover)!=null?_ref3.reposition():void 0});this.listenTo(this.model,"destroy",this.remove,this);this.listenTo(this.model.collection,"popover-toggled",function(originator){var _ref3;if(_this.model!==originator){return(_ref3=_this.popover)!=null?_ref3.hide():void 0}});return this.model.once("popover-toggled",function(){return _this.content.render()})};QueryNode.prototype.remove=function(){var _ref3,_ref4,_ref5;if((_ref3=this.popover)!=null){_ref3.hide()}if((_ref4=this.popover)!=null){_ref4.destroy()}if((_ref5=this.content)!=null){_ref5.remove()}delete this.content;delete this.popover;return QueryNode.__super__.remove.apply(this,arguments)};QueryNode.prototype.events=function(){var _this=this;return{shown:function(){var _ref3;if((_ref3=_this.popover)!=null){_ref3.reposition()}return _this.model.trigger("popover-toggled",_this.model)},hide:function(){return _this.content.$el.detach()}}};QueryNode.prototype.render=function(){var data,options,ul,_this=this;data=this.model.toJSON();this.$el.empty();this.$el.html(NODE_TEMPLATE(data));ul=this.$("ul");data.node.getDisplayName().done(function(name){var end,parents,_i,_ref3;_ref3=name.split(" > "),parents=2<=_ref3.length?__slice.call(_ref3,0,_i=_ref3.length-1):(_i=0,[]),end=_ref3[_i++];return _this.$("h4").text(end)});options={containment:".tab-pane",html:true,trigger:"click",placement:"top",content:function(){return _this.content.$el},title:function(){return _this.$("h4").text()}};this.popover=new intermine.bootstrap.DynamicPopover(this.el,options);return this};return QueryNode}(Backbone.View);PossibleColumns=function(_super){__extends(PossibleColumns,_super);function PossibleColumns(){_ref3=PossibleColumns.__super__.constructor.apply(this,arguments);return _ref3}PossibleColumns.prototype.tagName="div";PossibleColumns.prototype.className="im-possible-columns btn-group";PossibleColumns.prototype.initialize=function(options){this.options=options;return this.nodes=[]};PossibleColumns.prototype.remove=function(){var node;while(node=this.nodes.pop()){node.remove()}return PossibleColumns.__super__.remove.apply(this,arguments)};PossibleColumns.prototype.render=function(){var _this=this;this.collection.each(function(model){var el,item;item=new QueryNode({model:model});_this.nodes.push(item);el=item.render().$el;return _this.$el.append(el)});return this};return PossibleColumns}(Backbone.View);return scope("intermine.columns.views",{PossibleColumns:PossibleColumns})})();scope("intermine.conbuilder.messages",{ValuePlaceholder:"David*",ExtraPlaceholder:"Wernham-Hogg",ExtraLabel:"within",IsA:"is a",NoValue:"No value selected. Please enter a value.",Duplicate:"This constraint is already on the query",TooManySuggestions:"We cannot show you all the possible values"});(function(){var ActiveConstraint,HIGHLIGHTER,MATCHER,NewConstraint,PATH_SEGMENT_DIVIDER,TOO_MANY_SUGGESTIONS,UPDATER,aeql,basicEql,_ref,_ref1;PATH_SEGMENT_DIVIDER="&rarr;";MATCHER=function(tooMany){return function(item){var parts,_ref;if(item===tooMany||!this.query||/^\s+$/.test(this.query)){return true}else{parts=(_ref=this.query.toLowerCase().split(" "))!=null?_ref:[];return _.all(parts,function(p){return item.toLowerCase().indexOf(p)>=0})}}};HIGHLIGHTER=function(tooMany){return function(item){if(item===tooMany){return tooMany}else{return this.constructor.prototype.highlighter.call(this,item)}}};UPDATER=function(tooMany){return function(item){if(item===tooMany){return null}else{return item}}};TOO_MANY_SUGGESTIONS=_.template('<span class="alert alert-info">\n  <i class="icon-info-sign"></i>\n  '+intermine.conbuilder.messages.TooManySuggestions+"\n  There are <%= extra %> values we could not include.\n</span>");aeql=function(xs,ys){var longer,shorter,_ref;if(!xs&&!ys){return true}if(!xs||!ys){return false}_ref=_.sortBy([xs,ys],function(a){return a.length}),shorter=_ref[0],longer=_ref[1];return _.all(longer,function(x){return __indexOf.call(shorter,x)>=0})};basicEql=function(a,b){var k,keys,same,va,vb,x,_i,_len,_ref;if(!(a&&b)){return a===b}keys=_.union.apply(_,[a,b].map(_.keys));same=true;for(_i=0,_len=keys.length;_i<_len;_i++){k=keys[_i];_ref=function(){var _j,_len1,_ref,_results;_ref=[a,b];_results=[];for(_j=0,_len1=_ref.length;_j<_len1;_j++){x=_ref[_j];_results.push(x[k])}return _results}(),va=_ref[0],vb=_ref[1];same&&(same=_.isArray(va)?aeql(va,vb):va===vb)}return same};ActiveConstraint=function(_super){var BASIC_OPS,CON_OPTS,IS_BLANK,toLabel;__extends(ActiveConstraint,_super);function ActiveConstraint(){this.changeMultiValues=__bind(this.changeMultiValues,this);_ref=ActiveConstraint.__super__.constructor.apply(this,arguments);return _ref}ActiveConstraint.prototype.tagName="form";ActiveConstraint.prototype.className="form-inline im-constraint row-fluid";BASIC_OPS=intermine.Query.ATTRIBUTE_VALUE_OPS.concat(intermine.Query.NULL_OPS);ActiveConstraint.prototype.initialize=function(query,orig){var _ref1,_ref2;this.query=query;this.orig=orig;this.typeaheads=[];this.path=this.query.getPathInfo(this.orig.path);this.type=this.path.getType();this.cast=(_ref1=this.type,__indexOf.call(intermine.Model.NUMERIC_TYPES,_ref1)>=0)?function(x){return 1*x}:function(x){return""+x};this.con=new Backbone.Model(_.extend({},this.orig));if(this.path.isReference()||this.path.isRoot()){this.ops=intermine.Query.REFERENCE_OPS}else if(_ref2=this.path.getType(),__indexOf.call(intermine.Model.BOOLEAN_TYPES,_ref2)>=0){this.ops=["=","!="].concat(intermine.Query.NULL_OPS)}else if(this.con.has("values")){this.ops=intermine.Query.ATTRIBUTE_OPS}else{this.ops=BASIC_OPS}return this.con.on("change",this.fillConSummaryLabel,this)};ActiveConstraint.prototype.events={"change .im-ops":"drawValueOptions","click .im-edit":"toggleEditForm","click .btn-cancel":"hideEditForm","click .btn-primary":"editConstraint","click .icon-remove-sign":"removeConstraint","click td.im-multi-value":"toggleRowCheckbox",submit:function(e){e.preventDefault();return e.stopPropagation()}};ActiveConstraint.prototype.toggleRowCheckbox=function(e){var $td,input;$td=$(e.target);input=$td.prev().find("input")[0];input.checked=!input.checked;return $(input).trigger("change")};ActiveConstraint.prototype.toggleEditForm=function(){this.$(".im-constraint-options").show();this.$(".im-con-buttons").show();this.$(".im-value-options").show();this.$el.siblings(".im-constraint").slideUp();return this.$el.closest(".well").addClass("im-editing")};ActiveConstraint.prototype.hideEditForm=function(e){var ta,_results;if(e!=null){e.preventDefault()}if(e!=null){e.stopPropagation()}this.$el.removeClass("error");this.$el.siblings(".im-constraint").slideDown();this.$el.closest(".well").removeClass("im-editing");this.$(".im-con-overview").siblings('[class*="im-con"]').slideUp(200);this.$(".im-multi-value-table input").prop("checked",true);this.con.set(_.extend({},this.orig));_results=[];while(ta=this.typeaheads.shift()){_results.push(ta.remove())}return _results};IS_BLANK=/^\s*$/;ActiveConstraint.prototype.valid=function(){var e,ok,op,val;if(this.con.has("type")){return true}if(!this.con.get("op")||IS_BLANK.test(this.con.get("op"))){return false}op=this.con.get("op");if(this.path.isReference()&&(op==="="||op==="!=")){ok=function(){try{this.query.getPathInfo(this.con.get("value"));return true}catch(_error){e=_error;return false}}.call(this);return ok}if(__indexOf.call(intermine.Query.ATTRIBUTE_VALUE_OPS.concat(intermine.Query.REFERENCE_OPS),op)>=0){val=this.con.get("value");return val!=null&&!IS_BLANK.test(val)&&!_.isNaN(val)}if(__indexOf.call(intermine.Query.MULTIVALUE_OPS,op)>=0){return this.con.has("values")&&this.con.get("values").length>0}return true};ActiveConstraint.prototype.isDuplicate=function(){return _.any(this.query.constraints,_.partial(basicEql,this.con.toJSON()))};ActiveConstraint.prototype.setError=function(key){this.$el.addClass("error");this.$(".im-conbuilder-error").text(intermine.conbuilder.messages[key]);return false};ActiveConstraint.prototype.editConstraint=function(e){var silently,ta,_ref1,_ref2,_ref3;if(e!=null){e.stopPropagation()}if(e!=null){e.preventDefault()}if(!this.valid()){return this.setError("NoValue")}if(this.isDuplicate()){return this.setError("Duplicate")}this.removeConstraint(e,silently=true);if(_ref1=this.con.get("op"),__indexOf.call(intermine.Query.MULTIVALUE_OPS.concat(intermine.Query.NULL_OPS),_ref1)>=0){this.con.unset("value")}if(_ref2=this.con.get("op"),__indexOf.call(intermine.Query.ATTRIBUTE_VALUE_OPS.concat(intermine.Query.NULL_OPS),_ref2)>=0){this.con.unset("values")}if((_ref3=this.con.get("op"),__indexOf.call(intermine.Query.MULTIVALUE_OPS,_ref3)>=0)&&this.con.get("values").length===0){this.query.trigger("change:constraints")}else{this.query.addConstraint(this.con.toJSON())}while(ta=this.typeaheads.shift()){ta.remove()}return true};ActiveConstraint.prototype.removeConstraint=function(e,silently){if(silently==null){silently=false}return this.query.removeConstraint(this.orig,silently)};ActiveConstraint.prototype.addIcons=function($label){$label.append('<a><i class="icon-remove-sign"></i></a>');if(this.con.locked){return $label.append('<a><i class="icon-lock" title="this constraint is not editable"></i></a>')}else{return $label.append('<a><i class="im-edit '+intermine.icons.Edit+'"></i></a>')}};ActiveConstraint.prototype.buttons=[{text:"Update","class":"btn btn-primary"},{text:"Cancel","class":"btn btn-cancel"}];ActiveConstraint.prototype.addButtons=function(){var btns,c,t,_fn,_i,_len,_ref1,_ref2;btns=$('<div class="btn-group im-con-buttons">\n</div>');_ref1=this.buttons;_fn=function(){return btns.append('<button class="'+c+'">'+t+"</button>")};for(_i=0,_len=_ref1.length;_i<_len;_i++){_ref2=_ref1[_i],t=_ref2.text,c=_ref2["class"];_fn()}return this.$el.append(btns)};ActiveConstraint.prototype.getTitleOp=function(){return this.con.get("op")||intermine.conbuilder.messages.IsA};ActiveConstraint.prototype.getTitleVal=function(){if(this.con.get("values")){return this.con.get("values").length+" values"}else if(this.con.has("value")){return this.con.get("value")}else{return this.con.get("type")}};toLabel=function(content,type){return $('<span class="label label-'+type+'">'+content+"</span>")};ActiveConstraint.prototype.fillConSummaryLabel=function(){var op,sp,ul,val,_ref1,_this=this;if(this.label==null){return}this.label.empty();this.addIcons(this.label);ul=$('<ul class="breadcrumb">').appendTo(this.label);if(this.con.has("title")){ul.append(toLabel(this.con.get("title"),"path"))}else{sp=toLabel(this.path,"path");(function(sp){return _this.path.getDisplayName(function(name){return sp.text(name)})})(sp);ul.append(sp)}if(op=this.getTitleOp()){ul.append(toLabel(op,"op"))}if(_ref1=this.con.get("op"),__indexOf.call(intermine.Query.NULL_OPS,_ref1)<0){val=this.getTitleVal();if(val!=null){ul.append(toLabel(val,"value"))}if(this.con.has("extraValue")){ul.append(intermine.conbuilder.messages.ExtraLabel);return ul.append(toLabel(this.con.get("extraValue"),"extra"))}}};CON_OPTS='<fieldset class="im-constraint-options"></fieldset>';ActiveConstraint.prototype.render=function(){var fs;this.label=$('<label class="im-con-overview">\n</label>');this.fillConSummaryLabel();this.$el.append(this.label);fs=$(CON_OPTS).appendTo(this.el);if(this.con.has("op")){this.drawOperatorSelector(fs)}this.drawValueOptions();this.$el.append('<div class="alert alert-error im-hidden">\n  <i class="icon-warning-sign"></i>\n  <span class="im-conbuilder-error">\n  </span>\n</div>');this.addButtons();return this};ActiveConstraint.prototype.drawOperatorSelector=function(fs){var $select,current,_this=this;current=this.con.get("op");$select=$('<select class="span4 im-ops"><option>'+current+"</option></select>");$select.appendTo(fs);_(this.ops).chain().without(current).each(function(op){return $select.append("<option>"+op+"</select>")});return $select.change(function(e){return _this.con.set({op:$select.val()})})};ActiveConstraint.prototype.btnGroup='<div class="im-value-options btn-group" data-toggle="buttons-radio"></div>';ActiveConstraint.prototype.drawTypeOpts=function(fs){var baseType,label,schema,select,subclasses,t,type,types,_fn,_i,_len,_this=this;label='<label class="span4">IS A</label>';select=$('<select class="span7">\n</select>');fs.append(label);fs.append(select);type=this.con.get("type");subclasses=this.query.getSubclasses();schema=this.query.model;delete subclasses[this.path];baseType=schema.getPathInfo(this.path,subclasses).getType();types=[type].concat(schema.getSubclassesOf(baseType));_fn=function(t){var option;option=$("<option>");option.attr({value:t});select.append(option);return schema.getPathInfo(t).getDisplayName().done(function(name){return option.text(name)})};for(_i=0,_len=types.length;_i<_len;_i++){t=types[_i];_fn(t)}return select.change(function(){return _this.con.set({type:select.val()})})};ActiveConstraint.prototype.drawBooleanOpts=function(fs){var con,current,grp,val,_i,_len,_ref1,_results,_this=this;current=this.con.get("value");con=this.con;grp=$(this.btnGroup).appendTo(fs);_ref1=["true","false"];_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){val=_ref1[_i];_results.push(function(val){var button;button=$('<button class="btn '+(current===val?"active":"")+'">\n    '+val+"\n</button>");button.appendTo(grp);return button.click(function(e){var wasActive;wasActive=button.is(".active");grp.find("button").removeClass("active");if(!wasActive){button.addClass("active");return _this.con.set({value:val})}else{return _this.con.unset("value")}})}(val))}return _results};ActiveConstraint.prototype.valueSelect='<select class="span7 im-value-options im-con-value"></select>';ActiveConstraint.prototype.listOptionTempl=_.template('<option value="<%- name %>">\n    <%- name %> (<%- size %> <%- type %>s)\n</option>');ActiveConstraint.prototype.multiValueTable='<div class="im-value-options im-multi-value-table">\n  <table class="table table-condensed"></table>\n</div>';ActiveConstraint.prototype.multiValueOptTempl=_.template('<tr>\n    <td><input type=checkbox checked data-value="<%- value %>"></td>\n    <td class="im-multi-value"><%- value %></td>\n</tr>');ActiveConstraint.prototype.clearer='<div class="im-value-options" style="clear:both;">';ActiveConstraint.prototype.drawMultiValueOps=function(fs){var $multiValues,con,table,values,_this=this;con=this.con;if(!con.has("values")){con.set({values:[]})}values=con.get("values");$multiValues=$(this.multiValueTable).appendTo(fs);table=$multiValues.find("table");_(values).each(function(v){return table.append(_this.multiValueOptTempl({value:v}))});return $multiValues.find("input").change(this.changeMultiValues)};ActiveConstraint.prototype.changeMultiValues=function(e){var changed,value,values;changed=$(e.target);values=this.con.get("values");value=changed.data("value");if(changed.prop("checked")){values=_.union(values,[value])}else{values=_.without(values,value)}return this.con.set({values:values})};ActiveConstraint.prototype.drawListOptions=function(fs){var $lists,_this=this;$lists=$(this.valueSelect).appendTo(fs);this.query.service.fetchLists(function(ls){var selectables,sl,_i,_len;selectables=_(ls).filter(function(l){return l.size&&_this.path.isa(l.type)});for(_i=0,_len=selectables.length;_i<_len;_i++){sl=selectables[_i];$lists.append(_this.listOptionTempl(sl))}if(_this.con.has("value")){$lists.val(_this.con.get("value"))}if(selectables.length===0){$lists.attr({disabled:true});return $lists.append("No lists of this type available")}else{return _this.con.set({value:$lists.val()})}});return $lists.change(function(e){return _this.con.set({value:$lists.val()})})};ActiveConstraint.prototype.drawLoopOpts=function(fs){var $loops,lc,loopCandidates,opt,_i,_len,_results,_this=this;$loops=$(this.valueSelect).appendTo(fs);loopCandidates=this.query.getQueryNodes().filter(function(lc){return lc.isa(_this.type)||_this.path.isa(lc.getType())});_results=[];for(_i=0,_len=loopCandidates.length;_i<_len;_i++){lc=loopCandidates[_i];opt=$('<option value="'+lc.toString()+'">');opt.appendTo($loops);_results.push(function(opt,lc){return lc.getDisplayName(function(name){return opt.text(name)})}(opt,lc))}return _results};ActiveConstraint.prototype.handleSummary=function(input,items,total){var MaxSuggestions,item,suggestions,tooMany;suggestions=function(){var _i,_len,_ref1,_results;_ref1=_.pluck(items,"item");_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){item=_ref1[_i];_results.push(""+item)}return _results}();MaxSuggestions=intermine.options.MaxSuggestions;if(total>MaxSuggestions){tooMany=TOO_MANY_SUGGESTIONS({extra:total-MaxSuggestions});suggestions.push(tooMany)}input.typeahead({source:suggestions,items:20,minLength:0,updater:UPDATER(tooMany),highlighter:HIGHLIGHTER(tooMany),matcher:MATCHER(tooMany)});this.typeaheads.push(input.data("typeahead").$menu);this.query.on("cancel:add-constraint",function(){var _ref1;return(_ref1=input.data("typeahead"))!=null?_ref1.$menu.remove():void 0});return input.attr({placeholder:items[0].item})};ActiveConstraint.prototype.handleNumericSummary=function(input,_arg){var $slider,average,caster,fs,isInt,max,min,step,_ref1;min=_arg.min,max=_arg.max,average=_arg.average;isInt=(_ref1=this.path.getType(),__indexOf.call(intermine.Model.INTEGRAL_TYPES,_ref1)>=0);step=isInt?1:max-min/100;caster=isInt?parseInt:parseFloat;fs=input.closest("fieldset");fs.append(this.clearer);$slider=$('<div class="im-value-options">');$slider.appendTo(fs).slider({min:min,max:max,value:this.con.has("value")?this.con.get("value"):caster(average),step:step,slide:function(e,ui){return input.val(ui.value).change()}});input.attr({placeholder:caster(average)});fs.append(this.clearer);return input.change(function(e){return $slider.slider("value",caster(input.val()))})};ActiveConstraint.prototype.drawAttributeOpts=function(fs){var input,setValue,_this=this;input=$('<input class="span7 im-constraint-value im-value-options im-con-value" type="text"\n    placeholder="'+intermine.conbuilder.messages.ValuePlaceholder+'"\n    value="'+(this.con.get("value")||"")+'"\n>');fs.append(input);setValue=function(){var _ref1;return _this.con.set({value:_this.cast((_ref1=input.val())!=null?_ref1.trim():void 0)})};input.keyup(setValue);input.change(setValue);this.con.on("change:value",function(){var current;current=_this.con.get("value");if(current!==_this.cast(input.val())){return input.val(current).change()}});if(this.path.isAttribute()){return this.provideSuggestions(input)}};ActiveConstraint.prototype.provideSuggestions=function(input){var c,clone,filtering,pstr,value,_this=this;clone=this.query.clone();pstr=this.path.toString();value=this.con.get("value");clone.constraints=function(){var _i,_len,_ref1,_results;_ref1=clone.constraints;_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){c=_ref1[_i];if(!(c.path===pstr&&c.value===value)){_results.push(c)}}return _results}();filtering=clone.filterSummary(pstr,"",intermine.options.MaxSuggestions);return filtering.done(function(items,stats){if((items!=null?items.length:void 0)>0){if(items[0].item!=null){return _this.handleSummary(input,items,stats.uniqueValues)}else if(items[0].max!=null){return _this.handleNumericSummary(input,items[0])}}})};ActiveConstraint.prototype.drawExtraOpts=function(fs){var input,_this=this;fs.append('<label class="im-value-options">\n    '+intermine.conbuilder.messages.ExtraLabel+'\n    <input type="text" class="im-extra-value"\n        placeholder="'+intermine.conbuilder.messages.ExtraPlaceholder+'"\n        value="'+(this.con.get("extraValue")||"")+'"\n    >\n</label>');return input=fs.find("input.im-extra-value").change(function(e){return _this.con.set({extraValue:input.val()})})};ActiveConstraint.prototype.drawValueOptions=function(){var currentOp,fs,_ref1;this.$(".im-value-options").remove();fs=this.$(".im-constraint-options");currentOp=this.con.get("op");if(!currentOp&&this.con.has("type")){this.drawTypeOpts(fs)}else if((_ref1=this.path.getType(),__indexOf.call(intermine.Model.BOOLEAN_TYPES,_ref1)>=0)&&!(__indexOf.call(intermine.Query.NULL_OPS,currentOp)>=0)){this.drawBooleanOpts(fs)}else if(__indexOf.call(intermine.Query.MULTIVALUE_OPS,currentOp)>=0){this.drawMultiValueOps(fs)}else if(__indexOf.call(intermine.Query.LIST_OPS,currentOp)>=0){this.drawListOptions(fs)}else if(this.path.isReference()&&(currentOp==="="||currentOp==="!=")){this.drawLoopOpts(fs)}else if(!(__indexOf.call(intermine.Query.NULL_OPS,currentOp)>=0)){this.drawAttributeOpts(fs)}if(__indexOf.call(intermine.Query.TERNARY_OPS,currentOp)>=0){return this.drawExtraOpts(fs)}};return ActiveConstraint}(Backbone.View);NewConstraint=function(_super){__extends(NewConstraint,_super);function NewConstraint(){_ref1=NewConstraint.__super__.constructor.apply(this,arguments);return _ref1}NewConstraint.prototype.initialize=function(q,c){NewConstraint.__super__.initialize.call(this,q,c);this.$el.addClass("new");this.buttons[0].text="Apply";return this.con.set({op:this.path.isReference()?"LOOKUP":"="})};NewConstraint.prototype.addIcons=function(){};NewConstraint.prototype.valueChanged=function(value){return this.fillConSummaryLabel(_.extend({},this.con,{value:""+value}))};NewConstraint.prototype.opChanged=function(op){return this.$(".label-op").text(op)};NewConstraint.prototype.removeConstraint=function(){};NewConstraint.prototype.hideEditForm=function(e){NewConstraint.__super__.hideEditForm.call(this,e);this.query.trigger("cancel:add-constraint");return this.remove()};return NewConstraint}(ActiveConstraint);return scope("intermine.query",{ActiveConstraint:ActiveConstraint,NewConstraint:NewConstraint})})();(function(){var DownloadDialogue;DownloadDialogue=function(){return'<div class="modal-header">\n  <a  class="close im-closer" data-dismiss="modal">close</a>\n  <h2>\n    '+intermine.messages.actions.ExportTitle+'\n  </h2>\n</div>\n\n<div class="modal-body tab-content">\n <div class="carousel slide">\n  <div class="carousel-inner">\n  <div class="active item">\n\n   <div class="tabbable tabs-left">\n     <ul class="nav nav-tabs">\n       <li class="active">\n         <a  class="im-export-format">format</a>\n       </li>\n       <li>\n         <a  class="im-export-columns">columns</a>\n       </li>\n       <li>\n         <a  class="im-export-rows">Rows</a>\n       </li>\n       <li>\n         <a  class="im-export-output">Output</a>\n       </li>\n       <li>\n         <a  class="im-export-destination">\n          Destination: <span class="im-current"></span>\n         </a>\n       </li>\n       <div class="alert alert-info">\n         <p>\n          <i class="icon-info-sign"></i>\n          '+intermine.messages.actions.ConfigureExportHelp+'\n         </p>\n       </div>\n     </ul>\n     <div class="tab-content">\n       <div class="tab-pane active im-export-format">\n          <h2>\n            '+intermine.messages.actions.ExportFormat+'\n          </h2>\n         <div class="im-export-formats" data-toggle="buttons-radio">\n         </div>\n       </div>\n       <div class="tab-pane im-export-columns">\n           <button class="im-reset-cols btn disabled pull-right">\n             <i class="'+intermine.icons.Undo+'"></i>\n             '+intermine.messages.actions.ResetColumns+"\n           </button>\n          <h2>\n            "+intermine.messages.actions.WhichColumns+'\n          </h2>\n          <div class="im-col-options">\n            <div class="well">\n              <ul class="im-cols im-exported-cols nav nav-tabs nav-stacked"></ul>\n            </div>\n            <h4>'+intermine.messages.actions.PossibleColumns+'</h4>\n            <div class="im-can-be-exported-cols">\n            </div>\n            <div style="clear:both;"></div>\n          </div>\n          <div class="im-col-options-bio">\n          </div>\n       </div>\n       <div class="tab-pane im-export-rows">\n         <h2>\n          '+intermine.messages.actions.WhichRows+'\n         </h2>\n          <div class="form-horizontal">\n            <fieldset class="im-row-selection control-group">\n              <label class="control-label">\n                '+intermine.messages.actions.FirstRow+'\n                <input type="text" value="1"\n                        class="disabled input-mini im-first-row im-range-limit">\n              </label>\n              <label class="control-label">\n                '+intermine.messages.actions.LastRow+'\n                <input type="text"\n                        class="disabled input-mini im-last-row im-range-limit">\n              </label>\n              <div style="clear:both"></div>\n              <div class="slider im-row-range-slider"></div>\n            </fieldset>\n          </div>\n       </div>\n       <div class="tab-pane im-export-output">\n          <label>\n            '+intermine.messages.actions.CompressResults+'\n          </label>\n          <div class="span11 im-compression-opts radio btn-group pull-right"\n                data-toggle="buttons-radio">\n            <button class="btn active im-no-compression span7">\n              '+intermine.messages.actions.NoCompression+'\n            </button>\n            <button class="btn im-gzip-compression span2">\n              '+intermine.messages.actions.GZIPCompression+'\n            </button>\n            <button class="btn im-zip-compression span2">\n              '+intermine.messages.actions.ZIPCompression+'\n            </button>\n          </div>\n          <div style="clear:both"></div>\n          <div class="im-output-options">\n          </div>\n       </div>\n       <div class="tab-pane im-export-destination">\n      <ul class="im-export-destinations nav nav-pills">\n        <li class="active">\n          <a  data-destination="download-file">\n            <i class="'+intermine.icons.Download+'"></i>\n            '+intermine.messages.actions.ExportLong+'\n          </a>\n        </li>\n      </ul>\n        <div class="row-fluid im-export-destination-options">\n\n          <div class="im-download-file active">\n            <div class="btn-group im-what-to-show">\n              <button class="im-results-uri btn active">\n                '+intermine.messages.actions.ResultsPermaLinkText+':\n              </button>\n              <button class="im-query-xml btn">\n                '+intermine.messages.actions.QueryXML+'\n              </button>\n            </div>\n            <span class="im-copy">\n              <i class="icon '+intermine.icons.ClipBoard+'"></i>\n              '+intermine.messages.actions.Copy+'\n            </span>\n\n            <div class="well im-perma-link-content active"></div>\n            <div class="well im-query-xml"></div>\n\n            <div class="alert alert-block im-private-query">\n              <button type="button" class="close im-closer" data-dismiss="alert"></button>\n              <h4>nb:</h4>\n              '+intermine.messages.actions.IsPrivateData+'\n            </div>\n\n            <div class="alert alert-block alert-info im-long-uri">\n              <button type="button" class="close im-closer" data-dismiss="alert"></button>\n              <h4>nb:</h4>\n              '+intermine.messages.actions.LongURI+'\n            </div>\n\n\n          </div>\n\n        </div>\n       </div>\n     </div>\n   </div>\n  \n  </div> <!-- End item -->\n  \n  <div class="item">\n    <iframe class="gs-frame" width="0" height="0" frameborder="0"\n      id="im-to-gs-'+(new Date).getTime()+'">\n    </iframe>\n  </div>\n\n  </div> <!-- end inner -->\n  </div> <!-- end carousel -->\n\n</div>\n\n<!--\n-->\n\n<div class="modal-footer">\n  <a  class="btn btn-primary im-download pull-right">\n    <i class="icon '+intermine.icons.Export+'"></i>\n    '+intermine.messages.actions.Export+'\n  </a>\n  <button class="btn btn-cancel pull-left im-cancel">\n    '+intermine.messages.actions.Cancel+"\n  </button>\n</div>"
};return scope("intermine.snippets.actions",{DownloadDialogue:DownloadDialogue})})();(function(){var DropDownColumnSummary,OuterJoinDropDown,SummaryHeading,_ref,_ref1,_ref2;OuterJoinDropDown=function(_super){__extends(OuterJoinDropDown,_super);function OuterJoinDropDown(){_ref=OuterJoinDropDown.__super__.constructor.apply(this,arguments);return _ref}OuterJoinDropDown.prototype.className="im-summary-selector no-margins";OuterJoinDropDown.prototype.tagName="ul";OuterJoinDropDown.prototype.initialize=function(query,path,model){var _ref1;this.query=query;this.path=path;return _ref1=model.toJSON(),this.replaces=_ref1.replaces,this.isFormatted=_ref1.isFormatted,_ref1};OuterJoinDropDown.prototype.getSubpaths=function(){return this.replaces.slice()};OuterJoinDropDown.prototype.render=function(){var node,v,vs,_fn,_i,_len,_this=this;vs=[];node=this.path;vs=this.getSubpaths();if(vs.length===1){this.showPathSummary(vs[0])}else{_fn=function(v){var li;li=$('<li class="im-subpath im-outer-joined-path"><a href="#"></a></li>');_this.$el.append(li);$.when(node.getDisplayName(),_this.query.getPathInfo(v).getDisplayName()).done(function(parent,name){return li.find("a").text(name.replace(parent,"").replace(/^\s*>\s*/,""))});return li.click(function(e){e.stopPropagation();e.preventDefault();return _this.showPathSummary(v)})};for(_i=0,_len=vs.length;_i<_len;_i++){v=vs[_i];_fn(v)}}return this};OuterJoinDropDown.prototype.showPathSummary=function(v){var summ;summ=new intermine.query.results.DropDownColumnSummary(this.query,v);this.$el.parent().html(summ.render().el);this.summ=summ;return this.$el.remove()};OuterJoinDropDown.prototype.remove=function(){var _ref1;if((_ref1=this.summ)!=null){_ref1.remove()}return OuterJoinDropDown.__super__.remove.call(this)};return OuterJoinDropDown}(Backbone.View);DropDownColumnSummary=function(_super){__extends(DropDownColumnSummary,_super);function DropDownColumnSummary(){_ref1=DropDownColumnSummary.__super__.constructor.apply(this,arguments);return _ref1}DropDownColumnSummary.prototype.className="im-dropdown-summary";DropDownColumnSummary.prototype.initialize=function(query,view){this.query=query;this.view=view};DropDownColumnSummary.prototype.remove=function(){var _ref2,_ref3;if((_ref2=this.heading)!=null){_ref2.remove()}if((_ref3=this.summ)!=null){_ref3.remove()}return DropDownColumnSummary.__super__.remove.call(this)};DropDownColumnSummary.prototype.render=function(){var heading;heading=new SummaryHeading(this.query,this.view);heading.render().$el.appendTo(this.el);this.heading=heading;this.summ=new intermine.results.ColumnSummary(this.query,this.view);this.summ.noTitle=true;this.summ.render().$el.appendTo(this.el);return this};return DropDownColumnSummary}(Backbone.View);SummaryHeading=function(_super){var nts;__extends(SummaryHeading,_super);function SummaryHeading(){_ref2=SummaryHeading.__super__.constructor.apply(this,arguments);return _ref2}nts=function(num){return intermine.utils.numToString(num,",",3)};SummaryHeading.prototype.initialize=function(query,view){var _this=this;this.query=query;this.view=view;return this.query.on("got:summary:total",function(path,total,got,filteredTotal){var available;if(path===_this.view){available=filteredTotal!=null?filteredTotal:total;_this.$(".im-item-available").text(nts(available));_this.$(".im-item-total").text(filteredTotal!=null?"(filtered from "+nts(total)+")":"");if(available>got){return _this.$(".im-item-got").text("Showing "+nts(got)+" of ")}else{return _this.$(".im-item-got").text("")}}})};SummaryHeading.prototype.template=_.template('<h3>\n    <span class="im-item-got"></span>\n    <span class="im-item-available"></span>\n    <span class="im-type-name"></span>\n    <span class="im-attr-name"></span>\n    <span class="im-item-total"></span>\n</h3>');SummaryHeading.prototype.render=function(){var attr,s,type,_this=this;this.$el.append(this.template());s=this.query.service;type=this.query.getPathInfo(this.view).getParent().getType().name;attr=this.query.getPathInfo(this.view).end.name;s.get("model/"+type).then(function(info){return _this.$(".im-type-name").text(info.name)});s.get("model/"+type+"/"+attr).then(function(info){return _this.$(".im-attr-name").text(intermine.utils.pluralise(info.name))});return this};return SummaryHeading}(Backbone.View);return scope("intermine.query.results",{OuterJoinDropDown:OuterJoinDropDown,DropDownColumnSummary:DropDownColumnSummary})})();(function(){var DynamicPopover;DynamicPopover=function(_super){__extends(DynamicPopover,_super);function DynamicPopover(elem,opts){this.init("popover",elem,opts);$(elem).data("popover",this);if(opts!=null?opts.classes:void 0){this.tip().addClass(opts.classes)}}DynamicPopover.prototype.hasContent=function(){return true};DynamicPopover.prototype.getPlacement=function(){if(typeof this.options.placement==="function"){return this.options.placement.call(this,this.tip()[0],this.$element[0])}else{return this.options.placement}};DynamicPopover.prototype.respectContainment=function(offset,pos,placement){var $containment,$tip,actualHeight,actualWidth,arrowHeight,arrowOffset,arrowWidth,bottom,diff,height,left,top,_ref;$tip=this.tip();arrowOffset={};actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;$containment=this.$element.closest(this.options.containment);_ref=$containment.offset(),top=_ref.top,left=_ref.left;height=$containment[0].offsetHeight;bottom=top+height;arrowHeight=$tip.find(".arrow")[0].offsetHeight;arrowWidth=$tip.find(".arrow")[0].offsetWidth;if(actualHeight>=height){$tip.find(".arrow").css({top:"",left:""});return}if(placement==="right"||placement==="left"){if(offset.top<top){diff=top-offset.top;offset.top+=diff;arrowOffset.top=offset.top+(pos.top-offset.top)+pos.height/2-arrowHeight/2}else if(offset.top+actualHeight>bottom){diff=offset.top+actualHeight-bottom;offset.top-=diff;arrowOffset.top=offset.top+(pos.top-offset.top)+pos.height/2-arrowHeight/2}}else{if(offset.left<left){diff=left-offset.left;offset.left+=diff;arrowOffset.left=pos.left+pos.width/2-arrowWidth/2}}if(placement==="right"){offset.left+=arrowWidth}else if(placement==="top"){offset.top-=arrowHeight}else if(placement==="left"){offset.left-=arrowWidth}$tip.offset(offset);return $tip.find(".arrow").offset(arrowOffset)};DynamicPopover.prototype.applyPlacement=function(offset,placement){var $tip;$tip=this.tip();$tip.removeClass("left right top bottom");return DynamicPopover.__super__.applyPlacement.call(this,offset,placement)};DynamicPopover.prototype.reposition=function(){var $tip,actualHeight,actualWidth,placement,pos,tp;pos=this.getPosition();$tip=this.tip();actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;placement=this.getPlacement();tp=function(){switch(placement){case"bottom":return{top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2};case"top":return{top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2};case"left":return{top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth};case"right":return{top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}}}();this.applyPlacement(tp,placement);if(this.options.containment!=null){this.respectContainment(tp,pos,placement)}return this.$element.trigger("repositioned")};return DynamicPopover}(jQuery.fn.popover.Constructor);return scope("intermine.bootstrap",{DynamicPopover:DynamicPopover})})();(function(){var ExportColumnHeader,NAME_TEMPLATE,TEMPLATE,moveRight,shift,_ref;TEMPLATE='<div>\n  <div class="pull-right im-promoters">\n    <i class="'+intermine.icons.MoveUp+' im-promote"></i>\n    <i class="'+intermine.icons.MoveDown+' im-demote"></i>\n  </div>\n  <i class="'+intermine.icons.Check+' im-exclude"></i>\n  <span class="im-path"></span>\n</div>';NAME_TEMPLATE=_.template('<span class="im-name-part"><%- part %></span>');moveRight=function(xs,i){return xs.splice(i,2,xs[i+1],xs[i])};shift=function(model,toLeft){var idx,models;models=model.collection.models;idx=models.indexOf(model);moveRight(models,toLeft?idx-1:idx);return model.collection.trigger("reset")};ExportColumnHeader=function(_super){__extends(ExportColumnHeader,_super);function ExportColumnHeader(){_ref=ExportColumnHeader.__super__.constructor.apply(this,arguments);return _ref}ExportColumnHeader.prototype.tagName="li";ExportColumnHeader.prototype.className="im-exported-col im-view-element";ExportColumnHeader.prototype.template=function(){return TEMPLATE};ExportColumnHeader.prototype.events={"click .im-promote":"promote","click .im-demote":"demote","click .im-exclude":"toggle","click .im-path":"toggle"};ExportColumnHeader.prototype.promote=function(e){var toLeft;if(!$(e.target).is(".disabled")){return shift(this.model,toLeft=true)}};ExportColumnHeader.prototype.demote=function(e){var toLeft;if(!$(e.target).is(".disabled")){return shift(this.model,toLeft=false)}};ExportColumnHeader.prototype.toggle=function(){return this.model.set({excluded:!this.model.get("excluded")})};ExportColumnHeader.prototype.initialize=function(){if(!this.model.has("excluded")){this.model.set({excluded:false})}this.$el.data({model:this.model});this.on("rendered",this.displayName,this);this.on("rendered",this.onChangeExclusion,this);this.on("rendered",this.checkShifters,this);return this.model.on("change:excluded",this.onChangeExclusion,this)};ExportColumnHeader.prototype.checkShifters=function(){var idx;idx=this.model.collection.models.indexOf(this.model);this.$(".im-promote").toggleClass("disabled",idx===0);return this.$(".im-demote").toggleClass("disabled",idx+1===this.model.collection.length)};ExportColumnHeader.prototype.onChangeExclusion=function(){var excl;excl=this.model.get("excluded");this.$(".im-exclude").toggleClass(intermine.icons.Check,!excl).toggleClass(intermine.icons.UnCheck,excl);return this.$el.toggleClass("im-excluded",excl)};ExportColumnHeader.prototype.displayName=function(){var _this=this;return this.model.get("path").getDisplayName().done(function(dname){var $path,part,parts,_i,_len,_results;parts=dname.split(" > ");$path=_this.$(".im-path");_results=[];for(_i=0,_len=parts.length;_i<_len;_i++){part=parts[_i];_results.push($path.append(NAME_TEMPLATE({part:part})))}return _results})};return ExportColumnHeader}(intermine.views.ItemView);return scope("intermine.columns.views",{ExportColumnHeader:ExportColumnHeader})})();(function(){var ExportColumnOptions,NODE_HTML,SelectableNode,namePart,_ref,_ref1;NODE_HTML=_.template('<div>\n  <i class="<%= icon %>"></i>\n  <span class="im-display-name"></span>\n</div>');namePart=_.template('<span class="im-name-part"><%- part %></span>');SelectableNode=function(_super){__extends(SelectableNode,_super);function SelectableNode(){this.render=__bind(this.render,this);_ref=SelectableNode.__super__.constructor.apply(this,arguments);return _ref}SelectableNode.prototype.tagName="li";SelectableNode.prototype.className="im-selectable-node im-view-element";SelectableNode.prototype.initialize=function(){this.model.on("change:included",this.render);return this.model.on("destroy",this.remove,this)};SelectableNode.prototype.events={click:"toggleIncluded"};SelectableNode.prototype.toggleIncluded=function(){return this.model.set({included:!this.model.get("included")})};SelectableNode.prototype.render=function(){var Check,UnCheck,icon,included,path,_ref1,_ref2,_this=this;_ref1=this.model.toJSON(),path=_ref1.path,included=_ref1.included;_ref2=intermine.icons,Check=_ref2.Check,UnCheck=_ref2.UnCheck;icon=included?Check:UnCheck;this.$el.html(NODE_HTML({icon:icon}));this.$el.toggleClass("included",included);path.getDisplayName(function(name){var $name,part,parts,_i,_len,_results;parts=name.split(" > ");$name=_this.$(".im-display-name").empty();_results=[];for(_i=0,_len=parts.length;_i<_len;_i++){part=parts[_i];_results.push($name.append(namePart({part:part})))}return _results});return this};return SelectableNode}(Backbone.View);ExportColumnOptions=function(_super){var COUNT_INCLUDED,TEMPLATE;__extends(ExportColumnOptions,_super);function ExportColumnOptions(){this.update=__bind(this.update,this);this.insert=__bind(this.insert,this);_ref1=ExportColumnOptions.__super__.constructor.apply(this,arguments);return _ref1}ExportColumnOptions.prototype.tagName="label";ExportColumnOptions.prototype.className="export-column-options";TEMPLATE=function(ctx){return _.template('<div class="control-label">\n  <%= message %>\n  <span class="im-selected-count">0</span> selected.\n  <div class="btn im-clear disabled">\n    '+intermine.messages.actions.Clear+'\n  </div>\n</div>\n<div class="well">\n  <ul class="im-export-paths nav nav-tabs nav-stacked"></ul>\n</div>',ctx)};COUNT_INCLUDED=function(sum,m){if(m.get("included")){return++sum}else{return sum}};ExportColumnOptions.prototype.initialize=function(options){var col,_ref2;this.options=options;this.paths=col=function(){if((_ref2=this.collection)!=null){return _ref2}else{throw new Error("collection required")}}.call(this);this.listenTo(col,"change:included",this.update);this.listenTo(col,"add",this.insert);this.listenTo(col,"add",this.update);return this.listenTo(col,"close",this.remove,this)};ExportColumnOptions.prototype.insert=function(m){return this.$(".im-export-paths").append(new SelectableNode({model:m}).render().el)};ExportColumnOptions.prototype.events={"click .im-clear":"clear","click .im-collapser":"toggle"};ExportColumnOptions.prototype.clear=function(){return this.paths.each(function(m){return m.set({included:false})})};ExportColumnOptions.prototype.toggle=function(){this.$(".im-export-paths").slideToggle();this.$(".im-left-col").toggleClass("span4 span10");return this.$(".im-collapser").toggleClass(intermine.icons.ExpandCollapse)};ExportColumnOptions.prototype.update=function(){var c;c=this.paths.reduce(COUNT_INCLUDED,0);this.$(".im-selected-count").text(c);this.$(".im-clear").toggleClass("disabled",c<1);return this.$el.toggleClass("error",!this.isValidCount(c))};ExportColumnOptions.prototype.isValidCount=function(){return true};ExportColumnOptions.prototype.render=function(){var m,_i,_len,_ref2;this.$el.append(TEMPLATE({message:this.options.message}));if(this.paths.isEmpty()){this.$(".im-export-paths").append('<li>\n  <span class="label label-important">\n  '+intermine.messages.actions.NoSuitableColumns+"\n  </span>\n</li>")}else{_ref2=this.paths.models;for(_i=0,_len=_ref2.length;_i<_len;_i++){m=_ref2[_i];this.insert(m)}}this.paths.trigger("change:included");return this};return ExportColumnOptions}(Backbone.View);return scope("intermine.actions",{ExportColumnOptions:ExportColumnOptions})})();define("export/dialogue",using("perma-query",function(getPermaQuery){var BIO_FORMATS,DELENDA,ENTER,EXPORT_FORMATS,ExportDialogue,SPACE,Tab,anyAny,anyNodeIsSuitable,defer,featuresToPaths,formatByExtension,idAttr,isImplicitlyConstrained,isIncluded,isntExcluded,toPath,_ref;defer=function(x){return new jQuery.Deferred(function(){return this.resolve(x)})};EXPORT_FORMATS=[{name:"Spreadsheet (tab separated values)",extension:"tsv",param:"tab"},{name:"Spreadsheet (comma separated values)",extension:"csv"},{name:"XML",extension:"xml"},{name:"JSON",extension:"json"}];BIO_FORMATS=[{name:"GFF3 (General Feature Format)",extension:"gff3",types:["SequenceFeature"]},{name:"UCSC-BED (Browser Extensible Display Format)",extension:"bed",types:["SequenceFeature"]},{name:"FASTA sequence",extension:"fasta",types:["SequenceFeature","Protein"]}];DELENDA=["requestInfo","state","exportedCols","possibleColumns","seqFeatures","fastaFeatures","extraAttributes"];ENTER=13;SPACE=32;formatByExtension=function(ext){return _.find(EXPORT_FORMATS.concat(BIO_FORMATS),function(f){return f.extension===ext})};toPath=function(col){return col.get("path")};idAttr=function(path){return path.append("id")};isIncluded=function(col){return col.get("included")};isntExcluded=function(col){return!col.get("excluded")};featuresToPaths=function(features){return features.filter(isIncluded).map(_.compose(idAttr,toPath))};isImplicitlyConstrained=function(q,node){var c,n,v,_i,_j,_len,_len1,_ref,_ref1;if(q.isInView(node)){return true}n=node.toString();_ref=q.views;for(_i=0,_len=_ref.length;_i<_len;_i++){v=_ref[_i];if(0===v.indexOf(n)){return true}}_ref1=q.constraints;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){c=_ref1[_j];if(c.op&&0===c.path.indexOf(n)){return true}}return false};anyAny=function(xs,ys,f){return _.any(xs,function(x){return _.any(ys,function(y){return f(x,y)})})};anyNodeIsSuitable=function(model,nodes){return function(types){return anyAny(types,nodes,function(t,n){var _ref;return _ref=n.name,__indexOf.call(model.getSubclassesOf(t),_ref)>=0})}};Tab=intermine.bootstrap.Tab;ExportDialogue=function(_super){var formatToEl,ignore,switchActive;__extends(ExportDialogue,_super);function ExportDialogue(){this.initCols=__bind(this.initCols,this);this.onChangeDest=__bind(this.onChangeDest,this);this.onChangePermalink=__bind(this.onChangePermalink,this);this.onChangePermaquery=__bind(this.onChangePermaquery,this);this.onChangeURL=__bind(this.onChangeURL,this);this.onChangePrivacy=__bind(this.onChangePrivacy,this);this.buildPermaLink=__bind(this.buildPermaLink,this);_ref=ExportDialogue.__super__.constructor.apply(this,arguments);return _ref}ExportDialogue.prototype.tagName="div";ExportDialogue.prototype.className="modal im-export-dialogue";ExportDialogue.prototype.initialize=function(query){var col,enabled,name,_fn,_i,_len,_ref1,_ref2,_ref3,_this=this;this.query=query.clone();this.service=query.service;this.dummyParams=["allRows","allCols","end","columnHeaders"];this.qids={};this.requestInfo=new Backbone.Model({format:EXPORT_FORMATS[0],allRows:true,allCols:true,start:0,compress:"no",columnHeaders:true});_ref1=intermine.options.ExternalExportDestinations;for(name in _ref1){enabled=_ref1[name];if(enabled){if((_ref2=intermine["export"].external[name].init)!=null){_ref2.call(this)}}}this.state=new Backbone.Model({destination:"download-file"});this.state.on("change:isPrivate",this.onChangePrivacy);this.state.on("change:url",this.onChangeURL);this.state.on("change:destination",this.onChangeDest);this.state.on("change:permalink",this.onChangePermalink);this.state.on("change:permaquery",this.onChangePermaquery);this.service.fetchVersion(function(v){if(v<12){return _this.$(".im-ws-v12").remove()}});this.exportedCols=new Backbone.Collection;this.resetExportedColumns();this.seqFeatures=new intermine.models.ClosableCollection;this.fastaFeatures=new intermine.models.ClosableCollection;this.extraAttributes=new intermine.models.ClosableCollection;_ref3=[this.seqFeatures,this.fastaFeatures];_fn=function(col){return col.on("change:included",function(){return _this.onChangeIncludedNodes(col)})};for(_i=0,_len=_ref3.length;_i<_len;_i++){col=_ref3[_i];_fn(col)}this.fastaFeatures.on("change:included",function(originator,incl){var f;f=function(m){if(m!==originator){return m.set({included:false})}};if(incl){return _this.fastaFeatures.each(f)}});this.fastaFeatures.on("change:included",function(col,incl){var canHaveExt,inp;canHaveExt=incl&&col.get("path").isa("SequenceFeature");inp=_this.$("input.im-fasta-extension").attr({disabled:!canHaveExt});if(canHaveExt){return _this.requestInfo.set({extension:inp.val()})}else{return _this.requestInfo.unset("extension")}});this.extraAttributes.on("change:included",function(){var extras;extras=_this.extraAttributes.where({included:true});return _this.requestInfo.set({view:extras.map(toPath).map(String)})});this.requestInfo.on("change",this.buildPermaLink);this.requestInfo.on("change:format",this.onChangeFormat,this);this.requestInfo.on("change:format",this.updateColTabText,this);this.requestInfo.on("change:format",this.updateFormatOptions,this);this.requestInfo.on("change:start",function(m,start){var $elem,newVal,_ref4;$elem=_this.$(".im-first-row");newVal=""+(start+1);if(newVal!==$elem.val()){$elem.val(newVal)}return(_ref4=_this.$slider)!=null?_ref4.slider("option","values",[start,m.get("end")-1]):void 0});this.requestInfo.on("change:end",function(m,end){var $elem,newVal,_ref4;$elem=_this.$(".im-last-row");newVal=""+end;if(newVal!==$elem.val()){$elem.val(newVal)}return(_ref4=_this.$slider)!=null?_ref4.slider("option","values",[m.get("start"),end-1]):void 0});this.requestInfo.on("change:format",function(m,format){return _this.$(".im-export-format").val(format)});this.exportedCols.on("add remove reset",this.initCols);this.exportedCols.on("add remove change:excluded",this.updateColTabText,this);this.exportedCols.on("add remove reset change:excluded",this.buildPermaLink);return this.requestInfo.on("change:start change:end",function(){var end,start,text,_ref4;_ref4=_this.requestInfo.toJSON(),start=_ref4.start,end=_ref4.end;text=start===0&&(!end||_this.count&&end===_this.count)?"All rows":""+(end-start)+" rows";return _this.$(".nav-tabs .im-export-rows").text(text)})};ExportDialogue.prototype.updateColTabText=function(){var n;n=this.exportedCols.filter(function(c){return!c.get("excluded")}).length;return this.$(".nav-tabs .im-export-columns").text(""+n+" columns")};ExportDialogue.prototype.onChangeIncludedNodes=function(coll){var n;n=coll.reduce(function(n,m){return n+(m.get("included")?1:0)},0);this.$(".nav-tabs .im-export-columns").text(""+n+" nodes");return this.buildPermaLink()};ExportDialogue.prototype.onChangeFormat=function(){var format,tab;format=this.requestInfo.get("format");tab=this.$(".nav-tabs .im-export-format");tab.text("Format: "+format.extension);this.$(".im-export-formats input").val([format.extension]);return this.$(".im-format-choice").each(function(){var inp;inp=$("input",this);return $(this).toggleClass("active",inp.attr("value")===format.extension)})};ExportDialogue.prototype.resetExportedColumns=function(e){var q;if(e!=null){e.stopPropagation()}if(e!=null){e.preventDefault()}this.$(".im-reset-cols").addClass("disabled");q=this.query;return this.exportedCols.reset(q.views.map(function(v){return{path:q.getPathInfo(v)}}))};ExportDialogue.prototype.readColumnHeaders=function(e){return this.requestInfo.set({columnHeaders:$(e.target).is(":checked")})};ExportDialogue.prototype.readBedChrPrefix=function(e){return this.requestInfo.set({useChrPrefix:$(e.target).is(":checked")})};ExportDialogue.prototype.events=function(){var enabled,events,format,moreEvents,name,val,x,_fn,_fn1,_fn2,_i,_j,_k,_len,_len1,_len2,_ref1,_ref2,_ref3,_ref4,_ref5,_this=this;events={"click .im-reset-cols":"resetExportedColumns","click .im-col-btns":"toggleColSelection","click .im-row-btns":"toggleRowSelection","click .close":"stop","click .im-cancel":"stop","click a.im-download":"export","change .im-first-row":"changeStart","change .im-last-row":"changeEnd","keyup .im-range-limit":"keyPressOnLimit","submit form":"dontReallySubmitForm","click .im-perma-link":"buildPermaLink","click .im-perma-link-share":"buildSharableLink","click .im-download-file .im-collapser":"toggleLinkViewer","click .im-download-file .im-copy":"copyUriToClipboard","click .im-export-destinations > li > a":"moveToSection",hidden:"modalHidden","change .im-column-headers":"readColumnHeaders","change .im-bed-chr-prefix":"readBedChrPrefix","change .im-fasta-extension":"readFastaExt","click .im-download-file .im-what-to-show button":"switchWhatToShow","keyup .im-format-choice":function(e){var input,key;input=$(e.target).find("input");key=e!=null?e.which:void 0;if(key===ENTER||key===SPACE){input.attr({checked:true});return _this.requestInfo.set({format:formatByExtension(input.val())})}}};_ref1=EXPORT_FORMATS.concat(BIO_FORMATS);_fn=function(format){var cb,key;key="click .im-format-"+format.extension;cb=function(){return _this.requestInfo.set({format:format})};return events[key]=cb};for(_i=0,_len=_ref1.length;_i<_len;_i++){format=_ref1[_i];_fn(format)}_ref2=["format","columns","rows","output","destination"];_fn1=function(x){var cb,key;key="click .nav-tabs .im-export-"+x;cb=function(e){var $a;$a=$(e.target);if($a.parent().is(".disabled")){e.preventDefault();return false}$a.data({target:_this.$(".tab-pane.im-export-"+x)});return Tab.call($a,"show")};return events[key]=cb};for(_j=0,_len1=_ref2.length;_j<_len1;_j++){x=_ref2[_j];_fn1(x)}_ref3=["no","gzip","zip"];_fn2=function(val){return events["click .im-"+val+"-compression"]=function(e){return _this.requestInfo.set({compress:val})}};for(_k=0,_len2=_ref3.length;_k<_len2;_k++){val=_ref3[_k];_fn2(val)}_ref4=intermine.options.ExternalExportDestinations;for(name in _ref4){enabled=_ref4[name];if(!enabled){continue}moreEvents=(_ref5=intermine["export"].external[name].events)!=null?_ref5.call(this):void 0;if(moreEvents!=null){_.extend(events,moreEvents)}}return events};ExportDialogue.prototype.readFastaExt=function(e){var ext;ext=this.$("input.im-fasta-extension").val();if(ext&&/\S/.test(ext)){return this.requestInfo.set({extension:ext})}else{return this.requestInfo.unset("extension")}};ExportDialogue.prototype.modalHidden=function(e){if(e!=null&&e.target===this.el){return this.remove()}};ExportDialogue.prototype.copyUriToClipboard=function(){var text;text=this.$("button.im-results-uri").is(".active")?this.$(".im-download").attr("href"):this.$(".well.im-query-xml").text();return window.prompt(intermine.messages.actions.CopyToClipBoard,text)};ExportDialogue.prototype.toggleLinkViewer=function(){this.$(".im-download-file .im-perma-link-content").toggleClass("hide show");return this.$(".im-download-file .im-collapser").toggleClass("icon-angle-right icon-angle-down")};ExportDialogue.prototype.moveToSection=function(e){var $this,destination;$this=$(e.currentTarget);Tab.call($this,"show");destination=$this.data("destination");return this.state.set({destination:destination})};ExportDialogue.prototype.buildSharableLink=function(e){return this.$(".im-perma-link-share-content").text("TODO")};switchActive=function(){var $this;$this=$(this);return $this.toggleClass("active",!$this.hasClass("active"))};ExportDialogue.prototype.switchWhatToShow=function(e){var btns,wells;if($(e.target).hasClass("active")){return false}btns=this.$(".im-what-to-show button");btns.each(switchActive);wells=this.$(".im-export-destination-options .im-download-file .well");return wells.each(switchActive)};ExportDialogue.prototype.buildPermaLink=function(e){var currentQuery,endpoint,isPrivate,noIds,prop,_i,_len,_ref1,_ref2,_results,_this=this;endpoint=this.getExportEndPoint();currentQuery=this.query;isPrivate=intermine.utils.requiresAuthentication(currentQuery);this.state.set({isPrivate:isPrivate});_ref1=[[true,"permalink"],[false,"url"]];_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){_ref2=_ref1[_i],noIds=_ref2[0],prop=_ref2[1];_results.push(function(noIds,prop){return _this.getExportParams(noIds).then(function(params){var uriIsTooLong,url;if(!isPrivate){delete params.token}url=endpoint+"?"+$.param(params,true);if(noIds){_this.state.set({permaquery:params.query})}_this.state.set(prop,url);uriIsTooLong=url.length>4e3;if(uriIsTooLong){return _this.getExportQuery(noIds).then(function(eq){var fetching,xml,_base,_ref3;xml=eq.toXML();fetching=(_ref3=(_base=_this.qids)[xml])!=null?_ref3:_base[xml]=eq.fetchQID();return fetching.done(function(qid){_this.$(".im-long-uri").show();delete params.query;params.qid=qid;url=endpoint+"?"+$.param(params,true);return _this.state.set(prop,url)})})}else{return _this.$(".im-long-uri").hide()}})}(noIds,prop))}return _results};ExportDialogue.prototype.onChangePrivacy=function(state,isPrivate){return this.$(".im-private-query").toggle(isPrivate)};ExportDialogue.prototype.onChangeURL=function(state,url){return this.$("a.im-download").attr({href:url})};ExportDialogue.prototype.onChangePermaquery=function(state,permaquery){return this.$(".well.im-query-xml").text(permaquery)};ExportDialogue.prototype.onChangePermalink=function(state,permalink){var $a;$a=$("<a>").text(permalink).attr({href:permalink});return this.$(".im-perma-link-content").empty().append($a)};ExportDialogue.prototype.onChangeDest=function(){var action,dest,destination,x,_ref1;destination=this.state.get("destination");_ref1=function(){var _i,_len,_ref1,_results;_ref1=["Dest",""];_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){x=_ref1[_i];_results.push(intermine.messages.actions[x+destination])}return _results}(),dest=_ref1[0],action=_ref1[1];this.$(".nav-tabs .im-export-destination .im-current").text(dest);this.$(".btn-primary.im-download").text(action);this.$(".im-export-destination-options > div").removeClass("active");return this.$(".im-"+destination.toLowerCase()).addClass("active")};ExportDialogue.prototype.dontReallySubmitForm=function(e){e.preventDefault();e.stopPropagation();return false};ExportDialogue.prototype.keyPressOnLimit=function(e){var input;input=$(e.target);switch(e.keyCode){case 38:input.val(1+parseInt(input.val(),10));break;case 40:input.val(parseInt(input.val(),10)-1)}return input.change()};ExportDialogue.prototype.changeStart=function(e){if(this.checkStartAndEnd()){return this.requestInfo.set({start:parseInt(this.$(".im-first-row").val(),10)-1})}};ExportDialogue.prototype.changeEnd=function(e){if(this.checkStartAndEnd()){return this.requestInfo.set({end:parseInt(this.$(".im-last-row").val(),10)})}};ExportDialogue.prototype.DIGITS=/^\s*\d+\s*$/;ExportDialogue.prototype.checkStartAndEnd=function(){var end,ok,start,valA,valB;start=this.$(".im-first-row");end=this.$(".im-last-row");valA=start.val();valB=end.val();ok=this.DIGITS.test(valA)&&parseInt(valA,10)>=1&&this.DIGITS.test(valB)&&parseInt(valB,10)<=this.count;if(this.DIGITS.test(valA)&&this.DIGITS.test(valB)){ok=ok&&parseInt(valA,10)<=parseInt(valB,10)}$(".im-row-selection").toggleClass("error",!ok);return ok};ignore=function(e){e.stopPropagation();return e.preventDefault()};ExportDialogue.prototype.getExportEndPoint=function(){var format,suffix;format=this.requestInfo.get("format");suffix=__indexOf.call(BIO_FORMATS,format)>=0?"/"+format.extension:"";return""+this.service.root+"query/results"+suffix};ExportDialogue.prototype["export"]=function(e){var dest;dest=this.state.get("destination");if(dest in intermine["export"].external){ignore(e);return intermine["export"].external[dest]["export"].call(this)}else{return true}};ExportDialogue.prototype.getExportQuery=function(noIdCons){var columns,f,newOrder,node,path,q,viewNodes,_i,_len,_ref1;if(noIdCons==null){noIdCons=false}q=this.query.clone();f=this.requestInfo.get("format");columns=function(){switch(f.extension){case"bed":case"gff3":return featuresToPaths(this.seqFeatures);case"fasta":return featuresToPaths(this.fastaFeatures);default:return this.exportedCols.filter(isntExcluded).map(toPath)}}.call(this);if(columns!=null){q.select(columns)}_ref1=this.query.views;for(_i=0,_len=_ref1.length;_i<_len;_i++){path=_ref1[_i];if(!!q.isOuterJoined(path)){continue}node=q.getPathInfo(path).getParent();if(!isImplicitlyConstrained(q,node)){q.addConstraint({path:node.append("id"),op:"IS NOT NULL"})}}newOrder=__indexOf.call(BIO_FORMATS,f)>=0?[]:(viewNodes=q.getViewNodes(),_.filter(q.sortOrder,function(_arg){var parent,path;path=_arg.path;parent=q.getPathInfo(path).getParent();return _.any(viewNodes,function(node){return parent.equals(node)})}));q.orderBy(newOrder);if(noIdCons){return getPermaQuery(q)}else{return defer(q)}};ExportDialogue.prototype.getExportParams=function(noIdCons){var dummy,end,params,start,_i,_len,_ref1,_ref2,_ref3;if(noIdCons==null){noIdCons=false}params=this.requestInfo.toJSON();params.token=this.service.token;params.format=this.getFormatParam();_ref1=this.dummyParams;for(_i=0,_len=_ref1.length;_i<_len;_i++){dummy=_ref1[_i];delete params[dummy]}if(params.compress==="no"){delete params.compress}if((_ref2=params.format)!=="gff3"&&_ref2!=="fasta"){delete params.view}if(this.requestInfo.get("columnHeaders")&&((_ref3=params.format)==="tab"||_ref3==="csv")){params.columnheaders="1"}start=params.start=this.requestInfo.get("start");end=this.requestInfo.get("end");if(end!==this.count){params.size=end-start}return this.getExportQuery(noIdCons).then(function(q){params.query=q.toXML();return params})};ExportDialogue.prototype.getExportURI=function(noIdCons){var _this=this;if(noIdCons==null){noIdCons=false}return this.getExportQuery(noIdCons).then(function(q){var uri;
uri=q.getExportURI(_this.getFormatParam());uri+=_this.getExtraOptions();return uri})};ExportDialogue.prototype.getFormatParam=function(){var format;format=this.requestInfo.get("format");return format.param||format.extension};ExportDialogue.prototype.getExtraOptions=function(){var end,ret,start;ret="";if(this.requestInfo.get("columnHeaders")){ret+="&columnheaders=1"}if(!this.requestInfo.get("allRows")){start=this.requestInfo.get("start");end=this.requestInfo.get("end");ret+="&start="+start;if(end!==this.count){ret+="&size="+(end-start)}}return ret};ExportDialogue.prototype.toggleColSelection=function(e){this.requestInfo.set({allCols:!this.requestInfo.get("allCols")});return false};ExportDialogue.prototype.toggleRowSelection=function(e){this.requestInfo.set({allRows:!this.requestInfo.get("allRows")});return false};ExportDialogue.prototype.show=function(){return this.$el.modal("show")};ExportDialogue.prototype.stop=function(){return this.$el.modal("hide")};ExportDialogue.prototype.remove=function(){var obj,x,_i,_len,_ref1;for(_i=0,_len=DELENDA.length;_i<_len;_i++){x=DELENDA[_i];obj=this[x];if(obj!=null){if(typeof obj.close==="function"){obj.close()}}if(obj!=null){if(typeof obj.destroy==="function"){obj.destroy()}}if(obj!=null){obj.off()}delete this[x]}delete this.query;if((_ref1=this.$slider)!=null){_ref1.slider("destroy")}delete this.$slider;return ExportDialogue.__super__.remove.call(this)};ExportDialogue.prototype.isSpreadsheet=function(){var ColumnHeaders,SpreadsheetOptions,_ref1;_ref1=intermine.messages.actions,ColumnHeaders=_ref1.ColumnHeaders,SpreadsheetOptions=_ref1.SpreadsheetOptions;this.$(".im-output-options").append("<h2>"+SpreadsheetOptions+'</h2>\n<div>\n  <label>\n    <span class="span4">'+ColumnHeaders+'</span>\n    <input type="checkbox" class="span8 im-column-headers">\n  </label>\n</div>');return this.$(".im-column-headers").attr({checked:!!this.requestInfo.get("columnHeaders")})};ExportDialogue.prototype.isBED=function(){var BEDOptions,ChrPrefix,chrPref,_ref1;_ref1=intermine.messages.actions,BEDOptions=_ref1.BEDOptions,ChrPrefix=_ref1.ChrPrefix;chrPref=$("<h3>"+BEDOptions+'</h3>\n<div>\n  <label>\n    <span class="span4">'+ChrPrefix+'</span>\n    <input type="checkbox" class="im-bed-chr-prefix span8">\n  </label>\n</div>');chrPref.appendTo(this.$(".im-output-options"));chrPref.find("input").attr({checked:!!this.requestInfo.get("useChrPrefix")});return this.addSeqFeatureSelector()};ExportDialogue.prototype.isGFF3=function(){this.addSeqFeatureSelector();this.$(".im-output-options").append("<h3>"+intermine.messages.actions.Gff3Options+"</h3>");return this.addExtraColumnsSelector()};ExportDialogue.prototype.isFASTA=function(){this.addFastaFeatureSelector();this.addFastaExtensionInput();return this.addExtraColumnsSelector()};ExportDialogue.prototype.updateFormatOptions=function(){var format,opts,requestInfo,_name,_ref1;opts=this.$(".im-output-options").empty();requestInfo=this.requestInfo;format=requestInfo.get("format");if(__indexOf.call(BIO_FORMATS,format)>=0){this.$(".im-col-options").hide();this.$(".im-col-options-bio").show();this.$(".tab-pane.im-export-rows").removeClass("active");this.$(".nav-tabs .im-export-rows").text("All rows").parent().removeClass("active").addClass("disabled");this.requestInfo.set({start:0,end:this.count})}else{this.$(".im-col-options").show();this.$(".im-col-options-bio").hide();this.$(".nav-tabs .im-export-rows").parent().removeClass("disabled")}if((_ref1=format.extension)==="tsv"||_ref1==="csv"){return this.isSpreadsheet()}else{return typeof this[_name="is"+format.extension.toUpperCase()]==="function"?this[_name]():void 0}};ExportDialogue.prototype.addFastaExtensionInput=function(){var FastaExtension,FastaOptions,extOpt,_ref1;_ref1=intermine.messages.actions,FastaOptions=_ref1.FastaOptions,FastaExtension=_ref1.FastaExtension;extOpt=$("<h3>"+FastaOptions+'</h3>\n<div>\n  <label>\n    <span class="span4">'+FastaExtension+'</span>\n    <input type="text"\n           placeholder="5kbp"\n           class="span8 im-fasta-extension">\n  </label>\n</div>');extOpt.appendTo(this.$(".im-output-options"));return extOpt.find("input").val(this.requestInfo.get("extension"))};ExportDialogue.prototype.initExtraAttributes=function(){var coll,path,_i,_len,_ref1,_results;coll=this.extraAttributes.close();_ref1=this.query.views;_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){path=_ref1[_i];if(!this.query.canHaveMultipleValues(path)){_results.push(coll.add({path:this.query.getPathInfo(path),included:false}))}}return _results};ExportDialogue.prototype.addExtraColumnsSelector=function(){var row;this.initExtraAttributes();row=new intermine.actions.ExportColumnOptions({collection:this.extraAttributes,message:intermine.messages.actions.ExtraAttributes});return this.$(".im-output-options").append(row.render().$el)};ExportDialogue.prototype.initFastaFeatures=function(){var included,node,_i,_len,_ref1,_results;this.fastaFeatures.close();included=true;_ref1=this.query.getViewNodes();_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){node=_ref1[_i];if(node.isa("SequenceFeature")||node.isa("Protein")){this.fastaFeatures.add({path:node,included:included});_results.push(included=false)}else{_results.push(void 0)}}return _results};ExportDialogue.prototype.addFastaFeatureSelector=function(){var row;this.initFastaFeatures();row=new intermine.actions.ExportColumnOptions({collection:this.fastaFeatures,message:intermine.messages.actions.FastaFeatures});row.isValidCount=function(c){return c===1};return this.$(".im-col-options-bio").html(row.render().$el)};ExportDialogue.prototype.initSeqFeatures=function(){var node,_i,_len,_ref1,_results;this.seqFeatures.close();_ref1=this.query.getViewNodes();_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){node=_ref1[_i];if(node.isa("SequenceFeature")){_results.push(this.seqFeatures.add({path:node,included:true}))}}return _results};ExportDialogue.prototype.addSeqFeatureSelector=function(){var row;this.initSeqFeatures();row=new intermine.actions.ExportColumnOptions({collection:this.seqFeatures,message:intermine.messages.actions.IncludedFeatures});row.isValidCount=function(c){return c>0};return this.$(".im-col-options-bio").html(row.render().$el)};ExportDialogue.prototype.initColumnOptions=function(){var node,nodes;nodes=function(){var _i,_len,_ref1,_results;_ref1=this.query.getQueryNodes();_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){node=_ref1[_i];_results.push({node:node})}return _results}.call(this);return this.possibleColumns=new intermine.columns.models.PossibleColumns(nodes,{exported:this.exportedCols})};ExportDialogue.prototype.initCols=function(){var cols,maybes,_ref1,_this=this;this.$("ul.im-cols li").remove();cols=this.$(".im-exported-cols");this.exportedCols.each(function(col){var exported;exported=new intermine.columns.views.ExportColumnHeader({model:col});return exported.render().$el.appendTo(cols)});cols.sortable({items:"li",axis:"y",placeholder:"im-resorting-placeholder im-exported-col",forcePlaceholderSize:true,update:function(e,ui){_this.$(".im-reset-cols").removeClass("disabled");return _this.exportedCols.reset(cols.find("li").map(function(){return $(this).data("model")}).get())}});this.initColumnOptions();maybes=this.$(".im-can-be-exported-cols");if((_ref1=this.maybeView)!=null){_ref1.remove()}this.maybeView=new intermine.columns.views.PossibleColumns({collection:this.possibleColumns});return maybes.append(this.maybeView.render().el)};ExportDialogue.prototype.warnOfOuterJoinedCollections=function(){var q,_this=this;q=this.query;if(_.any(q.joins,function(s,p){return s==="OUTER"&&q.canHaveMultipleValues(p)})){return this.$(".im-row-selection").append('<div class="alert alert-warning">\n    <button class="close" data-dismiss="alert"></button>\n    <strong>NB</strong>\n    '+intermine.messages.actions.OuterJoinWarning+"\n</div>")}};formatToEl=function(format){return'<div class="im-format-choice">\n  <label class="radio">\n    <input type="radio" class="im-format-'+format.extension+'"\n          name="im-export-format" value="'+format.extension+'">\n    <i class="'+intermine.icons[format.extension]+'"></i>\n    '+format.name+"\n  </label>\n</div>"};ExportDialogue.prototype.initFormats=function(){var $btn,$formats,current,ext,format,i,_i,_len,_this=this;$formats=this.$(".tab-pane.im-export-format .im-export-formats");current=this.requestInfo.get("format");for(i=_i=0,_len=EXPORT_FORMATS.length;_i<_len;i=++_i){format=EXPORT_FORMATS[i];$btn=$(formatToEl(format));$btn[0].tabIndex=i;$formats.append($btn)}this.service.fetchModel().done(function(model){var isSuitableForThisQuery,viewNodeTypes,_j,_len1,_results;if(intermine.utils.modelIsBio(model)){viewNodeTypes=_this.query.getViewNodes().map(function(n){return n.getType()});isSuitableForThisQuery=anyNodeIsSuitable(model,viewNodeTypes);_results=[];for(i=_j=0,_len1=BIO_FORMATS.length;_j<_len1;i=++_j){format=BIO_FORMATS[i];if(!isSuitableForThisQuery(format.types)){continue}$btn=$(formatToEl(format));$btn[0].tabIndex=i+EXPORT_FORMATS.length;_results.push($formats.append($btn))}return _results}});ext=this.requestInfo.get("format").extension;return $formats.find("input").val([ext])};ExportDialogue.prototype.render=function(){this.$el.append(intermine.snippets.actions.DownloadDialogue());this.initFormats();this.initCols();this.makeSlider();this.updateFormatOptions();this.warnOfOuterJoinedCollections();this.addExternalExports();this.state.trigger("change:destination");this.requestInfo.trigger("change");this.requestInfo.trigger("change:format");return this};ExportDialogue.prototype.addExternalExports=function(){var $navs,$options,action,enabled,name,_base,_ref1,_results;$options=this.$(".im-export-destination-options");$navs=this.$(".im-export-destinations.nav");_ref1=intermine.options.ExternalExportDestinations;_results=[];for(name in _ref1){enabled=_ref1[name];if(!enabled){continue}action="SendTo"+name;$navs.append('<li>\n  <a data-destination="'+name+'">\n    '+intermine.messages.actions[action]+"\n  </a>\n</li>");_results.push($options.append(typeof(_base=intermine["export"].snippets)[name]==="function"?_base[name](this.requestInfo.toJSON()):void 0))}return _results};ExportDialogue.prototype.makeSlider=function(){var _ref1,_this=this;if((_ref1=this.$slider)!=null){_ref1.slider("destroy")}this.$slider=null;return this.query.count(function(c){_this.count=c;_this.requestInfo.set({end:c});return _this.$slider=_this.$(".im-row-range-slider").slider({range:true,min:0,max:c-1,values:[0,c-1],step:1,slide:function(e,ui){return _this.requestInfo.set({start:ui.values[0],end:ui.values[1]+1})}})})};return ExportDialogue}(Backbone.View);return scope("intermine.query.export",{ExportDialogue:ExportDialogue})}));(function(){var changeGalaxyURI,defaultGalaxy,doGalaxy,forgetGalaxy,getResultClass,saveGalaxyPreference,sendToGalaxy,yielding;yielding=function(x){return $.Deferred(function(){return this.resolve(x)}).promise()};getResultClass=function(q){return $.when(q).then(function(query){var commonType,model,node,viewNodes;viewNodes=query.getViewNodes();model=query.model;if(viewNodes.length===1){return model.getPathInfo(viewNodes[0].getType().name).getDisplayName()}else if(commonType=model.findCommonType(function(){var _i,_len,_results;_results=[];for(_i=0,_len=viewNodes.length;_i<_len;_i++){node=viewNodes[_i];_results.push(node.getType())}return _results}())){return model.getPathInfo(commonType).getDisplayName()}else if(model.name){return yielding(model.name)}else{return yielding("")}})};saveGalaxyPreference=function(uri){return this.query.service.whoami(function(user){if(user.hasPreferences&&user.preferences["galaxy-url"]!==uri){return user.setPreference("galaxy-url",uri)}})};doGalaxy=function(galaxy){var c,endpoint,format,qLists,query,uri,_this=this;uri=/tool_runner/.test(galaxy)?galaxy:""+galaxy+"/tool_runner";query=this.getExportQuery();endpoint=this.getExportEndPoint();format=this.requestInfo.get("format");qLists=function(){var _i,_len,_ref,_results;_ref=this.query;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){c=_ref[_i];if(c.op==="IN"){_results.push(c.value)}}return _results}.call(this);return $.when(intermine.utils.getOrganisms(query),getResultClass(query)).then(function(orgs,type){var brand,name,params,prefix,suffix;prefix=orgs.length===1?orgs[0]+" ":"";brand=intermine.options.brand[_this.service.root.replace(/\/[^\.]+$/,"")];suffix=brand!=null?" from "+brand:"";name=prefix+(""+type+" data")+suffix;params={tool_id:intermine.options.GalaxyTool,organism:orgs.join(", "),URL:endpoint,URL_method:"post",name:name,data_type:format.extension==="tsv"?"tabular":format.extension,info:""+query.root+" data from "+_this.service.root+".\nUploaded from "+window.location.toString().replace(/\?.*/,"")+".\n"+(qLists.length?" source: "+lists.join(", "):"")+"\n"+(orgs.length?" organisms: "+orgs.join(", "):"")};return _this.getExportParams().then(function(ep){var k,v;for(k in ep){v=ep[k];params[k]=v}return intermine.utils.openWindowWithPost(uri,"Upload",params)})})};changeGalaxyURI=function(e){return this.requestInfo.set({galaxy:this.$(".im-galaxy-uri").val()})};defaultGalaxy=function(){var _ref;return(_ref=intermine.options.GalaxyCurrent)!=null?_ref:intermine.options.GalaxyMain};forgetGalaxy=function(e){var _this=this;this.service.whoami().then(function(user){return user.clearPreference("galaxy-url")}).done(function(){return _this.requestInfo.set({galaxy:defaultGalaxy()})});return false};sendToGalaxy=function(){var uri;uri=this.requestInfo.get("galaxy");doGalaxy.call(this,uri);if(this.$(".im-galaxy-save-url").is(":checked")&&uri!==intermine.options.GalaxyMain){return saveGalaxyPreference.call(this,uri)}};return scope("intermine.export.external.Galaxy",{"export":sendToGalaxy,init:function(){var _this=this;this.requestInfo.set({galaxy:defaultGalaxy()});this.dummyParams.push("galaxy");this.service.whoami(function(user){var myGalaxy;if(user.hasPreferences&&(myGalaxy=user.preferences["galaxy-url"])){return _this.requestInfo.set({galaxy:myGalaxy})}});return this.requestInfo.on("change:galaxy",function(m,uri){var currentVal,input;input=_this.$("input.im-galaxy-uri");currentVal=input.val();if(currentVal!==uri){input.val(uri)}return _this.$(".im-galaxy-save-url").attr({disabled:uri===intermine.options.GalaxyMain})})},events:function(){var _this=this;return{"click .im-forget-galaxy":function(e){return forgetGalaxy.call(_this,e)},"change .im-galaxy-uri":function(e){return changeGalaxyURI.call(_this,e)},"click .im-send-to-galaxy":function(e){return sendToGalaxy.call(_this,e)}}}})})();(function(){var sendToGenomeSpace;sendToGenomeSpace=function(){var fileName,format,genomeSpaceURL,gsFileName,qs,uploadUrl,url,win,_ref,_this=this;genomeSpaceURL=intermine.options.GenomeSpaceUpload;uploadUrl=this.state.get("url");_ref=this.requestInfo.toJSON(),format=_ref.format,gsFileName=_ref.gsFileName;fileName=""+gsFileName+"."+format.extension;qs=$.param({uploadUrl:uploadUrl,fileName:fileName});url=""+genomeSpaceURL+"?"+qs;win=window.open(url);win.setCallbackOnGSUploadComplete=function(savePath){return _this.stop()};win.setCallbackOnGSUploadError=function(savePath){_this.trigger("export:error","genomespace");return _this.stop()};return win.focus()};return scope("intermine.export.external.Genomespace",{init:function(){var gsFileName,onChange,s,view;view=this;onChange=function(){var format,gsFileName,_ref;_ref=view.requestInfo.toJSON(),format=_ref.format,gsFileName=_ref.gsFileName;view.$(".im-genomespace .im-format").text("."+format.extension);return view.$(".im-genomespace-filename").val(gsFileName)};this.dummyParams.push("gsFileName");this.requestInfo.on("change",onChange);s=this.service.name||this.service.root.replace(/^https?:\/\//,"").replace(/\/.*/,"");gsFileName=""+this.query.root+" results from "+s+" "+new Date;return this.requestInfo.set({gsFileName:gsFileName})},"export":sendToGenomeSpace,events:function(){var _this=this;return{"click .im-send-to-genomespace":function(e){return sendToGenomeSpace.call(_this,e)},"change .im-genomespace-filename":function(e){return _this.requestInfo.set({gsFileName:$(e.target).val()})}}}})})();scope("intermine.export.snippets",{Galaxy:_.template('<div class="im-galaxy">\n  <form class="im-galaxy form form-compact well">\n    <label>\n      '+intermine.messages.actions.GalaxyURILabel+'\n      <input class="im-galaxy-uri" \n            type="text"\n            value="<%- galaxy %>"\n    </label>\n    <label>\n      '+intermine.messages.actions.SaveGalaxyURL+'\n      <input type="checkbox" disabled checked class="im-galaxy-save-url">\n    </label>\n  </form>\n</div>'),Genomespace:function(){return'<div class="im-genomespace">\n  <div class="well">\n    <label>File Name</label>\n    <div class="input-append">\n      <input class="im-genomespace-filename input" style="width: 40em" type="text">\n      <span class="add-on im-format"></span>\n    </div>\n  </div>\n</div>'}});scope("intermine.snippets.facets",{OnlyOne:_.template('<div class="alert alert-info im-all-same">\n    All <%= count %> values are the same: <strong><%= item %></strong>\n</div>')});(function(){var BooleanFacet,ColumnSummary,FACET_TEMPLATE,FACET_TITLE,FacetRow,FacetView,FrequencyFacet,HistoFacet,Int,MORE_FACETS_HTML,NormalCurve,NumericFacet,NumericRange,PieFacet,SUMMARY_FORMATS,numeric,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8;NormalCurve=function(mean,stdev){return function(x){var a;a=x-mean;return Math.exp(-(a*a)/(2*stdev*stdev))/(Math.sqrt(2*Math.PI)*stdev)}};Int=function(x){return parseInt(x,10)};numeric=function(x){return+x};MORE_FACETS_HTML='<i class="icon-plus-sign pull-right" title="Showing top ten. Click to see all values"></i>';FACET_TITLE='<dt>\n  <i class="icon-chevron-right"></i>\n  <span class="im-facet-title"></span>\n  &nbsp;<span class="im-facet-count"></span>\n</dt>';FACET_TEMPLATE=_.template('<dd>\n    <a href=#>\n        <b class="im-facet-count pull-right">\n            (<%= count %>)\n        </b>\n        <%= item %>\n    </a>\n</dd>');SUMMARY_FORMATS={tab:"tsv",csv:"csv",xml:"xml",json:"json"};ColumnSummary=function(_super){__extends(ColumnSummary,_super);function ColumnSummary(){this.render=__bind(this.render,this);_ref=ColumnSummary.__super__.constructor.apply(this,arguments);return _ref}ColumnSummary.prototype.tagName="div";ColumnSummary.prototype.className="im-column-summary";ColumnSummary.prototype.initialize=function(query,facet){var fp,_this=this;this.query=query;this.state=new Backbone.Model({open:false});if(facet.path){return this.facet=facet}else{fp=this.query.getPathInfo(facet);return this.facet={path:fp,title:fp.getDisplayName().then(function(name){return name.replace(/^[^>]+>\s*/,"")}),ignoreTitle:true}}};ColumnSummary.prototype.render=function(){var attrType,clazz,initialLimit,_this=this;attrType=this.facet.path.getType();clazz=__indexOf.call(intermine.Model.NUMERIC_TYPES,attrType)>=0?NumericFacet:FrequencyFacet;initialLimit=intermine.options.INITIAL_SUMMARY_ROWS;this.fac=new clazz(this.query,this.facet,initialLimit,this.noTitle);this.$el.append(this.fac.el);this.fac.render();this.fac.on("ready",function(){return _this.trigger("ready",_this)});this.fac.on("toggled",function(){return _this.state.set({open:!_this.state.get("open")})});this.fac.on("closed",function(){return _this.state.set({open:false})});this.trigger("rendered",this);return this};ColumnSummary.prototype.toggle=function(){var _ref1;return(_ref1=this.fac)!=null?_ref1.toggle():void 0};ColumnSummary.prototype.close=function(){var _ref1;return(_ref1=this.fac)!=null?_ref1.close():void 0};ColumnSummary.prototype.remove=function(){var _ref1;if((_ref1=this.fac)!=null){_ref1.remove()}return ColumnSummary.__super__.remove.call(this)};return ColumnSummary}(Backbone.View);FacetView=function(_super){__extends(FacetView,_super);function FacetView(){this.render=__bind(this.render,this);_ref1=FacetView.__super__.constructor.apply(this,arguments);return _ref1}FacetView.prototype.tagName="dl";FacetView.prototype.initialize=function(query,facet,limit,noTitle){this.query=query;this.facet=facet;this.limit=limit;this.noTitle=noTitle;this.query.on("change:constraints",this.render);return this.query.on("filter:summary",this.render)};FacetView.prototype.events=function(){return{"click dt":"toggle"}};FacetView.prototype.toggle=function(){this.$(".im-facet").slideToggle();this.$("dt i").first().toggleClass("icon-chevron-right icon-chevron-down");return this.trigger("toggled",this)};FacetView.prototype.close=function(){this.$(".im-facet").slideUp();this.$("dt i").removeClass("icon-chevron-down").addClass("icon-chevron-right");return this.trigger("close",this)};FacetView.prototype.render=function(){var _this=this;if(!this.noTitle){this.$el.prepend(FACET_TITLE);$.when(this.facet.title).then(function(title){return _this.$(".im-facet-title").text(title)})}return this};return FacetView}(Backbone.View);FrequencyFacet=function(_super){__extends(FrequencyFacet,_super);function FrequencyFacet(){this.addItem=__bind(this.addItem,this);this.showMore=__bind(this.showMore,this);_ref2=FrequencyFacet.__super__.constructor.apply(this,arguments);return _ref2}FrequencyFacet.prototype.showMore=function(e){var areVisible,got,more,_this=this;more=$(e.target);got=this.$("dd").length();areVisible=this.$("dd").first().is(":visible");e.stopPropagation();e.preventDefault();return this.query.summarise(this.facet.path,function(items){var item,_i,_len,_ref3;_ref3=items.slice(got);for(_i=0,_len=_ref3.length;_i<_len;_i++){item=_ref3[_i];_this.addItem(item).toggle(areVisible)}return more.tooltip("hide").remove()})};FrequencyFacet.prototype.render=function(filterTerm){var $progress,getSummary,limit,placement,_this=this;if(filterTerm==null){filterTerm=""}if(this.rendering){return}this.filterTerm=filterTerm;this.rendering=true;this.$el.empty();FrequencyFacet.__super__.render.call(this);$progress=$('<div class="progress progress-info progress-striped active">\n    <div class="bar" style="width:100%"></div>\n</div>');$progress.appendTo(this.el);getSummary=this.query.filterSummary(this.facet.path,filterTerm,this.limit);getSummary.fail(this.remove);limit=this.limit;placement="left";return getSummary.done(function(results,stats,count){var Vizualization,hasMore,summaryView;_this.query.trigger("got:summary:total",_this.facet.path,stats.uniqueValues,results.length,count);$progress.remove();_this.$(".im-facet-count").text("("+stats.uniqueValues+")");hasMore=results.length<limit?false:stats.uniqueValues>limit;if(hasMore){$(MORE_FACETS_HTML).appendTo(_this.$dt).tooltip({placement:placement}).click(_this.showMore)}summaryView=stats.uniqueValues<=1?(_this.$el.empty(),stats.uniqueValues?intermine.snippets.facets.OnlyOne(results[0]):"No results"):(Vizualization=_this.getVizualization(stats),new Vizualization(_this.query,_this.facet,results,hasMore,filterTerm));_this.$el.append(summaryView.el?summaryView.el:summaryView);if(typeof summaryView.render==="function"){summaryView.render()}_this.rendering=false;return _this.trigger("ready",_this)})};FrequencyFacet.prototype.getVizualization=function(stats){var _ref3;if(!this.query.canHaveMultipleValues(this.facet.path)){if(_ref3=this.query.getType(this.facet.path),__indexOf.call(intermine.Model.BOOLEAN_TYPES,_ref3)>=0){return BooleanFacet}else if(stats.uniqueValues<=intermine.options.MAX_PIE_SLICES){return PieFacet}}return HistoFacet};FrequencyFacet.prototype.addItem=function(item){var $dd,_this=this;$dd=$(FACET_TEMPLATE(item)).appendTo(this.el);$dd.click(function(){return _this.query.addConstraint({title:_this.facet.title,path:_this.facet.path,op:"=",value:item.item})});return $dd};return FrequencyFacet}(FacetView);NumericRange=function(_super){__extends(NumericRange,_super);function NumericRange(){_ref3=NumericRange.__super__.constructor.apply(this,arguments);return _ref3}NumericRange.prototype._defaults={};NumericRange.prototype.setLimits=function(limits){return this._defaults=limits};NumericRange.prototype.get=function(prop){var ret;ret=NumericRange.__super__.get.call(this,prop);if(ret!=null){return ret}else if(prop in this._defaults){return this._defaults[prop]}else{return null}};NumericRange.prototype.toJSON=function(){return _.extend({},this._defaults,this.attributes)};NumericRange.prototype.nullify=function(){var evt,_i,_len,_ref4,_results;this.set({min:null,max:null});this.nulled=true;_ref4=["change:min","change:max","change"];_results=[];for(_i=0,_len=_ref4.length;_i<_len;_i++){evt=_ref4[_i];_results.push(this.trigger(evt,this))}return _results};NumericRange.prototype.set=function(name,value){var meth;this.nulled=false;if(_.isString(name)&&name in this._defaults){meth=name==="min"?"max":"min";return NumericRange.__super__.set.call(this,name,Math[meth](this._defaults[name],value))}else{return NumericRange.__super__.set.apply(this,arguments)}};NumericRange.prototype.isNotAll=function(){var max,min,_ref4;if(this.nulled){return true}_ref4=this.toJSON(),min=_ref4.min,max=_ref4.max;return min!=null&&min!==this._defaults.min||max!=null&&max!==this._defaults.max};return NumericRange}(Backbone.Model);NumericFacet=function(_super){var fracWithinRange,getPartialCount,inty,sumCounts;__extends(NumericFacet,_super);function NumericFacet(){this.drawSelection=__bind(this.drawSelection,this);this.drawChart=__bind(this.drawChart,this);this.drawSlider=__bind(this.drawSlider,this);this.drawStats=__bind(this.drawStats,this);this.handleSummary=__bind(this.handleSummary,this);this.valForX=__bind(this.valForX,this);this.xForVal=__bind(this.xForVal,this);_ref4=NumericFacet.__super__.constructor.apply(this,arguments);return _ref4}NumericFacet.prototype.initialize=function(){var idx,prop,_fn,_ref5,_this=this;NumericFacet.__super__.initialize.apply(this,arguments);this.range=new NumericRange;this.range.on("change",function(){var width,x,_ref5;if(_this.shouldDrawBox()){if(_this.range.nulled){return _this.drawSelection(0,25)}else{x=_this.xForVal(_this.range.get("min"));width=_this.xForVal(_this.range.get("max"))-x;return _this.drawSelection(x,width)}}else{if((_ref5=_this.selection)!=null){_ref5.remove()}return _this.selection=null}});this.range.on("change",function(){var _ref5;if(_this.range.isNotAll()){return _this.drawEstCount()}else{if((_ref5=_this.estCount)!=null){_ref5.remove()}return _this.estCount=null}});this.range.on("reset",function(){var max,min,prop,val,_ref5,_ref6,_ref7,_results;_ref5=_this.range.toJSON(),min=_ref5.min,max=_ref5.max;if((_ref6=_this.$slider)!=null){_ref6.slider("option","values",[min,max])}_ref7={min:min,max:max};_results=[];for(prop in _ref7){val=_ref7[prop];_results.push(_this.$("input.im-range-"+prop).val(""+val))}return _results});_ref5={min:0,max:1};_fn=function(prop,idx){return _this.range.on("change:"+prop,function(m,val){var _ref6,_ref7;if(m.nulled){_this.$("input.im-range-"+prop).val("null")}if(val==null){return}val=_this.round(val);_this.$("input.im-range-"+prop).val(""+val);if(((_ref6=_this.$slider)!=null?_ref6.slider("values",idx):void 0)!==val){return(_ref7=_this.$slider)!=null?_ref7.slider("values",idx,val):void 0}})};for(prop in _ref5){idx=_ref5[prop];_fn(prop,idx)}return this.range.on("change",function(){var changed;changed=_this.range.isNotAll();return _this.$(".btn").toggleClass("disabled",!changed)})};NumericFacet.prototype.events=function(){return _.extend(NumericFacet.__super__.events.apply(this,arguments),{click:function(e){return e.stopPropagation()},"keyup input.im-range-val":"incRangeVal","change input.im-range-val":"setRangeVal","click .btn-primary":"changeConstraints","click .btn-cancel":"clearRange"})};NumericFacet.prototype.clearRange=function(){var _ref5,_ref6;if((_ref5=this.range)!=null){_ref5.clear()}return(_ref6=this.range)!=null?_ref6.trigger("reset"):void 0};NumericFacet.prototype.changeConstraints=function(e){var fpath,newConstraints;e.preventDefault();e.stopPropagation();fpath=this.facet.path.toString();this.query.constraints=_(this.query.constraints).filter(function(c){return c.path!==fpath});if(this.range.nulled){newConstraints=[{path:this.facet.path,op:"IS NULL"}]}else{newConstraints=[{path:this.facet.path,op:">=",value:this.range.get("min")},{path:this.facet.path,op:"<=",value:this.range.get("max")}]}return this.query.addConstraints(newConstraints)};NumericFacet.prototype.className="im-numeric-facet";NumericFacet.prototype.chartHeight=70;NumericFacet.prototype.leftMargin=25;NumericFacet.prototype.xForVal=function(val){var conversionRate;if(val===this.min){return this.leftMargin}if(val===this.max){return this.w}conversionRate=(this.w-this.leftMargin)/(this.max-this.min);return this.leftMargin+conversionRate*(val-this.min)};NumericFacet.prototype.valForX=function(x){var conversionRate;if(x<=this.leftMargin){return this.min}if(x>=this.w){return this.max}conversionRate=(this.max-this.min)/(this.w-this.leftMargin);return this.min+conversionRate*(x-this.leftMargin)};NumericFacet.prototype.shouldDrawBox=function(){return this.range.isNotAll()};NumericFacet.prototype.render=function(){var promise,_this=this;NumericFacet.__super__.render.call(this);this.container=this.make("div",{"class":"facet-content im-facet"});this.$el.append(this.container);this.canvas=this.make("div");$(this.canvas).mouseout(function(){return _this._selecting_paths_=false});$(this.container).append(this.canvas);this.throbber=$('<div class="progress progress-info progress-striped active">\n    <div class="bar" style="width:100%"></div>\n</div>');this.throbber.appendTo(this.el);promise=this.query.summarise(this.facet.path,this.handleSummary);promise.fail(this.remove);promise.done(function(){return _this.trigger("ready",_this)});return this};NumericFacet.prototype.remove=function(){var _ref5,_ref6;if((_ref5=this.$slider)!=null){_ref5.slider("destroy")}delete this.$slider;if((_ref6=this.range)!=null){_ref6.off()}delete this.range;return NumericFacet.__super__.remove.call(this)};inty=function(type){return type==="int"||type==="Integer"||type==="long"||type==="Long"};NumericFacet.prototype.handleSummary=function(items,stats){var hasMore,hf,step,summary;this.throbber.remove();summary=items[0];this.w=this.$el.closest(":visible").width()*.95;if(summary.item!=null){if(items.length>1){hasMore=items.length<this.limit?false:stats.uniqueValues>this.limit;hf=new HistoFacet(this.query,this.facet,items,hasMore,"");this.$el.append(hf.el);return hf.render()}else{return this.$el.empty().append(intermine.snippets.facets.OnlyOne(summary))}}this.mean=parseFloat(summary.average);this.dev=parseFloat(summary.stdev);this.range.setLimits(summary);this.max=summary.max;this.min=summary.min;this.step=step=inty(this.query.getType(this.facet.path))?1:Math.abs((this.max-this.min)/100);this.round=function(x){if(step===1){return Math.round(x)}else{return x}};if(summary.count!=null){this.stepWidth=(this.w-(this.leftMargin+1))/items[0].buckets;this.drawChart(items)}else{this.drawCurve()}this.drawStats();return this.drawSlider()};NumericFacet.prototype.drawStats=function(){return $(this.container).append('<table class="table table-condensed">\n    <thead>\n        <tr>\n            <th>Min</th>\n            <th>Max</th>\n            <th>Mean</th>\n            <th>Standard Deviation</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td>'+this.min+"</td>\n            <td>"+this.max+"</td>\n            <td>"+this.mean.toFixed(5)+"</td>\n            <td>"+this.dev.toFixed(5)+"</td>\n        </tr>\n    </tbody>\n</table>")};NumericFacet.prototype.setRangeVal=function(e){var $input,current,next,prop,_ref5;$input=$(e.target);prop=$input.data("var");current=(_ref5=this.range.get(prop))!=null?_ref5:this[prop];next=numeric($input.val());if(current!==next){return this.range.set(prop,next)}};NumericFacet.prototype.incRangeVal=function(e){var $input,current,next,prop,_ref5;$input=$(e.target);prop=$input.data("var");current=next=(_ref5=this.range.get(prop))!=null?_ref5:this[prop];switch(e.keyCode){case 40:next-=this.step;break;case 38:next+=this.step}if(next!==current){return this.range.set(prop,next)}};NumericFacet.prototype.drawSlider=function(){var opts,_this=this;
$(this.container).append('<div class="btn-group pull-right">\n  <button class="btn btn-primary disabled">Apply</button>\n  <button class="btn btn-cancel disabled">Reset</button>\n</div>\n<input type="text" data-var="min" class="im-range-min input im-range-val" value="'+this.min+'">\n<span>...</span>\n<input type="text" data-var="max" class="im-range-max input im-range-val" value="'+this.max+'">\n<div class="slider"></div>');opts={range:true,min:this.min,max:this.max,values:[this.min,this.max],step:this.step,slide:function(e,ui){var _ref5;return(_ref5=_this.range)!=null?_ref5.set({min:ui.values[0],max:ui.values[1]}):void 0}};return this.$slider=this.$(".slider").slider(opts)};NumericFacet.prototype.drawChart=function(items){var _this=this;if(typeof d3!=="undefined"&&d3!==null){return setTimeout(function(){return _this._drawD3Chart(items)},0)}};NumericFacet.prototype._drawD3Chart=function(items){var axis,barClickHandler,bottomMargin,bucketRange,bucketVal,chart,container,getTitle,h,item,most,n,rects,rightMargin,val,x,xToVal,y,_i,_len,_this=this;this.items=items;bottomMargin=18;rightMargin=14;n=items[0].buckets+1;h=this.chartHeight;most=d3.max(items,function(d){return d.count});x=d3.scale.linear().domain([1,n]).range([this.leftMargin,this.w-rightMargin]);y=d3.scale.linear().domain([0,most]).rangeRound([0,h-bottomMargin]);this.xForVal=d3.scale.linear().domain([this.min,this.max]).range([this.leftMargin,this.w-rightMargin]);xToVal=d3.scale.linear().domain([1,n]).range([this.min,this.max]);val=function(x){return _this.round(xToVal(x))};bucketVal=function(x){var raw;raw=val(x);if(raw<_this.min){return _this.min}else if(raw>_this.max){return _this.max}else{return raw}};bucketRange=function(bucket){var delta,max,min,_ref5,_ref6;if(bucket!=null){_ref5=function(){var _i,_len,_ref5,_results;_ref5=[0,1];_results=[];for(_i=0,_len=_ref5.length;_i<_len;_i++){delta=_ref5[_i];_results.push(bucketVal(bucket+delta))}return _results}(),min=_ref5[0],max=_ref5[1]}else{_ref6=[0-bucketVal(2),bucketVal(1)],min=_ref6[0],max=_ref6[1]}return{min:min,max:max}};getTitle=function(item){var brange,title;return title=item.bucket!=null?(brange=bucketRange(item.bucket),""+brange.min+" >= x < "+brange.max+": "+item.count+" items"):"x is null: "+item.count+" items"};this.paper=chart=d3.select(this.canvas).append("svg").attr("class","chart").attr("width",this.w).attr("height",h);container=this.canvas;barClickHandler=function(d,i){var _ref5,_ref6;if(d.bucket!=null){return(_ref5=_this.range)!=null?_ref5.set(bucketRange(d.bucket)):void 0}else{return(_ref6=_this.range)!=null?_ref6.nullify():void 0}};for(_i=0,_len=items.length;_i<_len;_i++){item=items[_i];if(item.bucket!=null){item.brange=bucketRange(item.bucket)}}chart.selectAll("rect").data(items).enter().append("rect").attr("x",function(d,i){return x(d.bucket)-.5}).attr("y",h-bottomMargin).attr("width",function(d){return Math.abs(x(d.bucket+1)-x(d.bucket))}).attr("height",0).classed("im-null-bucket",function(d){return d.bucket===null}).on("click",barClickHandler).each(function(d,i){var title;title=getTitle(d);return $(this).tooltip({title:title,container:container})});rects=chart.selectAll("rect").data(items).transition().duration(intermine.options.D3.Transition.Duration).ease(intermine.options.D3.Transition.Easing).attr("y",function(d){return h-bottomMargin-y(d.count)-.5}).attr("height",function(d){return y(d.count)});chart.append("line").attr("x1",0).attr("x2",this.w).attr("y1",h-bottomMargin-.5).attr("y2",h-bottomMargin-.5).style("stroke","#000");axis=chart.append("svg:g");axis.selectAll("line").data(x.ticks(n)).enter().append("svg:line").attr("x1",x).attr("x2",x).attr("y1",h-bottomMargin*.75).attr("y2",h-bottomMargin).attr("stroke","gray").attr("text-anchor","start");return this};NumericFacet.prototype.drawEstCount=function(){var _ref5;if((_ref5=this.estCount)!=null){_ref5.remove()}if(typeof d3==="undefined"||d3===null){return false}return this.estCount=this.paper.append("text").classed("im-est-count",true).attr("x",this.w*.75).attr("y",22).text("~"+this.estimateCount())};sumCounts=function(xs){return _.reduce(xs,function(total,x){return total+x.count},0)};fracWithinRange=function(range,min,max){var overlap,rangeSize;if(!range){return 0}rangeSize=range.max-range.min;overlap=range.min<min?Math.min(range.max,max)-min:max-Math.max(range.min,min);return overlap/rangeSize};getPartialCount=function(min,max){return function(item){if(item!=null){return item.count*fracWithinRange(item.brange,min,max)}else{return 0}}};NumericFacet.prototype.estimateCount=function(){var fullBuckets,left,max,min,partialLeft,partialRight,right,_ref5,_ref6;if(this.range.nulled){return sumCounts(this.items.filter(function(i){return i.bucket===null}))}else{_ref5=this.range.toJSON(),min=_ref5.min,max=_ref5.max;fullBuckets=sumCounts(this.items.filter(function(i){return i.brange!=null&&i.brange.min>=min&&i.brange.max<=max}));partialLeft=this.items.filter(function(i){return i.brange!=null&&i.brange.min<min&&i.brange.max>min})[0];partialRight=this.items.filter(function(i){return i.brange!=null&&i.brange.max>max&&i.brange.min<max})[0];_ref6=[partialLeft,partialRight].map(getPartialCount(min,max)),left=_ref6[0],right=_ref6[1];return this.round(fullBuckets+left+right)}};NumericFacet.prototype.drawSelection=function(x,width){var _ref5;if((_ref5=this.selection)!=null){_ref5.remove()}if(x<=0&&width>=this.w){return}if(typeof d3!=="undefined"&&d3!==null){return this.selection=this.paper.append("svg:rect").attr("x",x).attr("y",0).attr("width",width).attr("height",this.chartHeight*.9).classed("rubberband-selection",true)}else{return console.error("Cannot draw selection without SVG lib")}};NumericFacet.prototype._selecting_paths_=false;return NumericFacet}(FacetView);PieFacet=function(_super){var IGNORE_E,basicOps,getChartPalette,negateOps;__extends(PieFacet,_super);function PieFacet(){this.filterItems=__bind(this.filterItems,this);_ref5=PieFacet.__super__.constructor.apply(this,arguments);return _ref5}PieFacet.prototype.className="im-grouped-facet im-pie-facet im-facet";PieFacet.prototype.chartHeight=100;PieFacet.prototype.initialize=function(query,facet,items,hasMore,filterTerm){var _ref6,_this=this;this.query=query;this.facet=facet;this.hasMore=hasMore;this.filterTerm=filterTerm;this.items=new Backbone.Collection(items);this.items.each(function(item){return item.set({visibility:true,selected:false})});this.items.maxCount=(_ref6=this.items.first())!=null?_ref6.get("count"):void 0;this.items.on("change:selected",function(){var allAreSelected,someAreSelected;someAreSelected=_this.items.any(function(item){return!!item.get("selected")});allAreSelected=!_this.items.any(function(item){return!item.get("selected")});_this.$(".im-filter .btn-group .btn").attr("disabled",!someAreSelected);return _this.$(".im-filter .btn-toggle-selection").attr("disabled",allAreSelected).toggleClass("im-invert",someAreSelected)});return this.items.on("add",this.addItemRow,this)};basicOps={single:"=",multi:"ONE OF",absent:"IS NULL"};negateOps=function(ops){var ret;ret={};ret.multi=ops.multi==="ONE OF"?"NONE OF":"ONE OF";ret.single=ops.single==="="?"!=":"=";ret.absent=ops.absent==="IS NULL"?"IS NOT NULL":"IS NULL";return ret};IGNORE_E=function(e){e.preventDefault();return e.stopPropagation()};PieFacet.prototype.events=function(){var _this=this;return{"submit .im-facet form":IGNORE_E,"click .im-filter .btn-cancel":"resetOptions","click .im-filter .btn-toggle-selection":"toggleSelection","click .im-export-summary":"exportSummary","click .im-load-more":"loadMoreItems","click .im-filter .im-filter-in":function(e){return _this.addConstraint(e,basicOps)},"click .im-filter .im-filter-out":function(e){return _this.addConstraint(e,negateOps(basicOps))},"keyup .im-filter-values":_.throttle(this.filterItems,750,{leading:false}),"click .im-clear-value-filter":"clearValueFilter",click:IGNORE_E}};PieFacet.prototype.filterItems=function(e){var $input,current,parts,test,_this=this;$input=this.$(".im-filter-values");current=$input.val();if(this.hasMore||this.filterTerm&&current.length<this.filterTerm.length){if(this._filter_queued){return}this._filter_queued=true;return _.delay(function(){return _this.query.trigger("filter:summary",$input.val())},750)}else{parts=(current!=null?current:"").toLowerCase().split(/\s+/);test=function(str){return _.all(parts,function(part){return!!(str&&~str.toLowerCase().indexOf(part))})};return this.items.each(function(x){return x.set({visibility:test(x.get("item"))})})}};PieFacet.prototype.clearValueFilter=function(){var $input;$input=this.$(".im-filter-values");$input.val(this.filterTerm);return this.items.each(function(x){return x.set({visibility:true})})};PieFacet.prototype.loadMoreItems=function(){var loader,text,_this=this;if(this.summarising){return}loader=this.$(".im-load-more");text=loader.text();loader.html('<i class="icon-refresh icon-spin"></i>');this.limit*=2;this.summarising=this.query.filterSummary(this.facet.path,this.filterTerm,this.limit);this.summarising.done(function(items,stats,fcount){var newItem,newItems,_i,_len;_this.hasMore=stats.uniqueValues>_this.limit;newItems=items.slice(_this.items.length);for(_i=0,_len=newItems.length;_i<_len;_i++){newItem=newItems[_i];_this.items.add(_.extend(newItem,{visibility:true,selected:false}))}return _this.query.trigger("got:summary:total",_this.facet.path,stats.uniqueValues,items.length,fcount)});this.summarising.done(function(){loader.empty().text(text);return loader.toggle(_this.hasMore)});return this.summarising.always(function(){return delete _this.summarising})};PieFacet.prototype.exportSummary=function(e){e.stopImmediatePropagation();return true};PieFacet.prototype.changeSelection=function(f){var tbody,_this=this;tbody=this.$(".im-item-table tbody")[0];return this.items.each(function(item){return _.defer(function(){return f.call(_this,item)})})};PieFacet.prototype.resetOptions=function(e){return this.changeSelection(function(item){return item.set({selected:false})})};PieFacet.prototype.toggleSelection=function(e){return this.changeSelection(function(item){if(item.get("visibility")){return item.set({selected:!item.get("selected")})}})};PieFacet.prototype.addConstraint=function(e,ops,vals){var item,newCon,unselected;e.preventDefault();e.stopPropagation();newCon={path:this.facet.path};if(vals==null){vals=function(){var _i,_len,_ref6,_results;_ref6=this.items.where({selected:true});_results=[];for(_i=0,_len=_ref6.length;_i<_len;_i++){item=_ref6[_i];_results.push(item.get("item"))}return _results}.call(this);unselected=this.items.where({selected:false});if(!this.hasMore&&vals.length>unselected.length){return this.addConstraint(e,negateOps(ops),function(){var _i,_len,_results;_results=[];for(_i=0,_len=unselected.length;_i<_len;_i++){item=unselected[_i];_results.push(item.get("item"))}return _results}())}}if(vals.length===1){if(vals[0]===null){newCon.op=ops.absent}else{newCon.op=ops.single;newCon.value=""+vals[0]}}else{newCon.op=ops.multi;newCon.values=vals}if(!this.facet.ignoreTitle){newCon.title=this.facet.title}return this.query.addConstraint(newCon)};PieFacet.prototype.render=function(){this.addChart();this.addControls();return this};PieFacet.prototype.addChart=function(){var _this=this;this.chartElem=this.make("div");this.$el.append(this.chartElem);if(typeof d3!=="undefined"&&d3!==null){setTimeout(function(){return _this._drawD3Chart()},0)}return this};getChartPalette=function(){var PieColors,paint;PieColors=intermine.options.PieColors;if(_.isFunction(PieColors)){paint=PieColors}else{paint=d3.scale[PieColors]()}return function(d,i){return paint(i)}};PieFacet.prototype._drawD3Chart=function(){var arc,arc_group,centre_group,chart,colour,donut,getTween,h,ir,label_group,paths,percent,r,total,w,whiteCircle,_this=this;h=this.chartHeight;w=this.$el.closest(":visible").width();r=h*.4;ir=h*.1;donut=d3.layout.pie().value(function(d){return d.get("count")});colour=getChartPalette();chart=d3.select(this.chartElem).append("svg").attr("class","chart").attr("height",h).attr("width",w);arc=d3.svg.arc().startAngle(function(d){return d.startAngle}).endAngle(function(d){return d.endAngle}).innerRadius(function(d){if(d.data.get("selected")){return ir+5}else{return ir}}).outerRadius(function(d){if(d.data.get("selected")){return r+5}else{return r}});arc_group=chart.append("svg:g").attr("class","arc").attr("transform","translate("+w/2+","+h/2+")");centre_group=chart.append("svg:g").attr("class","center_group").attr("transform","translate("+w/2+","+h/2+")");label_group=chart.append("svg:g").attr("class","label_group").attr("transform","translate("+w/2+","+h/2+")");whiteCircle=centre_group.append("svg:circle").attr("fill","white").attr("r",ir);getTween=function(d,i){var j;j=d3.interpolate({startAngle:0,endAngle:0},d);return function(t){return arc(j(t))}};paths=arc_group.selectAll("path").data(donut(this.items.models));paths.enter().append("svg:path").attr("class","donut-arc").attr("stroke","white").attr("stroke-width",.5).attr("fill",colour).on("click",function(d,i){return d.data.set({selected:!d.data.get("selected")})}).on("mouseover",function(d,i){return d.data.trigger("hover")}).on("mouseout",function(d,i){return d.data.trigger("unhover")}).transition().duration(intermine.options.D3.Transition.Duration).attrTween("d",getTween);total=this.items.reduce(function(sum,m){return sum+m.get("count")},0);percent=function(d){return(d.data.get("count")/total*100).toFixed(1)};paths.each(function(d,i){var placement,title;title=""+d.data.get("item")+": "+percent(d)+"%";placement=(d.endAngle+d.startAngle)/2>Math.PI?"left":"right";return $(this).tooltip({title:title,placement:placement,container:this.chartElem})});paths.transition().duration(intermine.options.D3.Transition.Duration).ease(intermine.options.D3.Transition.Easing).attrTween("d",getTween);this.items.on("change:selected",function(){paths.data(donut(_this.items.models)).attr("d",arc);return paths.transition().duration(intermine.options.D3.Transition.Duration).ease(intermine.options.D3.Transition.Easing)});return this};PieFacet.prototype.filterControls='<div class="input-prepend">\n    <span class="add-on im-clear-value-filter">\n      <i class="icon-refresh"></i>\n    </span>\n    <input type="text" class="input-medium  im-filter-values" placeholder="Filter values">\n</div>';PieFacet.prototype.getDownloadPopover=function(){var href,i,icons,lis,name,param;icons=intermine.icons;lis=function(){var _results;_results=[];for(param in SUMMARY_FORMATS){name=SUMMARY_FORMATS[param];href=""+this.query.getExportURI(param)+"&summaryPath="+this.facet.path;i='<i class="'+icons[name]+'"></i>';_results.push('<li><a href="'+href+'"> '+i+" "+name+"</a></li>")}return _results}.call(this);return'<ul class="im-export-summary">'+lis.join("")+"</ul>"};PieFacet.prototype.addControls=function(){var $btns,$grp,DownloadData,DownloadFormat,More,imd,tbody,_ref6,_this=this;_ref6=intermine.messages.facets,More=_ref6.More,DownloadData=_ref6.DownloadData,DownloadFormat=_ref6.DownloadFormat;$grp=$('<form class="form form-horizontal">\n  '+this.filterControls+'\n  <div class="im-item-table">\n    <table class="table table-condensed table-striped">\n      <colgroup>\n        '+this.colClasses.map(function(cl){return"<col class="+cl+">"}).join("")+"\n      </colgroup>\n      <thead>\n        <tr>"+this.columnHeaders.map(function(h){return"<th>"+h+"</th>"}).join("")+'</tr>\n      </thead>\n      <tbody class="scrollable"></tbody>\n    </table>\n    '+(this.hasMore?'<div class="im-load-more">'+More+"</div>":"")+"\n  </div>\n</form>");$grp.button();tbody=$grp.find("tbody")[0];this.items.each(function(item){return _this.addItemRow(item,_this.items,{},tbody)});$grp.append('<div class="im-filter">\n  <button class="btn pull-right im-download" >\n    <i class="'+intermine.icons.Download+'"></i>\n    '+DownloadData+"\n  </button>\n  "+this.buttons()+"\n</div>");$btns=$grp.find(".im-filter .btn").tooltip({placement:"top",container:this.el});$btns.on("click",function(e){return $btns.tooltip("hide")});$grp.find(".dropdown-toggle").click(function(e){var $parent,$this;$this=$(this);$parent=$this.parent();return $parent.toggleClass("open")});imd=$grp.find(".im-download").popover({placement:"top",html:true,container:this.el,title:DownloadFormat,content:this.getDownloadPopover(),trigger:"manual"});imd.click(function(e){return imd.popover("toggle")});this.initFilter($grp);$grp.appendTo(this.el);return this};PieFacet.prototype.addItemRow=function(item,items,opts,tbody){if(tbody==null){tbody=this.$(".im-item-table tbody").get()[0]}return tbody.appendChild(this.makeRow(item))};PieFacet.prototype.buttons=function(){return'<div class="btn-group">\n  <button type="submit" class="btn btn-primary im-filter-in" disabled\n          title="'+intermine.messages.facets.Include+'">\n    Filter\n  </button>\n  <button class="btn btn-primary dropdown-toggle" \n          title="Select filter type"  disabled>\n    <span class="caret"></span>\n  </button>\n  <ul class="dropdown-menu">\n    <li>\n      <a href="#" class="im-filter-in">\n        '+intermine.messages.facets.Include+'\n      </a>\n    </li>\n    <li>\n      <a href="#" class="im-filter-out">\n        '+intermine.messages.facets.Exclude+'\n      </a>\n    </li>\n  </ul>\n</div>\n\n<div class="btn-group">\n  <button class="btn btn-cancel" disabled\n            title="'+intermine.messages.facets.Reset+'">\n    <i class="'+intermine.icons.Undo+'"></i>\n  </button>\n  <button class="btn btn-toggle-selection"\n          title="'+intermine.messages.facets.ToggleSelection+'">\n    <i class="'+intermine.icons.Toggle+'"></i>\n  </button>\n</div>'};PieFacet.prototype.initFilter=function($grp){var $valFilter,sel;if(this.filterTerm==null){return}sel=".im-filter-values";$valFilter=$grp!=null?$grp.find(sel):this.$(sel);return $valFilter.val(this.filterTerm)};PieFacet.prototype.colClasses=["im-item-selector","im-item-value","im-item-count"];PieFacet.prototype.columnHeaders=[" ","Item","Count"];PieFacet.prototype.makeRow=function(item){var row;row=new FacetRow(item,this.items);return row.render().el};return PieFacet}(Backbone.View);FacetRow=function(_super){__extends(FacetRow,_super);function FacetRow(){_ref6=FacetRow.__super__.constructor.apply(this,arguments);return _ref6}FacetRow.prototype.tagName="tr";FacetRow.prototype.className="im-facet-row";FacetRow.prototype.isBelow=function(){var parent;parent=this.$el.closest(".im-item-table");return this.$el.offset().top+this.$el.outerHeight()>parent.offset().top+parent.outerHeight()};FacetRow.prototype.isAbove=function(){var parent;parent=this.$el.closest(".im-item-table");return this.$el.offset().top<parent.offset().top};FacetRow.prototype.isVisible=function(){return!(this.isAbove()||this.isBelow())};FacetRow.prototype.initialize=function(item,items){var _this=this;this.item=item;this.items=items;this.item.facetRow=this;this.listenTo(this.item,"change:selected",function(){return _this.onChangeSelected()});this.listenTo(this.item,"change:visibility",function(){return _this.onChangeVisibility()});this.listenTo(this.item,"hover",function(){var above,itemTable,newTop,surrogate;_this.$el.addClass("hover");if(!_this.isVisible()){above=_this.isAbove();surrogate=$('<div class="im-facet-surrogate '+(above?"above":"below")+'">\n    <i class="icon-caret-'+(above?"up":"down")+'"></i>\n    '+_this.item.get("item")+": "+_this.item.get("count")+"\n</div>");itemTable=_this.$el.closest(".im-item-table").append(surrogate);newTop=above?itemTable.offset().top+itemTable.scrollTop():itemTable.scrollTop()+itemTable.offset().top+itemTable.outerHeight()-surrogate.outerHeight();return surrogate.offset({top:newTop})}});return this.listenTo(this.item,"unhover",function(){var s;_this.$el.removeClass("hover");return s=_this.$el.closest(".im-item-table").find(".im-facet-surrogate").fadeOut("fast",function(){return s.remove()})})};FacetRow.prototype.initState=function(){this.onChangeVisibility();return this.onChangeSelected()};FacetRow.prototype.onChangeVisibility=function(){return this.$el.toggle(this.item.get("visibility"))};FacetRow.prototype.onChangeSelected=function(){var f,isSelected,_this=this;isSelected=!!this.item.get("selected");if(this.item.has("path")){item.get("path").node.setAttribute("class",isSelected?"selected":"")}f=function(){_this.$el.toggleClass("active",isSelected);if(isSelected!==_this.$("input").prop("checked")){return _this.$("input").prop("checked",isSelected)}};return setTimeout(f,0)};FacetRow.prototype.events={click:"handleClick","change input":"handleChange"};FacetRow.prototype.render=function(){var opacity,percent,ratio,_ref7;ratio=parseInt(this.item.get("count"),10)/this.items.maxCount;opacity=ratio.toFixed(2)/2+.5;percent=(ratio*100).toFixed(1);this.$el.append('<td class="im-selector-col">\n    <span>'+(this.item.get("symbol")||"")+'</span>\n    <input type="checkbox">\n</td>\n<td class="im-item-col">\n  '+((_ref7=this.item.get("item"))!=null?_ref7:"<span class=null-value>&nbsp;</span>")+'\n</td>\n<td class="im-count-col">\n    <div class="im-facet-bar"\n         style="width:'+percent+"%;background:rgba(206, 210, 222, "+opacity+')">\n      <span class="im-count">\n        '+this.item.get("count")+"\n      </span>\n    </div>\n</td>");if(this.item.get("percent")){this.$el.append('<td class="im-prop-col"><i>'+this.item.get("percent").toFixed()+"%</i></td>")}this.initState();return this};FacetRow.prototype.handleClick=function(e){e.stopPropagation();if(e.target.type!=="checkbox"){return this.$("input").trigger("click")}};FacetRow.prototype.handleChange=function(e){var _this=this;e.stopPropagation();return setTimeout(function(){return _this.item.set("selected",_this.$("input").is(":checked"))},0)};return FacetRow}(Backbone.View);HistoFacet=function(_super){__extends(HistoFacet,_super);function HistoFacet(){_ref7=HistoFacet.__super__.constructor.apply(this,arguments);return _ref7}HistoFacet.prototype.className="im-grouped-facet im-facet";HistoFacet.prototype.chartHeight=50;HistoFacet.prototype.leftMargin=25;HistoFacet.prototype.colClasses=["im-item-selector","im-item-value","im-item-count"];HistoFacet.prototype.columnHeaders=[" ","Item","Count"];HistoFacet.prototype._drawD3Chart=function(){var chart,data,f,h,itemW,max,n,onSelection,rectClass,rects,w,x,y,_this=this;if(this.items.all(function(i){return 1===i.get("count")})){return this}data=this.items.models;w=this.$el.closest(":visible").width()*.95;n=data.length;itemW=(w-this.leftMargin)/data.length;h=this.chartHeight;f=this.items.first();max=f.get("count");x=d3.scale.linear().domain([0,n]).range([this.leftMargin,w]);y=d3.scale.linear().domain([0,max]).rangeRound([0,h]);chart=d3.select(this.chartElem).append("svg").attr("class","chart").attr("width",w).attr("height",h);rectClass=n>w/4?"squashed":"bar";rects=chart.selectAll("rect");rects.data(data).enter().append("rect").attr("class",rectClass).attr("width",itemW).attr("y",h).attr("height",0).attr("x",function(d,i){return x(i)-.5}).on("click",function(d,i){return d.set({selected:!d.get("selected")})}).on("mouseover",function(d,i){return d.trigger("hover")}).on("mouseout",function(d,i){return d.trigger("unhover")});chart.selectAll("rect").data(this.items.models).transition().duration(intermine.options.D3.Transition.Duration).ease(intermine.options.D3.Transition.Easing).attr("y",function(d){return h-y(d.get("count"))-.5}).attr("height",function(d){return y(d.get("count"))});chart.append("line").attr("x1",0).attr("x2",w).attr("y1",h-.5).attr("y2",h-.5).style("stroke","#000");onSelection=function(){return _.defer(function(){return chart.selectAll("rect").data(_this.items.models).transition().duration(intermine.options.D3.Transition.Duration).ease(intermine.options.D3.Transition.Easing).attr("class",function(d){return rectClass+(d.get("selected")?"-selected":"")})})};this.items.on("change:selected",_.throttle(onSelection,150));return this};return HistoFacet}(PieFacet);BooleanFacet=function(_super){__extends(BooleanFacet,_super);function BooleanFacet(){_ref8=BooleanFacet.__super__.constructor.apply(this,arguments);return _ref8}BooleanFacet.prototype.initialize=function(){var _this=this;BooleanFacet.__super__.initialize.apply(this,arguments);if(this.items.length===2){return this.items.on("change:selected",function(x,selected){var someAreSelected;_this.items.each(function(y){if(selected&&x!==y){return y.set({selected:false})}});someAreSelected=_this.items.any(function(item){return!!item.get("selected")});return _this.$(".im-filtering.btn").attr("disabled",!someAreSelected)})}};BooleanFacet.prototype.filterControls="";BooleanFacet.prototype.initFilter=function(){};BooleanFacet.prototype.buttons=function(){return'<button type="submit" class="btn btn-primary im-filtering im-filter-in" disabled>Filter</button>\n<button class="btn btn-cancel im-filtering" disabled>Reset</button>'};return BooleanFacet}(PieFacet);return scope("intermine.results",{ColumnSummary:ColumnSummary,FacetView:FacetView,FrequencyFacet:FrequencyFacet,NumericFacet:NumericFacet,PieFacet:PieFacet,FacetRow:FacetRow,HistoFacet:HistoFacet,BooleanFacet:BooleanFacet})})();scope("intermine.messages.filters",{AddNew:"Add Filter",DefineNew:"Define a new filter",EditOrRemove:"edit or remove the currently active filters",None:"No active filters",Heading:"Active Filters"});scope("intermine.css",{FilterBoxClass:"well"});(function(){var Constraints,FACETS,Facets,FilterManager,Filters,SingleColumnConstraints,SingleColumnConstraintsSummary,SingleConstraintAdder,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6;Filters=function(_super){__extends(Filters,_super);function Filters(){_ref=Filters.__super__.constructor.apply(this,arguments);return _ref}Filters.prototype.className="im-query-filters";Filters.prototype.initialize=function(query){this.query=query};Filters.prototype.render=function(){var constraints,facets;constraints=new Constraints(this.query);constraints.render().$el.appendTo(this.el);facets=new Facets(this.query);facets.render().$el.appendTo(this.el);return this};return Filters}(Backbone.View);FACETS={Gene:[{title:"Pathways",path:"pathways.name"},{title:"Expression Term",path:"mRNAExpressionResults.mRNAExpressionTerms.name"},{title:"Ontology Term",path:"ontologyAnnotations.ontologyTerm.name"},{title:"Protein Domains",path:"proteins.proteinDomains.name"}]};Facets=function(_super){__extends(Facets,_super);function Facets(){this.render=__bind(this.render,this);_ref1=Facets.__super__.constructor.apply(this,arguments);return _ref1}Facets.prototype.className="im-query-facets";Facets.prototype.tagName="dl";Facets.prototype.initialize=function(query){this.query=query;this.query.on("change:constraints",this.render);return this.query.on("change:joins",this.render)};Facets.prototype.render=function(){var cs,f,facets,searcher,simplify,v,_i,_len,_this=this;this.$el.empty();simplify=function(x){return x.replace(/^[^\.]+\./,"").replace(/\./g," > ")};facets=(FACETS[this.query.root]||[]).concat(function(){var _i,_len,_ref2,_results;_ref2=this.query.views;_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){v=_ref2[_i];_results.push({title:simplify(v),path:v})}return _results}.call(this));if(facets){searcher=this.make("input",{"class":"input-long",placeholder:"Filter facets..."});$(searcher).appendTo(this.el).keyup(function(e){var pattern;pattern=new RegExp($(e.target).val(),"i");return _this.query.trigger("filter:facets",pattern)});for(_i=0,_len=facets.length;_i<_len;_i++){f=facets[_i];cs=new intermine.results.ColumnSummary(f,this.query);this.$el.append(cs.el);cs.render()}}return this};return Facets}(Backbone.View);Constraints=function(_super){__extends(Constraints,_super);function Constraints(){this.render=__bind(this.render,this);_ref2=Constraints.__super__.constructor.apply(this,arguments);return _ref2}Constraints.prototype.className="im-constraints";Constraints.prototype.initialize=function(query){this.query=query;return this.query.on("change:constraints",this.render)};Constraints.prototype.getConstraints=function(){return this.query.constraints};Constraints.prototype.getConAdder=function(){return new intermine.query.ConstraintAdder(this.query)};Constraints.prototype.render=function(){var c,conBox,cons,msgs,ul,_fn,_i,_len,_ref3,_this=this;cons=this.getConstraints();msgs=intermine.messages.filters;this.$el.empty();this.$el.append(this.make("h3",{},msgs.Heading));conBox=$('<div class="'+intermine.css.FilterBoxClass+'">');conBox.appendTo(this.el).append(this.make("p",{"class":"well-help"},cons.length?msgs.EditOrRemove:msgs.None)).append(ul=this.make("ul",{}));_fn=function(c){var con;con=new intermine.query.ActiveConstraint(_this.query,c);return con.render().$el.appendTo($(ul))};for(_i=0,_len=cons.length;_i<_len;_i++){c=cons[_i];_fn(c)}if((_ref3=this.getConAdder())!=null){_ref3.render().$el.appendTo(this.el)}return this};Constraints.prototype.events={click:function(e){return e.stopPropagation()}};return Constraints}(Backbone.View);FilterManager=function(_super){__extends(FilterManager,_super);function FilterManager(){_ref3=FilterManager.__super__.constructor.apply(this,arguments);return _ref3}FilterManager.prototype.className="im-filter-manager modal";FilterManager.prototype.tagName="div";FilterManager.prototype.initialize=function(query){var _this=this;this.query=query;return this.query.on("change:constraints",function(){return _this.hideModal()})};FilterManager.prototype.html='<div class="modal-header">\n    <a class="close im-closer">close</a>\n    <h3>'+intermine.messages.filters.Heading+'</h3>\n</div>\n<div class="modal-body">\n    <div class="'+intermine.css.FilterBoxClass+'">\n        <p class="well-help"></p>\n        <ul></ul>\n    </div>\n    <button class="btn im-closer im-define-new-filter">\n        '+intermine.messages.filters.DefineNew+"\n    </button>\n</div>";FilterManager.prototype.events={hidden:"remove","click .icon-remove-sign":"hideModal","click .im-closer":"hideModal","click .im-define-new-filter":"addNewFilter"};FilterManager.prototype.addNewFilter=function(e){return this.query.trigger("add-filter-dialogue:please")};FilterManager.prototype.hideModal=function(e){this.$el.modal("hide");return $(".modal-backdrop").trigger("click")};FilterManager.prototype.showModal=function(){return this.$el.modal().modal("show")};FilterManager.prototype.render=function(){var c,cons,msgs,ul,_fn,_i,_len,_this=this;this.$el.append(this.html);cons=this.getConstraints();msgs=intermine.messages.filters;this.$(".well-help").append(cons.length?msgs.EditOrRemove:msgs.None);ul=this.$("ul");_fn=function(c){var con;con=new intermine.query.ActiveConstraint(_this.query,c);return con.render().$el.appendTo(ul)};for(_i=0,_len=cons.length;_i<_len;_i++){c=cons[_i];_fn(c)}return this};return FilterManager}(Constraints);SingleConstraintAdder=function(_super){__extends(SingleConstraintAdder,_super);function SingleConstraintAdder(){_ref4=SingleConstraintAdder.__super__.constructor.apply(this,arguments);return _ref4}SingleConstraintAdder.prototype.initialize=function(query,view){var _this=this;this.view=view;SingleConstraintAdder.__super__.initialize.call(this,query);return this.query.on("cancel:add-constraint",function(){return _this.$(".btn-primary").toggle(_this.getTreeRoot().isAttribute())})};SingleConstraintAdder.prototype.initPaths=function(){return[this.view]};SingleConstraintAdder.prototype.getTreeRoot=function(){return this.query.getPathInfo(this.view)};SingleConstraintAdder.prototype.render=function(){SingleConstraintAdder.__super__.render.call(this);this.$("input").remove();root=this.getTreeRoot();console.log(this.view);if(root.isAttribute()){this.chosen=root;this.$("button.btn-primary").text(intermine.messages.filters.DefineNew).attr({disabled:false});this.$("button.btn-chooser").remove()}return this};return SingleConstraintAdder}(intermine.query.ConstraintAdder);SingleColumnConstraints=function(_super){__extends(SingleColumnConstraints,_super);function SingleColumnConstraints(){_ref5=SingleColumnConstraints.__super__.constructor.apply(this,arguments);return _ref5}SingleColumnConstraints.prototype.initialize=function(query,view){this.view=view;
return SingleColumnConstraints.__super__.initialize.call(this,query)};SingleColumnConstraints.prototype.getConAdder=function(){return null};SingleColumnConstraints.prototype.getConstraints=function(){var c,_i,_len,_ref6,_results;_ref6=this.query.constraints;_results=[];for(_i=0,_len=_ref6.length;_i<_len;_i++){c=_ref6[_i];if(c.path.match(this.view)){_results.push(c)}}return _results};return SingleColumnConstraints}(Constraints);SingleColumnConstraintsSummary=function(_super){__extends(SingleColumnConstraintsSummary,_super);function SingleColumnConstraintsSummary(){_ref6=SingleColumnConstraintsSummary.__super__.constructor.apply(this,arguments);return _ref6}SingleColumnConstraintsSummary.prototype.getConAdder=function(){};SingleColumnConstraintsSummary.prototype.render=function(){var cons;SingleColumnConstraintsSummary.__super__.render.call(this);cons=this.getConstraints();if(cons.length<1){this.undelegateEvents();this.$el.hide()}return this};return SingleColumnConstraintsSummary}(SingleColumnConstraints);return scope("intermine.query.filters",{SingleColumnConstraintsSummary:SingleColumnConstraintsSummary,SingleColumnConstraints:SingleColumnConstraints,Filters:Filters,FilterManager:FilterManager})})();define("formatters/bio/core/chromosome-location",function(){var ChrLocFormatter,fetch;fetch=function(service,id){return service.rows({from:"Location",select:ChrLocFormatter.replaces,where:{id:id}})};return ChrLocFormatter=function(){ChrLocFormatter.replaces=["locatedOn.primaryIdentifier","start","end"];ChrLocFormatter.merge=function(location,chromosome){if(chromosome.has("primaryIdentifier")){return location.set({chr:chromosome.get("primaryIdentifier")})}};function ChrLocFormatter(model){var chr,end,id,needs,start,_ref;id=model.get("id");this.$el.addClass("chromosome-location");needs=["start","end","chr"];if(!(model._fetching!=null||_.all(needs,function(n){return model.has(n)}))){model._fetching=fetch(this.options.query.service,id);model._fetching.done(function(_arg){var chr,end,start,_ref;_ref=_arg[0],chr=_ref[0],start=_ref[1],end=_ref[2];return model.set({chr:chr,start:start,end:end})})}_ref=model.toJSON(),start=_ref.start,end=_ref.end,chr=_ref.chr;return""+chr+":"+start+"-"+end}return ChrLocFormatter}()});define("formatters/bio/core/organism",function(){var Organism,ensureData,getData,templ;getData=function(model,prop,backupProp){var ret,val;ret={};val=ret[prop]=model.get(prop);if(val==null){ret[prop]=model.get(backupProp)}return ret};ensureData=function(model,service){var p;if(model._fetching!=null||model.has("shortName")){return}model._fetching=p=service.findById("Organism",model.get("id"));return p.done(function(org){return model.set({shortName:org.shortName})})};templ=_.template('<span class="name"><%- shortName %></span>');return Organism=function(model){var data;this.$el.addClass("organism");ensureData(model,this.options.query.service);if(model.get("id")){data=getData(model,"shortName","name");return templ(data)}else{return'<span class="null-value">&nbsp;</span>'}}});define("formatters/bio/core/publication",function(){var PublicationFormatter;PublicationFormatter=function(model){var firstAuthor,id,title,year,_ref,_ref1;id=model.get("id");this.$el.addClass("publication");if(!(model.has("title")&&model.has("firstAuthor")&&model.has("year"))){if((_ref=model._formatter_promise)==null){model._formatter_promise=this.options.query.service.findById("Publication",id)}model._formatter_promise.done(function(pub){return model.set(pub)})}_ref1=model.toJSON(),title=_ref1.title,firstAuthor=_ref1.firstAuthor,year=_ref1.year;return""+title+" ("+firstAuthor+", "+year+")"};PublicationFormatter.replaces=["title","firstAuthor","year"];return PublicationFormatter});define("formatters/bio/core/sequence",function(){var SequenceFormatter,lineLength;lineLength=40;return SequenceFormatter=function(model){var id,line,lines,rest,sequence,_ref;id=model.get("id");this.$el.addClass("dna-sequence");if(!model.has("residues")){if((_ref=model._formatter_promise)==null){model._formatter_promise=this.options.query.service.findById("Sequence",id)}model._formatter_promise.done(function(seq){return model.set(seq)})}sequence=model.get("residues")||"";lines=[];while(sequence.length>0){line=sequence.slice(0,lineLength);rest=sequence.slice(lineLength);lines.push(line);sequence=rest}return function(){var _i,_len,_results;_results=[];for(_i=0,_len=lines.length;_i<_len;_i++){line=lines[_i];_results.push("<code>"+line+"</code>")}return _results}().join("<br/>")}});bio_formatters=function(){var _i,_len,_ref,_results;_ref=["chromosome-location","sequence","organism","publication"];_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){x=_ref[_i];_results.push("formatters/bio/core/"+x)}return _results}();define("formatters/bio/core",using.apply(null,__slice.call(bio_formatters).concat([function(Chr,Seq,Org,Pub){scope("intermine.results.formatters",{Location:Chr,Sequence:Seq,Publication:Pub,Organism:Org});return scope("intermine.results.formatsets.genomic",{"Location.start":false,"Location.end":false,"Organism.name":false,"Publication.title":false,"Sequence.residues":false})}])));scope("intermine.results",{getFormatter:function(path){var a,ancestors,cd,fieldName,formats,formatter,_i,_len,_ref;if(path==null){return null}cd=path.isAttribute()?path.getParent().getType():path.getType();ancestors=[cd.name].concat(path.model.getAncestorsOf(cd.name));formats=(_ref=intermine.results.formatsets[path.model.name])!=null?_ref:{};fieldName=path.end.name;for(_i=0,_len=ancestors.length;_i<_len;_i++){a=ancestors[_i];formatter=formats[""+a+".*"]||formats[""+a+"."+fieldName];if(formatter===true){formatter=intermine.results.formatters[a]}if(formatter!=null){return formatter}}return null},shouldFormat:function(path,formatSet){var a,ancestors,cd,fieldName,formats,formatterAvailable,model,_i,_len,_ref;if(!path.isAttribute()){return false}model=path.model;if(formatSet==null){formatSet=model.name}cd=path.isAttribute()?path.getParent().getType():path.getType();fieldName=path.end.name;formatterAvailable=intermine.results.getFormatter(path)!=null;if(!formatterAvailable){return false}if(fieldName==="id"){return true}ancestors=[cd.name].concat(path.model.getAncestorsOf(cd.name));formats=(_ref=intermine.results.formatsets[formatSet])!=null?_ref:{};for(_i=0,_len=ancestors.length;_i<_len;_i++){a=ancestors[_i];if(formats[""+a+".*"]||formats[""+a+"."+fieldName]){return true}}return false}});define("html/append-list",function(){return'<div class="modal">\n  <div class="modal-header">\n    <a class="close btn-cancel">close</a>\n    <h2>Add Items To Existing List</h2>\n  </div>\n  <div class="modal-body">\n    <form class="form-horizontal form">\n      <fieldset class="control-group">\n        <label>\n          Add\n          <span class="im-item-count"></span>\n          <span class="im-item-type"></span>\n          to:\n          <select class="im-receiving-list input-xlarge">\n              <option value=""><i>Select a list</i></option>\n          </select>\n        </label>\n        <span class="help-inline"></span>\n      </fieldset>\n    </form>\n    <div class="alert alert-error im-none-compatible-error">\n      <b>Sorry!</b> You don\'t have access to any compatible lists.\n    </div>\n    <div class="alert alert-info im-selection-instruction">\n      <b>Get started!</b> Choose items from the table below.\n      You can move this dialogue around by dragging it, if you \n      need access to a column it is covering up.\n    </div>\n  </div>\n  <div class="modal-footer">\n    <div class="btn-group">\n      <button disabled class="btn btn-primary">Add to list</button>\n      <button class="btn btn-cancel">Cancel</button>\n    </div>\n  </div>\n</div>'});define("html/code-gen",function(){return _.template('<div class="btn-group">\n    <a class="btn btn-action">\n        <i class="'+intermine.icons.Script+'"></i>\n        <span class="im-only-widescreen">Get</span>\n        <span class="im-code-lang hidden-tablet"></span>\n        <span class="hidden-tablet">Code</span>\n    </a>\n    <a class="btn dropdown-toggle" data-toggle="dropdown">\n        <span class="caret"></span>\n    </a>\n    <ul class="dropdown-menu">\n        <% _(langs).each(function(lang) { %>\n          <li>\n            <a data-lang="<%= lang.extension %>">\n                <i class="icon-<%= lang.extension %>"></i>\n                <%= lang.name %>\n            </a>\n          </li>\n        <% }); %>\n    </ul>\n</div>\n<div class="modal">\n    <div class="modal-header">\n        <a class="close im-closer" data-dismiss="modal">close</a>\n        <h3>Generated <span class="im-code-lang"></span> Code</h3>\n    </div>\n    <div class="modal-body">\n        <pre class="im-generated-code prettyprint linenums">\n        </pre>\n    </div>\n    <div class="modal-footer">\n        <a class="btn btn-save"><i class="icon-file"></i>Save</a>\n        <a data-dismiss="modal" class="btn im-closer">Close</a>\n    </div>\n</div>')});define("html/new-list",function(){return'<div class="modal im-list-creation-dialogue">\n    <div class="modal-header">\n        <a class="close btn-cancel">close</a>\n        <a class="im-minimise">&nbsp;</a>\n        <h2>List Details</h2>\n    </div>\n    <div class="modal-body">\n        <form class="form form-horizontal">\n            <p class="im-list-summary"></p>\n            <fieldset class="control-group">\n                <label>Name</label>\n                <input class="im-list-name span10" type="text" placeholder="required identifier">\n                <span class="help-inline"></span>\n            </fieldset>\n            <fieldset class="control-group">\n                <label>Description</label>\n                <input class="im-list-desc span10" type="text" placeholder="an optional description" >\n            </fieldset>\n            <fieldset class="control-group im-tag-options">\n                <label>Add Tags</label>\n                <input type="text" class="im-available-tags input-medium" placeholder="categorize your list">\n                <button class="btn im-confirm-tag" disabled>Add</button>\n                <ul class="im-list-tags choices well">\n                    <div style="clear:both"></div>\n                </ul>\n                <h5><i class="icon-chevron-down"></i>Suggested Tags</h5>\n                <ul class="im-list-tags suggestions well">\n                    <div style="clear:both"></div>\n                </ul>\n            </fieldset>\n            <input type="hidden" class="im-list-type">\n        </form>\n        <div class="alert alert-info im-selection-instruction">\n            <b>Get started!</b> Choose items from the table below.\n            You can move this dialogue around by dragging it, if you \n            need access to a column it is covering up.\n        </div>\n    </div>\n    <div class="modal-footer">\n        <div class="btn-group">\n            <button class="btn btn-primary">Create</button>\n            <button class="btn btn-cancel">Cancel</button>\n            <button class="btn btn-reset">Reset</button>\n        </div>\n    </div>\n</div>'});(function(){var FPObject,IMObject,NullObject,_ref,_ref1,_ref2;IMObject=function(_super){__extends(IMObject,_super);function IMObject(){_ref=IMObject.__super__.constructor.apply(this,arguments);return _ref}IMObject.prototype.initialize=function(obj,query,field,base,history){var model,_this=this;obj[field]=obj.value;obj["obj:type"]=obj["class"];obj["service:base"]=base;obj["service:url"]=obj.url;obj["is:selected"]=false;obj["is:selectable"]=true;obj["is:selecting"]=false;this.set(obj);model=query.model;query.on("selection:cleared",function(){return _this.set({"is:selectable":true})});query.on("common:type:selected",function(type){var ok;ok=!type||model.findSharedAncestor(type,_this.get("obj:type"));return _this.set({"is:selectable":!!ok})});this.on("change:is:selected",function(self,selected){return query.trigger("imo:selected",_this.get("obj:type"),_this.get("id"),selected)});return this.on("click",function(){return query.trigger("imo:click",_this.get("obj:type"),_this.get("id"),_this.toJSON())})};IMObject.prototype.selectionState=function(){return{selected:this.get("is:selected"),selecting:this.get("is:selecting"),selectable:this.get("is:selectable")}};IMObject.prototype.merge=function(obj,field){return this.set(field,obj.value)};return IMObject}(Backbone.Model);NullObject=function(_super){__extends(NullObject,_super);function NullObject(){_ref1=NullObject.__super__.constructor.apply(this,arguments);return _ref1}NullObject.prototype.initialize=function(_,_arg){var field,query,type;query=_arg.query,field=_arg.field,type=_arg.type;this.set({id:null,"obj:type":type,"is:selected":false,"is:selectable":false,"is:selecting":false,"service:base":"","service:url":""});if(field){return this.set(field,null)}};NullObject.prototype.merge=function(){};return NullObject}(IMObject);FPObject=function(_super){__extends(FPObject,_super);function FPObject(){_ref2=FPObject.__super__.constructor.apply(this,arguments);return _ref2}FPObject.prototype.initialize=function(_arg,_arg1){var field,obj,query;_arg;query=_arg1.query,obj=_arg1.obj,field=_arg1.field;this.set({id:null,"obj:type":obj["class"],"is:selected":false,"is:selectable":false,"is:selecting":false,"service:base":"","service:url":""});return this.set(field,obj.value)};return FPObject}(NullObject);return scope("intermine.model",{IMObject:IMObject,NullObject:NullObject,FPObject:FPObject})})();(function(){var SVG,supportsSVG;SVG="http://www.w3.org/TR/SVG11/feature#Shape";supportsSVG=function(){var _ref;return typeof SVGAngle!=="undefined"&&SVGAngle!==null||window.SVGAngle!=null||((_ref=document.implementation)!=null?typeof _ref.hasFeature==="function"?_ref.hasFeature(SVG,"1.0"):void 0:void 0)};jQuery.event.special.destroyed={remove:function(o){if(o.type!=="destroyed"){return typeof o.handler==="function"?o.handler():void 0}}};(function($){var proto,_mouseInit;$.support.touch=typeof Touch==="object";if(!$.support.touch){return false}proto=$.ui.mouse.prototype;_mouseInit=proto._mouseInit;return $.extend(proto,{_mouseInit:function(){this.element.bind("touchstart."+this.widgetName,$.proxy(this,"_touchStart"));return _mouseInit.apply(this,arguments)},_touchStart:function(event){if(event.originalEvent.targetTouches.length!==1){return false}this.element.bind("touchmove."+this.widgetName,$.proxy(this,"_touchMove")).bind("touchend."+this.widgetName,$.proxy(this,"_touchEnd"));this._modifyEvent(event);$(document).trigger($.Event("mouseup"));this._mouseDown(event);return false},_touchMove:function(event){this._modifyEvent(event);return this._mouseMove(event)},_touchEnd:function(event){this.element.unbind("touchmove."+this.widgetName).unbind("touchend."+this.widgetName);return this._mouseUp(event)},_modifyEvent:function(event){var target;event.which=1;target=event.originalEvent.targetTouches[0];event.pageX=target.clientX;return event.pageY=target.clientY}})})(jQuery);return jQuery.fn.imWidget=function(arg0,arg1){var cls,error,events,icons,options,properties,query,service,token,type,url,view;if(typeof arg0==="string"){view=this.data("widget");if(arg0==="option"){switch(arg1){case"query":return view.query;case"service":return view.service;case"events":return view.queryEvents;case"type":return this.data("widget-type");case"properties":return this.data("widget-options");default:throw new Error("Unknown option "+arg1)}}else if(arg0==="table"){return view}else{throw new Error("Unknown method "+arg0)}}else{type=arg0.type,service=arg0.service,url=arg0.url,token=arg0.token,query=arg0.query,events=arg0.events,properties=arg0.properties,error=arg0.error,options=arg0.options;if(supportsSVG()&&(typeof d3==="undefined"||d3===null)){intermine.cdn.load("d3")}icons=intermine.options.Style.icons;intermine.cdn.load(icons);if(service==null){service=new intermine.Service({root:url,token:token})}if(error!=null){service.errorHandler=error}cls=type==="table"?intermine.query.results.CompactView:type==="dashboard"?intermine.query.results.DashBoard:type==="minimal"?intermine.query.results.Toolless:void 0;if(!cls){console.error(""+type+" widgets are not supported");return false}if(this.width()<jQuery("body").width()*.6){this.addClass("im-half")}if(options!=null){intermine.setOptions(options)}view=new cls(service,query,events,properties);this.empty().append(view.el);view.render();this.data("widget-options",properties);this.data("widget-type",type);this.data("widget",view);return this.data("widget")}}})();scope("intermine.snippets.table",{LargeTableDisuader:'<div class="modal im-page-size-sanity-check">\n  <div class="modal-header">\n    <h3>\n      Are you sure?\n    </h3>\n  </div>\n  <div class="modal-body">\n    <p>\n      You have requested a very large table size. Your\n      browser may struggle to render such a large table,\n      and the page will probably become unresponsive. It\n      will be very difficult for you to read the whole table\n      in the page. We suggest the following alternatives:\n    </p>\n    <ul>\n      <li>\n         <p>\n            If you are looking for something specific, you can use the\n            <span class="label label-info">filtering tools</span>\n            to narrow down the result set. Then you \n            might be able to fit the items you are interested in in a\n            single page.\n         </p>\n          <button class="btn im-alternative-action" data-event="add-filter-dialogue:please">\n          <i class="'+intermine.icons.Filter+'"></i>\n          Add a new filter.\n          </button>\n        </li>\n        <li>\n          <p>\n            If you want to see all the data, you can page \n            <span class="label label-info">\n             <i class="icon-chevron-left"></i>\n              backwards\n            </span>\n            and \n            <span class="label label-info">\n              forwards\n              <i class="icon-chevron-right"></i>\n            </span>\n            through the results.\n          </p>\n          <div class="btn-group">\n            <a class="btn im-alternative-action" data-event="page:backwards" href="#">\n             <i class="icon-chevron-left"></i>\n             go one page back\n           </a>\n           <a class="btn im-alternative-action" data-event="page:forwards" href="#">\n             go one page forward\n             <i class="icon-chevron-right"></i>\n           </a>\n          </div>\n        </li>\n        <li>\n            <p>\n                If you want to get and save the results, we suggest\n                <span class="label label-info">downloading</span>\n                the results in a format that suits you. \n            <p>\n            <button class="btn im-alternative-action" data-event="download-menu:open">\n                <i class="'+intermine.icons.Export+'"></i>\n                Open the download menu.\n            </buttn>\n        </li>\n    </ul>\n  </div>\n  <div class="modal-footer">\n      <button class="btn btn-primary pull-right">\n          I know what I\'m doing.\n      </button>\n      <button class="btn pull-left im-alternative-action">\n          OK, no worries then.\n      </button>\n  </div>\n</div>'});(function(){var ManagementTools,_ref;ManagementTools=function(_super){__extends(ManagementTools,_super);function ManagementTools(){_ref=ManagementTools.__super__.constructor.apply(this,arguments);return _ref}ManagementTools.prototype.initialize=function(states,columnHeaders){this.states=states;this.columnHeaders=columnHeaders;return this.states.on("add reverted",this.checkHasFilters,this)};ManagementTools.prototype.checkHasFilters=function(){var count,q;if(q=this.states.currentQuery){count=q.constraints.length;this.$(".im-filters").toggleClass("im-has-constraint",count>0);return this.$(".im-filters .im-action").text(count>0?count:"Add ")}};ManagementTools.prototype.tagName="div";ManagementTools.prototype.className="im-management-tools";ManagementTools.prototype.html='<div class="btn-group"> \n  <button class="btn im-columns">\n      <i class="'+intermine.icons.Columns+'"></i>\n      <span class="im-only-widescreen">Manage </span>\n      <span class="hidden-tablet">Columns</span>\n  </button>\n  <button class="btn im-filters">\n      <i class="'+intermine.icons.Filter+'"></i>\n      <span class="hidden-phone im-action">Manage </span>\n      <span class="hidden-phone">Filters</span>\n  </button>\n</div>';ManagementTools.prototype.events={"click .im-columns":"showColumnDialogue","click .im-filters":"showFilterDialogue"};ManagementTools.prototype.showColumnDialogue=function(e){var dialogue,q;q=this.states.currentQuery;dialogue=new intermine.query.results.table.ColumnsDialogue(q,this.columnHeaders);this.$el.append(dialogue.el);return dialogue.render().showModal()};ManagementTools.prototype.showFilterDialogue=function(e){var dialogue,q;q=this.states.currentQuery;dialogue=new intermine.query.filters.FilterManager(q);this.$el.append(dialogue.el);return dialogue.render().showModal()};ManagementTools.prototype.render=function(){this.$el.append(this.html);this.checkHasFilters();return this};return ManagementTools}(Backbone.View);return scope("intermine.query.tools",{ManagementTools:ManagementTools})})();(function(){var History,_ref;History=function(_super){__extends(History,_super);function History(){_ref=History.__super__.constructor.apply(this,arguments);return _ref}History.prototype.initialize=function(){this.currentStep=0;this.currentQuery=null;return this.on("revert",this.revert,this)};History.prototype.unwatch=function(){var _ref1;if(((_ref1=this.currentQuery)!=null?_ref1.off:void 0)!=null){return this.stopListening(this.currentQuery)}};History.prototype.watch=function(){var q,_this=this;if(q=this.currentQuery){this.listenTo(q,"change:constraints",function(){return _this.onChange(q,"constraints","filter")});this.listenTo(q,"change:views",function(){return _this.onChange(q,"views","column")});this.listenTo(q,"change:joins",function(){return _this.addStep("Changed joins",q)});this.listenTo(q,"set:sortorder",function(){return _this.addStep("Changed sort order",q)});this.listenTo(q,"count:is",function(n){return _this.last().set({count:n})});return this.listenTo(q,"undo",function(){return _this.popState()})}};History.prototype.onChange=function(query,prop,label){var n,now,pl,quantity,title,verb,was,xs,ys;xs=this.last().get("query")[prop];ys=query[prop];was=xs.length;now=ys.length;n=Math.abs(was-now);quantity=n===1?"a ":n?""+n+" ":"";pl=n!==1?"s":"";verb=was<now?"Added":was>now?"Removed":now===_.union(xs,ys).length?"Rearranged":"Changed";title=""+verb+" "+quantity+label+pl;return this.addStep(title,query)};History.prototype.addStep=function(title,query){var was;was=this.currentQuery;this.unwatch();this.currentQuery=query.clone();this.currentQuery.revision=this.currentStep;this.watch();this.each(function(state){return state.set({current:false})});this.add({query:query.clone(),current:true,title:title,stepNo:this.currentStep++});return was!=null?was.trigger("replaced:by",this.currentQuery):void 0};History.prototype.popState=function(){return this.revert(this.at(this.length-2))};History.prototype.revert=function(target){var current,was,_ref1;this.unwatch();was=this.currentQuery;while(this.last().get("stepNo")>target.get("stepNo")){this.pop()}current=this.last();if(current!=null){current.set({current:true})}this.currentQuery=current!=null?(_ref1=current.get("query"))!=null?_ref1.clone():void 0:void 0;this.currentQuery.revision=current.get("stepNo");this.watch();this.trigger("reverted",this.currentQuery);return was!=null?was.trigger("replaced:by",this.currentQuery):void 0};return History}(Backbone.Collection);return scope("intermine.models.table",{History:History})})();define("models/uniq-items",function(){var Item,UniqItems,_ref,_ref1;Item=function(_super){__extends(Item,_super);function Item(){_ref=Item.__super__.constructor.apply(this,arguments);return _ref}Item.prototype.initialize=function(item){return this.set("item",item)};return Item}(Backbone.Model);UniqItems=function(_super){__extends(UniqItems,_super);function UniqItems(){_ref1=UniqItems.__super__.constructor.apply(this,arguments);return _ref1}UniqItems.prototype.model=Item;UniqItems.prototype.add=function(items,opts){var item,_i,_len,_results;items=_(items).isArray()?items:[items];_results=[];for(_i=0,_len=items.length;_i<_len;_i++){item=items[_i];if(item!=null&&""!==item){if(!this.any(function(i){return i.get("item")===item})){_results.push(UniqItems.__super__.add.call(this,new Item(item,opts)))}else{_results.push(void 0)}}}return _results};UniqItems.prototype.remove=function(item,opts){var delenda;delenda=this.filter(function(i){return i.get("item")===item});return UniqItems.__super__.remove.call(this,delenda,opts)};return UniqItems}(Backbone.Collection);return UniqItems});(function(){var NewFilterDialogue,_ref;NewFilterDialogue=function(_super){__extends(NewFilterDialogue,_super);function NewFilterDialogue(){_ref=NewFilterDialogue.__super__.constructor.apply(this,arguments);return _ref}NewFilterDialogue.prototype.tagName="div";NewFilterDialogue.prototype.className="im-constraint-dialogue modal";NewFilterDialogue.prototype.html='<div class="modal-header">\n    <a href="#" class="close pull-right im-close">close</a>\n    <h3>Add New Filter</h3>\n</div>\n<div class="modal-body">\n</div>\n<div class="modal-footer">\n    <button class="disabled btn btn-primary pull-right im-add-constraint">\n        Add Filter\n    </button>\n    <button class="btn im-close pull-left">\n        Cancel\n    </button>\n</div>';NewFilterDialogue.prototype.initialize=function(query){var _this=this;this.query=query;this.query.on("change:constraints",this.closeDialogue,this);return this.query.on("editing-constraint",function(){return _this.$(".im-add-constraint").removeClass("disabled")})};NewFilterDialogue.prototype.events={"click .im-close":"closeDialogue",hidden:"onHidden","click .im-add-constraint":"addConstraint"};NewFilterDialogue.prototype.onHidden=function(e){if(!(e&&e.target===this.el)){return false}return this.remove()};NewFilterDialogue.prototype.closeDialogue=function(e){return this.$el.modal("hide")};NewFilterDialogue.prototype.openDialogue=function(){return this.$el.modal().modal("show")};NewFilterDialogue.prototype.addConstraint=function(e){var edited;edited=this.conAdder.newCon.editConstraint(e);if(edited){return this.$el.modal("hide")}};NewFilterDialogue.prototype.render=function(){this.$el.append(this.html);this.conAdder=new intermine.query.ConstraintAdder(this.query);this.$el.find(".modal-body").append(this.conAdder.render().el);this.conAdder.showTree();return this};return NewFilterDialogue}(Backbone.View);return scope("intermine.filters",{NewFilterDialogue:NewFilterDialogue})})();define("perma-query",function(){var Deferred,any,defer,get,getPermaQuery,replaceIdConstraint,whenAll,zip;get=intermine.funcutils.get;any=_.any,zip=_.zip;Deferred=jQuery.Deferred;defer=function(x){return Deferred(function(){return this.resolve(x)})};whenAll=function(promises){return $.when.apply($,promises).then(function(){var results;results=1<=arguments.length?__slice.call(arguments,0):[];return results.slice()})};replaceIdConstraint=function(classkeys,query){return function(c){var def,finding,keys,path,type,_ref;path=query.makePath(c.path);def=new Deferred;if(!(((_ref=c.op)==="="||_ref==="==")&&path.end.name==="id")){def.resolve(c)}else{type=path.getParent().getType().name;keys=classkeys[type];if(keys==null){def.reject("No class keys configured for "+type)}else{finding=query.service.rows({select:keys,where:{id:c.value}}).then(get(0));finding.fail(def.reject);finding.then(function(values){var value,_i,_len,_ref1,_ref2;if(!values){return def.reject(""+type+"@"+c.value+" not found")}_ref1=zip(keys,values);for(_i=0,_len=_ref1.length;_i<_len;_i++){_ref2=_ref1[_i],path=_ref2[0],value=_ref2[1];if(value!=null){return def.resolve({path:path,value:value,op:"=="})}}return def.reject(""+type+"@"+c.value+" has no identifying fields")})}}return def.promise()}};return getPermaQuery=function(query){var applyNewCons,c,containsIdConstraint,copy,def,nodes;nodes=function(){var _i,_len,_ref,_results;_ref=query.constraints;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){c=_ref[_i];if(c.type==null){_results.push(query.makePath(c.path))}}return _results}();containsIdConstraint=nodes.length&&any(nodes,function(n){var _ref;return"id"===((_ref=n.end)!=null?_ref.name:void 0)});copy=query.clone();if(!containsIdConstraint){return defer(copy)}def=new Deferred;applyNewCons=function(newCons){copy.constraints=newCons;return def.resolve(copy)};query.service.get("classkeys").then(function(_arg){var classes,replaceIdCon;classes=_arg.classes;replaceIdCon=replaceIdConstraint(classes,copy);return whenAll(function(){var _i,_len,_ref,_results;_ref=copy.constraints;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){c=_ref[_i];_results.push(replaceIdCon(c))}return _results}()).then(applyNewCons).fail(def.reject)});return def.promise()}});(function(){var CompactView,DashBoard,Toolless,_ref,_ref1,_ref2;DashBoard=function(_super){__extends(DashBoard,_super);function DashBoard(){_ref=DashBoard.__super__.constructor.apply(this,arguments);return _ref}DashBoard.prototype.tagName="div";DashBoard.prototype.className="query-display row-fluid";DashBoard.prototype.initialize=function(service,query,queryEvents,tableProperties){var _ref1,_this=this;this.query=query;this.queryEvents=queryEvents;this.tableProperties=tableProperties;this.columnHeaders=new Backbone.Collection;this.states=new intermine.models.table.History;if((_ref1=this.events)==null){this.events={}}if(_(service).isString()){this.service=new intermine.Service({root:service})}else if(service.fetchModel!=null){this.service=service}else{this.service=new intermine.Service(service)}return this.states.on("reverted add",function(){return _this.loadQuery(_this.states.currentQuery)})};DashBoard.prototype.TABLE_CLASSES="span9 im-query-results";DashBoard.prototype.loadQuery=function(q){var cb,currentPageSize,evt,k,v,_ref1,_ref2,_ref3,_ref4,_results;currentPageSize=(_ref1=this.table)!=null?_ref1.getCurrentPageSize():void 0;if((_ref2=this.table)!=null){_ref2.remove()}this.main.empty();this.table=new intermine.query.results.Table(q,this.main,this.columnHeaders);_ref3=this.tableProperties;for(k in _ref3){v=_ref3[k];this.table[k]=v}if(currentPageSize!=null){this.table.pageSize=currentPageSize}this.table.render();_ref4=this.queryEvents;_results=[];for(evt in _ref4){cb=_ref4[evt];_results.push(q.on(evt,cb))}return _results};DashBoard.prototype.render=function(){var queryPromise,_this=this;this.$el.addClass(intermine.options.StylePrefix);this.tools=$('<div class="clearfix">');this.$el.append(this.tools);this.main=$('<div class="'+this.TABLE_CLASSES+'">');this.$el.append(this.main);queryPromise=this.service.query(this.query);queryPromise.done(function(q){return _this.states.addStep("Original state",q)});queryPromise.done(function(q){_this.renderQueryManagement(q);return _this.renderTools(q)});queryPromise.fail(function(xhr,err,msg){return _this.$el.append('<div class="alert alert-error">\n  <h1>'+(err||xhr)+"</h1>\n  <p>Unable to construct query: "+(msg||xhr)+"</p>\n</div>")});return this};DashBoard.prototype.renderTools=function(q){var tools;tools=this.make("div",{"class":"span3 im-query-toolbox"});this.$el.append(tools);this.toolbar=new intermine.query.tools.Tools(this.states);return this.toolbar.render().$el.appendTo(tools)};DashBoard.prototype.renderQueryManagement=function(q){var ManagementTools,Trail,managementGroup,trail,_ref1;_ref1=intermine.query.tools,ManagementTools=_ref1.ManagementTools,Trail=_ref1.Trail;managementGroup=new ManagementTools(this.states,this.columnHeaders);managementGroup.render().$el.appendTo(this.tools);trail=new Trail(this.states);return trail.render().$el.appendTo(managementGroup.el)};return DashBoard}(Backbone.View);CompactView=function(_super){__extends(CompactView,_super);function CompactView(){_ref1=CompactView.__super__.constructor.apply(this,arguments);
return _ref1}CompactView.prototype.className="im-query-display compact";CompactView.prototype.TABLE_CLASSES="im-query-results";CompactView.prototype.renderTools=function(q){this.toolbar=new intermine.query.tools.ToolBar(this.states);return this.tools.append(this.toolbar.render().el)};return CompactView}(DashBoard);Toolless=function(_super){__extends(Toolless,_super);function Toolless(){_ref2=Toolless.__super__.constructor.apply(this,arguments);return _ref2}Toolless.prototype.className="im-query-display im-toolless";Toolless.prototype.TABLE_CLASSES="im-query-results";Toolless.prototype.renderTools=function(q){};Toolless.prototype.renderQueryManagement=function(q){var Trail,trail;Trail=intermine.query.tools.Trail;trail=new Trail(this.states);return this.$el.prepend(trail.render().el)};return Toolless}(DashBoard);return scope("intermine.query.results",{DashBoard:DashBoard,CompactView:CompactView,Toolless:Toolless})})();scope("intermine.messages.columns",{AddThisColumn:"Add this column to the Sort Order"});(function(){var OrderElement,PossibleOrderElements,PossibleSortOrder,SortOrder,_ref,_ref1,_ref2,_ref3;OrderElement=function(_super){__extends(OrderElement,_super);function OrderElement(){_ref=OrderElement.__super__.constructor.apply(this,arguments);return _ref}OrderElement.prototype.isNumeric=false;OrderElement.prototype.initialize=function(){var _ref1;OrderElement.__super__.initialize.apply(this,arguments);if(!this.has("direction")){this.set({direction:"ASC"})}return this.isNumeric=(_ref1=this.get("path").getType(),__indexOf.call(intermine.Model.NUMERIC_TYPES,_ref1)>=0)};OrderElement.prototype.toJSON=function(){return{path:this.get("path").toString(),direction:this.get("direction")}};return OrderElement}(Backbone.Model);SortOrder=function(_super){__extends(SortOrder,_super);function SortOrder(){_ref1=SortOrder.__super__.constructor.apply(this,arguments);return _ref1}SortOrder.prototype.model=OrderElement;SortOrder.prototype.initialize=function(){return this.on("destroy",this.remove,this)};return SortOrder}(Backbone.Collection);PossibleSortOrder=function(_super){__extends(PossibleSortOrder,_super);function PossibleSortOrder(){_ref2=PossibleSortOrder.__super__.constructor.apply(this,arguments);return _ref2}PossibleSortOrder.prototype.toSortOrder=function(){return{path:this.get("path")}};PossibleSortOrder.prototype.isInView=function(){var _ref3;return _ref3=this.get("path").toString(),__indexOf.call(this.get("query").views,_ref3)>=0};PossibleSortOrder.prototype.initialize=function(){this.set({visibleInView:true,matchesTerm:true});return this.set({path:this.get("query").getPathInfo(this.get("path"))})};PossibleSortOrder.prototype.toJSON=function(){return{isInView:this.isInView(),path:this.get("path").toString()}};return PossibleSortOrder}(Backbone.Model);PossibleOrderElements=function(_super){__extends(PossibleOrderElements,_super);function PossibleOrderElements(){_ref3=PossibleOrderElements.__super__.constructor.apply(this,arguments);return _ref3}PossibleOrderElements.prototype.model=PossibleSortOrder;PossibleOrderElements.prototype.initialize=function(){return this.on("destroy",this.remove,this)};return PossibleOrderElements}(Backbone.Collection);return scope("intermine.columns.collections",{SortOrder:SortOrder,PossibleOrderElements:PossibleOrderElements})})();(function(){var OrderElement,PossibleOrderElement,placement,_ref,_ref1;placement=intermine.utils.addStylePrefix("top");OrderElement=function(_super){var TEMPLATE;__extends(OrderElement,_super);function OrderElement(){_ref=OrderElement.__super__.constructor.apply(this,arguments);return _ref}OrderElement.prototype.tagName="li";OrderElement.prototype.className="im-reorderable im-soe im-in-order";TEMPLATE=_.template('<div>\n  <span class="im-sort-direction <%= direction.toLowerCase() %>"></span>\n  <i class="'+intermine.css.headerIcon+" "+intermine.css.headerIconRemove+' im-remove-soe" t\n     title="Remove this column from the sort order"></i>\n  <span class="im-path" title="<%- path %>"><%- path %></span>\n  <i class="'+intermine.icons.Reorder+' pull-right"></i>\n</div>');OrderElement.prototype.initialize=function(options){var _this=this;this.options=options!=null?options:{};this.model.on("change:direction",function(){return _this.$(".im-sort-direction").toggleClass("asc desc")});this.model.on("destroy",this.remove,this);return this.model.el=this.el};OrderElement.prototype.events={"click .im-sort-direction":"changeDirection","click .im-remove-soe":"deorder"};OrderElement.prototype.deorder=function(){return this.model.destroy()};OrderElement.prototype.changeDirection=function(){var direction;direction=this.model.get("direction")==="ASC"?"DESC":"ASC";return this.model.set({direction:direction})};OrderElement.prototype.remove=function(){this.model.off();this.$(".im-remove-soe").tooltip("hide");return OrderElement.__super__.remove.call(this)};OrderElement.prototype.render=function(){var _this=this;if(this.model.isNumeric){this.$el.addClass("numeric")}this.$el.append(TEMPLATE(this.model.toJSON()));this.$(".im-remove-soe").tooltip({placement:placement});this.model.get("path").getDisplayName().done(function(name){return _this.$(".im-path").text(name)});return this};return OrderElement}(Backbone.View);PossibleOrderElement=function(_super){var TEMPLATE;__extends(PossibleOrderElement,_super);function PossibleOrderElement(){_ref1=PossibleOrderElement.__super__.constructor.apply(this,arguments);return _ref1}PossibleOrderElement.prototype.tagName="li";PossibleOrderElement.prototype.className="im-soe";TEMPLATE=_.template('<div>\n  <a class="im-add-soe"\n     title="'+intermine.messages.columns.AddThisColumn+'" >\n    <i class="'+intermine.icons.Add+'"></i>\n    <span title="<%- path %>"><%- path %></span>\n  </a>\n  <i class="'+intermine.icons.Reorder+' pull-right"></i>\n</div>');PossibleOrderElement.prototype.events={"click .im-add-soe":"addToOrderBy",dropped:"addToOrderBy"};PossibleOrderElement.prototype.addToOrderBy=function(){this.options.sortOrder.add(this.model.toSortOrder());this.model.destroy();return this.remove()};PossibleOrderElement.prototype.remove=function(){this.model.off();this.$(".im-add-soe").tooltip("hide");return PossibleOrderElement.__super__.remove.call(this)};PossibleOrderElement.prototype.initialize=function(options){var _this=this;this.options=options!=null?options:{};this.model.on("only-in-view",function(only){return _this.model.set({visibleInView:!only||_this.model.isInView()})});this.model.on("filter",function(pattern){return _this.model.set({matchesTerm:!pattern||pattern.test(_this.model.get("path"))})});return this.model.on("change",function(){var visible;visible=_this.model.get("visibleInView")&&_this.model.get("matchesTerm");return _this.$el.toggle(visible)})};PossibleOrderElement.prototype.render=function(){var so,_this=this;so=this.model.toJSON();this.$el.append(TEMPLATE(so));if(!so.isInView){this.$el.addClass("im-not-in-view")}this.model.get("path").getDisplayName().done(function(name){return _this.$("span").text(name)});this.$el.draggable({revert:"invalid",revertDuration:100});this.$(".im-add-soe").tooltip({placement:placement});return this};return PossibleOrderElement}(Backbone.View);return scope("intermine.columns.views",{PossibleOrderElement:PossibleOrderElement,OrderElement:OrderElement})})();(function(){var FormattedSorting,ICONS,INIT_CARETS,NEXT_DIRECTION_OF,ROW,_ref;ROW='<li class="im-formatted-part im-subpath"><a><i class="sort-icon"></i></a></li>';INIT_CARETS=/^\s*>\s*/;ICONS=function(){return{ASC:intermine.css.sortedASC,DESC:intermine.css.sortedDESC,NONE:intermine.css.unsorted}};NEXT_DIRECTION_OF={ASC:"DESC",DESC:"ASC",NONE:"ASC"};FormattedSorting=function(_super){__extends(FormattedSorting,_super);function FormattedSorting(){this.appendSortOption=__bind(this.appendSortOption,this);_ref=FormattedSorting.__super__.constructor.apply(this,arguments);return _ref}FormattedSorting.prototype.className="im-col-sort-menu no-margins";FormattedSorting.prototype.tagName="ul";FormattedSorting.prototype.initialize=function(query,path,model){this.query=query;this.path=path;this.model=model};FormattedSorting.prototype.toggleSort=function(paths){var currentDir,direction,path;console.log("Ordering by "+paths);currentDir=this.currentDir(paths);direction=NEXT_DIRECTION_OF[currentDir];this.query.orderBy(function(){var _i,_len,_results;_results=[];for(_i=0,_len=paths.length;_i<_len;_i++){path=paths[_i];_results.push({path:path,direction:direction})}return _results}());this.model.set({direction:direction});return this.remove()};FormattedSorting.prototype.currentDir=function(paths){var current,dirs,p;dirs=function(){var _i,_len,_results;_results=[];for(_i=0,_len=paths.length;_i<_len;_i++){p=paths[_i];_results.push(this.query.getSortDirection(p))}return _results}.call(this);if(_.unique(dirs).length===1){current=dirs[0]}return current!=null?current:"NONE"};FormattedSorting.prototype.render=function(){var paths,replaces;console.log("Rendering FormattedSorting for "+this.path);paths=[];replaces=this.model.get("replaces");if(replaces.length>1){paths=[replaces].concat(replaces.map(function(x){return[x]}))}else{paths=[this.path]}if(paths.length===1){this.toggleSort(paths[0])}else{paths.forEach(this.appendSortOption)}return this};FormattedSorting.prototype.appendSortOption=function(paths){var $a,currentDir,icons,li,p,_fn,_i,_len,_this=this;li=$(ROW);$a=li.find("a");icons=ICONS();_fn=function(p){var $span,path;console.log("Adding span for "+p);$span=$('<span class="im-sort-path">');$a.append($span);path=_this.query.getPathInfo(p);return $.when(_this.path.getDisplayName(),path.getDisplayName()).done(function(pn,cn){return $span.text(cn.replace(pn,"").replace(INIT_CARETS,""))})};for(_i=0,_len=paths.length;_i<_len;_i++){p=paths[_i];_fn(p)}$a.click(function(e){e.stopPropagation();e.preventDefault();return _this.toggleSort(paths)});currentDir=paths===this.model.get("replaces")?this.currentDir(paths):this.currentDir(this.model.get("replaces"))!=="NONE"?"NONE":this.currentDir(paths);li.find("i").addClass(icons[currentDir]);this.$el.append(li);return null};return FormattedSorting}(Backbone.View);return scope("intermine.query",{FormattedSorting:FormattedSorting})})();(function(){var CellCutoff,HIDDEN_FIELDS,NUM_CHUNK_SIZE,NUM_SEPARATOR,Preview,getLeaves,numToStr,sortTableByFieldName,toField,_ref,_ref1;HIDDEN_FIELDS=["class","objectId"];getLeaves=function(o){var leaf,leaves,name,values,_i,_len;leaves=[];values=function(){var _results;_results=[];for(name in o){leaf=o[name];if(__indexOf.call(HIDDEN_FIELDS,name)<0){_results.push(leaf)}}return _results}();for(_i=0,_len=values.length;_i<_len;_i++){x=values[_i];if(x["objectId"]){leaves=leaves.concat(getLeaves(x))}else{leaves.push(x)}}return leaves};toField=function(row){return $(row).find(".im-field-name").text()};sortTableByFieldName=function(tbody){return tbody.html(_.sortBy(tbody.children("tr").get(),toField))};_ref=intermine.options,NUM_SEPARATOR=_ref.NUM_SEPARATOR,NUM_CHUNK_SIZE=_ref.NUM_CHUNK_SIZE,CellCutoff=_ref.CellCutoff;numToStr=function(n){return intermine.utils.numToString(n,NUM_SEPARATOR,NUM_CHUNK_SIZE)};Preview=function(_super){var ITEMS,ITEM_ROW,REFERENCE,RELATION,RELATIONS,THROBBER;__extends(Preview,_super);function Preview(){this.handleItem=__bind(this.handleItem,this);_ref1=Preview.__super__.constructor.apply(this,arguments);return _ref1}Preview.prototype.className="im-cell-preview-inner";ITEM_ROW=_.template('<tr>\n  <td class="im-field-name"><%= field %></td>\n  <td class="im-field-value <%= field.toLowerCase() %>">\n    <%- value %>\n    <span class="im-overspill"><%- valueOverspill %></span>\n    <% if (tooLong) { %>\n      <a href="#" class="im-too-long">\n        <span class="im-ellipsis">...</span>\n        <i class="'+intermine.icons.More+'"></i>\n      </a>\n    <% } %>\n  </td>\n</tr>');THROBBER='<div class="progress progress-info progress-striped active">\n  <div class="bar" style="width: 100%"></div>\n</div>';ITEMS='<table class="im-item-details table table-condensed table-bordered">\n<colgroup>\n    <col class="im-item-field"/>\n    <col class="im-item-value"/>\n</colgroup>\n</table>';RELATIONS='<ul class="im-related-counts"></ul>';RELATION=_.template('<li class="im-relation">\n  <span class="pull-left"><%- label %></span>\n  <span class="pull-right im-count"><%= count %></span>\n</li>');REFERENCE=_.template('<tr>\n  <td class="im-field-name"><%= field %></td>\n  <td class="im-field-value <%= field.toLowerCase() %>">\n     <%- values.join(\', \') %>\n  </td>\n</tr>');Preview.prototype.events={"click .im-too-long":"revealLongField"};Preview.prototype.revealLongField=function(e){var $overSpill,$tooLong;if(e!=null){e.preventDefault()}if(e!=null){e.stopPropagation()}$tooLong=$(e.currentTarget);$overSpill=$tooLong.siblings(".im-overspill");$tooLong.remove();return $overSpill.show()};Preview.prototype.template=_.template(THROBBER);Preview.prototype.initialize=function(options){this.options=options!=null?options:{};Preview.__super__.initialize.apply(this,arguments);return this.on("rendered",this.insertRows,this)};Preview.prototype.formatName=function(field,row){var fv,p,type,_this=this;type=this.model.get("type");p=this.options.schema.getPathInfo(""+type+"."+field);fv=row.find(".im-field-value");fv.addClass(p.getType().toString().toLowerCase());return p.getDisplayName().done(function(name){row.find(".im-field-name").text(name.split(" > ").pop());sortTableByFieldName(row.parent());return _this.trigger("ready")})};Preview.prototype.handleItem=function(item){var field,row,snipPoint,table,tooLong,v,value,valueOverspill,values,_results;table=this.itemDetails;for(field in item){v=item[field];if(!(v&&__indexOf.call(HIDDEN_FIELDS,field)<0&&!v["objectId"])){continue}value=v+"";tooLong=value.length>CellCutoff;snipPoint=value.indexOf(" ",CellCutoff*.9);if(snipPoint===-1){snipPoint=CellCutoff}value=tooLong?value.substring(0,snipPoint):value;valueOverspill=(v+"").substring(snipPoint);row=$(ITEM_ROW({field:field,value:value,tooLong:tooLong,valueOverspill:valueOverspill}));this.formatName(field,row);table.append(row)}_results=[];for(field in item){value=item[field];if(!(value&&value["objectId"])){continue}values=getLeaves(value);row=$(REFERENCE({field:field,values:values}));this.formatName(field,row);_results.push(table.append(row))}return _results};Preview.prototype.fillRelationsTable=function(table){var settings,type,_i,_len,_ref2,_ref3,_ref4,_results;type=this.model.get("type");root=this.options.service.root;_ref4=(_ref2=(_ref3=intermine.options.preview.count[root])!=null?_ref3[type]:void 0)!=null?_ref2:[];_results=[];for(_i=0,_len=_ref4.length;_i<_len;_i++){settings=_ref4[_i];_results.push(this.handleRelationCount(settings))}return _results};Preview.prototype.handleRelationCount=function(settings){var counter,id,label,query,table,type,_ref2;table=this.relatedCounts;_ref2=this.model.toJSON(),type=_ref2.type,id=_ref2.id;if(_.isObject(settings)){query=settings.query,label=settings.label;counter=intermine.utils.copy(query);intermine.utils.walk(counter,function(o,k,v){if(v==="{{ID}}"){return o[k]=id}})}else{label=settings;counter={select:settings+".id",from:type,where:{id:id}}}return this.options.service.count(counter).done(function(c){return table.append(RELATION({label:label,count:numToStr(c)}))})};Preview.prototype.fillItemTable=function(){var id,schema,service,t,table,type,types,_ref2,_ref3;_ref2=this.model.toJSON(),type=_ref2.type,id=_ref2.id;_ref3=this.options,schema=_ref3.schema,service=_ref3.service;table=this.itemDetails;types=[type].concat(schema.getAncestorsOf(type));table.addClass(function(){var _i,_len,_results;_results=[];for(_i=0,_len=types.length;_i<_len;_i++){t=types[_i];_results.push(t.toLowerCase())}return _results}().join(" "));return service.findById(type,id,this.handleItem)};Preview.prototype.insertRows=function(){var promise,ready,relations,_i,_len,_this=this;this.itemDetails=$(ITEMS);this.relatedCounts=$(RELATIONS);ready=this.fillItemTable();relations=this.fillRelationsTable();for(_i=0,_len=relations.length;_i<_len;_i++){promise=relations[_i];ready=ready.then(function(){return promise})}ready.done(function(){_this.$el.empty().append(_this.itemDetails);if(relations.length){_this.$el.append("<h4>"+intermine.messages.cell.RelatedItems+"</h4>");_this.$el.append(_this.relatedCounts)}return _this.trigger("ready")});return ready.fail(function(err){_this.renderError(err);return _this.trigger("ready")})};return Preview}(intermine.views.ItemView);return scope("intermine.table.cell",{Preview:Preview})})();(function(){var CELL_HTML,Cell,NullCell,SubTable,_CELL_HTML,_ref,_ref1,_ref2;_CELL_HTML=_.template('<input class="list-chooser" type="checkbox"\n  <% if (checked) { %> checked <% } %>\n  <% if (disabled) { %> disabled <% } %>\n  style="display: <%= display %>"\n>\n<a class="im-cell-link" target="<%= target %>" href="<%= url %>">\n  <% if (isForeign) { %>\n    <% if (icon) { %>\n      <img src="<%= icon %>" class="im-external-link"></img>\n    <% } else { %>\n      <i class="icon-globe"></i>\n    <% } %>\n  <% } %>\n  <% if (value == null) { %>\n    <span class="null-value">&nbsp;</span>\n  <% } else { %>\n    <span class="im-displayed-value">\n      <%= value %>\n    </span>\n  <% } %>\n</a>\n<% if (rawValue != null && field == \'url\' && rawValue != url) { %>\n    <a class="im-cell-link external" href="<%= rawValue %>">\n      <i class="icon-globe"></i>\n      link\n    </a>\n<% } %>');CELL_HTML=function(data){var host,url;url=data.url,host=data.host;data.isForeign=url&&!url.match(host);data.target=data.isForeign?"_blank":"";return _CELL_HTML(data)};SubTable=function(_super){__extends(SubTable,_super);function SubTable(){this.appendRow=__bind(this.appendRow,this);_ref=SubTable.__super__.constructor.apply(this,arguments);return _ref}SubTable.prototype.tagName="td";SubTable.prototype.className="im-result-subtable";SubTable.prototype.initialize=function(options){var subtable,_this=this;this.options=options!=null?options:{};this.query=this.options.query;this.cellify=this.options.cellify;this.path=this.options.node;subtable=this.options.subtable;this.rows=subtable.rows;this.view=subtable.view;this.column=this.query.getPathInfo(subtable.column);this.query.on("expand:subtables",function(path){if(path.toString()===_this.column.toString()){return _this.renderTable().slideDown()}});return this.query.on("collapse:subtables",function(path){if(path.toString()===_this.column.toString()){return _this.$(".im-subtable").slideUp()}})};SubTable.prototype.getSummaryText=function(){var def,level;def=jQuery.Deferred();if(this.column.isCollection()){def.resolve(""+this.rows.length+" "+this.column.getType().name+"s")}else{if(this.rows.length===0){level=this.query.isOuterJoined(this.view[0])?this.query.getPathInfo(this.query.getOuterJoin(this.view[0])):this.column;def.resolve('<span class="im-no-value">No '+level.getType().name+"</span>")}else{def.resolve(""+this.rows[0][0].value+" ("+this.rows[0].slice(1).map(function(c){return c.value}).join(", ")+")")}}return def.promise()};SubTable.prototype.getEffectiveView=function(){var c,cell,col,columns,commonPrefix,explicitReplacements,fieldExpr,formatter,getFormatter,getReplacedTest,isReplaced,longestCommonPrefix,parent,path,r,replacedBy,replaces,row,shouldFormat,subPath,sv,view,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7;_ref1=intermine.utils,getReplacedTest=_ref1.getReplacedTest,longestCommonPrefix=_ref1.longestCommonPrefix;_ref2=intermine.results,shouldFormat=_ref2.shouldFormat,getFormatter=_ref2.getFormatter;row=this.rows[0];replacedBy={};explicitReplacements={};columns=function(){var _i,_len,_ref3,_results;_results=[];for(_i=0,_len=row.length;_i<_len;_i++){cell=row[_i];_ref3=cell.view!=null?(commonPrefix=longestCommonPrefix(cell.view),path=this.query.getPathInfo(commonPrefix),[path,function(){var _j,_len1,_ref3,_results1;_ref3=cell.view;_results1=[];for(_j=0,_len1=_ref3.length;_j<_len1;_j++){sv=_ref3[_j];_results1.push(this.query.getPathInfo(sv))}return _results1}.call(this)]):(path=this.query.getPathInfo(cell.column),[path,[path]]),path=_ref3[0],replaces=_ref3[1];_results.push({path:path,replaces:replaces})}return _results}.call(this);for(_i=0,_len=columns.length;_i<_len;_i++){c=columns[_i];if(!(c.path.isAttribute()&&shouldFormat(c.path))){continue}parent=c.path.getParent();if((_ref3=replacedBy[parent])==null){replacedBy[parent]=c}formatter=getFormatter(c.path);if(__indexOf.call(this.options.blacklistedFormatters,formatter)<0){c.isFormatted=true;c.formatter=formatter;_ref5=(_ref4=formatter.replaces)!=null?_ref4:[];for(_j=0,_len1=_ref5.length;_j<_len1;_j++){fieldExpr=_ref5[_j];subPath=this.query.getPathInfo(""+parent+"."+fieldExpr);if((_ref6=replacedBy[subPath])==null){replacedBy[subPath]=c}c.replaces.push(subPath)}}_ref7=c.replaces;for(_k=0,_len2=_ref7.length;_k<_len2;_k++){r=_ref7[_k];explicitReplacements[r]=c}}isReplaced=getReplacedTest(replacedBy,explicitReplacements);view=[];for(_l=0,_len3=columns.length;_l<_len3;_l++){col=columns[_l];if(!!isReplaced(col)){continue}if(col.isFormatted){col.path=col.path.getParent()}view.push(col)}return view};SubTable.prototype.renderHead=function(headers,columns){var c,tableNamePromise,_i,_len,_results,_this=this;tableNamePromise=this.column.getDisplayName();_results=[];for(_i=0,_len=columns.length;_i<_len;_i++){c=columns[_i];_results.push(function(c){var th;th=$('<th>\n    <i class="'+intermine.css.headerIconRemove+'"></i>\n    <span></span>\n</th>');th.find("i").click(function(e){return _this.query.removeFromSelect(c.replaces)});$.when(tableNamePromise,c.path.getDisplayName()).then(function(tableName,colName){var span,text;text=colName.match(tableName)?colName.replace(tableName,"").replace(/^\s*>?\s*/,""):colName.replace(/^[^>]*\s*>\s*/,"");return span=th.find("span").text(text)});return headers.append(th)}(c))}return _results};SubTable.prototype.appendRow=function(columns,row,tbody){var c,cell,cells,processed,r,replacedBy,tr,w,_fn,_i,_j,_k,_len,_len1,_len2,_ref1,_this=this;if(tbody==null){tbody=this.$(".im-subtable tbody")}tr=$("<tr>");w=this.$el.width()/this.view.length;processed={};replacedBy={};for(_i=0,_len=columns.length;_i<_len;_i++){c=columns[_i];_ref1=c.replaces;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){r=_ref1[_j];replacedBy[r]=c}}cells=row.map(this.cellify);_fn=function(tr,cell){var formatter,otherC,path,replaces,_l,_len3,_len4,_m,_ref2,_ref3;if(processed[cell.path]){return}processed[cell.path]=true;_ref3=(_ref2=replacedBy[cell.path])!=null?_ref2:{replaces:[]},replaces=_ref3.replaces,formatter=_ref3.formatter,path=_ref3.path;if(replaces.length>1){if(!path.equals(cell.path.getParent())){return}if((formatter!=null?formatter.merge:void 0)!=null){for(_l=0,_len3=row.length;_l<_len3;_l++){otherC=row[_l];if(_.any(replaces,function(repl){return repl.equals(otherC.path)})){formatter.merge(cell.model,otherC.model)}}}}for(_m=0,_len4=replaces.length;_m<_len4;_m++){r=replaces[_m];processed[r]=true}if(formatter!=null){cell.formatter=formatter}tr.append(cell.el);return cell.render().setWidth(w)};for(_k=0,_len2=cells.length;_k<_len2;_k++){cell=cells[_k];_fn(tr,cell)}tr.appendTo(tbody);return null};SubTable.prototype.renderTable=function($table){var colRoot,colStr,columns,docfrag,row,tbody,_i,_len,_ref1;if($table==null){$table=this.$(".im-subtable")}if(this.tableRendered){return $table}colRoot=this.column.getType().name;colStr=this.column.toString();if(this.rows.length>0){columns=this.getEffectiveView();this.renderHead($table.find("thead tr"),columns);tbody=$table.find("tbody");docfrag=document.createDocumentFragment();if(this.column.isCollection()){_ref1=this.rows;for(_i=0,_len=_ref1.length;_i<_len;_i++){row=_ref1[_i];this.appendRow(columns,row,docfrag)}}else{this.appendRow(columns,this.rows[0],docfrag)}tbody.html(docfrag)}this.tableRendered=true;return $table};SubTable.prototype.events={"click .im-subtable-summary":"toggleTable"};SubTable.prototype.toggleTable=function(e){var $table,evt;if(e!=null){e.stopPropagation()}$table=this.$(".im-subtable");evt=$table.is(":visible")?"subtable:collapsed":(this.renderTable($table),"subtable:expanded");$table.slideToggle();return this.query.trigger(evt,this.column)};SubTable.prototype.render=function(){var icon,summary;icon=this.rows.length>0?'<i class="'+intermine.icons.Table+'"></i>':"<i class=icon-non-existent></i>";summary=$('<span class="im-subtable-summary">\n  '+icon+"&nbsp;\n</span>");summary.appendTo(this.$el);this.getSummaryText().done(function(content){return summary.append(content)});this.$el.append('<table class="im-subtable table table-condensed table-striped">\n  <thead><tr></tr></thead>\n  <tbody></tbody>\n</table>');if(intermine.options.SubtableInitialState==="open"||this.options.mainTable.SubtableInitialState==="open"){this.toggleTable()}return this};SubTable.prototype.getUnits=function(){if(this.rows.length=0){return this.view.length}else{return _.reduce(this.rows[0],function(a,item){return a+(item.view!=null?item.view.length:1)},0)}};SubTable.prototype.setWidth=function(w){return this};return SubTable}(Backbone.View);Cell=function(_super){__extends(Cell,_super);function Cell(){this.getPopoverPlacement=__bind(this.getPopoverPlacement,this);this.getPopoverContent=__bind(this.getPopoverContent,this);_ref1=Cell.__super__.constructor.apply(this,arguments);return _ref1}Cell.prototype.tagName="td";Cell.prototype.className="im-result-field";Cell.prototype.getUnits=function(){return 1};Cell.prototype.formatter=function(model){if(model.get(this.options.field)!=null){return model.escape(this.options.field)}else{return'<span class="null-value">&nbsp;</span>'}};Cell.prototype.initialize=function(options){var field,path;this.options=options!=null?options:{};this.model.on("change",this.selectingStateChange,this);this.model.on("change",this.updateValue,this);this.listenToQuery(this.options.query);field=this.options.field;path=this.path=this.options.node.append(field);return this.$el.addClass("im-type-"+path.getType().toLowerCase())};Cell.prototype.events=function(){var _this=this;return{shown:function(){var _ref2;return(_ref2=_this.cellPreview)!=null?_ref2.reposition():void 0},show:function(e){_this.options.query.trigger("showing:preview",_this.el);if(_this.model.get("is:selecting")){return e!=null?e.preventDefault():void 0}},hide:function(e){var _ref2;return(_ref2=_this.model.cachedPopover)!=null?_ref2.detach():void 0},click:"activateChooser","click a.im-cell-link":function(e){return e!=null?e.stopPropagation():void 0}}};Cell.prototype.reportClick=function(){return this.model.trigger("click",this.model)};Cell.prototype.listenToQuery=function(q){var _this=this;q.on("start:list-creation",function(){return _this.model.set({"is:selecting":true})});q.on("stop:list-creation",function(){return _this.model.set({"is:selecting":false,"is:selected":false})});q.on("showing:preview",function(el){var _ref2;if(el!==_this.el){return(_ref2=_this.cellPreview)!=null?_ref2.hide():void 0}});q.on("start:highlight:node",function(node){var _ref2;if(((_ref2=_this.options.node)!=null?_ref2.toPathString():void 0)===node.toPathString()){return _this.$el.addClass("im-highlight")}});q.on("stop:highlight",function(){return _this.$el.removeClass("im-highlight")});return q.on("replaced:by",function(replacement){return _this.listenToQuery(replacement)})};Cell.prototype.getPopoverContent=function(){var content,id,popover,type,_this=this;if(this.model.cachedPopover!=null){return this.model.cachedPopover}type=this.model.get("obj:type");id=this.model.get("id");popover=new intermine.table.cell.Preview({service:this.options.query.service,schema:this.options.query.model,model:{type:type,id:id}});content=popover.$el;popover.on("ready",function(){return _this.cellPreview.reposition()});popover.render();return this.model.cachedPopover=content};Cell.prototype.getPopoverPlacement=function(popover){var elPos,fitsOnLeft,fitsOnRight,h,left,limits,ph,pw,table,w;table=this.$el.closest(".im-table-container");left=this.$el.offset().left;limits=table.offset();_.extend(limits,{right:limits.left+table.width(),bottom:limits.top+table.height()});w=this.$el.width();h=this.$el.height();elPos=this.$el.offset();pw=$(popover).outerWidth();ph=$(popover)[0].offsetHeight;fitsOnRight=left+w+pw<=limits.right;fitsOnLeft=limits.left<=left-pw;if(fitsOnLeft){return"left"}if(fitsOnRight){return"right"}else{return"top"}};Cell.prototype.setupPreviewOverlay=function(){var options;options={container:this.el,containment:".im-query-results",html:true,title:this.model.get("obj:type"),trigger:intermine.options.CellPreviewTrigger,delay:{show:250,hide:250},classes:"im-cell-preview",content:this.getPopoverContent,placement:this.getPopoverPlacement};return this.cellPreview=new intermine.bootstrap.DynamicPopover(this.el,options)};Cell.prototype.updateValue=function(){var _this=this;return _.defer(function(){return _this.$(".im-displayed-value").html(_this.formatter(_this.model))})};Cell.prototype.getInputState=function(){var checked,disabled,display,selectable,selected,selecting,_ref2;_ref2=this.model.selectionState(),selected=_ref2.selected,selectable=_ref2.selectable,selecting=_ref2.selecting;checked=selected;disabled=!selectable;display=selecting&&selectable?"inline":"none";return{checked:checked,disabled:disabled,display:display}};Cell.prototype.selectingStateChange=function(){var checked,disabled,display,_ref2;_ref2=this.getInputState(),checked=_ref2.checked,disabled=_ref2.disabled,display=_ref2.display;this.$el.toggleClass("active",checked);return this.$("input").attr({checked:checked,disabled:disabled}).css({display:display})};Cell.prototype.getData=function(){var ExternalLinkIcons,IndicateOffHostLinks,data,domain,field,url,_ref2,_ref3;_ref2=intermine.options,IndicateOffHostLinks=_ref2.IndicateOffHostLinks,ExternalLinkIcons=_ref2.ExternalLinkIcons;field=this.options.field;data={value:this.formatter(this.model),rawValue:this.model.get(field),field:field,url:this.model.get("service:url"),host:IndicateOffHostLinks?window.location.host:/.*/,icon:null};_.extend(data,this.getInputState());if(!/^http/.test(data.url)){data.url=this.model.get("service:base")+data.url}for(domain in ExternalLinkIcons){url=ExternalLinkIcons[domain];if(data.url.match(domain)){if((_ref3=data.icon)==null){data.icon=url}}}return data};Cell.prototype.render=function(){var data;data=this.getData();this.$el.html(CELL_HTML(data));if(data.checked){this.$el.addClass("active")}if(this.model.get("id")){this.setupPreviewOverlay()}return this};Cell.prototype.setWidth=function(w){return this};Cell.prototype.activateChooser=function(){var selectable,selected,selecting,_ref2;this.reportClick();_ref2=this.model.selectionState(),selected=_ref2.selected,selectable=_ref2.selectable,selecting=_ref2.selecting;if(selectable&&selecting){return this.model.set({"is:selected":!selected})}};return Cell}(Backbone.View);NullCell=function(_super){__extends(NullCell,_super);function NullCell(){_ref2=NullCell.__super__.constructor.apply(this,arguments);return _ref2}NullCell.prototype.setupPreviewOverlay=function(){};NullCell.prototype.initialize=function(options){this.options=options!=null?options:{};this.model=new intermine.model.NullObject;return NullCell.__super__.initialize.call(this)};return NullCell}(Cell);return scope("intermine.results.table",{NullCell:NullCell,SubTable:SubTable,Cell:Cell})})();(function(){var COL_FILTER_TITLE,ColumnHeader,ICONS,NEXT_DIRECTION_OF,RENDER_TITLE,TEMPLATE,ignore,_ref;ignore=function(e){if(e!=null){e.preventDefault()}if(e!=null){e.stopPropagation()}return false};ICONS=function(){return{ASC:intermine.css.sortedASC,DESC:intermine.css.sortedDESC,css_unsorted:intermine.css.unsorted,css_header:intermine.icons.Base+" "+intermine.css.headerIcon,css_remove:intermine.css.headerIconRemove,css_hide:intermine.css.headerIconHide,css_reveal:intermine.css.headerIconReveal,css_filter:intermine.icons.Filter,css_summary:intermine.icons.Summary,css_composed:intermine.icons.Composed}};TEMPLATE=_.template(' \n<div class="im-column-header">\n  <div class="im-th-buttons">\n    <% if (sortable) { %>\n      <span class="im-th-dropdown im-col-sort dropdown">\n        <a class="im-th-button im-col-sort-indicator" title="sort this column">\n          <i class="icon-sorting <%- css_unsorted %> <%- css_header %>"></i>\n        </a>\n        <div class="dropdown-menu">\n          <div>Could not intitialise the sorting menu.</div>\n        </div>\n      </span>\n    <% }; %>\n    <a class="im-th-button im-col-remover"\n       title="remove this column">\n      <i class="<%- css_remove %> <%- css_header %>"></i>\n    </a>\n    <a class="im-th-button im-col-minumaximiser"\n       title="Toggle column visibility">\n      <i class="<%- css_hide %> <%- css_header %>"></i>\n    </a>\n    <span class="dropdown im-filter-summary im-th-dropdown">\n      <a class="im-th-button im-col-filters dropdown-toggle"\n         title=""\n         data-toggle="dropdown" >\n        <i class="<%- css_filter %> <%- css_header %>"></i>\n      </a>\n      <div class="dropdown-menu">\n        <div>Could not ititialise the filter summary.</div>\n      </div>\n    </span>\n    <span class="dropdown im-summary im-th-dropdown">\n      <a class="im-th-button summary-img dropdown-toggle" title="column summary"\n        data-toggle="dropdown" >\n        <i class="<%- css_summary %> <%- css_header %>"></i>\n      </a>\n      <div class="dropdown-menu">\n        <div>Could not ititialise the column summary.</div>\n      </div>\n    </span>\n    <a class="im-th-button im-col-composed"\n        title="Toggle formatting">\n      <i class="<%- css_composed %> <%- css_header %>"></i>\n    </a>\n  </div>\n  <div class="im-col-title">\n    <%- path %>\n  </div>\n</div>');
COL_FILTER_TITLE=function(count){if(count>0){return""+count+" active filters"}else{return"Filter by values in this column"}};RENDER_TITLE=_.template('<div\n  class="im-title-part im-parent im-<%= parentType %>-parent<% if (!last) { %> im-last<% } %>">\n    <%- penult %>\n</div>\n<% if (last) { %>\n  <div class="im-title-part im-last"><%- last %></div>\n<% } %>');NEXT_DIRECTION_OF={ASC:"DESC",DESC:"ASC"};ColumnHeader=function(_super){var firstResult,getCompositionTitle;__extends(ColumnHeader,_super);function ColumnHeader(){this.toggleSubTable=__bind(this.toggleSubTable,this);this.setSortOrder=__bind(this.setSortOrder,this);this.minumaximise=__bind(this.minumaximise,this);this.toggleColumnVisibility=__bind(this.toggleColumnVisibility,this);this.showFilterSummary=__bind(this.showFilterSummary,this);this.showColumnSummary=__bind(this.showColumnSummary,this);this.showSummary=__bind(this.showSummary,this);this.bestFit=__bind(this.bestFit,this);this.displaySortDirection=__bind(this.displaySortDirection,this);this.displayConCount=__bind(this.displayConCount,this);this.updateModel=__bind(this.updateModel,this);this.renderName=__bind(this.renderName,this);_ref=ColumnHeader.__super__.constructor.apply(this,arguments);return _ref}ColumnHeader.prototype.tagName="th";ColumnHeader.prototype.className="im-column-th";ColumnHeader.prototype.initialize=function(_arg){var query,_this=this;query=_arg.query;this.query=query;this.view=this.model.get("path").toString();if(this.model.get("replaces").length===1&&this.model.get("isFormatted")){this.view=this.model.get("replaces")[0].toString()}this.namePromise=this.model.get("path").getDisplayName();this.namePromise.done(function(name){return _this.model.set({name:name})});this.updateModel();this.query.on("change:sortorder",this.updateModel);this.query.on("change:joins",this.updateModel);this.query.on("change:constraints",this.updateModel);this.query.on("change:minimisedCols",this.minumaximise);this.query.on("subtable:expanded",function(node){if(node.toString().match(_this.view)){return _this.model.set({expanded:true})}});this.query.on("subtable:collapsed",function(node){if(node.toString().match(_this.view)){return _this.model.set({expanded:false})}});this.query.on("showing:column-summary",function(path){var _ref1;if(!path.equals(_this.model.get("path"))){return(_ref1=_this.summary)!=null?_ref1.remove():void 0}});this.model.on("change:conCount",this.displayConCount);return this.model.on("change:direction",this.displaySortDirection)};getCompositionTitle=function(replaces){return"This column replaces "+replaces.length+" others. Click here\nto show the individual columns separately."};ColumnHeader.prototype.renderName=function(){var ancestors,content,last,p,parentType,parts,penult,title,_i,_ref1;_ref1=parts=this.model.get("name").split(" > "),ancestors=3<=_ref1.length?__slice.call(_ref1,0,_i=_ref1.length-2):(_i=0,[]),penult=_ref1[_i++],last=_ref1[_i++];parentType=ancestors.length?"non-root":"root";parts=function(){var _j,_len,_results;_results=[];for(_j=0,_len=parts.length;_j<_len;_j++){p=parts[_j];_results.push('<span class="im-name-part">'+p+"</span>")}return _results}();content=RENDER_TITLE({penult:penult,last:last,parentType:parentType});title=parts.join("");return this.$(".im-col-title").html(content).popover({title:title,placement:"bottom",html:true})};ColumnHeader.prototype.isComposed=function(){if(this.query.isOuterJoined(this.view)){return false}return(this.model.get("replaces")||[]).length>1};ColumnHeader.prototype.render=function(){var replaces,_this=this;this.$el.empty();this.$el.append(this.html());this.displayConCount();this.displaySortDirection();this.namePromise.done(this.renderName);this.$(".summary-img").click(this.showColumnSummary);this.$(".im-col-filters").click(this.showFilterSummary);replaces=this.model.get("replaces");this.$(".im-col-composed").attr({title:getCompositionTitle(replaces)}).click(function(){return _this.query.trigger("formatter:blacklist",_this.view,_this.model.get("formatter"))});this.$el.toggleClass("im-is-composed",this.isComposed());this.$(".im-th-button").tooltip({placement:this.bestFit,container:this.el});this.$(".dropdown .dropdown-toggle").dropdown();if(!this.model.get("path").isAttribute()&&this.query.isOuterJoined(this.view)){this.addExpander()}if(this.model.get("expanded")){this.query.trigger("expand:subtables",this.model.get("path"))}return this};firstResult=_.compose(_.first,_.compact,_.map);ColumnHeader.prototype.updateModel=function(){var direction,_this=this;direction=firstResult(this.model.get("replaces").concat(this.view),function(p){return _this.query.getSortDirection(p)});return this.model.set({direction:direction,sortable:!this.query.isOuterJoined(this.view),conCount:_.size(_.filter(this.query.constraints,function(c){return!!c.path.match(_this.view)}))})};ColumnHeader.prototype.displayConCount=function(){var conCount;conCount=this.model.get("conCount");if(conCount){this.$el.addClass("im-has-constraint")}return this.$(".im-col-filters").attr({title:COL_FILTER_TITLE(conCount)})};ColumnHeader.prototype.html=function(){return TEMPLATE(_.extend({},ICONS(),this.model.toJSON()))};ColumnHeader.prototype.displaySortDirection=function(){var ASC,DESC,css_unsorted,icons,sortButton,_ref1;sortButton=this.$(".icon-sorting");_ref1=icons=ICONS(),css_unsorted=_ref1.css_unsorted,ASC=_ref1.ASC,DESC=_ref1.DESC;sortButton.addClass(css_unsorted);sortButton.removeClass(ASC+" "+DESC);if(this.model.has("direction")){return sortButton.toggleClass(css_unsorted+" "+icons[this.model.get("direction")])}};ColumnHeader.prototype.events={"click .im-col-sort":"setSortOrder","click .im-col-minumaximiser":"toggleColumnVisibility","click .im-col-filters":"showFilterSummary","click .im-subtable-expander":"toggleSubTable","click .im-col-remover":"removeColumn","toggle .im-th-button":"summaryToggled"};ColumnHeader.prototype.summaryToggled=function(e,isOpen){var _ref1;ignore(e);if(e.target!==e.currentTarget){return}if(!isOpen){return(_ref1=this.summary)!=null?_ref1.remove():void 0}};ColumnHeader.prototype.hideTooltips=function(){return this.$(".im-th-button").tooltip("hide")};ColumnHeader.prototype.removeColumn=function(e){var unwanted,v;this.hideTooltips();unwanted=function(){var _i,_len,_ref1,_results;_ref1=this.query.views;_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){v=_ref1[_i];if(v.match(this.view)){_results.push(v)}}return _results}.call(this);this.query.removeFromSelect(unwanted);return false};ColumnHeader.prototype.bestFit=function(tip,elem){$(tip).addClass(intermine.options.StylePrefix);return"top"};ColumnHeader.prototype.checkHowFarOver=function(el){var bounds;bounds=this.$el.closest(".im-table-container");if(el.offset().left+350>=bounds.offset().left+bounds.width()){return this.$el.addClass("too-far-over")}};ColumnHeader.prototype.showSummary=function(selector,View){var _this=this;return function(e){var $menu,summary;ignore(e);_this.checkHowFarOver(e!=null?$(e.currentTarget):_this.$el);if(!_this.$(selector).hasClass("open")){_this.query.trigger("showing:column-summary",_this.model.get("path"));summary=new View(_this.query,_this.model.get("path"),_this.model);$menu=_this.$(selector+" .dropdown-menu");if(!$menu.length){console.log(""+selector+" not found")}$menu.html(summary.el);summary.render();_this.summary=summary}return false}};ColumnHeader.prototype.showColumnSummary=function(e){var cls;cls=this.path().isAttribute()?intermine.query.results.DropDownColumnSummary:intermine.query.results.OuterJoinDropDown;return this.showSummary(".im-summary",cls)(e)};ColumnHeader.prototype.showFilterSummary=function(e){return this.showSummary(".im-filter-summary",intermine.query.filters.SingleColumnConstraints)(e)};ColumnHeader.prototype.toggleColumnVisibility=function(e){if(e!=null){e.preventDefault()}if(e!=null){e.stopPropagation()}return this.query.trigger("columnvis:toggle",this.view)};ColumnHeader.prototype.minumaximise=function(minimisedCols){var $i,css_hide,css_reveal,minimised,_ref1;_ref1=ICONS(),css_hide=_ref1.css_hide,css_reveal=_ref1.css_reveal;$i=this.$(".im-col-minumaximiser i").removeClass(css_hide+" "+css_reveal);minimised=minimisedCols[this.view];$i.addClass(minimised?css_reveal:css_hide);this.$el.toggleClass("im-minimised-th",!!minimised);return this.$(".im-col-title").toggle(!minimised)};ColumnHeader.prototype.path=function(){return this.model.get("path")};ColumnHeader.prototype.setSortOrder=function(e){var direction,formatter,replaces,_ref1,_ref2;_ref1=this.model.toJSON(),direction=_ref1.direction,replaces=_ref1.replaces;direction=(_ref2=NEXT_DIRECTION_OF[direction])!=null?_ref2:"ASC";formatter=intermine.results.getFormatter(this.path());if(replaces.length){this.showSummary(".im-col-sort",intermine.query.FormattedSorting)(e);return this.$(".im-col-sort").toggleClass("open")}else{this.$(".im-col-sort").removeClass("open");return this.query.orderBy([{path:this.view,direction:direction}])}};ColumnHeader.prototype.addExpander=function(){var expandAll;expandAll=$('<a href="#" \n   class="im-subtable-expander im-th-button"\n   title="Expand/Collapse all subtables">\n  <i class="'+intermine.icons.Table+'"></i>\n</a>');expandAll.tooltip({placement:this.bestFit});return this.$(".im-th-buttons").prepend(expandAll)};ColumnHeader.prototype.toggleSubTable=function(e){var cmd,isExpanded;ignore(e);isExpanded=this.model.get("expanded");cmd=isExpanded?"collapse":"expand";this.query.trigger(cmd+":subtables",this.model.get("path"));return this.model.set({expanded:!isExpanded})};return ColumnHeader}(Backbone.View);return scope("intermine.query.results",{ColumnHeader:ColumnHeader})})();scope("intermine.snippets.table",{NoResults:function(query){return _.template('<tr>\n  <td colspan="<%= views.length %>">\n    <div class="im-no-results alert alert-info">\n      <div <% if (revision === 0) { %> style="display:none;" <% } %> >\n        '+intermine.snippets.query.UndoButton+'\n      </div>\n      <strong>NO RESULTS</strong>\n      This query returned 0 results.\n      <div style="clear:both"></div>\n    </div>\n  </td>\n</tr>',query)},CountSummary:_.template('<span class="hidden-phone">\n<span class="im-only-widescreen">Showing</span>\n<span>\n  <% if (last == 0) { %>\n      All\n  <% } else { %>\n      <%= first %> to <%= last %> of\n  <% } %>\n  <%= count %> <span class="visible-desktop"><%= roots %></span>\n</span>\n</span>'),Pagination:'<div class="pagination pagination-right">\n  <ul>\n    <li title="Go to start">\n      <a class="im-pagination-button" data-goto=start>&#x21e4;</a>\n    </li>\n    <li title="Go back five pages" class="visible-desktop">\n      <a class="im-pagination-button" data-goto=fast-rewind>&#x219e;</a>\n    </li>\n    <li title="Go to previous page">\n      <a class="im-pagination-button" data-goto=prev>&larr;</a>\n    </li>\n    <li class="im-current-page">\n      <a data-goto=here  href="#">&hellip;</a>\n      <form class="im-page-form input-append form form-horizontal" style="display:none;">\n      <div class="control-group"></div>\n    </form>\n    </li>\n    <li title="Go to next page">\n      <a class="im-pagination-button" data-goto=next>&rarr;</a>\n    </li>\n    <li title="Go forward five pages" class="visible-desktop">\n      <a class="im-pagination-button" data-goto=fast-forward>&#x21a0;</a>\n    </li>\n    <li title="Go to last page">\n      <a class="im-pagination-button" data-goto=end>&#x21e5;</a>\n    </li>\n  </ul>\n</div>'});scope("intermine.snippets.query",{UndoButton:'<button class="btn btn-primary pull-right">\n  <i class="'+intermine.icons.Undo+'"></i> undo\n</button>'});(function(){var NUMERIC_TYPES,Page,PageSizer,ResultsTable,Table,_ref,_ref1,_ref2;NUMERIC_TYPES=["int","Integer","double","Double","float","Float"];Page=function(){function Page(start,size){this.start=start;this.size=size}Page.prototype.end=function(){return this.start+this.size};Page.prototype.all=function(){return!this.size};Page.prototype.toString=function(){return"Page("+this.start+", "+this.size+")"};return Page}();ResultsTable=function(_super){__extends(ResultsTable,_super);function ResultsTable(){this.addColumnHeaders=__bind(this.addColumnHeaders,this);this.handleError=__bind(this.handleError,this);this.appendRow=__bind(this.appendRow,this);this.readHeaderInfo=__bind(this.readHeaderInfo,this);this.appendRows=__bind(this.appendRows,this);_ref=ResultsTable.__super__.constructor.apply(this,arguments);return _ref}ResultsTable.nextDirections={ASC:"DESC",DESC:"ASC"};ResultsTable.prototype.className="im-results-table table table-striped table-bordered";ResultsTable.prototype.tagName="table";ResultsTable.prototype.attributes={width:"100%",cellpadding:0,border:0,cellspacing:0};ResultsTable.prototype.pageSize=25;ResultsTable.prototype.pageStart=0;ResultsTable.prototype.throbber=_.template('<tr class="im-table-throbber">\n  <td colspan="<%= colcount %>">\n    <h2>Requesting Data</h2>\n    <div class="progress progress-info progress-striped active">\n      <div class="bar" style="width: 100%"></div>\n    </div>\n  </td>\n</tr>');ResultsTable.prototype.initialize=function(query,getData,columnHeaders){var _ref1,_this=this;this.query=query;this.getData=getData;this.columnHeaders=columnHeaders;if((_ref1=this.columnHeaders)==null){this.columnHeaders=new Backbone.Collection}this.blacklistedFormatters=[];this.minimisedCols={};this.query.on("set:sortorder",function(oes){_this.lastAction="resort";return _this.fill()});this.query.on("columnvis:toggle",function(view){_this.minimisedCols[view]=!_this.minimisedCols[view];_this.query.trigger("change:minimisedCols",_.extend({},_this.minimisedCols));return _this.fill()});return this.query.on("formatter:blacklist",function(path,formatter){_this.blacklistedFormatters.push(formatter);return _this.fill().then(_this.addColumnHeaders)})};ResultsTable.prototype.changePageSize=function(newSize){this.pageSize=newSize;if(newSize===0){this.pageStart=0}return this.fill()};ResultsTable.prototype.render=function(){var promise;this.$el.empty();this.$el.append(document.createElement("thead"));this.$el.append(document.createElement("tbody"));promise=this.fill();return promise.done(this.addColumnHeaders)};ResultsTable.prototype.goTo=function(start){this.pageStart=parseInt(start,10);return this.fill()};ResultsTable.prototype.goToPage=function(page){this.pageStart=page*this.pageSize;return this.fill()};ResultsTable.prototype.fill=function(){var promise,_this=this;promise=this.getData(this.pageStart,this.pageSize).then(this.readHeaderInfo);promise.done(this.appendRows);promise.fail(this.handleError);promise.done(function(){return _this.query.trigger("imtable:change:page",_this.pageStart,_this.pageSize)});return promise};ResultsTable.prototype.handleEmptyTable=function(){var apology,_this=this;apology=_.template(intermine.snippets.table.NoResults(this.query));this.$el.append(apology);return this.$el.find(".btn-primary").click(function(){return _this.query.trigger("undo")})};ResultsTable.prototype.appendRows=function(res){var docfrag,row,_i,_len,_ref1;if(res.rows.length===0){this.$("tbody > tr").remove();this.handleEmptyTable()}else{docfrag=document.createDocumentFragment();_ref1=res.rows;for(_i=0,_len=_ref1.length;_i<_len;_i++){row=_ref1[_i];this.appendRow(docfrag,row)}this.$el.children("tbody").html(docfrag)}return this.query.trigger("table:filled")};ResultsTable.prototype.minimisedColumnPlaceholder=_.template('<td class="im-minimised-col" style="width:<%= width %>px">&hellip;</td>');ResultsTable.prototype.readHeaderInfo=function(res){var _ref1,_this=this;if(res!=null?(_ref1=res.results)!=null?_ref1[0]:void 0:void 0){return this.getEffectiveView(res.results[0]).then(function(){return res})}else{return res}};ResultsTable.prototype.appendRow=function(tbody,row){var cell,i,k,minWidth,minimised,processed,replacer_of,tr,v,_i,_len,_results,_this=this;tr=document.createElement("tr");tbody.appendChild(tr);minWidth=10;minimised=function(){var _ref1,_results;_ref1=this.minimisedCols;_results=[];for(k in _ref1){v=_ref1[k];if(v){_results.push(k)}}return _results}.call(this);replacer_of={};processed={};this.columnHeaders.each(function(col){var r,rs,_i,_len,_ref1,_results;_ref1=rs=col.get("replaces");_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){r=_ref1[_i];_results.push(replacer_of[r]=col)}return _results});_results=[];for(i=_i=0,_len=row.length;_i<_len;i=++_i){cell=row[i];_results.push(function(cell,i){var c,formatter,path,r,replaces,_j,_k,_len1,_len2,_ref1,_ref2,_ref3;if(processed[cell.path]){return}processed[cell.path]=true;_ref3=(_ref1=(_ref2=replacer_of[cell.path])!=null?_ref2.toJSON():void 0)!=null?_ref1:{},replaces=_ref3.replaces,formatter=_ref3.formatter,path=_ref3.path;if((replaces!=null?replaces.length:void 0)>1){if(!path.equals(cell.path.getParent())){return}if((formatter!=null?formatter.merge:void 0)!=null){for(_j=0,_len1=row.length;_j<_len1;_j++){c=row[_j];if(_.any(replaces,function(x){return x.equals(c.path)})){formatter.merge(cell.model,c.model)}}}for(_k=0,_len2=replaces.length;_k<_len2;_k++){r=replaces[_k];processed[r]=true}}if(formatter!=null){cell.formatter=formatter}if(_this.minimisedCols[cell.path]||path&&_this.minimisedCols[path]){return $(tr).append(_this.minimisedColumnPlaceholder({width:minWidth}))}else{cell.render();return tr.appendChild(cell.el)}}(cell,i))}return _results};ResultsTable.prototype.errorTempl=_.template('<div class="alert alert-error">\n    <h2>Oops!</h2>\n    <p><i><%- error %></i></p>\n</div>');ResultsTable.prototype.handleError=function(err,time){var btn,mailto,notice,p;notice=$(this.errorTempl({error:err}));if(time!=null){notice.append("<p>Time: "+time+"</p>")}notice.append("<p>\n    This is most likely related to the query that was just run. If you have\n    time, please send us an email with details of this query to help us diagnose and\n    fix this bug.\n</p>");btn=$('<button class="btn btn-error">');notice.append(btn);p=$('<p style="display:none" class="well">');btn.text("show query");p.text(this.query.toXML());btn.click(function(){return p.slideToggle()});mailto=this.query.service.help+"?"+$.param({subject:"Error running embedded table query",body:"We encountered an error running a query from an\nembedded result table.\n\npage:       "+window.location+"\nservice:    "+this.query.service.root+"\nerror:      "+err+"\ndate-stamp: "+time+"\nquery:      "+this.query.toXML()},true);mailto=mailto.replace(/\+/g,"%20");notice.append('<a class="btn btn-primary pull-right" href="mailto:'+mailto+'">\n    Email the help-desk\n</a>');notice.append(p);return this.$el.append(notice)};ResultsTable.prototype.buildColumnHeader=function(model,tr){var header;header=new intermine.query.results.ColumnHeader({model:model,query:this.query});return header.render().$el.appendTo(tr)};ResultsTable.prototype.getEffectiveView=function(row){var _this=this;return this.query.service.get("/classkeys").then(function(_arg){var cell,classKeys,classes,col,cols,commonPrefix,explicitReplacements,formatter,getReplacedTest,isKeyField,isReplaced,longestCommonPrefix,p,path,q,r,replacedBy,replaces,subPath,v,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_m,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_results;classes=_arg.classes;q=_this.query;classKeys=classes;replacedBy={};_this.columnHeaders.reset();_ref1=intermine.utils,longestCommonPrefix=_ref1.longestCommonPrefix,getReplacedTest=_ref1.getReplacedTest;cols=function(){var _i,_len,_results;_results=[];for(_i=0,_len=row.length;_i<_len;_i++){cell=row[_i];path=q.getPathInfo(cell.column);replaces=cell.view!=null?(commonPrefix=longestCommonPrefix(cell.view),path=q.getPathInfo(commonPrefix),replaces=function(){var _j,_len1,_ref2,_results1;_ref2=cell.view;_results1=[];for(_j=0,_len1=_ref2.length;_j<_len1;_j++){v=_ref2[_j];_results1.push(q.getPathInfo(v))}return _results1}()):[];_results.push({path:path,replaces:replaces})}return _results}();for(_i=0,_len=cols.length;_i<_len;_i++){col=cols[_i];if(!(col.path.isAttribute()&&intermine.results.shouldFormat(col.path))){continue}p=col.path;formatter=intermine.results.getFormatter(p);if(__indexOf.call(_this.blacklistedFormatters,formatter)<0){col.isFormatted=true;col.formatter=formatter;_ref3=(_ref2=formatter.replaces)!=null?_ref2:[];for(_j=0,_len1=_ref3.length;_j<_len1;_j++){r=_ref3[_j];subPath=""+p.getParent()+"."+r;if((_ref4=replacedBy[subPath])==null){replacedBy[subPath]=col}if(__indexOf.call(q.views,subPath)>=0){col.replaces.push(q.getPathInfo(subPath))}}}}isKeyField=function(col){var fName,pType,_ref5,_ref6;if(!col.path.isAttribute()){return false}pType=col.path.getParent().getType().name;fName=col.path.end.name;return _ref5=""+pType+"."+fName,__indexOf.call((_ref6=classKeys!=null?classKeys[pType]:void 0)!=null?_ref6:[],_ref5)>=0};explicitReplacements={};for(_k=0,_len2=cols.length;_k<_len2;_k++){col=cols[_k];_ref5=col.replaces;for(_l=0,_len3=_ref5.length;_l<_len3;_l++){r=_ref5[_l];explicitReplacements[r]=col}}isReplaced=getReplacedTest(replacedBy,explicitReplacements);_results=[];for(_m=0,_len4=cols.length;_m<_len4;_m++){col=cols[_m];if(!!isReplaced(col)){continue}if(col.isFormatted){if(_ref6=col.path,__indexOf.call(col.replaces,_ref6)<0){col.replaces.push(col.path)}if(isKeyField(col)||col.replaces.length>1){col.path=col.path.getParent()}}_results.push(_this.columnHeaders.add(col))}return _results})};ResultsTable.prototype.addColumnHeaders=function(){var docfrag,tr,_this=this;docfrag=document.createDocumentFragment();tr=document.createElement("tr");docfrag.appendChild(tr);this.columnHeaders.each(function(model){return _this.buildColumnHeader(model,tr)});return this.$el.children("thead").html(docfrag)};return ResultsTable}(Backbone.View);PageSizer=function(_super){__extends(PageSizer,_super);function PageSizer(){_ref1=PageSizer.__super__.constructor.apply(this,arguments);return _ref1}PageSizer.prototype.tagName="form";PageSizer.prototype.className="im-page-sizer form-horizontal";PageSizer.prototype.sizes=[[10],[25],[50],[100],[250]];PageSizer.prototype.initialize=function(query,pageSize){var _this=this;this.query=query;this.pageSize=pageSize;if(this.pageSize!=null){if(!_.include(this.sizes.map(function(s){return s[0]}),this.pageSize)){this.sizes.unshift([this.pageSize,this.pageSize])}}else{this.pageSize=this.sizes[0][0]}return this.query.on("page-size:revert",function(size){return _this.$("select").val(size)})};PageSizer.prototype.events={"change select":"changePageSize"};PageSizer.prototype.changePageSize=function(evt){return this.query.trigger("page-size:selected",parseInt($(evt.target).val(),10))};PageSizer.prototype.render=function(){var ps,select,_i,_len,_ref2;this.$el.append('<label>\n    <span class="im-only-widescreen">Rows per page:</span>\n    <select class="span" title="Rows per page">\n    </select>\n</label>');select=this.$("select");_ref2=this.sizes;for(_i=0,_len=_ref2.length;_i<_len;_i++){ps=_ref2[_i];select.append(this.make("option",{value:ps[0],selected:ps[0]===this.pageSize},ps[1]||ps[0]))}return this};return PageSizer}(Backbone.View);Table=function(_super){var badJson,errorIntro,genericExplanation;__extends(Table,_super);function Table(){this.updatePageDisplay=__bind(this.updatePageDisplay,this);this.removeOverlay=__bind(this.removeOverlay,this);this.overlayTable=__bind(this.overlayTable,this);this.getRowData=__bind(this.getRowData,this);this.showError=__bind(this.showError,this);this.handlePageSizeSelection=__bind(this.handlePageSizeSelection,this);this.refresh=__bind(this.refresh,this);this.onDraw=__bind(this.onDraw,this);_ref2=Table.__super__.constructor.apply(this,arguments);return _ref2}Table.prototype.className="im-table-container";Table.prototype.events={"submit .im-page-form":"pageFormSubmit","click .im-pagination-button":"pageButtonClick"};Table.prototype.onDraw=function(){if(this.__selecting){this.query.trigger("start:list-creation")}return this.drawn=true};Table.prototype.refresh=function(){var _ref3;this.query.__changed=(this.query.__changed||0)+1;if((_ref3=this.table)!=null){_ref3.remove()}this.drawn=false;return this.render()};Table.prototype.remove=function(){var _ref3;if((_ref3=this.table)!=null){_ref3.remove()}return Table.__super__.remove.call(this)};Table.prototype.initialize=function(query,selector,columnHeaders){var _this=this;this.query=query;this.columnHeaders=columnHeaders;this.cache={};this.itemModels={};this._pipe_factor=10;this.$parent=jQuery(selector);this.__selecting=false;this.visibleViews=this.query.views.slice();this.query.on("start:list-creation",function(){return _this.__selecting=true});this.query.on("stop:list-creation",function(){return _this.__selecting=false});this.query.on("table:filled",this.onDraw);this.query.on("page:forwards",function(){return _this.goForward(1)});this.query.on("page:backwards",function(){return _this.goBack(1)});this.query.on("page-size:selected",this.handlePageSizeSelection);this.query.on("add-filter-dialogue:please",function(){var dialogue;dialogue=new intermine.filters.NewFilterDialogue(_this.query);_this.$el.append(dialogue.el);return dialogue.render().openDialogue()});return this.query.on("download-menu:open",function(){var dialogue;dialogue=new intermine.query["export"].ExportDialogue(_this.query);_this.$el.append(dialogue.render().el);return dialogue.show()})};Table.prototype.pageSizeFeasibilityThreshold=250;Table.prototype.aboveSizeThreshold=function(size){var total;if(size>=this.pageSizeFeasibilityThreshold){return true}if(size===0){total=this.cache.lastResult.iTotalRecords;return total>=this.pageSizeFeasibilityThreshold}return false};Table.prototype.handlePageSizeSelection=function(size){var $really,_this=this;if(this.aboveSizeThreshold(size)){$really=$(intermine.snippets.table.LargeTableDisuader);$really.find(".btn-primary").click(function(){return _this.table.changePageSize(size)});$really.find(".btn").click(function(){return $really.modal("hide")});$really.find(".im-alternative-action").click(function(e){if($(e.target).data("event")){_this.query.trigger($(e.target).data("event"))}return _this.query.trigger("page-size:revert",_this.table.pageSize)});$really.on("hidden",function(){return $really.remove()});return $really.appendTo(this.el).modal().modal("show")}else{return this.table.changePageSize(size)}};Table.prototype.adjustSortOrder=function(params){var i,noOfSortColumns,viewIndices;viewIndices=function(){var _i,_ref3,_results;_results=[];for(i=_i=0,_ref3=intermine.utils.getParameter(params,"iColumns");0<=_ref3?_i<=_ref3:_i>=_ref3;i=0<=_ref3?++_i:--_i){_results.push(intermine.utils.getParameter(params,"mDataProp_"+i))}return _results}();noOfSortColumns=intermine.utils.getParameter(params,"iSortingCols");if(noOfSortColumns){return this.query.orderBy(function(){var _i,_results,_this=this;_results=[];for(i=_i=0;0<=noOfSortColumns?_i<noOfSortColumns:_i>noOfSortColumns;i=0<=noOfSortColumns?++_i:--_i){_results.push(function(i){var displayed,so;displayed=intermine.utils.getParameter(params,"iSortCol_"+i);so={path:_this.query.views[viewIndices[displayed]],direction:intermine.utils.getParameter(params,"sSortDir_"+i)};return so}(i))}return _results}.call(this))}};Table.prototype.showError=function(resp){var data,err,_ref3,_ref4;try{data=JSON.parse(resp.responseText);return(_ref3=this.table)!=null?_ref3.handleError(data.error,data.executionTime):void 0}catch(_error){err=_error;return(_ref4=this.table)!=null?_ref4.handleError("Internal error",(new Date).toString()):void 0}};Table.prototype.getRowData=function(start,size){var end,freshness,isOutOfRange,isStale,page,promise,req,_this=this;end=start+size;isOutOfRange=false;freshness=this.query.getSorting()+this.query.getConstraintXML()+this.query.views.join();isStale=freshness!==this.cache.freshness;if(isStale){this.cache={}}else{isOutOfRange=this.cache.lowerBound<0||start<this.cache.lowerBound||end>this.cache.upperBound||size<=0}promise=new jQuery.Deferred;if(isStale||isOutOfRange){page=this.getPage(start,size);this.overlayTable();req=this.query[this.fetchMethod]({start:page.start,size:page.size});req.fail(this.showError);req.done(function(rows,rs){_this.addRowsToCache(page,rs);_this.cache.freshness=freshness;return promise.resolve(_this.serveResultsFromCache(start,size))});req.always(this.removeOverlay)}else{promise.resolve(this.serveResultsFromCache(start,size))}return promise};Table.prototype.overlayTable=function(){var elOffset,tableOffset,_this=this;if(!(this.table&&this.drawn)){return}elOffset=this.$el.offset();tableOffset=this.table.$el.offset();jQuery(".im-table-overlay").remove();this.overlay=jQuery(this.make("div",{"class":"im-table-overlay discrete "+intermine.options.StylePrefix}));this.overlay.css({top:elOffset.top,left:elOffset.left,width:this.table.$el.outerWidth(true),height:tableOffset.top-elOffset.top+this.table.$el.outerHeight()});this.overlay.append(this.make("h1",{},"Requesting data..."));this.overlay.find("h1").css({top:this.table.$el.height()/2+"px",left:this.table.$el.width()/4+"px"});this.overlay.appendTo("body");return _.delay(function(){return _this.overlay.removeClass("discrete")},100)};Table.prototype.removeOverlay=function(){var _ref3;return(_ref3=this.overlay)!=null?_ref3.remove():void 0};Table.prototype.getPage=function(start,size){var page;page=new Page(start,size);if(!this.cache.lastResult){page.size*=this._pipe_factor;return page}if(start<this.cache.lowerBound){page.start=Math.max(0,start-size*this._pipe_factor)}if(size>0){page.size*=this._pipe_factor}else{page.size=""}if(page.size&&page.end()<this.cache.lowerBound){if(this.cache.lowerBound-page.end()>page.size*10){this.cache={};page.size*=2;return page}else{page.size=this.cache.lowerBound-page.start}}if(this.cache.upperBound<page.start){if(page.start-this.cache.upperBound>page.size*10){this.cache={};page.size*=2;page.start=Math.max(0,page.start-size*this._pipe_factor);return page}if(page.size){page.size+=page.start-this.cache.upperBound}page.start=this.cache.upperBound}return page};Table.prototype.addRowsToCache=function(page,result){var merged,rows;if(!this.cache.lastResult){this.cache.lastResult=result;this.cache.lowerBound=result.start;return this.cache.upperBound=page.end()}else{rows=result.results;merged=this.cache.lastResult.results.slice();if(page.start<this.cache.lowerBound){merged=rows.concat(merged.slice(page.end()-this.cache.lowerBound))}if(this.cache.upperBound<page.end()||page.all()){merged=merged.slice(0,page.start-this.cache.lowerBound).concat(rows)}this.cache.lowerBound=Math.min(this.cache.lowerBound,page.start);this.cache.upperBound=this.cache.lowerBound+merged.length;return this.cache.lastResult.results=merged}};Table.prototype.updateSummary=function(start,size,result){var html,summary;summary=this.$(".im-table-summary");html=intermine.snippets.table.CountSummary({first:start+1,last:size===0?0:Math.min(start+size,result.iTotalRecords),count:intermine.utils.numToString(result.iTotalRecords,",",3),roots:"rows"});summary.html(html);return this.query.trigger("count:is",result.iTotalRecords)};Table.prototype.serveResultsFromCache=function(start,size){var base,fields,makeCell,result,v,_this=this;base=this.query.service.root.replace(/\/service\/?$/,"");result=jQuery.extend(true,{},this.cache.lastResult);result.results.splice(0,start-this.cache.lowerBound);if(size>0){result.results.splice(size,result.results.length)}this.updateSummary(start,size,result);fields=function(){var _i,_len,_ref3,_results;_ref3=result.views;_results=[];for(_i=0,_len=_ref3.length;_i<_len;_i++){v=_ref3[_i];_results.push([this.query.getPathInfo(v).getParent(),v.replace(/^.*\./,"")])}return _results}.call(this);makeCell=function(obj){var args,field,model,node,type,_base,_name,_ref3,_ref4;if(_.has(obj,"rows")){node=_this.query.getPathInfo(obj.column);return new intermine.results.table.SubTable({query:_this.query,cellify:makeCell,blacklistedFormatters:(_ref3=(_ref4=_this.table)!=null?_ref4.blacklistedFormatters:void 0)!=null?_ref3:[],mainTable:_this,subtable:obj,node:node})}else{node=_this.query.getPathInfo(obj.column).getParent();field=obj.column.replace(/^.*\./,"");model=obj.id!=null?(_base=_this.itemModels)[_name=obj.id]||(_base[_name]=new intermine.model.IMObject(obj,_this.query,field,base)):obj["class"]==null?(type=node.getParent().name,new intermine.model.NullObject({},{query:_this.query,field:field,type:type})):new intermine.model.FPObject({},{query:_this.query,obj:obj,field:field});
model.merge(obj,field);args={model:model,node:node,field:field};args.query=_this.query;return new intermine.results.table.Cell(args)}};result.rows=result.results.map(function(row){return row.map(function(cell,idx){var field,imo,_base,_name;if(_.has(cell,"column")){return makeCell(cell)}else if((cell!=null?cell.id:void 0)!=null){field=fields[idx];imo=(_base=_this.itemModels)[_name=cell.id]||(_base[_name]=new intermine.model.IMObject(cell,_this.query,field[1],base));imo.merge(cell,field[1]);return new intermine.results.table.Cell({model:imo,node:field[0],field:field[1],query:_this.query})}else if((cell!=null?cell.value:void 0)!=null){return new intermine.results.table.Cell({model:new intermine.model.FPObject(_this.query,cell,field[1]),query:_this.query,field:field[1]})}else{return new intermine.results.table.NullCell({query:_this.query})}})});return result};Table.prototype.tableAttrs={"class":"table table-striped table-bordered",width:"100%",cellpadding:0,border:0,cellspacing:0};Table.prototype.render=function(){var tel;this.$el.empty();tel=this.make("table",this.tableAttrs);this.$el.append(tel);jQuery(tel).append('<h2>Building table</h2>\n<div class="progress progress-striped active progress-info">\n    <div class="bar" style="width: 100%"></div>\n</div>');return this.query.service.fetchVersion(this.doRender(tel)).fail(this.onSetupError(tel))};Table.prototype.doRender=function(tel){var _this=this;return function(version){var path,setupParams;_this.fetchMethod=version>=10?"tableRows":"table";path="query/results";setupParams={format:"jsontable",query:_this.query.toXML(),token:_this.query.service.token};_this.$el.appendTo(_this.$parent);_this.query.service.post(path,setupParams).then(_this.onSetupSuccess(tel),_this.onSetupError(tel));return _this}};Table.prototype.horizontalScroller='<div class="scroll-bar-wrap well">\n    <div class="scroll-bar-containment">\n        <div class="scroll-bar alert-info alert"></div>\n    </div>\n</div>';Table.prototype.placePagination=function($widgets){var $pagination,currentPageButton,_this=this;$pagination=$(intermine.snippets.table.Pagination).appendTo($widgets);$pagination.find("li").tooltip({placement:"top"});return currentPageButton=$pagination.find(".im-current-page a").click(function(){var total;total=_this.cache.lastResult.iTotalRecords;if(_this.table.pageSize>=total){return false}currentPageButton.hide();return $pagination.find("form").show()})};Table.prototype.placePageSizer=function($widgets){var pageSizer;pageSizer=new PageSizer(this.query,this.pageSize);return pageSizer.render().$el.appendTo($widgets)};Table.prototype.placeScrollBar=function($widgets){var $scrollwrapper,currentPos,scrollbar,_this=this;if(this.bar==="horizontal"){$scrollwrapper=$(this.horizontalScroller).appendTo($widgets);scrollbar=this.$(".scroll-bar");currentPos=0;scrollbar.draggable({axis:"x",containment:"parent",stop:function(event,ui){scrollbar.removeClass("scrolling");scrollbar.tooltip("hide");return _this.table.goTo(currentPos)},start:function(){return $(this).addClass("scrolling")},drag:function(event,ui){var left,total;scrollbar.tooltip("show");left=ui.position.left;total=ui.helper.closest(".scroll-bar-wrap").width();return currentPos=_this.cache.lastResult.iTotalRecords*left/total}});scrollbar.css({position:"absolute"}).parent().css({position:"relative"});return scrollbar.tooltip({trigger:"manual",title:function(){return""+(currentPos+1).toFixed()+" ... "+(currentPos+_this.table.pageSize).toFixed()}})}};Table.prototype.placeTableSummary=function($widgets){return $widgets.append('<span class="im-table-summary"></div>')};Table.prototype.onSetupSuccess=function(telem){var _this=this;return function(result){var $telem,$widgets,component,method,_i,_len,_ref3;$telem=jQuery(telem).empty();$widgets=$("<div>").insertBefore(telem);_this.table=new ResultsTable(_this.query,_this.getRowData,_this.columnHeaders);_this.table.setElement(telem);if(_this.pageSize!=null){_this.table.pageSize=_this.pageSize}if(_this.pageStart!=null){_this.table.pageStart=_this.pageStart}_this.table.render();_this.query.on("imtable:change:page",_this.updatePageDisplay);_ref3=intermine.options.TableWidgets;for(_i=0,_len=_ref3.length;_i<_len;_i++){component=_ref3[_i];if(!("place"+component in _this)){continue}method="place"+component;_this[method]($widgets)}return $widgets.append('<div style="clear:both"></div>')}};Table.prototype.getCurrentPageSize=function(){var _ref3,_ref4;return(_ref3=(_ref4=this.table)!=null?_ref4.pageSize:void 0)!=null?_ref3:this.pageSize};Table.prototype.getCurrentPage=function(){if(this.table.pageSize){return Math.floor(this.table.pageStart/this.table.pageSize)}else{return 0}};Table.prototype.getMaxPage=function(){var correction,pageSize,total;total=this.cache.lastResult.iTotalRecords;pageSize=this.table.pageSize;correction=total%pageSize===0?-1:0;return Math.floor(total/pageSize)+correction};Table.prototype.goBack=function(pages){return this.table.goTo(Math.max(0,this.table.pageStart-pages*this.table.pageSize))};Table.prototype.goForward=function(pages){return this.table.goTo(Math.min(this.getMaxPage()*this.table.pageSize,this.table.pageStart+pages*this.table.pageSize))};Table.prototype.pageButtonClick=function(e){var $elem;$elem=$(e.target);if(!$elem.parent().is(".active")){switch($elem.data("goto")){case"start":return this.table.goTo(0);case"prev":return this.goBack(1);case"fast-rewind":return this.goBack(5);case"next":return this.goForward(1);case"fast-forward":return this.goForward(5);case"end":return this.table.goTo(this.getMaxPage()*this.table.pageSize)}}};Table.prototype.updatePageDisplay=function(start,size){var buttons,centre,cg,handle,maxPage,overhang,p,pageForm,pageSelector,proportion,scaled,scrollbar,tbl,total,totalWidth,unit,_i,_ref3,_results;total=this.cache.lastResult.iTotalRecords;if(size===0){size=total}scrollbar=this.$(".scroll-bar-wrap");if(scrollbar.length){totalWidth=scrollbar.width();proportion=size/total;scrollbar.toggle(size<total);unit=totalWidth/total;scaled=Math.max(totalWidth*proportion,20);overhang=size-(total-size*Math.floor(total/size))%size;scrollbar.find(".scroll-bar-containment").css({width:totalWidth+unit*overhang});handle=scrollbar.find(".scroll-bar").css({width:scaled});handle.animate({left:unit*start})}tbl=this.table;buttons=this.$(".im-pagination-button");buttons.each(function(){var $elem,isActive,li;$elem=$(this);li=$elem.parent();isActive=function(){switch($elem.data("goto")){case"start":case"prev":return start===0;case"fast-rewind":return start===0;case"next":case"end":return start+size>=total;case"fast-forward":return start+5*size>=total}}();return li.toggleClass("active",isActive)});centre=this.$(".im-current-page");centre.find("a").text("p. "+(this.getCurrentPage()+1));centre.toggleClass("active",size>=total);pageForm=centre.find("form");cg=pageForm.find(".control-group").empty().removeClass("error");maxPage=this.getMaxPage();if(maxPage<=100){pageSelector=$("<select>").appendTo(cg);pageSelector.val(this.getCurrentPage());pageSelector.change(function(e){e.stopPropagation();e.preventDefault();tbl.goToPage(parseInt(pageSelector.val()));centre.find("a").show();return pageForm.hide()});_results=[];for(p=_i=1,_ref3=maxPage+1;1<=_ref3?_i<=_ref3:_i>=_ref3;p=1<=_ref3?++_i:--_i){_results.push(pageSelector.append('<option value="'+(p-1)+'">p. '+p+"</option>"))}return _results}else{cg.append('<input type=text placeholder="go to page...">');return cg.append('<button class="btn" type="submit">go</button>')}};Table.prototype.pageFormSubmit=function(e){var centre,destination,inp,newSelectorVal,pageForm;e.stopPropagation();e.preventDefault();pageForm=this.$(".im-page-form");centre=this.$(".im-current-page");inp=pageForm.find("input");if(inp.size()){destination=inp.val().replace(/\s*/g,"")}if(destination.match(/^\d+$/)){newSelectorVal=Math.min(this.getMaxPage(),Math.max(parseInt(destination)-1,0));this.table.goToPage(newSelectorVal);centre.find("a").show();return pageForm.hide()}else{pageForm.find(".control-group").addClass("error");inp.val("");return inp.attr({placeholder:"1 .. "+(this.getMaxPage()+1)})}};errorIntro="Could not load the data-table.";genericExplanation="The server may be down, or \nincorrectly configured, or \nwe could be pointed at an invalid URL.";badJson="What we do know is that the server did not return a valid JSON response.";Table.prototype.onSetupError=function(telem){var _this=this;return function(resp){var content,e,issue,notice,reasonStr,reasons,text;$(telem).empty();console.error("SETUP FAILURE",arguments);notice=_this.make("div",{"class":"alert alert-error"});reasonStr=function(){if(text=resp!=null?resp.responseText:void 0){try{return(typeof JSON!=="undefined"&&JSON!==null?JSON.parse(text).error:void 0)||genericExplanation}catch(_error){e=_error;console.error(text);return genericExplanation+"\n"+badJson}}else if(resp!=null){return String(resp)}else{return genericExplanation}}();reasons=reasonStr.split("\n");content=[_this.make("span",{},errorIntro)];if(reasons.length){content.push(_this.make("ul",{},function(){var _i,_len,_results;_results=[];for(_i=0,_len=reasons.length;_i<_len;_i++){issue=reasons[_i];_results.push(this.make("li",{},issue))}return _results}.call(_this)))}return $(notice).append(_this.make("a",{"class":"close","data-dismiss":"alert"},"close")).append(_this.make("strong",{},"Ooops...! ")).append(content).appendTo(telem)}};return Table}(Backbone.View);return scope("intermine.query.results",{Table:Table})})();(function(){var PANE_HTML,Step,TAB_HTML,ToolBar,Tools,Trail,curry,_ref,_ref1,_ref2,_ref3;curry=intermine.funcutils.curry;TAB_HTML=_.template('<li>\n    <a href="#<%= ref %>" data-toggle="tab">\n        <%= title %>\n    </a>\n</li>');PANE_HTML=_.template('<div class="tab-pane" id="<%= ref %>"></div>');Tools=function(_super){__extends(Tools,_super);function Tools(){_ref=Tools.__super__.constructor.apply(this,arguments);return _ref}Tools.prototype.className="im-query-tools";Tools.prototype.initialize=function(states){this.states=states};Tools.prototype.render=function(){var $pane,actions,c,columns,conf,content,filters,tabs,view,_i,_j,_len,_len1;tabs=this.make("ul",{"class":"nav nav-tabs"});conf=[filters={title:"Filters",ref:"filters",view:intermine.query.filters.Filters},columns={title:"Columns",ref:"columns",view:intermine.query.columns.Columns},actions={title:"Actions",ref:"actions",view:intermine.query.actions.Actions}];for(_i=0,_len=conf.length;_i<_len;_i++){c=conf[_i];$(tabs).append(TAB_HTML(c))}this.$el.append(tabs);content=this.make("div",{"class":"tab-content"});for(_j=0,_len1=conf.length;_j<_len1;_j++){c=conf[_j];$pane=$(PANE_HTML(c)).appendTo(content);view=new c.view(this.query);$pane.append(view.render().el)}$(content).find(".tab-pane").first().addClass("active");$(tabs).find("a").first().tab("show");this.$el.append(content);return this};return Tools}(Backbone.View);ToolBar=function(_super){__extends(ToolBar,_super);function ToolBar(){_ref1=ToolBar.__super__.constructor.apply(this,arguments);return _ref1}ToolBar.prototype.className="im-query-actionbar";ToolBar.prototype.initialize=function(states){this.states=states};ToolBar.prototype.render=function(){var actions,e;actions=new intermine.query.actions.ActionBar(this.states);try{actions.render().$el.appendTo(this.el)}catch(_error){e=_error;console.error("Failed to set up toolbar because: "+e.message,e.stack)}return this};return ToolBar}(Backbone.View);Step=function(_super){var cell,nts,toInfoLabel,toLabel,toPathLabel,toValLabel;__extends(Step,_super);function Step(){_ref2=Step.__super__.constructor.apply(this,arguments);return _ref2}Step.prototype.className="im-step";Step.prototype.tagName="li";nts=function(n){return intermine.utils.numToString(n,",",3)};Step.prototype.initialize=function(opts){var _this=this;Step.__super__.initialize.call(this,opts);this.model.on("change:count",function(m,count){return _this.$(".im-step-count .count").text(nts(count))});this.model.on("change:current",this.renderCurrency,this);return this.model.on("remove",function(){return _this.remove()})};Step.prototype.events={"click .icon-info-sign":"showDetails","click h4":"toggleSection","click .btn":"revertToThisState"};Step.prototype.toggleSection=function(e){e.stopPropagation();$(e.target).find("i").toggleClass("icon-chevron-right icon-chevron-down");return $(e.target).next().children().toggle()};Step.prototype.showDetails=function(e){e.stopPropagation();return this.$(".im-step-details").toggle()};Step.prototype.revertToThisState=function(e){this.model.trigger("revert",this.model);return this.$(".btn-small").tooltip("hide")};Step.prototype.renderCurrency=function(){var isCurrent;isCurrent=this.model.get("current");this.$(".btn").toggleClass("btn-inverse",!isCurrent).attr({disabled:isCurrent});this.$(".btn-main").text(isCurrent?"Current State":"Revert to this State");return this.$(".btn i").toggleClass("icon-white",!isCurrent)};Step.prototype.sectionTempl=_.template('<div>\n  <h4>\n    <i class="icon-chevron-right"></i>\n    <%= n %> <%= things %>\n  </h4>\n  <table></table>\n</div>');cell=function(content){return $("<td>").html(content)};toLabel=function(type){return function(text){return cell('<span class="label label-'+type+'">'+text+"</span>")}};toPathLabel=toLabel("path");toInfoLabel=toLabel("info");toValLabel=toLabel("value");Step.prototype.template=_.template('<button class="btn btn-small im-state-revert" disabled\n    title="Revert to this state">\n    <i class="'+intermine.icons.Undo+'"></i>\n</button>\n<h3><%- title %></h3>\n<i class="icon-info-sign"></i>\n</div>\n<span class="im-step-count">\n    <span class="count"><%- count %></span> rows\n</span>\n<div class="im-step-details">\n<div style="clear:both"></div>');Step.prototype.addSection=function(xs,things,toPath,f){var k,n,q,table,v,_results;n=_.size(xs);if(n<1){return}q=this.model.get("query");table=$(this.sectionTempl({n:n,things:things})).appendTo(this.$(".im-step-details")).find("table");_results=[];for(k in xs){if(!__hasProp.call(xs,k))continue;v=xs[k];_results.push(function(k,v){var row;row=$("<tr>");table.append(row);return q.getPathInfo(toPath(k,v)).getDisplayName(function(name){return f(row,name,k,v)})}(k,v))}return _results};Step.prototype.getData=function(){var data;data={count:this.model.has("count")?nts(this.model.get("count")):""};return _.defaults(data,this.model.toJSON())};Step.prototype.render=function(){var ps,q,v;this.$el.attr({step:this.model.get("stepNo")});this.$el.append(this.template(this.getData()));this.renderCurrency();q=this.model.get("query");this.$(".btn-small").tooltip({placement:"right"});ps=function(){var _i,_len,_ref3,_results;_ref3=q.views;_results=[];for(_i=0,_len=_ref3.length;_i<_len;_i++){v=_ref3[_i];_results.push(q.getPathInfo(v))}return _results}();this.addSection(ps,"Columns",function(i,x){return x},function(row,name){return row.append(toPathLabel(name))});this.addSection(q.constraints,"Filters",function(i,c){return c.path},function(row,name,i,c){row.append(toPathLabel(name));if(c.type!=null){row.append(toInfoLabel("isa"));row.append(toValLabel(c.type))}if(c.op!=null){row.append(toInfoLabel(c.op))}if(c.value!=null){return row.append(toValLabel(c.value))}else if(c.values!=null){return row.append(toValLabel(c.values.join(", ")))}});this.addSection(q.joins,"Joins",function(p,style){return p},function(row,name,p,style){row.append(toPathLabel(name));return row.append(toInfoLabel(style))});this.addSection(q.sortOrder,"Sort Order Elements",function(i,so){return so.path},function(row,name,i,_arg){var direction;direction=_arg.direction;row.append(toPathLabel(name));return row.append(toInfoLabel(direction))});return this};return Step}(Backbone.View);Trail=function(_super){__extends(Trail,_super);function Trail(){_ref3=Trail.__super__.constructor.apply(this,arguments);return _ref3}Trail.prototype.className="im-query-trail";Trail.prototype.tagName="div";Trail.prototype.initialize=function(states){this.states=states;this.subViews=[];this.states.on("add",this.appendState,this);return this.states.on("reverted",this.render,this)};Trail.prototype.events={"click a.details":"minumaximise","click a.shade":"toggle","click a.im-undo":"undo"};Trail.prototype.toggle=function(){var _this=this;return this.$(".im-step").slideToggle("fast",function(){return _this.$el.toggleClass("toggled")})};Trail.prototype.minumaximise=function(){return this.$el.toggleClass("minimised")};Trail.prototype.undo=function(){return this.states.popState()};Trail.prototype.appendState=function(state){var step;step=new Step({model:state});this.subViews.push(step);this.$(".im-state-list").append(step.render().el);return this.$el.addClass("im-has-history")};Trail.prototype.render=function(){var step,_this=this;while(step=this.subViews.pop()){step.remove()}this.$el.html('<div class="btn-group">\n  <a class="btn im-undo">\n    <i class="'+intermine.icons.Undo+'"></i>\n    <span class="visible-desktop">Undo</span>\n  </a>\n  <a class="btn dropdown-toggle" data-toggle="dropdown">\n    <span class="caret"></span>\n  </a>\n  <ul class="dropdown-menu im-state-list">\n  </ul>\n</div>\n<div style="clear:both"></div>');this.states.each(function(s){return _this.appendState(s)});this.$el.toggleClass("im-has-history",this.states.size()>1);return this};return Trail}(Backbone.View);return scope("intermine.query.tools",{Tools:Tools,ToolBar:ToolBar,Trail:Trail})})();(function(){var ViewElement,_ref;ViewElement=function(_super){var TEMPLATE,namePart,splitName;__extends(ViewElement,_super);function ViewElement(){_ref=ViewElement.__super__.constructor.apply(this,arguments);return _ref}TEMPLATE=_.template('<div>\n  <a class="im-col-remover" title="Remove this column">\n    <i class="'+intermine.icons.Remove+'"></i>\n  </a>\n  <i class="icon-reorder pull-right"></i>\n  <% if (replaces.length) { %>\n    <i class="'+intermine.icons.Collapsed+' im-expander pull-right"></i>\n  <% } %>\n  <span class="im-display-name"><%- path %></span>\n  <ul class="im-sub-views"></ul>\n</div>');ViewElement.prototype.placement="top";ViewElement.prototype.tagName="li";ViewElement.prototype.className="im-view-element im-reorderable";ViewElement.prototype.events={"click .im-col-remover":"remove",click:"toggleSubViews"};ViewElement.prototype.toggleSubViews=function(){this.$(".im-sub-views").slideToggle();return this.$(".im-expander").toggleClass(intermine.icons.ExpandCollapse)};ViewElement.prototype.remove=function(){this.model.destroy();this.$(".im-col-remover").tooltip("hide");return ViewElement.__super__.remove.apply(this,arguments)};namePart=_.template('<span class="im-name-part"><%- part %></span>');splitName=function($elem){return function(name){var part,parts,_i,_len,_results;parts=name.split(" > ");_results=[];for(_i=0,_len=parts.length;_i<_len;_i++){part=parts[_i];_results.push($elem.append(namePart({part:part})))}return _results}};ViewElement.prototype.render=function(){var $name,path,replaced,ul,_i,_len,_ref1;path=this.model.get("path");this.model.el=this.el;this.$el.append(TEMPLATE(this.model.toJSON()));this.$(".im-col-remover").tooltip({placement:this.placement,container:this.el});$name=this.$(".im-display-name").empty();path.getDisplayName(splitName($name));ul=this.$(".im-sub-views");_ref1=this.model.get("replaces");for(_i=0,_len=_ref1.length;_i<_len;_i++){replaced=_ref1[_i];if(replaced.isAttribute()){(function(ul){var li,span;li=$("<li></li>");ul.append(li);span=document.createElement("span");li.append(span);span.className="im-display-name";return replaced.getDisplayName(splitName($(span)))})(ul)}}if(!ul.children().length){ul.remove()}return this};return ViewElement}(Backbone.View);return scope("intermine.columns.views",{ViewElement:ViewElement})})();end_of_definitions()}).call(this)}).call(context);window.intermine=context._.extend(window.intermine||{},context.intermine)}).call(window);